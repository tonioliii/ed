!function(){function e(e){return e&&e.__esModule?e.default:e}function t(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function r(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function a(e,t){return a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},a(e,t)}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}function l(e,n){return!n||"object"!=((i=n)&&i.constructor===Symbol?"symbol":typeof i)&&"function"!=typeof n?t(e):n;var i}var d;function u(e){return Array.isArray(e)||"[object Object]"=={}.toString.call(e)}function c(e){return!e||"object"!=typeof e&&"function"!=typeof e}d=function e(){var t=[].slice.call(arguments),n=!1;"boolean"==typeof t[0]&&(n=t.shift());var i=t[0];if(c(i))throw new Error("extendee must be an object");for(var r=t.slice(1),o=r.length,a=0;a<o;a++){var s=r[a];for(var l in s)if(Object.prototype.hasOwnProperty.call(s,l)){var d=s[l];if(n&&u(d)){var h=Array.isArray(d)?[]:{};i[l]=e(!0,Object.prototype.hasOwnProperty.call(i,l)&&!c(i[l])?i[l]:h,d)}else i[l]=d}}return i};var h=function(){"use strict";function e(){n(this,e)}return r(e,[{key:"on",value:function(e,t){return this._callbacks=this._callbacks||{},this._callbacks[e]||(this._callbacks[e]=[]),this._callbacks[e].push(t),this}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this._callbacks=this._callbacks||{};var r=this._callbacks[e],o=!0,a=!1,s=void 0;if(r)try{for(var l,d=r[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var u=l.value;u.apply(this,n)}}catch(e){a=!0,s=e}finally{try{o||null==d.return||d.return()}finally{if(a)throw s}}return this.element&&this.element.dispatchEvent(this.makeEvent("dropzone:"+e,{args:n})),this}},{key:"makeEvent",value:function(e,t){var n={bubbles:!0,cancelable:!0,detail:t};if("function"==typeof window.CustomEvent)return new CustomEvent(e,n);var i=document.createEvent("CustomEvent");return i.initCustomEvent(e,n.bubbles,n.cancelable,n.detail),i}},{key:"off",value:function(e,t){if(!this._callbacks||0===arguments.length)return this._callbacks={},this;var n=this._callbacks[e];if(!n)return this;if(1===arguments.length)return delete this._callbacks[e],this;for(var i=0;i<n.length;i++){var r=n[i];if(r===t){n.splice(i,1);break}}return this}}]),e}(),f={url:null,method:"post",withCredentials:!1,timeout:null,parallelUploads:2,uploadMultiple:!1,chunking:!1,forceChunking:!1,chunkSize:2097152,parallelChunkUploads:!1,retryChunks:!1,retryChunksLimit:3,maxFilesize:256,paramName:"file",createImageThumbnails:!0,maxThumbnailFilesize:10,thumbnailWidth:120,thumbnailHeight:120,thumbnailMethod:"crop",resizeWidth:null,resizeHeight:null,resizeMimeType:null,resizeQuality:.8,resizeMethod:"contain",filesizeBase:1e3,maxFiles:null,headers:null,defaultHeaders:!0,clickable:!0,ignoreHiddenFiles:!0,acceptedFiles:null,acceptedMimeTypes:null,autoProcessQueue:!0,autoQueue:!0,addRemoveLinks:!1,previewsContainer:null,disablePreviews:!1,hiddenInputContainer:"body",capture:null,renameFilename:null,renameFile:null,forceFallback:!1,dictDefaultMessage:"Drop files here to upload",dictFallbackMessage:"Your browser does not support drag'n'drop file uploads.",dictFallbackText:"Please use the fallback form below to upload your files like in the olden days.",dictFileTooBig:"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictInvalidFileType:"You can't upload files of this type.",dictResponseError:"Server responded with {{statusCode}} code.",dictCancelUpload:"Cancel upload",dictUploadCanceled:"Upload canceled.",dictCancelUploadConfirmation:"Are you sure you want to cancel this upload?",dictRemoveFile:"Remove file",dictRemoveFileConfirmation:null,dictMaxFilesExceeded:"You can not upload any more files.",dictFileSizeUnits:{tb:"TB",gb:"GB",mb:"MB",kb:"KB",b:"b"},init:function(){},params:function(e,t,n){if(n)return{dzuuid:n.file.upload.uuid,dzchunkindex:n.index,dztotalfilesize:n.file.size,dzchunksize:this.options.chunkSize,dztotalchunkcount:n.file.upload.totalChunkCount,dzchunkbyteoffset:n.index*this.options.chunkSize}},accept:function(e,t){return t()},chunksUploaded:function(e,t){t()},binaryBody:!1,fallback:function(){var e;this.element.className="".concat(this.element.className," dz-browser-not-supported");var t=!0,n=!1,i=void 0;try{for(var r,o=this.element.getElementsByTagName("div")[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;if(/(^| )dz-message($| )/.test(a.className)){e=a,a.className="dz-message";break}}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}e||(e=p.createElement('<div class="dz-message"><span></span></div>'),this.element.appendChild(e));var s=e.getElementsByTagName("span")[0];return s&&(null!=s.textContent?s.textContent=this.options.dictFallbackMessage:null!=s.innerText&&(s.innerText=this.options.dictFallbackMessage)),this.element.appendChild(this.getFallbackForm())},resize:function(e,t,n,i){var r={srcX:0,srcY:0,srcWidth:e.width,srcHeight:e.height},o=e.width/e.height;null==t&&null==n?(t=r.srcWidth,n=r.srcHeight):null==t?t=n*o:null==n&&(n=t/o);var a=(t=Math.min(t,r.srcWidth))/(n=Math.min(n,r.srcHeight));if(r.srcWidth>t||r.srcHeight>n)if("crop"===i)o>a?(r.srcHeight=e.height,r.srcWidth=r.srcHeight*a):(r.srcWidth=e.width,r.srcHeight=r.srcWidth/a);else{if("contain"!==i)throw new Error("Unknown resizeMethod '".concat(i,"'"));o>a?n=t/o:t=n*o}return r.srcX=(e.width-r.srcWidth)/2,r.srcY=(e.height-r.srcHeight)/2,r.trgWidth=t,r.trgHeight=n,r},transformFile:function(e,t){return(this.options.resizeWidth||this.options.resizeHeight)&&e.type.match(/image.*/)?this.resizeImage(e,this.options.resizeWidth,this.options.resizeHeight,this.options.resizeMethod,t):t(e)},previewTemplate:e('<div class="dz-file-preview dz-preview"> <div class="dz-image"><img data-dz-thumbnail=""></div> <div class="dz-details"> <div class="dz-size"><span data-dz-size=""></span></div> <div class="dz-filename"><span data-dz-name=""></span></div> </div> <div class="dz-progress"> <span class="dz-upload" data-dz-uploadprogress=""></span> </div> <div class="dz-error-message"><span data-dz-errormessage=""></span></div> <div class="dz-success-mark"> <svg width="54" height="54" fill="#fff"><path d="m10.207 29.793 4.086-4.086a1 1 0 0 1 1.414 0l5.586 5.586a1 1 0 0 0 1.414 0l15.586-15.586a1 1 0 0 1 1.414 0l4.086 4.086a1 1 0 0 1 0 1.414L22.707 42.293a1 1 0 0 1-1.414 0L10.207 31.207a1 1 0 0 1 0-1.414Z"/></svg> </div> <div class="dz-error-mark"> <svg width="54" height="54" fill="#fff"><path d="m26.293 20.293-7.086-7.086a1 1 0 0 0-1.414 0l-4.586 4.586a1 1 0 0 0 0 1.414l7.086 7.086a1 1 0 0 1 0 1.414l-7.086 7.086a1 1 0 0 0 0 1.414l4.586 4.586a1 1 0 0 0 1.414 0l7.086-7.086a1 1 0 0 1 1.414 0l7.086 7.086a1 1 0 0 0 1.414 0l4.586-4.586a1 1 0 0 0 0-1.414l-7.086-7.086a1 1 0 0 1 0-1.414l7.086-7.086a1 1 0 0 0 0-1.414l-4.586-4.586a1 1 0 0 0-1.414 0l-7.086 7.086a1 1 0 0 1-1.414 0Z"/></svg> </div> </div>'),drop:function(e){return this.element.classList.remove("dz-drag-hover")},dragstart:function(e){},dragend:function(e){return this.element.classList.remove("dz-drag-hover")},dragenter:function(e){return this.element.classList.add("dz-drag-hover")},dragover:function(e){return this.element.classList.add("dz-drag-hover")},dragleave:function(e){return this.element.classList.remove("dz-drag-hover")},paste:function(e){},reset:function(){return this.element.classList.remove("dz-started")},addedfile:function(e){if(this.element===this.previewsContainer&&this.element.classList.add("dz-started"),this.previewsContainer&&!this.options.disablePreviews){var t=this;e.previewElement=p.createElement(this.options.previewTemplate.trim()),e.previewTemplate=e.previewElement,this.previewsContainer.appendChild(e.previewElement);var n=!0,i=!1,r=void 0;try{for(var o,a=e.previewElement.querySelectorAll("[data-dz-name]")[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s.textContent=e.name}}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}var l=!0,d=!1,u=void 0;try{for(var c,h=e.previewElement.querySelectorAll("[data-dz-size]")[Symbol.iterator]();!(l=(c=h.next()).done);l=!0)(s=c.value).innerHTML=this.filesize(e.size)}catch(e){d=!0,u=e}finally{try{l||null==h.return||h.return()}finally{if(d)throw u}}this.options.addRemoveLinks&&(e._removeLink=p.createElement('<a class="dz-remove" href="javascript:undefined;" data-dz-remove>'.concat(this.options.dictRemoveFile,"</a>")),e.previewElement.appendChild(e._removeLink));var f=function(n){var i=t;if(n.preventDefault(),n.stopPropagation(),e.status===p.UPLOADING)return p.confirm(t.options.dictCancelUploadConfirmation,function(){return i.removeFile(e)});var r=t;return t.options.dictRemoveFileConfirmation?p.confirm(t.options.dictRemoveFileConfirmation,function(){return r.removeFile(e)}):t.removeFile(e)},m=!0,g=!1,_=void 0;try{for(var v,b=e.previewElement.querySelectorAll("[data-dz-remove]")[Symbol.iterator]();!(m=(v=b.next()).done);m=!0)v.value.addEventListener("click",f)}catch(e){g=!0,_=e}finally{try{m||null==b.return||b.return()}finally{if(g)throw _}}}},removedfile:function(e){return null!=e.previewElement&&null!=e.previewElement.parentNode&&e.previewElement.parentNode.removeChild(e.previewElement),this._updateMaxFilesReachedClass()},thumbnail:function(e,t){if(e.previewElement){e.previewElement.classList.remove("dz-file-preview");var n=!0,i=!1,r=void 0;try{for(var o,a=e.previewElement.querySelectorAll("[data-dz-thumbnail]")[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;s.alt=e.name,s.src=t}}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return setTimeout(function(){return e.previewElement.classList.add("dz-image-preview")},1)}},error:function(e,t){if(e.previewElement){e.previewElement.classList.add("dz-error"),"string"!=typeof t&&t.error&&(t=t.error);var n=!0,i=!1,r=void 0;try{for(var o,a=e.previewElement.querySelectorAll("[data-dz-errormessage]")[Symbol.iterator]();!(n=(o=a.next()).done);n=!0)o.value.textContent=t}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}}},errormultiple:function(){},processing:function(e){if(e.previewElement&&(e.previewElement.classList.add("dz-processing"),e._removeLink))return e._removeLink.innerHTML=this.options.dictCancelUpload},processingmultiple:function(){},uploadprogress:function(e,t,n){var i=!0,r=!1,o=void 0;if(e.previewElement)try{for(var a,s=e.previewElement.querySelectorAll("[data-dz-uploadprogress]")[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l=a.value;"PROGRESS"===l.nodeName?l.value=t:l.style.width="".concat(t,"%")}}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}},totaluploadprogress:function(){},sending:function(){},sendingmultiple:function(){},success:function(e){if(e.previewElement)return e.previewElement.classList.add("dz-success")},successmultiple:function(){},canceled:function(e){return this.emit("error",e,this.options.dictUploadCanceled)},canceledmultiple:function(){},complete:function(e){if(e._removeLink&&(e._removeLink.innerHTML=this.options.dictRemoveFile),e.previewElement)return e.previewElement.classList.add("dz-complete")},completemultiple:function(){},maxfilesexceeded:function(){},maxfilesreached:function(){},queuecomplete:function(){},addedfiles:function(){}},p=function(i){"use strict";function a(i,r){var s,u,c,h;if(n(this,a),(s=l(this,(u=a,o(u)).call(this))).element=i,s.clickableElements=[],s.listeners=[],s.files=[],"string"==typeof s.element&&(s.element=document.querySelector(s.element)),!s.element||null==s.element.nodeType)throw new Error("Invalid dropzone element.");if(s.element.dropzone)throw new Error("Dropzone already attached.");a.instances.push(t(s)),s.element.dropzone=t(s);var p=null!=(h=a.optionsForElement(s.element))?h:{};if(s.options=e(d)(!0,{},f,p,null!=r?r:{}),s.options.previewTemplate=s.options.previewTemplate.replace(/\n*/g,""),s.options.forceFallback||!a.isBrowserSupported())return l(s,s.options.fallback.call(t(s)));if(null==s.options.url&&(s.options.url=s.element.getAttribute("action")),!s.options.url)throw new Error("No URL provided.");if(s.options.acceptedFiles&&s.options.acceptedMimeTypes)throw new Error("You can't provide both 'acceptedFiles' and 'acceptedMimeTypes'. 'acceptedMimeTypes' is deprecated.");if(s.options.uploadMultiple&&s.options.chunking)throw new Error("You cannot set both: uploadMultiple and chunking.");if(s.options.binaryBody&&s.options.uploadMultiple)throw new Error("You cannot set both: binaryBody and uploadMultiple.");return s.options.acceptedMimeTypes&&(s.options.acceptedFiles=s.options.acceptedMimeTypes,delete s.options.acceptedMimeTypes),null!=s.options.renameFilename&&(s.options.renameFile=function(e){return s.options.renameFilename.call(t(s),e.name,e)}),"string"==typeof s.options.method&&(s.options.method=s.options.method.toUpperCase()),(c=s.getExistingFallback())&&c.parentNode&&c.parentNode.removeChild(c),!1!==s.options.previewsContainer&&(s.options.previewsContainer?s.previewsContainer=a.getElement(s.options.previewsContainer,"previewsContainer"):s.previewsContainer=s.element),s.options.clickable&&(!0===s.options.clickable?s.clickableElements=[s.element]:s.clickableElements=a.getElements(s.options.clickable,"clickable")),s.init(),s}return s(a,i),r(a,[{key:"getAcceptedFiles",value:function(){return this.files.filter(function(e){return e.accepted}).map(function(e){return e})}},{key:"getRejectedFiles",value:function(){return this.files.filter(function(e){return!e.accepted}).map(function(e){return e})}},{key:"getFilesWithStatus",value:function(e){return this.files.filter(function(t){return t.status===e}).map(function(e){return e})}},{key:"getQueuedFiles",value:function(){return this.getFilesWithStatus(a.QUEUED)}},{key:"getUploadingFiles",value:function(){return this.getFilesWithStatus(a.UPLOADING)}},{key:"getAddedFiles",value:function(){return this.getFilesWithStatus(a.ADDED)}},{key:"getActiveFiles",value:function(){return this.files.filter(function(e){return e.status===a.UPLOADING||e.status===a.QUEUED}).map(function(e){return e})}},{key:"init",value:function(){var e=this,t=this,n=this,i=this,r=this,o=this,s=this,l=this,d=this,u=this,c=this;if("form"===this.element.tagName&&this.element.setAttribute("enctype","multipart/form-data"),this.element.classList.contains("dropzone")&&!this.element.querySelector(".dz-message")&&this.element.appendChild(a.createElement('<div class="dz-default dz-message"><button class="dz-button" type="button">'.concat(this.options.dictDefaultMessage,"</button></div>"))),this.clickableElements.length){var h=this,f=function(){var e=h;h.hiddenFileInput&&h.hiddenFileInput.parentNode.removeChild(h.hiddenFileInput),h.hiddenFileInput=document.createElement("input"),h.hiddenFileInput.setAttribute("type","file"),(null===h.options.maxFiles||h.options.maxFiles>1)&&h.hiddenFileInput.setAttribute("multiple","multiple"),h.hiddenFileInput.className="dz-hidden-input",null!==h.options.acceptedFiles&&h.hiddenFileInput.setAttribute("accept",h.options.acceptedFiles),null!==h.options.capture&&h.hiddenFileInput.setAttribute("capture",h.options.capture),h.hiddenFileInput.setAttribute("tabindex","-1"),h.hiddenFileInput.style.visibility="hidden",h.hiddenFileInput.style.position="absolute",h.hiddenFileInput.style.top="0",h.hiddenFileInput.style.left="0",h.hiddenFileInput.style.height="0",h.hiddenFileInput.style.width="0",a.getElement(h.options.hiddenInputContainer,"hiddenInputContainer").appendChild(h.hiddenFileInput),h.hiddenFileInput.addEventListener("change",function(){var t=e.hiddenFileInput.files,n=!0,i=!1,r=void 0;if(t.length)try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;e.addFile(s)}}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}e.emit("addedfiles",t),f()})};f()}this.URL=null!==window.URL?window.URL:window.webkitURL;var p=!0,m=!1,g=void 0;try{for(var _,v=this.events[Symbol.iterator]();!(p=(_=v.next()).done);p=!0){var b=_.value;this.on(b,this.options[b])}}catch(e){m=!0,g=e}finally{try{p||null==v.return||v.return()}finally{if(m)throw g}}this.on("uploadprogress",function(){return e.updateTotalUploadProgress()}),this.on("removedfile",function(){return t.updateTotalUploadProgress()}),this.on("canceled",function(e){return n.emit("complete",e)}),this.on("complete",function(e){var t=i;if(0===i.getAddedFiles().length&&0===i.getUploadingFiles().length&&0===i.getQueuedFiles().length)return setTimeout(function(){return t.emit("queuecomplete")},0)});var y=function(e){if(function(e){if(e.dataTransfer.types)for(var t=0;t<e.dataTransfer.types.length;t++)if("Files"===e.dataTransfer.types[t])return!0;return!1}(e))return e.stopPropagation(),e.preventDefault?e.preventDefault():e.returnValue=!1};return this.listeners=[{element:this.element,events:{dragstart:function(e){return r.emit("dragstart",e)},dragenter:function(e){return y(e),o.emit("dragenter",e)},dragover:function(e){var t;try{t=e.dataTransfer.effectAllowed}catch(e){}return e.dataTransfer.dropEffect="move"===t||"linkMove"===t?"move":"copy",y(e),s.emit("dragover",e)},dragleave:function(e){return l.emit("dragleave",e)},drop:function(e){return y(e),d.drop(e)},dragend:function(e){return u.emit("dragend",e)}}}],this.clickableElements.forEach(function(e){var t=c;return c.listeners.push({element:e,events:{click:function(n){return(e!==t.element||n.target===t.element||a.elementInside(n.target,t.element.querySelector(".dz-message")))&&t.hiddenFileInput.click(),!0}}})}),this.enable(),this.options.init.call(this)}},{key:"destroy",value:function(){return this.disable(),this.removeAllFiles(!0),(null!=this.hiddenFileInput?this.hiddenFileInput.parentNode:void 0)&&(this.hiddenFileInput.parentNode.removeChild(this.hiddenFileInput),this.hiddenFileInput=null),delete this.element.dropzone,a.instances.splice(a.instances.indexOf(this),1)}},{key:"updateTotalUploadProgress",value:function(){var e,t=0,n=0;if(this.getActiveFiles().length){var i=!0,r=!1,o=void 0;try{for(var a,s=this.getActiveFiles()[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l=a.value;t+=l.upload.bytesSent,n+=l.upload.total}}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}e=100*t/n}else e=100;return this.emit("totaluploadprogress",e,n,t)}},{key:"_getParamName",value:function(e){return"function"==typeof this.options.paramName?this.options.paramName(e):"".concat(this.options.paramName).concat(this.options.uploadMultiple?"[".concat(e,"]"):"")}},{key:"_renameFile",value:function(e){return"function"!=typeof this.options.renameFile?e.name:this.options.renameFile(e)}},{key:"getFallbackForm",value:function(){var e,t;if(e=this.getExistingFallback())return e;var n='<div class="dz-fallback">';this.options.dictFallbackText&&(n+="<p>".concat(this.options.dictFallbackText,"</p>")),n+='<input type="file" name="'.concat(this._getParamName(0),'" ').concat(this.options.uploadMultiple?'multiple="multiple"':void 0,' /><input type="submit" value="Upload!"></div>');var i=a.createElement(n);return"FORM"!==this.element.tagName?(t=a.createElement('<form action="'.concat(this.options.url,'" enctype="multipart/form-data" method="').concat(this.options.method,'"></form>'))).appendChild(i):(this.element.setAttribute("enctype","multipart/form-data"),this.element.setAttribute("method",this.options.method)),null!=t?t:i}},{key:"getExistingFallback",value:function(){var e=function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;if(/(^| )fallback($| )/.test(a.className))return a}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}},t=!0,n=!1,i=void 0;try{for(var r,o=["div","form"][Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a,s=r.value;if(a=e(this.element.getElementsByTagName(s)))return a}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"setupEventListeners",value:function(){return this.listeners.map(function(e){return function(){var t=[];for(var n in e.events){var i=e.events[n];t.push(e.element.addEventListener(n,i,!1))}return t}()})}},{key:"removeEventListeners",value:function(){return this.listeners.map(function(e){return function(){var t=[];for(var n in e.events){var i=e.events[n];t.push(e.element.removeEventListener(n,i,!1))}return t}()})}},{key:"disable",value:function(){var e=this;return this.clickableElements.forEach(function(e){return e.classList.remove("dz-clickable")}),this.removeEventListeners(),this.disabled=!0,this.files.map(function(t){return e.cancelUpload(t)})}},{key:"enable",value:function(){return delete this.disabled,this.clickableElements.forEach(function(e){return e.classList.add("dz-clickable")}),this.setupEventListeners()}},{key:"filesize",value:function(e){var t=0,n="b";if(e>0){for(var i=["tb","gb","mb","kb","b"],r=0;r<i.length;r++){var o=i[r];if(e>=Math.pow(this.options.filesizeBase,4-r)/10){t=e/Math.pow(this.options.filesizeBase,4-r),n=o;break}}t=Math.round(10*t)/10}return"<strong>".concat(t,"</strong> ").concat(this.options.dictFileSizeUnits[n])}},{key:"_updateMaxFilesReachedClass",value:function(){return null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(this.getAcceptedFiles().length===this.options.maxFiles&&this.emit("maxfilesreached",this.files),this.element.classList.add("dz-max-files-reached")):this.element.classList.remove("dz-max-files-reached")}},{key:"drop",value:function(e){if(e.dataTransfer){this.emit("drop",e);for(var t=[],n=0;n<e.dataTransfer.files.length;n++)t[n]=e.dataTransfer.files[n];if(t.length){var i=e.dataTransfer.items;i&&i.length&&null!=i[0].webkitGetAsEntry?this._addFilesFromItems(i):this.handleFiles(t)}this.emit("addedfiles",t)}}},{key:"paste",value:function(e){if(null!=(n=function(e){return e.items},null!=(t=null!=e?e.clipboardData:void 0)?n(t):void 0)){var t,n;this.emit("paste",e);var i=e.clipboardData.items;return i.length?this._addFilesFromItems(i):void 0}}},{key:"handleFiles",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;this.addFile(a)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}},{key:"_addFilesFromItems",value:function(e){var t=this;return function(){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=e[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l,d=a.value;null!=d.webkitGetAsEntry&&(l=d.webkitGetAsEntry())?l.isFile?n.push(t.addFile(d.getAsFile())):l.isDirectory?n.push(t._addFilesFromDirectory(l,l.name)):n.push(void 0):null==d.getAsFile||null!=d.kind&&"file"!==d.kind?n.push(void 0):n.push(t.addFile(d.getAsFile()))}}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}()}},{key:"_addFilesFromDirectory",value:function(e,t){var n=this,i=e.createReader(),r=function(e){return"log",n=function(t){return t.log(e)},null!=(t=console)&&"function"==typeof t.log?n(t):void 0;var t,n},o=function(){var e=n;return i.readEntries(function(n){if(n.length>0){var i=!0,r=!1,a=void 0;try{for(var s,l=n[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var d=s.value,u=e;d.isFile?d.file(function(e){if(!u.options.ignoreHiddenFiles||"."!==e.name.substring(0,1))return e.fullPath="".concat(t,"/").concat(e.name),u.addFile(e)}):d.isDirectory&&e._addFilesFromDirectory(d,"".concat(t,"/").concat(d.name))}}catch(e){r=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}o()}return null},r)};return o()}},{key:"accept",value:function(e,t){this.options.maxFilesize&&e.size>1048576*this.options.maxFilesize?t(this.options.dictFileTooBig.replace("{{filesize}}",Math.round(e.size/1024/10.24)/100).replace("{{maxFilesize}}",this.options.maxFilesize)):a.isValidFile(e,this.options.acceptedFiles)?null!=this.options.maxFiles&&this.getAcceptedFiles().length>=this.options.maxFiles?(t(this.options.dictMaxFilesExceeded.replace("{{maxFiles}}",this.options.maxFiles)),this.emit("maxfilesexceeded",e)):this.options.accept.call(this,e,t):t(this.options.dictInvalidFileType)}},{key:"addFile",value:function(e){var t=this;e.upload={uuid:a.uuidv4(),progress:0,total:e.size,bytesSent:0,filename:this._renameFile(e)},this.files.push(e),e.status=a.ADDED,this.emit("addedfile",e),this._enqueueThumbnail(e),this.accept(e,function(n){n?(e.accepted=!1,t._errorProcessing([e],n)):(e.accepted=!0,t.options.autoQueue&&t.enqueueFile(e)),t._updateMaxFilesReachedClass()})}},{key:"enqueueFiles",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var a=r.value;this.enqueueFile(a)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return null}},{key:"enqueueFile",value:function(e){if(e.status!==a.ADDED||!0!==e.accepted)throw new Error("This file can't be queued because it has already been processed or was rejected.");var t=this;if(e.status=a.QUEUED,this.options.autoProcessQueue)return setTimeout(function(){return t.processQueue()},0)}},{key:"_enqueueThumbnail",value:function(e){if(this.options.createImageThumbnails&&e.type.match(/image.*/)&&e.size<=1048576*this.options.maxThumbnailFilesize){var t=this;return this._thumbnailQueue.push(e),setTimeout(function(){return t._processThumbnailQueue()},0)}}},{key:"_processThumbnailQueue",value:function(){var e=this;if(!this._processingThumbnail&&0!==this._thumbnailQueue.length){this._processingThumbnail=!0;var t=this._thumbnailQueue.shift();return this.createThumbnail(t,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.thumbnailMethod,!0,function(n){return e.emit("thumbnail",t,n),e._processingThumbnail=!1,e._processThumbnailQueue()})}}},{key:"removeFile",value:function(e){if(e.status===a.UPLOADING&&this.cancelUpload(e),this.files=m(this.files,e),this.emit("removedfile",e),0===this.files.length)return this.emit("reset")}},{key:"removeAllFiles",value:function(e){null==e&&(e=!1);var t=!0,n=!1,i=void 0;try{for(var r,o=this.files.slice()[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;(s.status!==a.UPLOADING||e)&&this.removeFile(s)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return null}},{key:"resizeImage",value:function(e,t,n,i,r){var o=this;return this.createThumbnail(e,t,n,i,!0,function(t,n){if(null==n)return r(e);var i=o.options.resizeMimeType;null==i&&(i=e.type);var s=n.toDataURL(i,o.options.resizeQuality);return"image/jpeg"!==i&&"image/jpg"!==i||(s=v.restore(e.dataURL,s)),r(a.dataURItoBlob(s))})}},{key:"createThumbnail",value:function(e,t,n,i,r,o){var a=this,s=new FileReader;s.onload=function(){e.dataURL=s.result,"image/svg+xml"!==e.type?a.createThumbnailFromUrl(e,t,n,i,r,o):null!=o&&o(s.result)},s.readAsDataURL(e)}},{key:"displayExistingFile",value:function(e,t,n,i,r){var o=void 0===r||r;if(this.emit("addedfile",e),this.emit("complete",e),o){var a=this;e.dataURL=t,this.createThumbnailFromUrl(e,this.options.thumbnailWidth,this.options.thumbnailHeight,this.options.thumbnailMethod,this.options.fixOrientation,function(t){a.emit("thumbnail",e,t),n&&n()},i)}else this.emit("thumbnail",e,t),n&&n()}},{key:"createThumbnailFromUrl",value:function(e,t,n,i,r,o,a){var s=this,l=document.createElement("img");return a&&(l.crossOrigin=a),r="from-image"!=getComputedStyle(document.body).imageOrientation&&r,l.onload=function(){var a=s,d=function(e){return e(1)};return"undefined"!=typeof EXIF&&null!==EXIF&&r&&(d=function(e){return EXIF.getData(l,function(){return e(EXIF.getTag(this,"Orientation"))})}),d(function(r){e.width=l.width,e.height=l.height;var s=a.options.resize.call(a,e,t,n,i),d=document.createElement("canvas"),u=d.getContext("2d");switch(d.width=s.trgWidth,d.height=s.trgHeight,r>4&&(d.width=s.trgHeight,d.height=s.trgWidth),r){case 2:u.translate(d.width,0),u.scale(-1,1);break;case 3:u.translate(d.width,d.height),u.rotate(Math.PI);break;case 4:u.translate(0,d.height),u.scale(1,-1);break;case 5:u.rotate(.5*Math.PI),u.scale(1,-1);break;case 6:u.rotate(.5*Math.PI),u.translate(0,-d.width);break;case 7:u.rotate(.5*Math.PI),u.translate(d.height,-d.width),u.scale(-1,1);break;case 8:u.rotate(-.5*Math.PI),u.translate(-d.height,0)}_(u,l,null!=s.srcX?s.srcX:0,null!=s.srcY?s.srcY:0,s.srcWidth,s.srcHeight,null!=s.trgX?s.trgX:0,null!=s.trgY?s.trgY:0,s.trgWidth,s.trgHeight);var c=d.toDataURL("image/png");if(null!=o)return o(c,d)})},null!=o&&(l.onerror=o),l.src=e.dataURL}},{key:"processQueue",value:function(){var e=this.options.parallelUploads,t=this.getUploadingFiles().length,n=t;if(!(t>=e)){var i=this.getQueuedFiles();if(i.length>0){if(this.options.uploadMultiple)return this.processFiles(i.slice(0,e-t));for(;n<e;){if(!i.length)return;this.processFile(i.shift()),n++}}}}},{key:"processFile",value:function(e){return this.processFiles([e])}},{key:"processFiles",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;s.processing=!0,s.status=a.UPLOADING,this.emit("processing",s)}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}return this.options.uploadMultiple&&this.emit("processingmultiple",e),this.uploadFiles(e)}},{key:"_getFilesWithXhr",value:function(e){return this.files.filter(function(t){return t.xhr===e}).map(function(e){return e})}},{key:"cancelUpload",value:function(e){if(e.status===a.UPLOADING){var t=this._getFilesWithXhr(e.xhr),n=!0,i=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)(f=o.value).status=a.CANCELED}catch(e){i=!0,r=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw r}}void 0!==e.xhr&&e.xhr.abort();var l=!0,d=!1,u=void 0;try{for(var c,h=t[Symbol.iterator]();!(l=(c=h.next()).done);l=!0){var f=c.value;this.emit("canceled",f)}}catch(e){d=!0,u=e}finally{try{l||null==h.return||h.return()}finally{if(d)throw u}}this.options.uploadMultiple&&this.emit("canceledmultiple",t)}else e.status!==a.ADDED&&e.status!==a.QUEUED||(e.status=a.CANCELED,this.emit("canceled",e),this.options.uploadMultiple&&this.emit("canceledmultiple",[e]));if(this.options.autoProcessQueue)return this.processQueue()}},{key:"resolveOption",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];return"function"==typeof e?e.apply(this,n):e}},{key:"uploadFile",value:function(e){return this.uploadFiles([e])}},{key:"uploadFiles",value:function(e){var t=this;this._transformFiles(e,function(n){if(t.options.chunking){var i=n[0];e[0].upload.chunked=t.options.chunking&&(t.options.forceChunking||i.size>t.options.chunkSize),e[0].upload.totalChunkCount=Math.ceil(i.size/t.options.chunkSize)}if(e[0].upload.chunked){var r=t,o=t,s=e[0];i=n[0],s.upload.chunks=[];var l=function(){for(var t=0;void 0!==s.upload.chunks[t];)t++;if(!(t>=s.upload.totalChunkCount)){var n=t*r.options.chunkSize,o=Math.min(n+r.options.chunkSize,i.size),l={name:r._getParamName(0),data:i.webkitSlice?i.webkitSlice(n,o):i.slice(n,o),filename:s.upload.filename,chunkIndex:t};s.upload.chunks[t]={file:s,index:t,dataBlock:l,status:a.UPLOADING,progress:0,retries:0},r._uploadData(e,[l])}};if(s.upload.finishedChunkUpload=function(t,n){var i=o,r=!0;t.status=a.SUCCESS,t.dataBlock=null,t.response=t.xhr.responseText,t.responseHeaders=t.xhr.getAllResponseHeaders(),t.xhr=null;for(var d=0;d<s.upload.totalChunkCount;d++){if(void 0===s.upload.chunks[d])return l();s.upload.chunks[d].status!==a.SUCCESS&&(r=!1)}r&&o.options.chunksUploaded(s,function(){i._finished(e,n,null)})},t.options.parallelChunkUploads)for(var d=0;d<s.upload.totalChunkCount;d++)l();else l()}else{var u=[];for(d=0;d<e.length;d++)u[d]={name:t._getParamName(d),data:n[d],filename:e[d].upload.filename};t._uploadData(e,u)}})}},{key:"_getChunk",value:function(e,t){for(var n=0;n<e.upload.totalChunkCount;n++)if(void 0!==e.upload.chunks[n]&&e.upload.chunks[n].xhr===t)return e.upload.chunks[n]}},{key:"_uploadData",value:function(t,n){var i=this,r=this,o=this,a=this,s=new XMLHttpRequest,l=!0,u=!1,c=void 0;try{for(var h=t[Symbol.iterator]();!(l=(N=h.next()).done);l=!0)(v=N.value).xhr=s}catch(e){u=!0,c=e}finally{try{l||null==h.return||h.return()}finally{if(u)throw c}}t[0].upload.chunked&&(t[0].upload.chunks[n[0].chunkIndex].xhr=s);var f=this.resolveOption(this.options.method,t,n),p=this.resolveOption(this.options.url,t,n);s.open(f,p,!0),this.resolveOption(this.options.timeout,t)&&(s.timeout=this.resolveOption(this.options.timeout,t)),s.withCredentials=!!this.options.withCredentials,s.onload=function(e){i._finishedUploading(t,s,e)},s.ontimeout=function(){r._handleUploadError(t,s,"Request timedout after ".concat(r.options.timeout/1e3," seconds"))},s.onerror=function(){o._handleUploadError(t,s)},(null!=s.upload?s.upload:s).onprogress=function(e){return a._updateFilesUploadProgress(t,s,e)};var m=this.options.defaultHeaders?{Accept:"application/json","Cache-Control":"no-cache","X-Requested-With":"XMLHttpRequest"}:{};for(var g in this.options.binaryBody&&(m["Content-Type"]=t[0].type),this.options.headers&&e(d)(m,this.options.headers),m){var _=m[g];_&&s.setRequestHeader(g,_)}if(this.options.binaryBody){l=!0,u=!1,c=void 0;try{for(h=t[Symbol.iterator]();!(l=(N=h.next()).done);l=!0){var v=N.value;this.emit("sending",v,s)}}catch(e){u=!0,c=e}finally{try{l||null==h.return||h.return()}finally{if(u)throw c}}this.options.uploadMultiple&&this.emit("sendingmultiple",t,s),this.submitRequest(s,null,t)}else{var b=new FormData;if(this.options.params){var y=this.options.params;for(var x in"function"==typeof y&&(y=y.call(this,t,s,t[0].upload.chunked?this._getChunk(t[0],s):null)),y){var w=y[x];if(Array.isArray(w))for(var S=0;S<w.length;S++)b.append(x,w[S]);else b.append(x,w)}}l=!0,u=!1,c=void 0;try{var N;for(h=t[Symbol.iterator]();!(l=(N=h.next()).done);l=!0)v=N.value,this.emit("sending",v,s,b)}catch(e){u=!0,c=e}finally{try{l||null==h.return||h.return()}finally{if(u)throw c}}for(this.options.uploadMultiple&&this.emit("sendingmultiple",t,s,b),this._addFormElementData(b),S=0;S<n.length;S++){var E=n[S];b.append(E.name,E.data,E.filename)}this.submitRequest(s,b,t)}}},{key:"_transformFiles",value:function(e,t){for(var n=this,i=function(i){n.options.transformFile.call(n,e[i],function(n){r[i]=n,++o===e.length&&t(r)})},r=[],o=0,a=0;a<e.length;a++)i(a)}},{key:"_addFormElementData",value:function(e){var t=!0,n=!1,i=void 0;if("FORM"===this.element.tagName)try{for(var r=this.element.querySelectorAll("input, textarea, select, button")[Symbol.iterator]();!(t=(l=r.next()).done);t=!0){var o=l.value,a=o.getAttribute("name"),s=o.getAttribute("type");if(s&&(s=s.toLowerCase()),null!=a)if("SELECT"===o.tagName&&o.hasAttribute("multiple")){t=!0,n=!1,i=void 0;try{var l;for(r=o.options[Symbol.iterator]();!(t=(l=r.next()).done);t=!0){var d=l.value;d.selected&&e.append(a,d.value)}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}else(!s||"checkbox"!==s&&"radio"!==s||o.checked)&&e.append(a,o.value)}}catch(e){n=!0,i=e}finally{try{t||null==r.return||r.return()}finally{if(n)throw i}}}},{key:"_updateFilesUploadProgress",value:function(e,t,n){var i=!0,r=!1,o=void 0;if(e[0].upload.chunked){u=e[0];var a=this._getChunk(u,t);n?(a.progress=100*n.loaded/n.total,a.total=n.total,a.bytesSent=n.loaded):(a.progress=100,a.bytesSent=a.total),u.upload.progress=0,u.upload.total=0,u.upload.bytesSent=0;for(var s=0;s<u.upload.totalChunkCount;s++)u.upload.chunks[s]&&void 0!==u.upload.chunks[s].progress&&(u.upload.progress+=u.upload.chunks[s].progress,u.upload.total+=u.upload.chunks[s].total,u.upload.bytesSent+=u.upload.chunks[s].bytesSent);u.upload.progress=u.upload.progress/u.upload.totalChunkCount,this.emit("uploadprogress",u,u.upload.progress,u.upload.bytesSent)}else try{for(var l,d=e[Symbol.iterator]();!(i=(l=d.next()).done);i=!0){var u;(u=l.value).upload.total&&u.upload.bytesSent&&u.upload.bytesSent==u.upload.total||(n?(u.upload.progress=100*n.loaded/n.total,u.upload.total=n.total,u.upload.bytesSent=n.loaded):(u.upload.progress=100,u.upload.bytesSent=u.upload.total),this.emit("uploadprogress",u,u.upload.progress,u.upload.bytesSent))}}catch(e){r=!0,o=e}finally{try{i||null==d.return||d.return()}finally{if(r)throw o}}}},{key:"_finishedUploading",value:function(e,t,n){var i;if(e[0].status!==a.CANCELED&&4===t.readyState){if("arraybuffer"!==t.responseType&&"blob"!==t.responseType&&(i=t.responseText,t.getResponseHeader("content-type")&&~t.getResponseHeader("content-type").indexOf("application/json")))try{i=JSON.parse(i)}catch(e){n=e,i="Invalid JSON response from server."}this._updateFilesUploadProgress(e,t),200<=t.status&&t.status<300?e[0].upload.chunked?e[0].upload.finishedChunkUpload(this._getChunk(e[0],t),i):this._finished(e,i,n):this._handleUploadError(e,t,i)}}},{key:"_handleUploadError",value:function(e,t,n){if(e[0].status!==a.CANCELED){if(e[0].upload.chunked&&this.options.retryChunks){var i=this._getChunk(e[0],t);if(i.retries++<this.options.retryChunksLimit)return void this._uploadData(e,[i.dataBlock]);console.warn("Retried this chunk too often. Giving up.")}this._errorProcessing(e,n||this.options.dictResponseError.replace("{{statusCode}}",t.status),t)}}},{key:"submitRequest",value:function(e,t,n){if(1==e.readyState)if(this.options.binaryBody)if(n[0].upload.chunked){var i=this._getChunk(n[0],e);e.send(i.dataBlock.data)}else e.send(n[0]);else e.send(t);else console.warn("Cannot send this request because the XMLHttpRequest.readyState is not OPENED.")}},{key:"_finished",value:function(e,t,n){var i=!0,r=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var d=s.value;d.status=a.SUCCESS,this.emit("success",d,t,n),this.emit("complete",d)}}catch(e){r=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}if(this.options.uploadMultiple&&(this.emit("successmultiple",e,t,n),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()}},{key:"_errorProcessing",value:function(e,t,n){var i=!0,r=!1,o=void 0;try{for(var s,l=e[Symbol.iterator]();!(i=(s=l.next()).done);i=!0){var d=s.value;d.status=a.ERROR,this.emit("error",d,t,n),this.emit("complete",d)}}catch(e){r=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw o}}if(this.options.uploadMultiple&&(this.emit("errormultiple",e,t,n),this.emit("completemultiple",e)),this.options.autoProcessQueue)return this.processQueue()}}],[{key:"initClass",value:function(){this.prototype.Emitter=h,this.prototype.events=["drop","dragstart","dragend","dragenter","dragover","dragleave","addedfile","addedfiles","removedfile","thumbnail","error","errormultiple","processing","processingmultiple","uploadprogress","totaluploadprogress","sending","sendingmultiple","success","successmultiple","canceled","canceledmultiple","complete","completemultiple","reset","maxfilesexceeded","maxfilesreached","queuecomplete"],this.prototype._thumbnailQueue=[],this.prototype._processingThumbnail=!1}},{key:"uuidv4",value:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}}]),a}(h);p.initClass(),p.options={},p.optionsForElement=function(e){return e.getAttribute("id")?p.options[g(e.getAttribute("id"))]:void 0},p.instances=[],p.forElement=function(e){if("string"==typeof e&&(e=document.querySelector(e)),null==(null!=e?e.dropzone:void 0))throw new Error("No Dropzone found for given element. This is probably because you're trying to access it before Dropzone had the time to initialize. Use the `init` option to setup any additional observers on your Dropzone.");return e.dropzone},p.discover=function(){var e;if(document.querySelectorAll)e=document.querySelectorAll(".dropzone");else{e=[];var t=function(t){return function(){var n=[],i=!0,r=!1,o=void 0;try{for(var a,s=t[Symbol.iterator]();!(i=(a=s.next()).done);i=!0){var l=a.value;/(^| )dropzone($| )/.test(l.className)?n.push(e.push(l)):n.push(void 0)}}catch(e){r=!0,o=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw o}}return n}()};t(document.getElementsByTagName("div")),t(document.getElementsByTagName("form"))}return function(){var t=[],n=!0,i=!1,r=void 0;try{for(var o,a=e[Symbol.iterator]();!(n=(o=a.next()).done);n=!0){var s=o.value;!1!==p.optionsForElement(s)?t.push(new p(s)):t.push(void 0)}}catch(e){i=!0,r=e}finally{try{n||null==a.return||a.return()}finally{if(i)throw r}}return t}()},p.blockedBrowsers=[/opera.*(Macintosh|Windows Phone).*version\/12/i],p.isBrowserSupported=function(){var e=!0;if(window.File&&window.FileReader&&window.FileList&&window.Blob&&window.FormData&&document.querySelector)if("classList"in document.createElement("a")){void 0!==p.blacklistedBrowsers&&(p.blockedBrowsers=p.blacklistedBrowsers);var t=!0,n=!1,i=void 0;try{for(var r,o=p.blockedBrowsers[Symbol.iterator]();!(t=(r=o.next()).done);t=!0)r.value.test(navigator.userAgent)&&(e=!1)}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}else e=!1;else e=!1;return e},p.dataURItoBlob=function(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],i=new ArrayBuffer(t.length),r=new Uint8Array(i),o=0,a=t.length,s=0<=a;s?o<=a:o>=a;s?o++:o--)r[o]=t.charCodeAt(o);return new Blob([i],{type:n})};var m=function(e,t){return e.filter(function(e){return e!==t}).map(function(e){return e})},g=function(e){return e.replace(/[\-_](\w)/g,function(e){return e.charAt(1).toUpperCase()})};p.createElement=function(e){var t=document.createElement("div");return t.innerHTML=e,t.childNodes[0]},p.elementInside=function(e,t){if(e===t)return!0;for(;e=e.parentNode;)if(e===t)return!0;return!1},p.getElement=function(e,t){var n;if("string"==typeof e?n=document.querySelector(e):null!=e.nodeType&&(n=e),null==n)throw new Error("Invalid `".concat(t,"` option provided. Please provide a CSS selector or a plain HTML element."));return n},p.getElements=function(e,t){var n,i;if(e instanceof Array){i=[];try{var r=!0,o=!1,a=void 0;try{for(var s=e[Symbol.iterator]();!(r=(l=s.next()).done);r=!0)n=l.value,i.push(this.getElement(n,t))}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}}catch(e){i=null}}else if("string"==typeof e){i=[],r=!0,o=!1,a=void 0;try{var l;for(s=document.querySelectorAll(e)[Symbol.iterator]();!(r=(l=s.next()).done);r=!0)n=l.value,i.push(n)}catch(e){o=!0,a=e}finally{try{r||null==s.return||s.return()}finally{if(o)throw a}}}else null!=e.nodeType&&(i=[e]);if(null==i||!i.length)throw new Error("Invalid `".concat(t,"` option provided. Please provide a CSS selector, a plain HTML element or a list of those."));return i},p.confirm=function(e,t,n){return window.confirm(e)?t():null!=n?n():void 0},p.isValidFile=function(e,t){if(!t)return!0;t=t.split(",");var n=e.type,i=n.replace(/\/.*$/,""),r=!0,o=!1,a=void 0;try{for(var s,l=t[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var d=s.value;if("."===(d=d.trim()).charAt(0)){if(-1!==e.name.toLowerCase().indexOf(d.toLowerCase(),e.name.length-d.length))return!0}else if(/\/\*$/.test(d)){if(i===d.replace(/\/.*$/,""))return!0}else if(n===d)return!0}}catch(e){o=!0,a=e}finally{try{r||null==l.return||l.return()}finally{if(o)throw a}}return!1},"undefined"!=typeof jQuery&&null!==jQuery&&(jQuery.fn.dropzone=function(e){return this.each(function(){return new p(this,e)})}),p.ADDED="added",p.QUEUED="queued",p.ACCEPTED=p.QUEUED,p.UPLOADING="uploading",p.PROCESSING=p.UPLOADING,p.CANCELED="canceled",p.ERROR="error",p.SUCCESS="success";var _=function(e,t,n,i,r,o,a,s,l,d){var u=function(e){e.naturalWidth;var t=e.naturalHeight,n=document.createElement("canvas");n.width=1,n.height=t;var i=n.getContext("2d");i.drawImage(e,0,0);for(var r=i.getImageData(1,0,1,t).data,o=0,a=t,s=t;s>o;)0===r[4*(s-1)+3]?a=s:o=s,s=a+o>>1;var l=s/t;return 0===l?1:l}(t);return e.drawImage(t,n,i,r,o,a,s,l,d/u)},v=function(){"use strict";function e(){n(this,e)}return r(e,null,[{key:"initClass",value:function(){this.KEY_STR="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}},{key:"encode64",value:function(e){for(var t="",n=void 0,i=void 0,r="",o=void 0,a=void 0,s=void 0,l="",d=0;o=(n=e[d++])>>2,a=(3&n)<<4|(i=e[d++])>>4,s=(15&i)<<2|(r=e[d++])>>6,l=63&r,isNaN(i)?s=l=64:isNaN(r)&&(l=64),t=t+this.KEY_STR.charAt(o)+this.KEY_STR.charAt(a)+this.KEY_STR.charAt(s)+this.KEY_STR.charAt(l),n=i=r="",o=a=s=l="",d<e.length;);return t}},{key:"restore",value:function(e,t){if(!e.match("data:image/jpeg;base64,"))return t;var n=this.decode64(e.replace("data:image/jpeg;base64,","")),i=this.slice2Segments(n),r=this.exifManipulation(t,i);return"data:image/jpeg;base64,".concat(this.encode64(r))}},{key:"exifManipulation",value:function(e,t){var n=this.getExifArray(t),i=this.insertExif(e,n);return new Uint8Array(i)}},{key:"getExifArray",value:function(e){for(var t=void 0,n=0;n<e.length;){if(255===(t=e[n])[0]&225===t[1])return t;n++}return[]}},{key:"insertExif",value:function(e,t){var n=e.replace("data:image/jpeg;base64,",""),i=this.decode64(n),r=i.indexOf(255,3),o=i.slice(0,r),a=i.slice(r),s=o;return(s=s.concat(t)).concat(a)}},{key:"slice2Segments",value:function(e){for(var t=0,n=[];!(255===e[t]&218===e[t+1]);){if(255===e[t]&216===e[t+1])t+=2;else{var i=t+(256*e[t+2]+e[t+3])+2,r=e.slice(t,i);n.push(r),t=i}if(t>e.length)break}return n}},{key:"decode64",value:function(e){var t=void 0,n=void 0,i="",r=void 0,o=void 0,a="",s=0,l=[];for(/[^A-Za-z0-9\+\/\=]/g.exec(e)&&console.warn("There were invalid base64 characters in the input text.\nValid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='\nExpect errors in decoding."),e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");t=this.KEY_STR.indexOf(e.charAt(s++))<<2|(r=this.KEY_STR.indexOf(e.charAt(s++)))>>4,n=(15&r)<<4|(o=this.KEY_STR.indexOf(e.charAt(s++)))>>2,i=(3&o)<<6|(a=this.KEY_STR.indexOf(e.charAt(s++))),l.push(t),64!==o&&l.push(n),64!==a&&l.push(i),t=n=i="",r=o=a="",s<e.length;);return l}}]),e}();v.initClass(),window.Dropzone=p}();var $bu_=new function(){var e=this;this.version="3.3.33npm",this.vsakt={c:"95",f:"93",s:"14.1.2",e:"94.0.992.50",i:"12",ios:"13.3",samsung:"15.0.2",o:"80",e_a:"93",o_a:"65",y:"21.9.1",v:"4.3",uc:"13.3.8"},this.vsinsecure_below={c:"88.0.4324.150",f:76,s:"11.1.1",e:16,i:11,ios:"12.3",samsung:12,o:62,o_a:52,y:"20",v:"2.7",uc:"13.1"},this.vsdefault={c:-3,f:-3,s:-1,e:17,i:11,ios:10,samsung:9.9,o:-3,o_a:-3,y:20.4,v:2.6,uc:13,a:535},this.names={c:"Chrome",f:"Firefox",s:"Safari",e:"Edge",i:"Internet Explorer",ios:"iOS",samsung:"Samsung Internet",o:"Opera",o_a:"Opera",e_a:"Edge",y:"Yandex Browser",v:"Vivaldi",uc:"UC Browser",a:"Android Browser",x:"Other",silk:"Silk"},this.get_browser=function(t){t=(t||navigator.userAgent).replace("_",".");var n={n:"x",v:0,t:"other browser",age_years:void 0,no_device_update:!1,available:e.vsakt};function i(e,n){return!!new RegExp(n,"i").test(t)&&e}n.other=i("bot","Pagespeed|pingdom|Preview|ktxn|dynatrace|Ruxit|PhantomJS|Headless|Lighthouse|bot|spider|archiver|transcoder|crawl|checker|monitoring|prerender|screenshot|python-|php|uptime|validator|fetcher|facebook|slurp|google|yahoo|node|mail.ru|github|cloudflare|addthis|thumb|proxy|feed|fetch|favicon|link|http|scrape|seo|page|search console|AOLBuild|Teoma|Expeditor")||i("TV","SMART-TV|SmartTV")||i("niche browser","Comodo.Dragon|OculusBrowser|Falkon|Brave|Classic Browser|Dorado|LBBROWSER|Focus|waterfox|Firefox/56.2|Firefox/56.3|Whale|MIDP|k-meleon|sparrow|wii|Chromium|Puffin|Opera Mini|maxthon|maxton|dolfin|dolphin|seamonkey|opera mini|netfront|moblin|maemo|arora|kazehakase|epiphany|konqueror|rekonq|symbian|webos|PaleMoon|Basilisk|QupZilla|Otter|Midori|qutebrowser|slimjet")||i("mobile without upgrade path or landing page","OPR/44.12.2246|cros|kindle|tizen|silk|blackberry|bb10|RIM|PlayBook|meego|nokia|ucweb|ZuneWP7|537.85.10"),n.embedded=/"QtWebEngine|Teams|Electron/i.test(t),n.mobile=/iphone|ipod|ipad|android|mobile|phone|ios|iemobile/i.test(t),n.discontinued=/netscape|greenbrowser|camino|flot|fennec|galeon|coolnovo/i.test(t);for(var r=[["CriOS.VV","c","ios"],["FxiOS.VV","f","ios"],["Trident.*rv:VV","i","i"],["Trident.VV","io","i"],["UCBrowser.VV","uc","c"],["MSIE.VV","i","i"],["Edge.VV","e","e"],["Edg.VV","e","c"],["EdgA.VV","e_a","c"],["Vivaldi.VV","v","c"],["Android.*OPR.VV","o_a","c"],["OPR.VV","o_a","c"],["YaBrowser.VV","y","c"],["SamsungBrowser.VV","samsung","c"],["Silk.VV","silk","c"],["Chrome.VV","c","c"],["Firefox.VV","f","f"],[" OS.VV.*Safari","ios","ios"],["Version.VV.*Safari","s","s"],["Safari.VV","so","s"],["Opera.*Version.VV","o"],["Opera.VV","o"]],o="(\\d+\\.?\\d+\\.?\\d*\\.?\\d*)",a=0;a<r.length;a++)if(t.match(new RegExp(r[a][0].replace("VV",o),"i"))){n.n=r[a][1],n.engine=r[a][2];break}if(n.fullv=RegExp.$1,n.v=parseFloat(n.fullv),/windows.nt.5|windows.nt.4|windows.nt.6.0|windows.95|windows.98|os x 10.2|os x 10.3|os x 10.4|os x 10.5/i.test(t)&&(n.no_device_update=!0,n.available={}),"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1&&(n.n="ios",n.engine="ios",n.fullv=n.v=13,n.no_device_update=!0),/iphone|ipod|ipad|ios/i.test(t)){t.match(new RegExp("OS."+o,"i")),n.n="ios",n.fullv=RegExp.$1,n.v=parseFloat(n.fullv),n.engine="ios";var s=e.available_ios(t,n.v);s<12&&11===Math.round(n.v)&&(s=12),n.available={ios:s},parseFloat(n.available.ios)<11&&(n.no_device_update=!0)}if(/windows.nt.5.1|windows.nt.5.2|windows.nt.6.0/i.test(t)&&(n.available={c:49.9,f:52.9}),/os x 10.6/i.test(t)&&(n.available={s:"5.1.10",c:49.9,f:48},n.no_device_update=!0),/os x 10.7|os x 10.8/i.test(t)&&(n.available={s:"6.2.8",c:49.9,f:48},n.no_device_update=!0),/os x 10.9/i.test(t)&&(n.available.s="9.1.3"),/os x 10.10/i.test(t)&&(n.available.s="10.1.2"),t.indexOf("Android")>-1&&"s"===n.n){var l=parseInt((/WebKit\/([0-9]+)/i.exec(t)||0)[1],10)||2e3;l<=534&&(n.n="a",n.fullv=n.v=l,n.is_insecure=!0)}"so"===n.n&&(n.v=n.fullv=4,n.n="s"),"io"===n.n&&(n.n="i",n.v>6?n.v=11:n.v>5?n.v=10:n.v>4?n.v=9:n.v>3.1?n.v=8:n.v>3?n.v=7:n.v=9,n.fullv=n.v),n.t=e.names[n.n]+" "+n.v,n.is_supported=n.is_latest=e.vsakt[n.n]?e.less(n.fullv,e.vsakt[n.n])<=0:void 0,n.vmaj=Math.round(n.v),n.is_insecure=n.is_insecure||!e.vsinsecure_below[n.n]?void 0:1===e.less(n.fullv,e.vsinsecure_below[n.n]),("f"===n.n&&(78===n.vmaj||91===n.vmaj)||"i"===n.n&&11===n.vmaj)&&(n.is_supported=!0,n.is_insecure=!1,"f"===n.n&&(n.esr=!0)),"ios"===n.n&&n.v>10.3&&(n.is_supported=!0),"a"!==n.n&&"x"!==n.n||(n.t=e.names[n.n]),"e"===n.n&&(n.t=e.names[n.n]+" "+n.vmaj,n.is_supported=1!=e.less(n.fullv,"18.15063")),n.n in["c","f","o","e"]&&e.less(n.fullv,parseFloat(e.vsakt[n.n])-1)<=0&&(n.is_supported=!0);var d={f:7,c:8,o:8,i:1,e:1,s:1};d[n.n]&&(n.age_years=Math.round((e.vsakt[n.n]-n.v)/d[n.n]*10)/10||0);return n.engine&&(t.match(new RegExp({e:"Edge.VV",c:"Chrome.VV",f:"Firefox.VV",s:"Version.VV",i:"MSIE.VV",ios:" OS.VV"}[n.engine].replace("VV",o),"i")),n.engine_version=parseFloat(RegExp.$1)),n},this.semver=function(e){if(e instanceof Array)return e;var t=(e+".0.0.0").split(".");return[parseInt(t[0])||0,parseInt(t[1])||0,parseInt(t[2])||0,parseInt(t[3])||0]},this.less=function(t,n){t=e.semver(t),n=e.semver(n);for(var i=0;;i++){if(i>=t.length)return i>=n.length?0:1;if(i>=n.length)return-1;var r=n[i]-t[i];if(r)return r>0?1:-1}},this.available_ios=function(e,t){var n=Math.max(window.screen.height,window.screen.width),i=window.devicePixelRatio;return/ipad/i.test(e)?1024==n&&2==i?10:1112==n||1366==n?15:1024==n&&t<6?5:9:1==i?6:812==n?15:736==n||667==n?12:568==n?10:480==n?7:6}};window.$bu_getBrowser=$bu_.get_browser;var $buo=function(e,t){var n,i=window.navigator,r=(e=window._buorgres=e||{}).l||(i.languages?i.languages[0]:null)||i.language||i.browserLanguage||i.userLanguage||document.documentElement.getAttribute("lang")||"en";e.llfull=r.replace("_","-").toLowerCase().substr(0,5),e.ll=e.llfull.substr(0,2),e.domain=void 0!==e.domain?e.domain:(/file:/.test(location.href)?"https:":"")+"//browser-update.org",e.apiver=e.api||e.c||-1,e.jsv=$bu_.version;var o=e.apiver<2018&&{i:10,f:11,o:21,s:8,c:30}||{},a=e.notify||e.vs||{};a.e=a.e||a.i,a.i=a.i||a.e;var s=e.required||{};for(n in s.e=s.e||s.i,s.i||(s.i=s.e,$bu_.vsakt.i=$bu_.vsakt.e),$bu_.vsdefault)a[n]&&($bu_.less(a[n],0)>=0?s[n]=parseFloat($bu_.vsakt[n])+parseFloat(a[n])+.01:s[n]=parseFloat(a[n])+.01),n in s&&null!=s[n]||(s[n]=$bu_.vsdefault[n]),$bu_.less(s[n],0)>=0&&(s[n]=parseFloat($bu_.vsakt[n])+parseFloat(s[n])),o[n]&&1===$bu_.less(s[n],o[n])&&(s[n]=o[n]);s.ios=s.ios||s.s,s.i<79&&s.i>65&&(s.i=s.i-60),s.e<79&&s.e>65&&(s.e=s.e-60),e.required=s,e.reminder=e.reminder<.1?0:e.reminder||168,e.reminderClosed=e.reminderClosed<1?0:e.reminderClosed||168,e.onshow=e.onshow||function(e){},e.onclick=e.onclick||function(e){},e.onclose=e.onclose||function(e){},e.pageurl=e.pageurl||location.hostname||"x",e.newwindow=!1!==e.newwindow,e.test=t||e.test||"#test-bu"===location.hash||!1,e.ignorecookie=e.ignorecookie||"#ignorecookie-bu"===location.hash,e.reasons=[],e.hide_reasons=[],e.notified=function(e){var t=e.browser=$bu_.get_browser(e.override_ua);return e.is_below_required=s[t.n]&&1===$bu_.less(t.fullv,s[t.n]),!1!==t.other&&e.hide_reasons.push("is other browser:"+t.other),!1!==t.embedded&&e.hide_reasons.push("is embedded browser:"+t.embedded),t.esr&&!e.notify_esr&&e.hide_reasons.push("Extended support (ESR)"),t.mobile&&!1===e.mobile&&e.hide_reasons.push("do not notify mobile"),t.is_latest&&e.hide_reasons.push("is latest version of the browser"),t.no_device_update&&e.hide_reasons.push("no device update"),e.is_below_required&&e.reasons.push("below required"),(e.insecure||e.unsecure)&&t.is_insecure&&e.reasons.push("insecure"),e.unsupported&&!t.is_supported&&e.reasons.push("no vendor support"),!(e.hide_reasons.length>0)&&e.reasons.length>0}(e),e.already_shown=document.cookie.indexOf("browserupdateorg=pause")>-1&&!e.ignorecookie,(e.test||e.notified&&!e.already_shown)&&(e.setCookie=function(e){document.cookie="browserupdateorg=pause; expires="+new Date((new Date).getTime()+36e5*e).toGMTString()+"; path=/; SameSite=Lax"+(/https:/.test(location.href)?"; Secure":"")},e.already_shown&&(e.ignorecookie||e.test)&&e.setCookie(-10),e.reminder>0&&e.setCookie(e.reminder),e.nomessage?e.onshow(e):$buo_show())};"undefined"!=typeof module&&(module.exports=$buo);var $buo_show=function(){var e=window._buorgres,t=$bu_getBrowser(),n=e.burl||"http"+(/MSIE/i.test(navigator.userAgent)?"":"s")+"://browser-update.org/";e.url||(e.url=n+(e.l&&e.l+"/"||"")+"update-browser.html"+(e.test?"?force_outdated=true":"")+"#"+e.jsv+":"+e.pageurl),e.url_permanent_hide=e.url_permanent_hide||n+"block-ignore-browser-update-warning.html";var i,r={};r.en={msg:"Your web browser ({brow_name}) is out of date.",msgmore:"Update your browser for more security, speed and the best experience on this site.",bupdate:"Update browser",bignore:"Ignore",remind:"You will be reminded in {days} days.",bnever:"Never show again"},r.ar={msg:"\u0645\u062a\u0635\u0641\u062d \u0627\u0644\u0625\u0646\u062a\u0631\u0646\u062a \u0627\u0644\u062e\u0627\u0635 \u0628\u0643 ({brow_name}) \u063a\u064a\u0631 \u0645\u064f\u062d\u062f\u0651\u062b.",msgmore:"\u0642\u0645 \u0628\u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u062a\u0635\u0641\u062d \u0627\u0644\u062e\u0627\u0635 \u0628\u0643 \u0644\u0645\u0632\u064a\u062f \u0645\u0646 \u0627\u0644\u0623\u0645\u0627\u0646 \u0648\u0627\u0644\u0633\u0631\u0639\u0629 \u0648\u0644\u0623\u0641\u0636\u0644 \u062a\u062c\u0631\u0628\u0629 \u0639\u0644\u0649 \u0647\u0630\u0627 \u0627\u0644\u0645\u0648\u0642\u0639.",bupdate:"\u062a\u062d\u062f\u064a\u062b \u0627\u0644\u0645\u062a\u0635\u0641\u062d",bignore:"\u062a\u062c\u0627\u0647\u0644",remind:"\u0633\u064a\u062a\u0645 \u062a\u0630\u0643\u064a\u0631\u0643 \u0641\u064a \u063a\u0636\u0648\u0646 {days} \u0623\u064a\u0627\u0645.",bnever:"\u0644\u0627 \u062a\u0638\u0647\u0631 \u0645\u0631\u0629 \u0623\u062e\u0631\u0649"},r.bg={msg:"\u0412\u0430\u0448\u0438\u044f\u0442 \u0443\u0435\u0431 \u0431\u0440\u0430\u0443\u0437\u044a\u0440 ({brow_name}) \u0435 \u043e\u0441\u0442\u0430\u0440\u044f\u043b.",msgmore:"\u0410\u043a\u0442\u0443\u0430\u043b\u0438\u0437\u0438\u0440\u0430\u0439\u0442\u0435 \u0431\u0440\u0430\u0443\u0437\u044a\u0440\u0430 \u0441\u0438 \u0437\u0430 \u043f\u043e\u0432\u0435\u0447\u0435 \u0441\u0438\u0433\u0443\u0440\u043d\u043e\u0441\u0442, \u0431\u044a\u0440\u0437\u0438\u043d\u0430 \u0438 \u043d\u0430\u0439-\u0434\u043e\u0431\u0440\u043e\u0442\u043e \u0438\u0437\u0436\u0438\u0432\u044f\u0432\u0430\u043d\u0435 \u043d\u0430 \u0442\u043e\u0437\u0438 \u0441\u0430\u0439\u0442.",bupdate:"\u0410\u043a\u0442\u0443\u0430\u043b\u0438\u0437\u0438\u0440\u0430\u043d\u0435 \u043d\u0430 \u0431\u0440\u0430\u0443\u0437\u044a\u0440\u0430",bignore:"\u0438\u0433\u043d\u043e\u0440\u0438\u0440\u0430\u0439",remind:"\u0429\u0435 \u0432\u0438 \u0431\u044a\u0434\u0435 \u043d\u0430\u043f\u043e\u043c\u043d\u0435\u043d\u043e \u0441\u043b\u0435\u0434 {days} \u0434\u043d\u0438.",bnever:"\u041d\u0438\u043a\u043e\u0433\u0430 \u043f\u043e\u0432\u0435\u0447\u0435 \u0434\u0430 \u043d\u0435 \u0441\u0435 \u043f\u043e\u043a\u0430\u0437\u0432\u0430"},r.ca={msg:"El teu navegador ({brow_name}) est\xe0 desactualitzat.",msgmore:"Actualitzeu el vostre navegador per obtenir m\xe9s seguretat, velocitat i una millor experi\xe8ncia en aquest lloc.",bupdate:"Actualitza el navegador",bignore:"Ignorar",remind:"T'ho recordarem d'aqu\xed a {days} dies.",bnever:"No ho tornis a mostrar"},r.cs={msg:"V\xe1\u0161 prohl\xed\u017ee\u010d ({brow_name}) je zastaral\xfd.",msgmore:"Aktualizujte prohl\xed\u017ee\u010d pro lep\u0161\xed zabezpe\u010den\xed, rychlost a nejlep\u0161\xed z\xe1\u017eitek z tohoto webu.",bupdate:"Aktualizovat prohl\xed\u017ee\u010d",bignore:"Ignorovat",remind:"Znovu budete upozorn\u011bni za {days} dn\u016f.",bnever:"Ji\u017e nezobrazovat"},r.cy={msg:"Mae eich porwr gwe ({brow_name}) angen ei ddiweddaru.",msgmore:"Diweddarwch eich porwr i gael mwy o ddiogelwch, cyflymder a'r profiad gorau ar y safle hwn.",bupdate:"Diweddaru porwr",bignore:"Anwybyddu",remind:"Byddwn yn eich atgoffa mewn {days} diwrnod.",bnever:"Peidiwch \xe2 dangos eto"},r.da={msg:"Din web browser ({brow_name}) er for\xe6ldet",msgmore:"Opdater din browser for mere sikkerhed, hastighed og den bedste oplevelse p\xe5 denne side.",bupdate:"Opdater browser",bignore:"Ignorer",remind:"Du vil blive p\xe5mindet om {days} dage.",bnever:"Vis aldrig igen"},r.de={msg:"Ihr Webbrowser ({brow_name}) ist veraltet.",msgmore:"Aktualisieren Sie Ihren Browser f\xfcr mehr Sicherheit, Geschwindigkeit und den besten Komfort auf dieser Seite.",bupdate:"Browser aktualisieren",bignore:"Ignorieren",remind:"Sie werden in {days} Tagen wieder erinnert.",bnever:"Nie wieder anzeigen"},r.el={msg:"\u03a4\u03bf \u03c0\u03c1\u03cc\u03b3\u03c1\u03b1\u03bc\u03bc\u03b1 \u03c0\u03b5\u03c1\u03b9\u03ae\u03b3\u03b7\u03c3\u03ae\u03c2 \u03c3\u03b1\u03c2 ({brow_name}) \u03b5\u03af\u03bd\u03b1\u03b9 \u03b1\u03c0\u03b1\u03c1\u03c7\u03b1\u03b9\u03c9\u03bc\u03ad\u03bd\u03bf.",msgmore:"\u0395\u03bd\u03b7\u03bc\u03b5\u03c1\u03ce\u03c3\u03c4\u03b5 \u03c4\u03bf \u03c0\u03c1\u03cc\u03b3\u03c1\u03b1\u03bc\u03bc\u03b1 \u03c0\u03b5\u03c1\u03b9\u03ae\u03b3\u03b7\u03c3\u03ae\u03c2 \u03c3\u03b1\u03c2 \u03b3\u03b9\u03b1 \u03c0\u03b5\u03c1\u03b9\u03c3\u03c3\u03cc\u03c4\u03b5\u03c1\u03b7 \u03b1\u03c3\u03c6\u03ac\u03bb\u03b5\u03b9\u03b1, \u03c4\u03b1\u03c7\u03cd\u03c4\u03b7\u03c4\u03b1 \u03ba\u03b1\u03b9 \u03c4\u03b7\u03bd \u03ba\u03b1\u03bb\u03cd\u03c4\u03b5\u03c1\u03b7 \u03b5\u03bc\u03c0\u03b5\u03b9\u03c1\u03af\u03b1 \u03c3' \u03b1\u03c5\u03c4\u03cc\u03bd \u03c4\u03bf\u03bd \u03b9\u03c3\u03c4\u03cc\u03c4\u03bf\u03c0\u03bf.",bupdate:"\u0395\u03bd\u03b7\u03bc\u03b5\u03c1\u03ce\u03c3\u03c4\u03b5 \u03c4\u03bf \u03c0\u03c1\u03cc\u03b3\u03c1\u03b1\u03bc\u03bc\u03b1 \u03c0\u03b5\u03c1\u03b9\u03ae\u03b3\u03b7\u03c3\u03b7\u03c2",bignore:"\u0391\u03b3\u03bd\u03bf\u03ae\u03c3\u03c4\u03b5",remind:"\u0398\u03b1 \u03c3\u03b1\u03c2 \u03c4\u03bf \u03c5\u03c0\u03b5\u03bd\u03b8\u03c5\u03bc\u03af\u03c3\u03bf\u03c5\u03bc\u03b5 \u03c3\u03b5 {days} \u03b7\u03bc\u03ad\u03c1\u03b5\u03c2.",bnever:"\u039d\u03b1 \u03bc\u03b7\u03bd \u03b5\u03bc\u03c6\u03b1\u03bd\u03b9\u03c3\u03c4\u03b5\u03af \u03be\u03b1\u03bd\u03ac"},r.es={msg:"Su navegador web ({brow_name}) est\xe1 desactualizado.",msgmore:"Actualice su navegador para obtener m\xe1s seguridad, velocidad y para disfrutar de la mejor experiencia en este sitio.",bupdate:"Actualizar navegador",bignore:"Ignorar",remind:"Se le recordar\xe1 en {days} d\xedas.",bnever:"No mostrar de nuevo"},r.et={msg:"Teie veebilehitseja ({brow_name}) on vananenud.",msgmore:"Veebilehitseja uuendamisega kaasneb nii parem turvalisus, kiirus kui ka kasutusmugavus.",bupdate:"Uuenda veebilehitsejat",bignore:"Eira",remind:"Uus meeldetuletus {days} p\xe4eva p\xe4rast.",bnever:"\xc4ra kunagi enam n\xe4ita"},r.fa={msg:"\u0645\u0631\u0648\u0631\u06af\u0631 \u0634\u0645\u0627 ({brow_name}) \u0642\u062f\u06cc\u0645\u06cc \u0627\u0633\u062a.",msgmore:"\u0628\u0631\u0627\u06cc \u0627\u06cc\u0645\u0646\u06cc\u060c \u0633\u0631\u0639\u062a \u0648 \u062a\u062c\u0631\u0628\u0647 \u0628\u0647\u062a\u0631 \u0645\u0631\u0648\u0631\u06af\u0631 \u062e\u0648\u062f \u0631\u0627 \u0628\u0647\u200c\u0631\u0648\u0632 \u06a9\u0646\u06cc\u062f.",bupdate:"\u0628\u0647\u200c\u0631\u0648\u0632\u0631\u0633\u0627\u0646\u06cc \u0645\u0631\u0648\u0631\u06af\u0631",bignore:"\u0646\u0627\u062f\u06cc\u062f\u0647 \u06af\u0631\u0641\u062a\u0646",remind:"\u0628\u0647 \u0634\u0645\u0627 \u062a\u0627 {days} \u0631\u0648\u0632 \u062f\u06cc\u06af\u0631 \u062f\u0648\u0628\u0627\u0631\u0647 \u06cc\u0627\u062f\u200c\u0622\u0648\u0631\u06cc \u062e\u0648\u0627\u0647\u062f \u0634\u062f.",bnever:"\u0647\u0631\u06af\u0632 \u0646\u0645\u0627\u06cc\u0634 \u0646\u062f\u0647"},r.fi={msg:"Selaimesi ({brow_name}) on vanhentunut.",msgmore:"P\xe4ivit\xe4 selaimesi saadaksesi tietoturvap\xe4ivityksi\xe4, nopeutta sek\xe4 parhaan k\xe4ytt\xf6kokemuksen sivustolla.",bupdate:"P\xe4ivit\xe4 selain",bignore:"Ohita",remind:"Saat uuden muistutuksen {days} p\xe4iv\xe4n p\xe4\xe4st\xe4.",bnever:"\xc4l\xe4 n\xe4yt\xe4 uudestaan"},r.fr={msg:"Votre navigateur Web ({brow_name}) n'est pas \xe0 jour.",msgmore:"Mettez \xe0 jour votre navigateur pour plus de s\xe9curit\xe9 et de rapidit\xe9 et une meilleure exp\xe9rience sur ce site.",bupdate:"Mettre \xe0 jour le navigateur",bignore:"Ignorer",remind:"Vous serez rappel\xe9 dans {days} jours.",bnever:"Ne plus afficher"},r.gl={msg:"T\xe1 an l\xedonl\xe9itheoir agat ({brow_name}) as d\xe1ta.",msgmore:"Actualiza o teu navegador para obter m\xe1is seguridade, rapidez e mellor experiencia neste sitio.",bupdate:"Actualizar navegador web",bignore:"Ignorar",remind:"Lembraralle en {days} d\xedas.",bnever:"Non volver mostrar m\xe1is"},r.he={msg:"\u05d3\u05e4\u05d3\u05e4\u05df ({brow_name}) \u05e9\u05dc\u05da \u05d0\u05d9\u05e0\u05d5 \u05de\u05e2\u05d5\u05d3\u05db\u05df.",msgmore:"\u05e2\u05d3\u05db\u05df/\u05d9 \u05d0\u05ea \u05d4\u05d3\u05e4\u05d3\u05e4\u05df \u05e9\u05dc\u05da \u05dc\u05e9\u05d9\u05e4\u05d5\u05e8 \u05d4\u05d0\u05d1\u05d8\u05d7\u05d4 \u05d5\u05d4\u05de\u05d4\u05d9\u05e8\u05d5\u05ea \u05d5\u05db\u05d3\u05d9 \u05dc\u05d9\u05d4\u05e0\u05d5\u05ea \u05de\u05d4\u05d7\u05d5\u05d5\u05d9\u05d4 \u05d4\u05d8\u05d5\u05d1\u05d4 \u05d1\u05d9\u05d5\u05ea\u05e8 \u05d1\u05d0\u05ea\u05e8 \u05d6\u05d4.",bupdate:"\u05e2\u05d3\u05db\u05df \u05d3\u05e4\u05d3\u05e4\u05df",bignore:"\u05d4\u05ea\u05e2\u05dc\u05dd",remind:"\u05ea\u05e7\u05d1\u05dc/\u05d9 \u05ea\u05d6\u05db\u05d5\u05e8\u05ea \u05d1\u05e2\u05d5\u05d3  {days} \u05d9\u05de\u05d9\u05dd.",bnever:"\u05d0\u05dc \u05ea\u05e6\u05d9\u05d2 \u05e9\u05d5\u05d1"},r.hi={msg:"\u0906\u092a\u0915\u093e \u0935\u0947\u092c \u092c\u094d\u0930\u093e\u0909\u091c\u093c\u0930 ({brow_name}) \u092a\u0941\u0930\u093e\u0928\u093e \u0939\u0948\u0964",msgmore:"\u0907\u0938 \u0938\u093e\u0907\u091f \u092a\u0930 \u0905\u0927\u093f\u0915 \u0938\u0941\u0930\u0915\u094d\u0937\u093e, \u0917\u0924\u093f \u0914\u0930 \u0938\u0930\u094d\u0935\u094b\u0924\u094d\u0924\u092e \u0905\u0928\u0941\u092d\u0935 \u0915\u0930\u0928\u0947 \u0915\u0947 \u0932\u093f\u090f \u0905\u092a\u0928\u0947 \u092c\u094d\u0930\u093e\u0909\u095b\u0930 \u0915\u094b \u0905\u092a\u0921\u0947\u091f \u0915\u0930\u0947\u0902 \u0964",bupdate:"\u092c\u094d\u0930\u093e\u0909\u091c\u093c\u0930 \u0905\u092a\u0921\u0947\u091f \u0915\u0930\u0947\u0902",bignore:"\u0928\u091c\u0930\u0905\u0902\u0926\u093e\u091c \u0915\u0930\u0947\u0902",remind:"\u0906\u092a\u0915\u094b {days} \u0926\u093f\u0928\u094b\u0902 \u092e\u0947\u0902 \u092f\u093e\u0926 \u0926\u093f\u0932\u093e\u092f\u093e \u091c\u093e\u090f\u0917\u093e\u0964",bnever:"\u092b\u093f\u0930 \u0915\u092d\u0940 \u092e\u0924 \u0926\u093f\u0916\u093e\u0928\u093e"},r.hu={msg:"Az \xd6n webb\xf6ng\xe9sz\u0151je ({brow_name}) elavult.",msgmore:"Friss\xedtse b\xf6ng\xe9sz\u0151j\xe9t a nagyobb biztons\xe1g, sebess\xe9g \xe9s \xe9lm\xe9ny \xe9rdek\xe9ben!",bupdate:"B\xf6ng\xe9sz\u0151 friss\xedt\xe9se",bignore:"Mell\u0151z\xe9s",remind:"\xdajra eml\xe9keztet\xfcnk {days} napon bel\xfcl.",bnever:"Ne mutassa t\xf6bbet"},r.id={msg:"Peramban web ({brow_name}) Anda sudah usang.",msgmore:"Perbarui peramban Anda untuk pengalaman terbaik, lebih aman, dan cepat di situs ini.",bupdate:"Perbarui peramban",bignore:"Abaikan",remind:"Anda akan diingatkan kembali dalam {days} hari.",bnever:"Jangan pernah tampilkan lagi"},r.it={msg:"Il tuo browser ({brow_name}) non \xe8 aggiornato.",msgmore:"Aggiorna il browser per una maggiore sicurezza, velocit\xe0 e la migliore esperienza su questo sito.",bupdate:"Aggiorna browser",bignore:"Ignora",remind:"Riceverai un promemoria tra {days} giorni.",bnever:"Non mostrare di nuovo"},r.ja={msg:"\u304a\u4f7f\u3044\u306e\u30d6\u30e9\u30a6\u30b6\uff08{brow_name}\uff09\u306f\u6700\u65b0\u7248\u3067\u306f\u3042\u308a\u307e\u305b\u3093\u3002",msgmore:"\u30bb\u30ad\u30e5\u30ea\u30c6\u30a3\u3001\u30b9\u30d4\u30fc\u30c9\u3001\u305d\u3057\u3066\u3053\u306e\u30b5\u30a4\u30c8\u3067\u306e\u6700\u826f\u306e\u4f53\u9a13\u306e\u305f\u3081\u306b\u304a\u4f7f\u3044\u306e\u30d6\u30e9\u30a6\u30b6\u3092\u66f4\u65b0\u3057\u3066\u304f\u3060\u3055\u3044\u3002",bupdate:"\u30d6\u30e9\u30a6\u30b6\u3092\u66f4\u65b0\u3059\u308b",bignore:"\u7121\u8996\u3059\u308b",remind:"{days} \u65e5\u5f8c\u306b\u3082\u3046\u4e00\u5ea6\u304a\u77e5\u3089\u305b\u3057\u307e\u3059\u3002",bnever:"\u6b21\u56de\u304b\u3089\u8868\u793a\u3057\u306a\u3044"},r.ko={msg:"\uadc0\ud558\uc758 \uc6f9 \ube0c\ub77c\uc6b0\uc800({brow_name})\ub294 \uc624\ub798\ub418\uc5c8\uc2b5\ub2c8\ub2e4.",msgmore:"\uc774 \uc0ac\uc774\ud2b8\uc5d0\uc11c \ubcf4\uc548, \uc18d\ub3c4\uc640 \ucd5c\uc0c1\uc758 \uacbd\ud5d8\uc744 \uc5bb\uc73c\ub824\uba74 \ube0c\ub77c\uc6b0\uc800\ub97c \uc5c5\ub370\uc774\ud2b8\ud558\uc2ed\uc2dc\uc624.",bupdate:"\ube0c\ub77c\uc6b0\uc800 \uc5c5\ub370\uc774\ud2b8\ud558\uae30",bignore:"\ubb34\uc2dc\ud558\uae30",remind:"{days}\uc77c \ud6c4\uc5d0 \uc54c\ub824 \ub4dc\ub9bd\ub2c8\ub2e4.",bnever:"\ub2e4\uc2dc \ud45c\uc2dc\ud558\uc9c0 \uc54a\uae30"},r.lt={msg:"J\u016bs\u0173 nar\u0161ykl\u0117 ({brow_name}) yra pasenusi.",msgmore:"Atsinaujinkite savo nar\u0161ykl\u0119 nor\u0117dami gauti daugiau saugumo, grei\u010dio ir pa\u010di\u0173 geriausi\u0173 patir\u010di\u0173 \u0161ioje svetain\u0117je.",bupdate:"Atnaujinti nar\u0161ykl\u0119",bignore:"Nepaisyti",remind:"Jums bus priminta po {days} dien\u0173.",bnever:"Daugiau niekada nerodyti"},r.lv={msg:"J\u016bsu p\u0101rl\u016bkprogramma ({brow_name}) ir novecojusi.",msgmore:"Atjaunojiet savu p\u0101rl\u016bkprogrammu liel\u0101kai dro\u0161\u012bbai, \u0101trumam un lab\u0101kai pieredzei ar \u0161o vietni.",bupdate:"Atjaunin\u0101t p\u0101rl\u016bkprogrammu",bignore:"Ignor\u0113t",remind:"Jums tiks par\u0101d\u012bts atg\u0101din\u0101jums p\u0113c {days} dien\u0101m.",bnever:"Vairs ner\u0101d\u012bt"},r.ms={msg:"Pelayar web anda ({brow_name}) sudah lapuk.",msgmore:"Kemas kini pelayar anda untuk lebih keselamatan, kelajuan dan pengalaman terbaik di laman web ini.",bupdate:"Kemas kini pelayar",bignore:"Abaikan",remind:"Anda akan diingatkan dalam {days} hari.",bnever:"Jangan tunjukkan lagi"},r.nl={msg:"Uw webbrowser ({brow_name}) is verouderd.",msgmore:"Update uw browser voor meer veiligheid, snelheid en om deze site optimaal te kunnen gebruiken.",bupdate:"Browser updaten",bignore:"Negeren",remind:"We zullen u er in {days} dagen aan herinneren.",bnever:"Nooit meer tonen"},r.no=r.nn=r.nb={msg:"Nettleseren din ({brow_name}) er utdatert.",msgmore:"Oppdater nettleseren din for \xf8kt sikkerhet, hastighet og den beste opplevelsen p\xe5 dette nettstedet.",bupdate:"Oppdater nettleser",bignore:"Ignorer",remind:"Du vil f\xe5 en p\xe5minnelse om {days} dager.",bnever:"Aldri vis igjen"},r.pl={msg:"Twoja przegl\u0105darka ({brow_name}) jest nieaktualna.",msgmore:"Zaktualizuj przegl\u0105dark\u0119, by korzysta\u0107 z tej strony bezpieczniej, szybciej i po prostu sprawniej.",bupdate:"Aktualizuj przegl\u0105dark\u0119",bignore:"Ignoruj",remind:"Przypomnimy o tym za {days} dni.",bnever:"Nie pokazuj wi\u0119cej"},r.pt={msg:"Seu navegador da web ({brow_name}) est\xe1 desatualizado.",msgmore:"Atualize seu navegador para ter mais seguran\xe7a e velocidade, al\xe9m da melhor experi\xeancia neste site.",bupdate:"Atualizar navegador",bignore:"Ignorar",remind:"Voc\xea ser\xe1 relembrado em {days} dias.",bnever:"N\xe3o mostrar novamente"},r.ro={msg:"Browserul t\u0103u ({brow_name}) nu este actualizat.",msgmore:"Actualizeaz\u0103 browserul pentru o mai mare siguran\u021b\u0103, vitez\u0103 \u0219i cea mai bun\u0103 experien\u021b\u0103 pe acest site.",bupdate:"Actualizeaz\u0103 browser",bignore:"Ignor\u0103",remind:"\u021ai se va reaminti peste {days} zile.",bnever:"Nu mai ar\u0103ta"},r.ru={msg:"\u0412\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 ({brow_name}) \u0443\u0441\u0442\u0430\u0440\u0435\u043b.",msgmore:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u0435 \u0432\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0434\u043b\u044f \u043f\u043e\u0432\u044b\u0448\u0435\u043d\u0438\u044f \u0443\u0440\u043e\u0432\u043d\u044f \u0431\u0435\u0437\u043e\u043f\u0430\u0441\u043d\u043e\u0441\u0442\u0438, \u0441\u043a\u043e\u0440\u043e\u0441\u0442\u0438 \u0438 \u043a\u043e\u043c\u0444\u043e\u0440\u0442\u0430 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u043d\u0438\u044f \u044d\u0442\u043e\u0433\u043e \u0441\u0430\u0439\u0442\u0430.",bupdate:"\u041e\u0431\u043d\u043e\u0432\u0438\u0442\u044c \u0431\u0440\u0430\u0443\u0437\u0435\u0440",bignore:"\u0418\u0433\u043d\u043e\u0440\u0438\u0440\u043e\u0432\u0430\u0442\u044c",remind:"\u0412\u044b \u043f\u043e\u043b\u0443\u0447\u0438\u0442\u0435 \u043d\u0430\u043f\u043e\u043c\u0438\u043d\u0430\u043d\u0438\u0435 \u0447\u0435\u0440\u0435\u0437 {days} \u0434\u043d\u0435\u0439.",bnever:"\u0411\u043e\u043b\u044c\u0448\u0435 \u043d\u0435 \u043f\u043e\u043a\u0430\u0437\u044b\u0432\u0430\u0442\u044c "},r.sk={msg:"V\xe1\u0161 internetov\xfd prehliada\u010d ({brow_name}) je zastaran\xfd.",msgmore:"Pre v\xe4\u010d\u0161iu bezpe\u010dnos\u0165, r\xfdchlos\u0165 a lep\u0161iu sk\xfasenos\u0165 s touto str\xe1nkou si aktualizujte svoj prehliada\u010d.",bupdate:"Aktualizova\u0165 prehliada\u010d",bignore:"Ignorova\u0165",remind:"Bude v\xe1m to pripomenut\xe9 o {days} dn\xed.",bnever:"U\u017e nikdy viac neukazova\u0165"},r.sl={msg:"Va\u0161 spletni brskalnik ({brow_name}) je zastarel.",msgmore:"Posodobite svoj brskalnik za dodatno varnost, hitrost in najbolj\u0161o izku\u0161njo na tem spletnem mestu.",bupdate:"Posodobi brskalnik",bignore:"Prezri",remind:"Opomnik boste prejeli \u010dez toliko dni: {days}.",bnever:"Ne prika\u017ei ve\u010d"},r.sq={msg:"Shfletuesi juaj ({brow_name}) \xebsht\xeb i vjetruar.",msgmore:"P\xebrdit\xebsoni shfletuesin tuaj p\xebr m\xeb tep\xebr siguri, shpejt\xebsi dhe p\xebr m\xeb t\xeb mirin e funksionimeve n\xeb k\xebt\xeb sajt.",bupdate:"P\xebrdit\xebso shfletuesin",bignore:"Shp\xebrfille",remind:"Do t\u2019ju rikujtohet pas {days} dit\xebsh.",bnever:"Mos e shfaq kurr\xeb m\xeb"},r.sr={msg:"Va\u0161 pretra\u017eiva\u010d ({brow_name}) je zastareo.",msgmore:"Ima poznate sigurnosne probleme i najverovatnije ne\u0107e prikazati sve funkcionalnisti ovog i drugih sajtova.",bupdate:"Nadogradi pretra\u017eiva\u010d",bignore:"Ignorisi",remind:"Zaboravic\u0301ete za {days} dana.",bnever:"Ne prikazuj opet"},r.sv={msg:"Din webbl\xe4sare ({brow_name}) \xe4r f\xf6r\xe5ldrad. ",msgmore:"Uppdatera din webbl\xe4sare f\xf6r mer s\xe4kerhet, hastighet och den b\xe4sta upplevelsen p\xe5 den h\xe4r sajten. ",bupdate:"Uppdatera webbl\xe4saren",bignore:"Ignorera",remind:"Du f\xe5r en p\xe5minnelse om {days} dagar.",bnever:"Visa aldrig igen"},r.th={msg:"\u0e40\u0e27\u0e47\u0e1a\u0e40\u0e1a\u0e23\u0e32\u0e27\u0e4c\u0e40\u0e0b\u0e2d\u0e23\u0e4c\u0e02\u0e2d\u0e07\u0e04\u0e38\u0e13 ({brow_name}) \u0e25\u0e49\u0e32\u0e2a\u0e21\u0e31\u0e22\u0e41\u0e25\u0e49\u0e27",msgmore:"\u0e2d\u0e31\u0e1b\u0e40\u0e14\u0e17\u0e40\u0e1a\u0e23\u0e32\u0e27\u0e4c\u0e40\u0e0b\u0e2d\u0e23\u0e4c\u0e40\u0e1e\u0e37\u0e48\u0e2d\u0e40\u0e1e\u0e34\u0e48\u0e21\u0e04\u0e27\u0e32\u0e21\u0e1b\u0e25\u0e2d\u0e14\u0e20\u0e31\u0e22, \u0e04\u0e27\u0e32\u0e21\u0e40\u0e23\u0e47\u0e27 \u0e41\u0e25\u0e30\u0e1b\u0e23\u0e30\u0e2a\u0e1a\u0e01\u0e32\u0e23\u0e13\u0e4c\u0e17\u0e35\u0e48\u0e14\u0e35\u0e17\u0e35\u0e48\u0e2a\u0e38\u0e14\u0e1a\u0e19\u0e40\u0e27\u0e47\u0e1a\u0e44\u0e0b\u0e15\u0e4c\u0e19\u0e35\u0e49",bupdate:"\u0e2d\u0e31\u0e1b\u0e40\u0e14\u0e17\u0e40\u0e1a\u0e23\u0e32\u0e27\u0e4c\u0e40\u0e0b\u0e2d\u0e23\u0e4c",bignore:"\u0e02\u0e49\u0e32\u0e21",remind:"\u0e04\u0e38\u0e13\u0e08\u0e30\u0e44\u0e14\u0e49\u0e23\u0e31\u0e1a\u0e01\u0e32\u0e23\u0e41\u0e08\u0e49\u0e07\u0e40\u0e15\u0e37\u0e2d\u0e19\u0e43\u0e19 {days} \u0e27\u0e31\u0e19",bnever:"\u0e44\u0e21\u0e48\u0e15\u0e49\u0e2d\u0e07\u0e41\u0e2a\u0e14\u0e07\u0e2d\u0e35\u0e01"},r.tr={msg:"Web taray\u0131c\u0131n\u0131z ({brow_name}) g\xfcncel de\u011fil.",msgmore:"Daha fazla g\xfcvenlik ve h\u0131z ile bu sitede en iyi deneyim i\xe7in taray\u0131c\u0131n\u0131z\u0131 g\xfcncelleyin.",bupdate:"Taray\u0131c\u0131y\u0131 g\xfcncelle",bignore:"Yok say",remind:"{days} g\xfcn sonra bir hat\u0131rlatma alacaks\u0131n\u0131z.",bnever:"Bir daha g\xf6sterme"},r.uk={msg:"\u0412\u0430\u0448 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 ({brow_name}) \u0437\u0430\u0441\u0442\u0430\u0440\u0456\u043b\u0438\u0439.",msgmore:"\u041e\u043d\u043e\u0432\u0456\u0442\u044c \u0441\u0432\u0456\u0439 \u0431\u0440\u0430\u0443\u0437\u0435\u0440 \u0434\u043b\u044f \u0431\u0456\u043b\u044c\u0448\u043e\u0457 \u0431\u0435\u0437\u043f\u0435\u043a\u0438, \u0448\u0432\u0438\u0434\u043a\u043e\u0441\u0442\u0456 \u0442\u0430 \u043f\u043e\u0432\u043d\u043e\u0446\u0456\u043d\u043d\u043e\u0457 \u0440\u043e\u0431\u043e\u0442\u0438 \u0446\u044c\u043e\u0433\u043e \u0441\u0430\u0439\u0442\u0443.",bupdate:"\u041e\u043d\u043e\u0432\u0438\u0442\u0438 \u0431\u0440\u0430\u0443\u0437\u0435\u0440",bignore:"\u041f\u0440\u043e\u043f\u0443\u0441\u0442\u0438\u0442\u0438",remind:"\u0412\u0438 \u043e\u0442\u0440\u0438\u043c\u0430\u0454\u0442\u0435 \u043d\u0430\u0433\u0430\u0434\u0443\u0432\u0430\u043d\u043d\u044f \u0447\u0435\u0440\u0435\u0437 {days} \u0434\u043d\u0456\u0432.",bnever:"\u0411\u0456\u043b\u044c\u0448\u0435 \u043d\u0435 \u043f\u043e\u043a\u0430\u0437\u0443\u0432\u0430\u0442\u0438"},r.uz={msg:"Sizning ({brow_name}) veb-brauzeringiz eskirgan",msgmore:"Xavfsizlik, tezkorlik va ushbu sayt imkoniyatlaridan to`liq foydalanish uchun brauzeringizni yangilang.",bupdate:"Brauzeringizni yangilang",bignore:"E\u2019tibor bermaslik",remind:"Sizga {days} kundan so`ng eslatammiz.",bnever:"Hech qachon qayta ko'rsatmang"},r.vi={msg:"Tr\xecnh duy\u1ec7t web c\u1ee7a b\u1ea1n ({brow_name}) \u0111\xe3 l\u1ed7i th\u1eddi.",msgmore:"C\u1eadp nh\u1eadt tr\xecnh duy\u1ec7t c\u1ee7a b\u1ea1n \u0111\u1ec3 c\xf3 th\xeam b\u1ea3o m\u1eadt, t\u1ed1c \u0111\u1ed9 v\xe0 tr\u1ea3i nghi\u1ec7m t\u1ed1t nh\u1ea5t tr\xean trang web n\xe0y.",bupdate:"C\u1eadp nh\u1eadt tr\xecnh duy\u1ec7t",bignore:"B\u1ecf qua",remind:"B\u1ea1n s\u1ebd \u0111\u01b0\u1ee3c nh\u1eafc nh\u1edf sau {days} ng\xe0y.",bnever:"Kh\xf4ng bao gi\u1edd hi\u1ec3n th\u1ecb l\u1ea1i"},r.zh={msg:"\u60a8\u7684\u7f51\u9875\u6d4f\u89c8\u5668\uff08{brow_name}\uff09\u5df2\u8fc7\u671f\u3002",msgmore:"\u66f4\u65b0\u60a8\u7684\u6d4f\u89c8\u5668\uff0c\u4ee5\u4fbf\u5728\u8be5\u7f51\u7ad9\u4e0a\u83b7\u5f97\u66f4\u5b89\u5168\u3001\u66f4\u5feb\u901f\u548c\u6700\u597d\u7684\u4f53\u9a8c\u3002",bupdate:"\u66f4\u65b0\u6d4f\u89c8\u5668",bignore:"\u5ffd\u7565",remind:"\u4f1a\u5728{days}\u5929\u540e\u63d0\u9192\u60a8\u3002",bnever:"\u4e0d\u518d\u663e\u793a"},r["zh-tw"]=r["zh-hans-cn"]={msg:"\u60a8\u7684\u7db2\u8def\u700f\u89bd\u5668\uff08{brow_name}\uff09\u5df2\u904e\u820a\u3002",msgmore:"\u66f4\u65b0\u60a8\u7684\u700f\u89bd\u5668\u4ee5\u7372\u5f97\u66f4\u4f73\u7684\u5b89\u5168\u6027\u3001\u901f\u5ea6\u4ee5\u53ca\u5728\u6b64\u7db2\u7ad9\u7684\u6700\u4f73\u9ad4\u9a57\u3002",bupdate:"\u66f4\u65b0\u700f\u89bd\u5668",bignore:"\u5ffd\u7565",remind:"\u60a8\u5c07\u5728 {days} \u5929\u5f8c\u6536\u5230\u63d0\u9192\u3002",bnever:"\u4e0d\u8981\u518d\u986f\u793a"};var o=e["text_for_"+t.n+"_in_"+e.ll]||e["text_for_"+t.n]||e["text_"+e.llfull]||e["text_in_"+e.ll]||e["text_"+e.ll]||e.text;if(r=i=r[e.llfull]||r[e.ll]||r.en,o)if("string"==typeof o)r=i=o;else for(var a in o)i[a]=o[a];i.msg&&(r='<b class="buorg-mainmsg">'+r.msg+'</b> <span class="buorg-moremsg">'+r.msgmore+'</span> <span class="buorg-buttons"><a{up_but}>'+r.bupdate+"</a> <a{ignore_but}>"+r.bignore+"</a></span>");var s="";e.newwindow&&(s=' target="_blank" rel="noopener"');var l=e.div=document.createElement("div");l.id=l.className="buorg";var d="<style>.buorg-icon {width: 22px; height: 16px; vertical-align: middle; position: relative; top: -0.05em; display: inline-block; background: no-repeat 0px center url(https://browser-update.org/static/img/small/"+t.n+".png);}</style>",u="<style>.buorg {position:absolute;position:fixed;z-index:111111; width:100%; top:0px; left:0px; border-bottom:1px solid #A29330; text-align:center;  color:#000; background-color: #fff8ea; font: 18px Calibri,Helvetica,sans-serif; box-shadow: 0 0 5px rgba(0,0,0,0.2);animation: buorgfly 1s ease-out 0s;}.buorg-pad { padding: 9px;  line-height: 1.7em; }.buorg-buttons { display: block; text-align: center; }#buorgig,#buorgul,#buorgpermanent { color: #fff; text-decoration: none; cursor:pointer; box-shadow: 0 0 2px rgba(0,0,0,0.4); padding: 1px 10px; border-radius: 4px; font-weight: normal; background: #5ab400;    white-space: nowrap;    margin: 0 2px; display: inline-block;}#buorgig { background-color: #edbc68;}@media only screen and (max-width: 700px){.buorg div { padding:5px 12px 5px 9px; line-height: 1.3em;}}@keyframes buorgfly {from {opacity:0;transform:translateY(-50px)} to {opacity:1;transform:translateY(0px)}}.buorg-fadeout {transition: visibility 0s 8.5s, opacity 8s ease-out .5s;}</style>";!i.msg||"ar"!=e.ll&&"he"!=e.ll&&"fa"!=e.ll||(u+="<style>.buorg {direction:RTL; unicode-bidi:embed;}</style>"),!i.msg&&r.indexOf&&-1!==r.indexOf("%s")?(r=function(){for(var e=arguments,t=e[0],n=1;n<e.length;++n)t=t.replace(/%s/,e[n]);return t}(r,t.t,' id="buorgul" href="'+e.url+'"'+s),d+="<style>.buorg {position:absolute;position:fixed;z-index:111111; width:100%; top:0px; left:0px; border-bottom:1px solid #A29330; text-align:left; cursor:pointer; color:#000; font: 13px Arial,sans-serif;color:#000;}.buorg div { padding:5px 36px 5px 40px; }.buorg>div>a,.buorg>div>a:visited{color:#E25600; text-decoration: underline;}#buorgclose{position:absolute;right:6px;top:0px;height:20px;width:12px;font:18px bold;padding:0;}#buorga{display:block;}@media only screen and (max-width: 700px){.buorg div { padding:5px 15px 5px 9px; }}</style>",l.innerHTML="<div>"+r+'<div id="buorgclose"><a id="buorga">&times;</a></div></div>'+d,e.addmargin=!0):("bottom"===e.style?u+="<style>.buorg {bottom:0; top:auto; border-top:1px solid #A29330; } @keyframes buorgfly {from {opacity:0;transform:translateY(50px)} to {opacity:1;transform:translateY(0px)}}</style>":"corner"===e.style?u+="<style> .buorg { text-align: left; width:300px; top:50px; right:50px; left:auto; border:1px solid #A29330; } .buorg-buttons, .buorg-mainmsg, .buorg-moremsg { display: block; } .buorg-buttons a {margin: 4px 2px;} .buorg-icon {display: none;}</style>":e.addmargin=!0,r=r.replace("{brow_name}",t.t).replace("{up_but}",' id="buorgul" href="'+e.url+'"'+s).replace("{ignore_but}",' id="buorgig" role="button" tabindex="0"'),l.innerHTML='<div class="buorg-pad" role="status" aria-live="polite"><span class="buorg-icon"> </span>'+r+"</div>"+d+u),e.text=r,e.container?(e.container.appendChild(l),e.addmargin=!1):document.body.insertBefore(l,document.body.firstChild);var c=document.getElementById("buorgul");if(c&&(c.onclick=function(t){l.onclick=null,e.onclick(e),e.noclose||(e.setCookie(e.reminderClosed),e.noclose||(l.style.display="none",e.addmargin&&!1!==e.shift_page_down&&(h.style.marginTop=e.bodymt)))}),o||(l.style.cursor="pointer",l.onclick=function(){e.newwindow?window.open(e.url,"_blank"):window.location.href=e.url,e.setCookie(e.reminderClosed),e.onclick(e)}),e.addmargin&&!1!==e.shift_page_down){var h=document.getElementsByTagName("html")[0]||document.body;e.bodymt=h.style.marginTop,h.style.marginTop=l.clientHeight+"px"}var f=document.getElementById("buorga")||document.getElementById("buorgig");if(f&&(f.onclick=function(t){return l.onclick=null,e.onclose(e),e.addmargin&&!1!==e.shift_page_down&&(h.style.marginTop=e.bodymt),e.setCookie(e.reminderClosed),!e.no_permanent_hide&&i.bnever&&i.remind?(e.div.innerHTML='<div class="buorg-pad"><span class="buorg-moremsg">'+(e.reminderClosed>24?i.remind.replace("{days}",Math.round(e.reminderClosed/24)):"")+'</span> <span class="buorg-buttons"><a id="buorgpermanent" role="button" tabindex="0" href="'+e.url_permanent_hide+'"'+s+">"+i.bnever+"</a></span></div>"+d+u,l.className="buorg buorg-fadeout",document.getElementById("buorgpermanent").onclick=function(t){e.setCookie(8760),e.div.style.display="none"},e.div.style.opacity=0,e.div.style.visibility="hidden",!1):(e.div.style.display="none",!1)},(e.noclose||0==e.reminderClosed)&&f.parentNode.removeChild(f)),e.onshow(e),e.test&&!e.dont_show_debuginfo){var p=document.createElement("script");p.src=e.domain+"/update.test.js",document.body.appendChild(p)}};!function(){function dtmlXMLLoaderObject(e,t,n,i){return this.xmlDoc="",this.async=void 0===n||n,this.onloadAction=e||null,this.mainObject=t||null,this.waitCall=null,this.rSeed=i||!1,this}function dhtmlDragAndDropObject(){return window.dhtmlDragAndDrop?window.dhtmlDragAndDrop:(this.lastLanding=0,this.dragNode=0,this.dragStartNode=0,this.dragStartObject=0,this.tempDOMU=null,this.tempDOMM=null,this.waitDrag=0,window.dhtmlDragAndDrop=this,this)}function _dhtmlxError(e,t,n){return this.catches||(this.catches=[]),this}function dhtmlXHeir(e,t){for(var n in t)"function"==typeof t[n]&&(e[n]=t[n]);return e}window.dhtmlx||(window.dhtmlx=function(e){for(var t in e)dhtmlx[t]=e[t];return dhtmlx}),dhtmlx.extend_api=function(e,t,n){var i=window[e];i&&(window[e]=function(e){var n;if(e&&"object"==typeof e&&!e.tagName){for(var r in n=i.apply(this,t._init?t._init(e):arguments),dhtmlx)t[r]&&this[t[r]](dhtmlx[r]);for(var r in e)t[r]?this[t[r]](e[r]):0===r.indexOf("on")&&this.attachEvent(r,e[r])}else n=i.apply(this,arguments);return t._patch&&t._patch(this),n||this},window[e].prototype=i.prototype,n&&dhtmlXHeir(window[e].prototype,n))},window.dhtmlxAjax={get:function(e,t){var n=new dtmlXMLLoaderObject(!0);return n.async=arguments.length<3,n.waitCall=t,n.loadXML(e),n},post:function(e,t,n){var i=new dtmlXMLLoaderObject(!0);return i.async=arguments.length<4,i.waitCall=n,i.loadXML(e,!0,t),i},getSync:function(e){return this.get(e,null,!0)},postSync:function(e,t){return this.post(e,t,null,!0)}},window.dtmlXMLLoaderObject=dtmlXMLLoaderObject,dtmlXMLLoaderObject.count=0,dtmlXMLLoaderObject.prototype.waitLoadFunction=function(e){var t=!0;return this.check=function(){if(e&&e.onloadAction&&(!e.xmlDoc.readyState||4==e.xmlDoc.readyState)){if(!t)return;t=!1,dtmlXMLLoaderObject.count++,"function"==typeof e.onloadAction&&e.onloadAction(e.mainObject,null,null,null,e),e.waitCall&&(e.waitCall.call(this,e),e.waitCall=null)}},this.check},dtmlXMLLoaderObject.prototype.getXMLTopNode=function(e,t){var n;if(this.xmlDoc.responseXML){if(0===(i=this.xmlDoc.responseXML.getElementsByTagName(e)).length&&-1!=e.indexOf(":"))var i=this.xmlDoc.responseXML.getElementsByTagName(e.split(":")[1]);n=i[0]}else n=this.xmlDoc.documentElement;if(n)return this._retry=!1,n;if(!this._retry&&_isIE){this._retry=!0;t=this.xmlDoc;return this.loadXMLString(this.xmlDoc.responseText.replace(/^[\s]+/,""),!0),this.getXMLTopNode(e,t)}return dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),document.createElement("div")},dtmlXMLLoaderObject.prototype.loadXMLString=function(e,t){if(_isIE)this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async=this.async,this.xmlDoc.onreadystatechange=function(){},this.xmlDoc.loadXML(e);else{var n=new DOMParser;this.xmlDoc=n.parseFromString(e,"text/xml")}t||(this.onloadAction&&this.onloadAction(this.mainObject,null,null,null,this),this.waitCall&&(this.waitCall(),this.waitCall=null))},dtmlXMLLoaderObject.prototype.loadXML=function(e,t,n,i){this.rSeed&&(e+=(-1!=e.indexOf("?")?"&":"?")+"a_dhx_rSeed="+(new Date).valueOf()),this.filePath=e,!_isIE&&window.XMLHttpRequest?this.xmlDoc=new XMLHttpRequest:this.xmlDoc=new ActiveXObject("Microsoft.XMLHTTP"),this.async&&(this.xmlDoc.onreadystatechange=new this.waitLoadFunction(this)),"string"==typeof t?this.xmlDoc.open(t,e,this.async):this.xmlDoc.open(t?"POST":"GET",e,this.async),i?(this.xmlDoc.setRequestHeader("User-Agent","dhtmlxRPC v0.1 ("+navigator.userAgent+")"),this.xmlDoc.setRequestHeader("Content-type","text/xml")):t&&this.xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),this.xmlDoc.setRequestHeader("X-Requested-With","XMLHttpRequest"),this.xmlDoc.send(n),this.async||new this.waitLoadFunction(this)()},dtmlXMLLoaderObject.prototype.destructor=function(){return this._filterXPath=null,this._getAllNamedChilds=null,this._retry=null,this.async=null,this.rSeed=null,this.filePath=null,this.onloadAction=null,this.mainObject=null,this.xmlDoc=null,this.doXPath=null,this.doXPathOpera=null,this.doXSLTransToObject=null,this.doXSLTransToString=null,this.loadXML=null,this.loadXMLString=null,this.doSerialization=null,this.xmlNodeToJSON=null,this.getXMLTopNode=null,this.setXSLParamValue=null,null},dtmlXMLLoaderObject.prototype.xmlNodeToJSON=function(e){for(var t={},n=0;n<e.attributes.length;n++)t[e.attributes[n].name]=e.attributes[n].value;t._tagvalue=e.firstChild?e.firstChild.nodeValue:"";for(n=0;n<e.childNodes.length;n++){var i=e.childNodes[n].tagName;i&&(t[i]||(t[i]=[]),t[i].push(this.xmlNodeToJSON(e.childNodes[n])))}return t},window.dhtmlDragAndDropObject=dhtmlDragAndDropObject,dhtmlDragAndDropObject.prototype.removeDraggableItem=function(e){e.onmousedown=null,e.dragStarter=null,e.dragLanding=null},dhtmlDragAndDropObject.prototype.addDraggableItem=function(e,t){e.onmousedown=this.preCreateDragCopy,e.dragStarter=t,this.addDragLanding(e,t)},dhtmlDragAndDropObject.prototype.addDragLanding=function(e,t){e.dragLanding=t},dhtmlDragAndDropObject.prototype.preCreateDragCopy=function(e){if(!e&&!window.event||2!=(e||event).button)return window.dhtmlDragAndDrop.waitDrag?(window.dhtmlDragAndDrop.waitDrag=0,document.body.onmouseup=window.dhtmlDragAndDrop.tempDOMU,document.body.onmousemove=window.dhtmlDragAndDrop.tempDOMM,!1):(window.dhtmlDragAndDrop.dragNode&&window.dhtmlDragAndDrop.stopDrag(e),window.dhtmlDragAndDrop.waitDrag=1,window.dhtmlDragAndDrop.tempDOMU=document.body.onmouseup,window.dhtmlDragAndDrop.tempDOMM=document.body.onmousemove,window.dhtmlDragAndDrop.dragStartNode=this,window.dhtmlDragAndDrop.dragStartObject=this.dragStarter,document.body.onmouseup=window.dhtmlDragAndDrop.preCreateDragCopy,document.body.onmousemove=window.dhtmlDragAndDrop.callDrag,window.dhtmlDragAndDrop.downtime=(new Date).valueOf(),!(!e||!e.preventDefault||(e.preventDefault(),1)))},dhtmlDragAndDropObject.prototype.callDrag=function(e){e||(e=window.event);var t=window.dhtmlDragAndDrop;if(!((new Date).valueOf()-t.downtime<100)){if(!t.dragNode){if(!t.waitDrag)return t.stopDrag(e,!0);if(t.dragNode=t.dragStartObject._createDragNode(t.dragStartNode,e),!t.dragNode)return t.stopDrag();t.dragNode.onselectstart=function(){return!1},t.gldragNode=t.dragNode,document.body.appendChild(t.dragNode),document.body.onmouseup=t.stopDrag,t.waitDrag=0,t.dragNode.pWindow=window,t.initFrameRoute()}if(t.dragNode.parentNode!=window.document.body&&t.gldragNode){var n=t.gldragNode;t.gldragNode.old&&(n=t.gldragNode.old),n.parentNode.removeChild(n);var i=t.dragNode.pWindow;if(n.pWindow&&n.pWindow.dhtmlDragAndDrop.lastLanding&&n.pWindow.dhtmlDragAndDrop.lastLanding.dragLanding._dragOut(n.pWindow.dhtmlDragAndDrop.lastLanding),_isIE){var r=document.createElement("div");r.innerHTML=t.dragNode.outerHTML,t.dragNode=r.childNodes[0]}else t.dragNode=t.dragNode.cloneNode(!0);t.dragNode.pWindow=window,t.gldragNode.old=t.dragNode,document.body.appendChild(t.dragNode),i.dhtmlDragAndDrop.dragNode=t.dragNode}var o;t.dragNode.style.left=e.clientX+15+(t.fx?-1*t.fx:0)+(document.body.scrollLeft||document.documentElement.scrollLeft)+"px",t.dragNode.style.top=e.clientY+3+(t.fy?-1*t.fy:0)+(document.body.scrollTop||document.documentElement.scrollTop)+"px",o=e.srcElement?e.srcElement:e.target,t.checkLanding(o,e)}},dhtmlDragAndDropObject.prototype.calculateFramePosition=function(e){if(window.name){for(var t=parent.frames[window.name].frameElement.offsetParent,n=0,i=0;t;)n+=t.offsetLeft,i+=t.offsetTop,t=t.offsetParent;if(parent.dhtmlDragAndDrop){var r=parent.dhtmlDragAndDrop.calculateFramePosition(1);n+=1*r.split("_")[0],i+=1*r.split("_")[1]}if(e)return n+"_"+i;this.fx=n,this.fy=i}return"0_0"},dhtmlDragAndDropObject.prototype.checkLanding=function(e,t){e&&e.dragLanding?(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding),this.lastLanding=e,this.lastLanding=this.lastLanding.dragLanding._dragIn(this.lastLanding,this.dragStartNode,t.clientX,t.clientY,t),this.lastLanding_scr=_isIE?t.srcElement:t.target):e&&"BODY"!=e.tagName?this.checkLanding(e.parentNode,t):(this.lastLanding&&this.lastLanding.dragLanding._dragOut(this.lastLanding,t.clientX,t.clientY,t),this.lastLanding=0,this._onNotFound&&this._onNotFound())},dhtmlDragAndDropObject.prototype.stopDrag=function(e,t){var n=window.dhtmlDragAndDrop;if(!t){n.stopFrameRoute();var i=n.lastLanding;n.lastLanding=null,i&&i.dragLanding._drag(n.dragStartNode,n.dragStartObject,i,_isIE?event.srcElement:e.target)}n.lastLanding=null,n.dragNode&&n.dragNode.parentNode==document.body&&n.dragNode.parentNode.removeChild(n.dragNode),n.dragNode=0,n.gldragNode=0,n.fx=0,n.fy=0,n.dragStartNode=0,n.dragStartObject=0,document.body.onmouseup=n.tempDOMU,document.body.onmousemove=n.tempDOMM,n.tempDOMU=null,n.tempDOMM=null,n.waitDrag=0},dhtmlDragAndDropObject.prototype.stopFrameRoute=function(e){e&&window.dhtmlDragAndDrop.stopDrag(1,1);for(var t=0;t<window.frames.length;t++)try{window.frames[t]!=e&&window.frames[t].dhtmlDragAndDrop&&window.frames[t].dhtmlDragAndDrop.stopFrameRoute(window)}catch(e){}try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.stopFrameRoute(window)}catch(e){}},dhtmlDragAndDropObject.prototype.initFrameRoute=function(e,t){e&&(window.dhtmlDragAndDrop.preCreateDragCopy(),window.dhtmlDragAndDrop.dragStartNode=e.dhtmlDragAndDrop.dragStartNode,window.dhtmlDragAndDrop.dragStartObject=e.dhtmlDragAndDrop.dragStartObject,window.dhtmlDragAndDrop.dragNode=e.dhtmlDragAndDrop.dragNode,window.dhtmlDragAndDrop.gldragNode=e.dhtmlDragAndDrop.dragNode,window.document.body.onmouseup=window.dhtmlDragAndDrop.stopDrag,window.waitDrag=0,!_isIE&&t&&(!_isFF||_FFrv<1.8)&&window.dhtmlDragAndDrop.calculateFramePosition());try{parent.dhtmlDragAndDrop&&parent!=window&&parent!=e&&parent.dhtmlDragAndDrop.initFrameRoute(window)}catch(e){}for(var n=0;n<window.frames.length;n++)try{window.frames[n]!=e&&window.frames[n].dhtmlDragAndDrop&&window.frames[n].dhtmlDragAndDrop.initFrameRoute(window,!e||t?1:0)}catch(e){}};var _isFF=!1,_isIE=!1,_isOpera=!1,_isKHTML=!1,_isMacOS=!1,_isChrome=!1,_FFrv=!1,_KHTMLrv=!1,_OperaRv=!1;-1!=navigator.userAgent.indexOf("Macintosh")&&(_isMacOS=!0),navigator.userAgent.toLowerCase().indexOf("chrome")>-1&&(_isChrome=!0),-1!=navigator.userAgent.indexOf("Safari")||-1!=navigator.userAgent.indexOf("Konqueror")?(_KHTMLrv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Safari")+7,5)),_KHTMLrv>525?(_isFF=!0,_FFrv=1.9):_isKHTML=!0):-1!=navigator.userAgent.indexOf("Opera")?(_isOpera=!0,_OperaRv=parseFloat(navigator.userAgent.substr(navigator.userAgent.indexOf("Opera")+6,3))):-1!=navigator.appName.indexOf("Microsoft")?(_isIE=!0,-1==navigator.appVersion.indexOf("MSIE 8.0")&&-1==navigator.appVersion.indexOf("MSIE 9.0")&&-1==navigator.appVersion.indexOf("MSIE 10.0")||"BackCompat"==document.compatMode||(_isIE=8)):"Netscape"==navigator.appName&&-1!=navigator.userAgent.indexOf("Trident")?_isIE=8:(_isFF=!0,_FFrv=parseFloat(navigator.userAgent.split("rv:")[1])),dtmlXMLLoaderObject.prototype.doXPath=function(e,t,n,i){if(_isKHTML||!_isIE&&!window.XPathResult)return this.doXPathOpera(e,t);if(_isIE)return t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),n&&t.setProperty("SelectionNamespaces","xmlns:xsl='"+n+"'"),"single"==i?t.selectSingleNode(e):t.selectNodes(e)||new Array(0);var r=t;t||(t=this.xmlDoc.nodeName?this.xmlDoc:this.xmlDoc.responseXML),t||dhtmlxError.throwError("LoadXML","Incorrect XML",[t||this.xmlDoc,this.mainObject]),-1!=t.nodeName.indexOf("document")?r=t:(r=t,t=t.ownerDocument);var o=XPathResult.ANY_TYPE;"single"==i&&(o=XPathResult.FIRST_ORDERED_NODE_TYPE);var a=[],s=t.evaluate(e,r,function(e){return n},o,null);if(o==XPathResult.FIRST_ORDERED_NODE_TYPE)return s.singleNodeValue;for(var l=s.iterateNext();l;)a[a.length]=l,l=s.iterateNext();return a},_dhtmlxError.prototype.catchError=function(e,t){this.catches[e]=t},_dhtmlxError.prototype.throwError=function(e,t,n){return this.catches[e]?this.catches[e](e,t,n):this.catches.ALL?this.catches.ALL(e,t,n):(window.alert("Error type: "+arguments[0]+"\nDescription: "+arguments[1]),null)},window.dhtmlxError=new _dhtmlxError,dtmlXMLLoaderObject.prototype.doXPathOpera=function(e,t){var n=e.replace(/[\/]+/gi,"/").split("/"),i=null,r=1;if(!n.length)return[];if("."==n[0])i=[t];else{if(""!==n[0])return[];i=(this.xmlDoc.responseXML||this.xmlDoc).getElementsByTagName(n[r].replace(/\[[^\]]*\]/g,"")),r++}for(;r<n.length;r++)i=this._getAllNamedChilds(i,n[r]);return-1!=n[r-1].indexOf("[")&&(i=this._filterXPath(i,n[r-1])),i},dtmlXMLLoaderObject.prototype._filterXPath=function(e,t){for(var n=[],i=(t=t.replace(/[^\[]*\[\@/g,"").replace(/[\[\]\@]*/g,""),0);i<e.length;i++)e[i].getAttribute(t)&&(n[n.length]=e[i]);return n},dtmlXMLLoaderObject.prototype._getAllNamedChilds=function(e,t){var n=[];_isKHTML&&(t=t.toUpperCase());for(var i=0;i<e.length;i++)for(var r=0;r<e[i].childNodes.length;r++)_isKHTML?e[i].childNodes[r].tagName&&e[i].childNodes[r].tagName.toUpperCase()==t&&(n[n.length]=e[i].childNodes[r]):e[i].childNodes[r].tagName==t&&(n[n.length]=e[i].childNodes[r]);return n},void 0===window.dhtmlxEvent&&(window.dhtmlxEvent=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)}),dtmlXMLLoaderObject.prototype.xslDoc=null,dtmlXMLLoaderObject.prototype.setXSLParamValue=function(e,t,n){n||(n=this.xslDoc),n.responseXML&&(n=n.responseXML);var i=this.doXPath("/xsl:stylesheet/xsl:variable[@name='"+e+"']",n,"http://www.w3.org/1999/XSL/Transform","single");i&&(i.firstChild.nodeValue=t)},dtmlXMLLoaderObject.prototype.doXSLTransToObject=function(e,t){var n;if(e||(e=this.xslDoc),e.responseXML&&(e=e.responseXML),t||(t=this.xmlDoc),t.responseXML&&(t=t.responseXML),_isIE){n=new ActiveXObject("Msxml2.DOMDocument.3.0");try{t.transformNodeToObject(e,n)}catch(i){n=t.transformNode(e)}}else this.XSLProcessor||(this.XSLProcessor=new XSLTProcessor,this.XSLProcessor.importStylesheet(e)),n=this.XSLProcessor.transformToDocument(t);return n},dtmlXMLLoaderObject.prototype.doXSLTransToString=function(e,t){var n=this.doXSLTransToObject(e,t);return"string"==typeof n?n:this.doSerialization(n)},dtmlXMLLoaderObject.prototype.doSerialization=function(e){return e||(e=this.xmlDoc),e.responseXML&&(e=e.responseXML),_isIE?e.xml:(new XMLSerializer).serializeToString(e)},window.dhtmlxEventable=function(obj){obj.attachEvent=function(e,t,n){return this[e="ev_"+e.toLowerCase()]||(this[e]=new this.eventCatcher(n||this)),e+":"+this[e].addEvent(t)},obj.callEvent=function(e,t){return!this[e="ev_"+e.toLowerCase()]||this[e].apply(this,t)},obj.checkEvent=function(e){return!!this["ev_"+e.toLowerCase()]},obj.eventCatcher=function(obj){var dhx_catch=[],z=function(){for(var e=!0,t=0;t<dhx_catch.length;t++)if(dhx_catch[t]){var n=dhx_catch[t].apply(obj,arguments);e=e&&n}return e};return z.addEvent=function(ev){return"function"!=typeof ev&&(ev=eval(ev)),!!ev&&dhx_catch.push(ev)-1},z.removeEvent=function(e){dhx_catch[e]=null},z},obj.detachEvent=function(e){if(e){var t=e.split(":");this[t[0]].removeEvent(t[1])}},obj.detachAllEvents=function(){for(var e in this)0===e.indexOf("ev_")&&(this.detachEvent(e),this[e]=null)},obj=null},window.dhtmlx||(window.dhtmlx={}),function(){function e(e,t){setTimeout(function(){if(e.box){var i=e.callback;n(!1),e.box.parentNode.removeChild(e.box),dhtmlx.callEvent("onAfterMessagePopup",[e.box]),h=e.box=null,i&&i(t)}},1)}function t(t){if(h){var n=(t=t||event).which||event.keyCode,i=!1;if(dhtmlx.message.keyboard){if(13==n||32==n){var r=t.target||t.srcElement;scheduler._getClassName(r).indexOf("dhtmlx_popup_button")>-1&&r.click?r.click():(e(h,!0),i=!0)}27==n&&(e(h,!1),i=!0)}if(i)return t.preventDefault&&t.preventDefault(),!(t.cancelBubble=!0)}}function n(e){n.cover||(n.cover=document.createElement("div"),n.cover.onkeydown=t,n.cover.className="dhx_modal_cover",document.body.appendChild(n.cover)),document.body.scrollHeight,n.cover.style.display=e?"inline-block":"none"}function i(e,t,n){return"<div "+scheduler._waiAria.messageButtonAttrString(e)+"class='dhtmlx_popup_button dhtmlx_"+(n||e||"").toLowerCase().replace(/ /g,"_")+"_button' result='"+t+"' ><div>"+e+"</div></div>"}function r(e){f.area||(f.area=document.createElement("div"),f.area.className="dhtmlx_message_area",f.area.style[f.position]="5px",document.body.appendChild(f.area)),f.hide(e.id);var t=document.createElement("div");return t.innerHTML="<div>"+e.text+"</div>",t.className="dhtmlx-info dhtmlx-"+e.type,t.onclick=function(){f.hide(e.id),e=null},scheduler._waiAria.messageInfoAttr(t),"bottom"==f.position&&f.area.firstChild?f.area.insertBefore(t,f.area.firstChild):f.area.appendChild(t),e.expire>0&&(f.timers[e.id]=window.setTimeout(function(){f.hide(e.id)},e.expire)),f.pull[e.id]=t,t=null,e.id}function o(t,n,r){var o=document.createElement("div");o.className=" dhtmlx_modal_box dhtmlx-"+t.type,o.setAttribute("dhxbox",1);var a=scheduler.uid();scheduler._waiAria.messageModalAttr(o,a);var s="",l=!1;if(t.width&&(o.style.width=t.width),t.height&&(o.style.height=t.height),t.title&&(s+='<div class="dhtmlx_popup_title" id="'+a+'">'+t.title+"</div>",l=!0),s+='<div class="dhtmlx_popup_text" '+(l?"":' id="'+a+'" ')+"><span>"+(t.content?"":t.text)+'</span></div><div  class="dhtmlx_popup_controls">',n){var d=t.ok||scheduler.locale.labels.message_ok;void 0===d&&(d="OK"),s+=i(d,!0,"ok")}if(r){var u=t.cancel||scheduler.locale.labels.message_cancel;void 0===u&&(u="Cancel"),s+=i(u,!1,"cancel")}if(t.buttons)for(var c=0;c<t.buttons.length;c++)s+=i(t.buttons[c],c);if(s+="</div>",o.innerHTML=s,t.content){var f=t.content;"string"==typeof f&&(f=document.getElementById(f)),"none"==f.style.display&&(f.style.display=""),o.childNodes[t.title?1:0].appendChild(f)}return o.onclick=function(n){var i=(n=n||event).target||n.srcElement,r=scheduler._getClassName(i);if(r||(i=i.parentNode),"dhtmlx_popup_button"==(r=scheduler._getClassName(i)).split(" ")[0]){var o=i.getAttribute("result");e(t,o="true"==o||"false"!=o&&o)}},t.box=o,h=t,o}function a(e,i,r){var a=e.tagName?e:o(e,i,r);e.hidden||n(!0),document.body.appendChild(a);var s=Math.abs(Math.floor(((window.innerWidth||document.documentElement.offsetWidth)-a.offsetWidth)/2)),l=Math.abs(Math.floor(((window.innerHeight||document.documentElement.offsetHeight)-a.offsetHeight)/2));return"top"==e.position?a.style.top="-3px":a.style.top=l+"px",a.style.left=s+"px",a.onkeydown=t,dhtmlx.modalbox.focus(a),e.hidden&&dhtmlx.modalbox.hide(a),dhtmlx.callEvent("onMessagePopup",[a]),a}function s(e){return a(e,!0,!1)}function l(e){return a(e,!0,!0)}function d(e){return a(e)}function u(e,t,n){return"object"!=typeof e&&("function"==typeof t&&(n=t,t=""),e={text:e,type:t,callback:n}),e}function c(e,t,n,i){return"object"!=typeof e&&(e={text:e,type:t,expire:n,id:i}),e.id=e.id||f.uid(),e.expire=e.expire||f.expire,e}var h=null;document.attachEvent?document.attachEvent("onkeydown",t):document.addEventListener("keydown",t,!0),dhtmlx.alert=function(){var e=u.apply(this,arguments);return e.type=e.type||"confirm",s(e)},dhtmlx.confirm=function(){var e=u.apply(this,arguments);return e.type=e.type||"alert",l(e)},dhtmlx.modalbox=function(){var e=u.apply(this,arguments);return e.type=e.type||"alert",d(e)},dhtmlx.modalbox.hide=function(e){for(;e&&e.getAttribute&&!e.getAttribute("dhxbox");)e=e.parentNode;e&&(e.parentNode.removeChild(e),n(!1))},dhtmlx.modalbox.focus=function(e){setTimeout(function(){var t=scheduler._getFocusableNodes(e);t.length&&t[0].focus&&t[0].focus()},1)};var f=dhtmlx.message=function(e,t,n,i){switch((e=c.apply(this,arguments)).type=e.type||"info",e.type.split("-")[0]){case"alert":return s(e);case"confirm":return l(e);case"modalbox":return d(e);default:return r(e)}};f.seed=(new Date).valueOf(),f.uid=function(){return f.seed++},f.expire=4e3,f.keyboard=!0,f.position="top",f.pull={},f.timers={},f.hideAll=function(){for(var e in f.pull)f.hide(e)},f.hide=function(e){var t=f.pull[e];t&&t.parentNode&&(window.setTimeout(function(){t.parentNode.removeChild(t),t=null},2e3),t.className+=" hidden",f.timers[e]&&window.clearTimeout(f.timers[e]),delete f.pull[e])}}(),dhtmlx.attachEvent||dhtmlxEventable(dhtmlx);var dataProcessor=window.dataProcessor=function(e){return this.serverProcessor=e,this.action_param="!nativeeditor_status",this.object=null,this.updatedRows=[],this.autoUpdate=!0,this.updateMode="cell",this._tMode="GET",this._headers=null,this._payload=null,this.post_delim="_",this._waitMode=0,this._in_progress={},this._invalid={},this.mandatoryFields=[],this.messages=[],this.styles={updated:"font-weight:bold;",inserted:"font-weight:bold;",deleted:"text-decoration : line-through;",invalid:"background-color:FFE0E0;",invalid_cell:"border-bottom:2px solid red;",error:"color:red;",clear:"font-weight:normal;text-decoration:none;"},this.enableUTFencoding(!0),dhtmlxEventable(this),this};dataProcessor.prototype={setTransactionMode:function(e,t){"object"==typeof e?(this._tMode=e.mode||this._tMode,void 0!==e.headers&&(this._headers=e.headers),void 0!==e.payload&&(this._payload=e.payload)):(this._tMode=e,this._tSend=t),"REST"==this._tMode&&(this._tSend=!1,this._endnm=!0);var n="Content-Type";"JSON"==this._tMode&&(this._tSend=!1,this._endnm=!0,this._headers=this._headers||{},this._headers[n]="application/json"),this._headers&&!function(e,t){var n=t.toLowerCase();for(var i in e)if(i.toLowerCase()===n)return!0;return!1}(this._headers,n)&&(this._headers[n]="application/x-www-form-urlencoded")},escape:function(e){return this._utf?encodeURIComponent(e):escape(e)},enableUTFencoding:function(e){this._utf=!!e},setDataColumns:function(e){this._columns="string"==typeof e?e.split(","):e},getSyncState:function(){return!this.updatedRows.length},enableDataNames:function(e){this._endnm=!!e},enablePartialDataSend:function(e){this._changed=!!e},setUpdateMode:function(e,t){this.autoUpdate="cell"==e,this.updateMode=e,this.dnd=t},ignore:function(e,t){this._silent_mode=!0,e.call(t||window),this._silent_mode=!1},setUpdated:function(e,t,n){if(!this._silent_mode){var i=this.findRow(e);n=n||"updated";var r=this.obj.getUserData(e,this.action_param);r&&"updated"==n&&(n=r),t?(this.set_invalid(e,!1),this.updatedRows[i]=e,this.obj.setUserData(e,this.action_param,n),this._in_progress[e]&&(this._in_progress[e]="wait")):this.is_invalid(e)||(this.updatedRows.splice(i,1),this.obj.setUserData(e,this.action_param,"")),t||this._clearUpdateFlag(e),this.markRow(e,t,n),t&&this.autoUpdate&&this.sendData(e)}},_clearUpdateFlag:function(e){},markRow:function(e,t,n){var i="",r=this.is_invalid(e);if(r&&(i=this.styles[r],t=!0),this.callEvent("onRowMark",[e,t,n,r])&&(i=this.styles[t?n:"clear"]+i,this.obj[this._methods[0]](e,i),r&&r.details)){i+=this.styles[r+"_cell"];for(var o=0;o<r.details.length;o++)r.details[o]&&this.obj[this._methods[1]](e,o,i)}},getState:function(e){return this.obj.getUserData(e,this.action_param)},is_invalid:function(e){return this._invalid[e]},set_invalid:function(e,t,n){n&&(t={value:t,details:n,toString:function(){return this.value.toString()}}),this._invalid[e]=t},checkBeforeUpdate:function(e){return!0},sendData:function(e){if(!this._waitMode||"tree"!=this.obj.mytype&&!this.obj._h2){if(this.obj.editStop&&this.obj.editStop(),void 0===e||this._tSend)return this.sendAllData();if(this._in_progress[e])return!1;if(this.messages=[],!this.checkBeforeUpdate(e)&&this.callEvent("onValidationError",[e,this.messages]))return!1;this._beforeSendData(this._getRowData(e),e)}},_beforeSendData:function(e,t){if(!this.callEvent("onBeforeUpdate",[t,this.getState(t),e]))return!1;this._sendData(e,t)},serialize:function(e,t){if("string"==typeof e)return e;if(void 0!==t)return this.serialize_one(e,"");var n=[],i=[];for(var r in e)e.hasOwnProperty(r)&&(n.push(this.serialize_one(e[r],r+this.post_delim)),i.push(r));return n.push("ids="+this.escape(i.join(","))),(scheduler.security_key||dhtmlx.security_key)&&n.push("dhx_security="+(scheduler.security_key||dhtmlx.security_key)),n.join("&")},serialize_one:function(e,t){if("string"==typeof e)return e;var n=[];for(var i in e)if(e.hasOwnProperty(i)){if(("id"==i||i==this.action_param)&&"REST"==this._tMode)continue;n.push(this.escape((t||"")+i)+"="+this.escape(e[i]))}return n.join("&")},_applyPayload:function(e){var t=this.obj.$ajax;if(this._payload)for(var n in this._payload)e=e+t.urlSeparator(e)+this.escape(n)+"="+this.escape(this._payload[n]);return e},_sendData:function(e,t){if(e){if(!this.callEvent("onBeforeDataSending",t?[t,this.getState(t),e]:[null,null,e]))return!1;t&&(this._in_progress[t]=(new Date).valueOf());var n=this,i=function(i){var r=[];if(t)r.push(t);else if(e)for(var o in e)r.push(o);return n.afterUpdate(n,i,r)},r=this.obj.$ajax,o=this.serverProcessor+(this._user?r.urlSeparator(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+this.obj.getUserData(0,"version")].join("&"):""),a=this._applyPayload(o);if("GET"==this._tMode)r.query({url:a+r.urlSeparator(a)+this.serialize(e,t),method:"GET",callback:i,headers:this._headers});else if("POST"==this._tMode)r.query({url:a,method:"POST",headers:this._headers,data:this.serialize(e,t),callback:i});else if("JSON"==this._tMode){var s=e[this.action_param],l={};for(var d in e)l[d]=e[d];delete l[this.action_param],delete l.id,delete l.gr_id,r.query({url:a,method:"POST",headers:this._headers,callback:i,data:JSON.stringify({id:t,action:s,data:l})})}else if("REST"==this._tMode){var u=this.getState(t),c=o.replace(/(\&|\?)editing\=true/,""),h=(l="","post");"inserted"==u?l=this.serialize(e,t):"deleted"==u?(h="DELETE",c=c+("/"==c.slice(-1)?"":"/")+t):(h="PUT",l=this.serialize(e,t),c=c+("/"==c.slice(-1)?"":"/")+t),c=this._applyPayload(c),r.query({url:c,method:h,headers:this._headers,data:l,callback:i})}this._waitMode++}},sendAllData:function(){if(this.updatedRows.length){this.messages=[];for(var e=!0,t=0;t<this.updatedRows.length;t++)e&=this.checkBeforeUpdate(this.updatedRows[t]);if(!e&&!this.callEvent("onValidationError",["",this.messages]))return!1;if(this._tSend)this._sendData(this._getAllData());else for(t=0;t<this.updatedRows.length;t++)if(!this._in_progress[this.updatedRows[t]]){if(this.is_invalid(this.updatedRows[t]))continue;if(this._beforeSendData(this._getRowData(this.updatedRows[t]),this.updatedRows[t]),this._waitMode&&("tree"==this.obj.mytype||this.obj._h2))return}}},_getAllData:function(e){for(var t={},n=!1,i=0;i<this.updatedRows.length;i++){var r=this.updatedRows[i];if(!this._in_progress[r]&&!this.is_invalid(r)){var o=this._getRowData(r);this.callEvent("onBeforeUpdate",[r,this.getState(r),o])&&(t[r]=o,n=!0,this._in_progress[r]=(new Date).valueOf())}}return n?t:null},setVerificator:function(e,t){this.mandatoryFields[e]=t||function(e){return""!==e}},clearVerificator:function(e){this.mandatoryFields[e]=!1},findRow:function(e){var t=0;for(t=0;t<this.updatedRows.length&&e!=this.updatedRows[t];t++);return t},defineAction:function(e,t){this._uActions||(this._uActions=[]),this._uActions[e]=t},afterUpdateCallback:function(e,t,n,i){var r=e,o="error"!=n&&"invalid"!=n;if(o||this.set_invalid(e,n),this._uActions&&this._uActions[n]&&!this._uActions[n](i))return delete this._in_progress[r];"wait"!=this._in_progress[r]&&this.setUpdated(e,!1);var a=e;switch(n){case"inserted":case"insert":t!=e&&(this.setUpdated(e,!1),this.obj[this._methods[2]](e,t),e=t);break;case"delete":case"deleted":return this.obj.setUserData(e,this.action_param,"true_deleted"),this.obj[this._methods[3]](e,t),delete this._in_progress[r],this.callEvent("onAfterUpdate",[e,n,t,i])}"wait"!=this._in_progress[r]?(o&&this.obj.setUserData(e,this.action_param,""),delete this._in_progress[r]):(delete this._in_progress[r],this.setUpdated(t,!0,this.obj.getUserData(e,this.action_param))),this.callEvent("onAfterUpdate",[a,n,t,i])},_errorResponse:function(e,t){return this.obj&&this.obj.callEvent&&this.obj.callEvent("onSaveError",[t,e.xmlDoc]),this.cleanUpdate(t)},afterUpdate:function(e,t,n){var i=this.obj.$ajax;if(200===t.xmlDoc.status){if(window.JSON){var r;try{r=JSON.parse(t.xmlDoc.responseText)}catch(e){t.xmlDoc.responseText.length||(r={})}if(r){var o=r.action||this.getState(n)||"updated",a=r.sid||n[0],s=r.tid||n[0];return e.afterUpdateCallback(a,s,o,r),void e.finalizeUpdate()}}var l=i.xmltop("data",t.xmlDoc);if(!l)return this._errorResponse(t,n);var d=i.xpath("//data/action",l);d.length||this._errorResponse(t,n);for(var u=0;u<d.length;u++){var c=d[u];o=c.getAttribute("type"),a=c.getAttribute("sid"),s=c.getAttribute("tid");e.afterUpdateCallback(a,s,o,c)}e.finalizeUpdate()}else this._errorResponse(t,n)},cleanUpdate:function(e){if(e)for(var t=0;t<e.length;t++)delete this._in_progress[e[t]]},finalizeUpdate:function(){this._waitMode&&this._waitMode--,("tree"==this.obj.mytype||this.obj._h2)&&this.updatedRows.length&&this.sendData(),this.callEvent("onAfterUpdateFinish",[]),this.updatedRows.length||this.callEvent("onFullSync",[])},init:function(e){this.obj=e,this.obj._dp_init&&this.obj._dp_init(this)},setOnAfterUpdate:function(e){this.attachEvent("onAfterUpdate",e)},enableDebug:function(e){},setOnBeforeUpdateHandler:function(e){this.attachEvent("onBeforeDataSending",e)},setAutoUpdate:function(e,t){e=e||2e3,this._user=t||(new Date).valueOf(),this._need_update=!1,this._update_busy=!1,this.attachEvent("onAfterUpdate",function(e,t,n,i){this.afterAutoUpdate(e,t,n,i)}),this.attachEvent("onFullSync",function(){this.fullSync()});var n=this;window.setInterval(function(){n.loadUpdate()},e)},afterAutoUpdate:function(e,t,n,i){return"collision"!=t||(this._need_update=!0,!1)},fullSync:function(){return this._need_update&&(this._need_update=!1,this.loadUpdate()),!0},getUpdates:function(e,t){var n=this.obj.$ajax;if(this._update_busy)return!1;this._update_busy=!0,n.get(e,t)},_v:function(e){return e.firstChild?e.firstChild.nodeValue:""},_a:function(e){for(var t=[],n=0;n<e.length;n++)t[n]=this._v(e[n]);return t},loadUpdate:function(){var e=this.obj.$ajax,t=this,n=this.obj.getUserData(0,"version"),i=this.serverProcessor+e.urlSeparator(this.serverProcessor)+["dhx_user="+this._user,"dhx_version="+n].join("&");i=i.replace("editing=true&",""),this.getUpdates(i,function(n){var i=e.xpath("//userdata",n);t.obj.setUserData(0,"version",t._v(i[0]));var r=e.xpath("//update",n);if(r.length){t._silent_mode=!0;for(var o=0;o<r.length;o++){var a=r[o].getAttribute("status"),s=r[o].getAttribute("id"),l=r[o].getAttribute("parent");switch(a){case"inserted":t.callEvent("insertCallback",[r[o],s,l]);break;case"updated":t.callEvent("updateCallback",[r[o],s,l]);break;case"deleted":t.callEvent("deleteCallback",[r[o],s,l])}}t._silent_mode=!1}t._update_busy=!1,t=null})}},window.dataProcessor&&!dataProcessor.prototype.init_original&&(dataProcessor.prototype.init_original=dataProcessor.prototype.init,dataProcessor.prototype.init=function(e){this.init_original(e),e._dataprocessor=this,this.setTransactionMode("POST",!0),this.serverProcessor+=(-1!=this.serverProcessor.indexOf("?")?"&":"?")+"editing=true"}),dhtmlxError.catchError("LoadXML",function(e,t,n){var i=n[0].responseText;switch(scheduler.config.ajax_error){case"alert":window.alert(i);break;case"console":window.console.log(i)}});var Scheduler={_seed:0,plugin:function(e){this._schedulerPlugins.push(e),e(window.scheduler)},_schedulerPlugins:[]};Scheduler.getSchedulerInstance=function(){function e(e){var t=document.createElement("div");return(e||"").split(" ").forEach(function(e){t.classList.add(e)}),t}function t(e){var t=function(e){var t;if(e.view)switch(e.view){case"today":case"next":case"prev":t=u.builtInButton;break;case"date":t=u.date;break;case"spacer":t=u.spacer;break;case"button":t=u.button;break;case"minicalendar":t=u.minicalendarButton;break;default:t=u.view}else e.rows?t=u.rows_container:e.cols&&(t=u.row);return t}(e);if(t){var n=t(e);if(e.css&&n.classList.add(e.css),e.width)(i=e.width)===1*i&&(i+="px"),n.style.width=i;if(e.height)(i=e.height)===1*i&&(i+="px"),n.style.height=i;if(e.click&&n.addEventListener("click",e.click),e.html&&(n.innerHTML=e.html),e.align){var i="";"right"==e.align?i="flex-end":"left"==e.align&&(i="flex-start"),n.style.justifyContent=i}return n}}function n(e){return"string"==typeof e&&(e={view:e}),e.view||e.rows||e.cols||(e.view="button"),e}function i(e){var r,o=document.createDocumentFragment();r=Array.isArray(e)?e:[e];for(var a=0;a<r.length;a++){var s,l=n(r[a]);if("day"===l.view&&r[a+1])"week"!==(s=n(r[a+1])).view&&"month"!==s.view||(l.$firstTab=!0);if("month"===l.view&&r[a-1])"week"!==(s=n(r[a-1])).view&&"day"!==s.view||(l.$lastTab=!0);var d=t(l);o.appendChild(d),(l.cols||l.rows)&&d.appendChild(i(l.cols||l.rows))}return o}function r(e){return!!(e.querySelector(".dhx_cal_header")&&e.querySelector(".dhx_cal_data")&&e.querySelector(".dhx_cal_navline"))}function o(){if(s._is_material_skin())return!0;if(void 0!==v)return v;var e=document.createElement("div");e.style.position="absolute",e.style.left="-9999px",e.style.top="-9999px",e.innerHTML="<div class='dhx_cal_container'><div class='dhx_cal_data'><div class='dhx_cal_event'><div class='dhx_body'></div></div><div>",document.body.appendChild(e);var t=window.getComputedStyle(e.querySelector(".dhx_body")).getPropertyValue("box-sizing");document.body.removeChild(e),(v=!("border-box"!==t))||setTimeout(function(){v=void 0},1e3)}function a(){if(!s._is_material_skin()&&!s._border_box_events()){var e=v;v=void 0,_=void 0,e!==o()&&s.$container&&s.getState().mode&&s.setCurrentView()}}var s={version:"5.3.13"},l={agenda:"https://docs.dhtmlx.com/scheduler/agenda_view.html",grid:"https://docs.dhtmlx.com/scheduler/grid_view.html",map:"https://docs.dhtmlx.com/scheduler/map_view.html",unit:"https://docs.dhtmlx.com/scheduler/units_view.html",timeline:"https://docs.dhtmlx.com/scheduler/timeline_view.html",week_agenda:"https://docs.dhtmlx.com/scheduler/weekagenda_view.html",year:"https://docs.dhtmlx.com/scheduler/year_view.html",anythingElse:"https://docs.dhtmlx.com/scheduler/views.html"},d={agenda:"ext/dhtmlxscheduler_agenda_view.js",grid:"ext/dhtmlxscheduler_grid_view.js",map:"ext/dhtmlxscheduler_map_view.js",unit:"ext/dhtmlxscheduler_units.js",timeline:"ext/dhtmlxscheduler_timeline.js, ext/dhtmlxscheduler_treetimeline.js, ext/dhtmlxscheduler_daytimeline.js",week_agenda:"ext/dhtmlxscheduler_week_agenda.js",year:"ext/dhtmlxscheduler_year_view.js",limit:"ext/dhtmlxscheduler_limit.js"};s._commonErrorMessages={unknownView:function(e){var t=d[e]?"You're probably missing "+d[e]+".":"";return"`"+e+"` view is not defined. \nPlease check parameters you pass to `scheduler.init` or `scheduler.setCurrentView` in your code and ensure you've imported appropriate extensions. \n"+("Related docs: "+(l[e]||l.anythingElse))+"\n"+(t?t+"\n":"")},collapsedContainer:function(e){return"Scheduler container height is set to *100%* but the rendered height is zero and the scheduler is not visible. \nMake sure that the container has some initial height or use different units. For example:\n<div id='scheduler_here' class='dhx_cal_container' style='width:100%; height:600px;'> \n"}},s.createTimelineView=function(){throw new Error("scheduler.createTimelineView is not implemented. Be sure to add the required extension: "+d.timeline+"\nRelated docs: "+l.timeline)},s.createUnitsView=function(){throw new Error("scheduler.createUnitsView is not implemented. Be sure to add the required extension: "+d.unit+"\nRelated docs: "+l.unit)},s.createGridView=function(){throw new Error("scheduler.createGridView is not implemented. Be sure to add the required extension: "+d.grid+"\nRelated docs: "+l.grid)},s.addMarkedTimespan=function(){throw new Error("scheduler.addMarkedTimespan is not implemented. Be sure to add the required extension: ext/dhtmlxscheduler_limit.js\nRelated docs: https://docs.dhtmlx.com/scheduler/limits.html")},s.renderCalendar=function(){throw new Error("scheduler.renderCalendar is not implemented. Be sure to add the required extension: ext/dhtmlxscheduler_minical.js\nhttps://docs.dhtmlx.com/scheduler/minicalendar.html")},s.exportToPNG=function(){throw new Error(["scheduler.exportToPNG is not implemented.","This feature requires an additional module, be sure to check the related doc here https://docs.dhtmlx.com/scheduler/png.html","Licensing info: https://dhtmlx.com/docs/products/dhtmlxScheduler/export.shtml"].join("\n"))},s.exportToPDF=function(){throw new Error(["scheduler.exportToPDF is not implemented.","This feature requires an additional module, be sure to check the related doc here https://docs.dhtmlx.com/scheduler/pdf.html","Licensing info: https://dhtmlx.com/docs/products/dhtmlxScheduler/export.shtml"].join("\n"))},dhtmlxEventable(s);var u={rows_container:function(){return e("dhx_cal_navbar_rows_container")},row:function(){return e("dhx_cal_navbar_row")},view:function(t){var n=e("dhx_cal_tab");return n.setAttribute("name",t.view+"_tab"),n.setAttribute("data-viewname",t.view),s.config.fix_tab_position&&(t.$firstTab?n.classList.add("dhx_cal_tab_first"):t.$lastTab?n.classList.add("dhx_cal_tab_last"):"week"!==t.view&&n.classList.add("dhx_cal_tab_standalone")),n},date:function(){return e("dhx_cal_date")},button:function(t){return e("dhx_cal_nav_button dhx_cal_nav_button_custom dhx_cal_tab")},builtInButton:function(t){return e("dhx_cal_"+t.view+"_button dhx_cal_nav_button")},spacer:function(){return e("dhx_cal_line_spacer")},minicalendarButton:function(t){var n=e("dhx_minical_icon");return t.click||(n.onclick=function(){s.isCalendarVisible()?s.destroyCalendar():s.renderCalendar({position:this,date:s.getState().date,navigation:!0,handler:function(e,t){s.setCurrentView(e),s.destroyCalendar()}})}),n},html_element:function(t){return e("dhx_cal_nav_content")}};s._init_nav_bar=function(e){var t=this.$container.querySelector(".dhx_cal_navline");return t||((t=document.createElement("div")).className="dhx_cal_navline dhx_cal_navline_flex",s._update_nav_bar(e,t),t)};var c=null;s._update_nav_bar=function(e,t){if(e){var n=!1,r=!1,o=e.height||s.xy.nav_height;null!==c&&c===o||(n=!0),r=!0,n&&(s.xy.nav_height=o),r&&(t.innerHTML="",t.appendChild(i(e))),(n||r)&&(s._els=[],s.get_elements(),s.set_actions()),t.style.display=0===o?"none":"",c=o}},s._detachDomEvent=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},s._init_once=function(){function e(e){return{w:e.innerWidth||document.documentElement.clientWidth,h:e.innerHeight||document.documentElement.clientHeight}}function t(t,n){var i,r=e(n);t.event(n,"resize",function(){clearTimeout(i),i=setTimeout(function(){if(function(e){for(var t=document.body;e&&e!=t;)e=e.parentNode;return!(t!=e)}(t.$container)){var i=e(n);(function(e,t){return e.w==t.w&&e.h==t.h})(r,i)||(r=i,t.callEvent("onSchedulerResize",[])&&(t.updateView(),t.callEvent("onAfterSchedulerResize",[])))}},150)})}(function(e){var n=e.$container;"static"==window.getComputedStyle(n).getPropertyValue("position")&&(n.style.position="relative");var i=document.createElement("iframe");i.className="scheduler_container_resize_watcher",i.tabIndex=-1,e.config.wai_aria_attributes&&(i.setAttribute("role","none"),i.setAttribute("aria-hidden",!0)),n.appendChild(i),i.contentWindow?t(e,i.contentWindow):(n.removeChild(i),t(e,window))})(s),s._init_once=function(){}};var h,f={render:function(e){return s._init_nav_bar(e)}},p={render:function(e){var t=document.createElement("div");return t.className="dhx_cal_header",t}},m={render:function(e){var t=document.createElement("div");return t.className="dhx_cal_data",t}};if(s.init=function(e,t,n){if(t=t||s._currentDate(),n=n||"week",this._obj&&this.unset_actions(),this._obj="string"==typeof e?document.getElementById(e):e,this.$container=this._obj,!this.$container.offsetHeight&&this.$container.offsetWidth&&"100%"===this.$container.style.height&&window.console.error(s._commonErrorMessages.collapsedContainer(),this.$container),this.config.wai_aria_attributes&&this.config.wai_aria_application_role&&this.$container.setAttribute("role","application"),this.config.header||r(this.$container)||(this.config.header=function(e){var t=["day","week","month"];if(e.matrix)for(var n in e.matrix)t.push(n);if(e._props)for(var n in e._props)t.push(n);if(e._grid&&e._grid.names)for(var n in e._grid.names)t.push(n);return["map","agenda","week_agenda","year"].forEach(function(n){e[n+"_view"]&&t.push(n)}),t.concat(["date"]).concat(["prev","today","next"])}(this),console.log(["Required DOM elements are missing from the scheduler container and **scheduler.config.header** is not specified.","Using a default header configuration: ","scheduler.config.header = "+JSON.stringify(this.config.header,null,2),"Check this article for the details: https://docs.dhtmlx.com/scheduler/initialization.html"].join("\n"))),this.config.header)this.$container.innerHTML="",this.$container.classList.add("dhx_cal_container"),this.config.header.height&&(this.xy.nav_height=this.config.header.height),this.$container.appendChild(f.render(this.config.header)),this.$container.appendChild(p.render()),this.$container.appendChild(m.render());else if(!r(this.$container))throw new Error(["Required DOM elements are missing from the scheduler container.","Be sure to either specify them manually in the markup: https://docs.dhtmlx.com/scheduler/initialization.html#initializingschedulerviamarkup","Or to use **scheduler.config.header** setting so they could be created automatically: https://docs.dhtmlx.com/scheduler/initialization.html#initializingschedulerviaheaderconfig"].join("\n"));this.config.rtl&&(this.$container.className+=" dhx_cal_container_rtl"),this._skin_init&&s._skin_init(),s.date.init(),this._scroll=!0,this._quirks=this.$env.isIE&&"BackCompat"==document.compatMode,this._quirks7=this.$env.isIE&&-1==navigator.appVersion.indexOf("MSIE 8"),this._els=[],this.get_elements(),this.init_templates(),this.set_actions(),this._init_once(),this._init_touch_events(),this.set_sizes(),s.callEvent("onSchedulerReady",[]),this.setCurrentView(t,n)},s.xy={min_event_height:40,scale_width:50,scroll_width:18,scale_height:20,month_scale_height:20,menu_width:25,margin_top:0,margin_left:0,editor_width:140,month_head_height:22,event_header_height:14},s.keys={edit_save:13,edit_cancel:27},s.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},s.set_sizes=function(){var e=this._x=this._obj.clientWidth-this.xy.margin_left,t=this._y=this._obj.clientHeight-this.xy.margin_top,n=this._table_view?0:this.xy.scale_width+this.xy.scroll_width,i=this._table_view?-1:this.xy.scale_width,r=this.$container.querySelector(".dhx_cal_scale_placeholder");s._is_material_skin()?(r||((r=document.createElement("div")).className="dhx_cal_scale_placeholder",this.$container.insertBefore(r,this._els.dhx_cal_header[0])),r.style.display="block",this.set_xy(r,e,this.xy.scale_height+1,0,this.xy.nav_height+(this._quirks?-1:1))):r&&r.parentNode.removeChild(r),this._lightbox&&(s.$container.offsetWidth<1200||this._setLbPosition(document.querySelector(".dhx_cal_light"))),this.set_xy(this._els.dhx_cal_navline[0],e,this.xy.nav_height,0,0),this.set_xy(this._els.dhx_cal_header[0],e-n,this.xy.scale_height,i,this.xy.nav_height+(this._quirks?-1:1));var o=this._els.dhx_cal_navline[0].offsetHeight;o>0&&(this.xy.nav_height=o);var a=this.xy.scale_height+this.xy.nav_height+(this._quirks?-2:0);this.set_xy(this._els.dhx_cal_data[0],e,t-(a+2),0,a+2)},s.set_xy=function(e,t,n,i,r){var o="left";e.style.width=Math.max(0,t)+"px",e.style.height=Math.max(0,n)+"px",arguments.length>3&&(this.config.rtl&&(o="right"),e.style[o]=i+"px",e.style.top=r+"px")},s.get_elements=function(){for(var e=this._obj.getElementsByTagName("DIV"),t=0;t<e.length;t++){var n=s._getClassName(e[t]),i=e[t].getAttribute("name")||"";n&&(n=n.split(" ")[0]),this._els[n]||(this._els[n]=[]),this._els[n].push(e[t]);var r=s.locale.labels[i||n];"string"!=typeof r&&i&&!e[t].innerHTML&&(r=i.split("_")[0]),r&&(this._waiAria.labelAttr(e[t],r),e[t].innerHTML=r)}},s.unset_actions=function(){for(var e in this._els)if(this._click[e])for(var t=0;t<this._els[e].length;t++)this._els[e][t].onclick=null;this._obj.onselectstart=null,this._obj.onmousemove=null,this._obj.onmousedown=null,this._obj.onmouseup=null,this._obj.ondblclick=null,this._obj.oncontextmenu=null},s.set_actions=function(){for(var e in this._els)if(this._click[e])for(var t=0;t<this._els[e].length;t++)this._els[e][t].onclick=s._click[e];this._obj.onselectstart=function(e){return!1},this._obj.onmousemove=function(e){s._temp_touch_block||s._on_mouse_move(e||event)},this._obj.onmousedown=function(e){s._ignore_next_click||s._on_mouse_down(e||event)},this._obj.onmouseup=function(e){s._ignore_next_click||s._on_mouse_up(e||event)},this._obj.ondblclick=function(e){s._on_dbl_click(e||event)},this._obj.oncontextmenu=function(e){var t=e||event,n=t.target||t.srcElement;return s.callEvent("onContextMenu",[s._locate_event(n),t])}},s.select=function(e){this._select_id!=e&&(s._close_not_saved(),this.editStop(!1),this.unselect(),this._select_id=e,this.updateEvent(e),this.callEvent("onEventSelected",[e]))},s.unselect=function(e){if(!e||e==this._select_id){var t=this._select_id;this._select_id=null,t&&this.getEvent(t)&&this.updateEvent(t),this.callEvent("onEventUnselected",[t])}},s.getState=function(){return{mode:this._mode,date:new Date(this._date),min_date:new Date(this._min_date),max_date:new Date(this._max_date),editor_id:this._edit_id,lightbox_id:this._lightbox_id,new_event:this._new_event,select_id:this._select_id,expanded:this.expanded,drag_id:this._drag_id,drag_mode:this._drag_mode}},s._click={dhx_cal_data:function(e){if(s._ignore_next_click)return e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,s._ignore_next_click=!1,!1;var t=e?e.target:event.srcElement,n=s._locate_event(t);if(e=e||event,n){if(!s.callEvent("onClick",[n,e])||s.config.readonly)return}else s.callEvent("onEmptyClick",[s.getActionData(e).date,e]);if(n&&s.config.select){s.select(n);var i=s._getClassName(t);-1!=i.indexOf("_icon")&&s._click.buttons[i.split(" ")[1].replace("icon_","")](n)}else s._close_not_saved(),(new Date).valueOf()-(s._new_event||0)>500&&s.unselect()},dhx_cal_prev_button:function(){s._click.dhx_cal_next_button(0,-1)},dhx_cal_next_button:function(e,t){var n=1;s.config.rtl&&(t=-t,n=-n),s.setCurrentView(s.date.add(s.date[s._mode+"_start"](new Date(s._date)),t||n,s._mode))},dhx_cal_today_button:function(){s.callEvent("onBeforeTodayDisplayed",[])&&s.setCurrentView(s._currentDate())},dhx_cal_tab:function(){var e=this.getAttribute("name"),t=e.substring(0,e.search("_tab"));s.setCurrentView(s._date,t)},buttons:{delete:function(e){var t=s.locale.labels.confirm_deleting;s._dhtmlx_confirm(t,s.locale.labels.title_confirm_deleting,function(){s.deleteEvent(e)})},edit:function(e){s.edit(e)},save:function(e){s.editStop(!0)},details:function(e){s.showLightbox(e)},cancel:function(e){s.editStop(!1)}}},s._dhtmlx_confirm=function(e,t,n){if(!e)return n();var i={text:e};t&&(i.title=t),n&&(i.callback=function(e){e&&n()}),dhtmlx.confirm(i)},s.addEventNow=function(e,t,n){var i={};s._isObject(e)&&!s._isDate(e)&&(i=e,e=null);var r=6e4*(this.config.event_duration||this.config.time_step);e||(e=i.start_date||Math.round(s._currentDate().valueOf()/r)*r);var o=new Date(e);if(!t){var a=this.config.first_hour;a>o.getHours()&&(o.setHours(a),e=o.valueOf()),t=e.valueOf()+r}var l=new Date(t);o.valueOf()==l.valueOf()&&l.setTime(l.valueOf()+r),i.start_date=i.start_date||o,i.end_date=i.end_date||l,i.text=i.text||this.locale.labels.new_event,i.id=this._drag_id=i.id||this.uid(),this._drag_mode="new-size",this._loading=!0;var d=this.addEvent(i);return this.callEvent("onEventCreated",[this._drag_id,n]),this._loading=!1,this._drag_event={},this._on_mouse_up(n),d},s._on_dbl_click=function(e,t){if(t=t||e.target||e.srcElement,!this.config.readonly){var n=s._getClassName(t).split(" ")[0];switch(n){case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_wa_day_data":if(!s.config.dblclick_create)break;this.addEventNow(this.getActionData(e).date,null,e);break;case"dhx_cal_event":case"dhx_wa_ev_body":case"dhx_agenda_line":case"dhx_grid_event":case"dhx_cal_event_line":case"dhx_cal_event_clear":var i=this._locate_event(t);if(!this.callEvent("onDblClick",[i,e]))return;this.config.details_on_dblclick||this._table_view||!this.getEvent(i)._timed||!this.config.select?this.showLightbox(i):this.edit(i);break;case"dhx_time_block":case"dhx_cal_container":return;default:var r=this["dblclick_"+n];if(r)r.call(this,e);else if(t.parentNode&&t!=this)return s._on_dbl_click(e,t.parentNode)}}},s._get_column_index=function(e){var t=0;if(this._cols){for(var n=0,i=0;n+this._cols[i]<e&&i<this._cols.length;)n+=this._cols[i],i++;if(t=i+(this._cols[i]?(e-n)/this._cols[i]:0),this._ignores&&t>=this._cols.length)for(;t>=1&&this._ignores[Math.floor(t)];)t--}return t},s._week_indexes_from_pos=function(e){if(this._cols){var t=this._get_column_index(e.x);return e.x=Math.min(this._cols.length-1,Math.max(0,Math.ceil(t)-1)),e.y=Math.max(0,Math.ceil(60*e.y/(this.config.time_step*this.config.hour_size_px))-1)+this.config.first_hour*(60/this.config.time_step),e}return e},s._mouse_coords=function(e){var t,n=document.body,i=document.documentElement;t=this.$env.isIE||!e.pageX&&!e.pageY?{x:e.clientX+(n.scrollLeft||i.scrollLeft||0)-n.clientLeft,y:e.clientY+(n.scrollTop||i.scrollTop||0)-n.clientTop}:{x:e.pageX,y:e.pageY},this.config.rtl&&this._colsS?(t.x=this.$container.querySelector(".dhx_cal_data").offsetWidth-t.x,"month"!==this._mode&&(t.x-=this.xy.scale_width)):t.x-=this.$domHelpers.getAbsoluteLeft(this._obj)+(this._table_view?0:this.xy.scale_width);var r=this.$container.querySelector(".dhx_cal_data");t.y-=this.$domHelpers.getAbsoluteTop(r)-this._els.dhx_cal_data[0].scrollTop,t.ev=e;var o=this["mouse_"+this._mode];if(o)t=o.call(this,t);else if(this._table_view){var a=this._get_column_index(t.x);if(!this._cols||!this._colsS)return t;var l=0;for(l=1;l<this._colsS.heights.length&&!(this._colsS.heights[l]>t.y);l++);t.y=Math.ceil(24*(Math.max(0,a)+7*Math.max(0,l-1))*60/this.config.time_step),(s._drag_mode||"month"==this._mode)&&(t.y=24*(Math.max(0,Math.ceil(a)-1)+7*Math.max(0,l-1))*60/this.config.time_step),"move"==this._drag_mode&&s._ignores_detected&&s.config.preserve_length&&(t._ignores=!0,this._drag_event._event_length||(this._drag_event._event_length=this._get_real_event_length(this._drag_event.start_date,this._drag_event.end_date,{x_step:1,x_unit:"day"}))),t.x=0}else t=this._week_indexes_from_pos(t);return t.timestamp=+new Date,t},s._close_not_saved=function(){if((new Date).valueOf()-(s._new_event||0)>500&&s._edit_id){var e=s.locale.labels.confirm_closing;s._dhtmlx_confirm(e,s.locale.labels.title_confirm_closing,function(){s.editStop(s.config.positive_closing)}),e&&(this._drag_id=this._drag_pos=this._drag_mode=null)}},s._correct_shift=function(e,t){return e-6e4*(new Date(s._min_date).getTimezoneOffset()-new Date(e).getTimezoneOffset())*(t?-1:1)},s._is_pos_changed=function(e,t){function n(e,t,n){return!!(Math.abs(e-t)>n)}if(!e||!this._drag_pos)return!0;return!!(this._drag_pos.has_moved||!this._drag_pos.timestamp||t.timestamp-this._drag_pos.timestamp>100||n(e.ev.clientX,t.ev.clientX,5)||n(e.ev.clientY,t.ev.clientY,5))},s._correct_drag_start_date=function(e){var t;s.matrix&&(t=s.matrix[s._mode]),t=t||{x_step:1,x_unit:"day"},e=new Date(e);var n=1;return(t._start_correction||t._end_correction)&&(n=60*(t.last_hour||0)-(60*e.getHours()+e.getMinutes())||1),1*e+(s._get_fictional_event_length(e,n,t)-n)},s._correct_drag_end_date=function(e,t){var n;s.matrix&&(n=s.matrix[s._mode]),n=n||{x_step:1,x_unit:"day"};var i=1*e+s._get_fictional_event_length(e,t,n);return new Date(1*i-(s._get_fictional_event_length(i,-1,n,-1)+1))},s._on_mouse_move=function(e){if(this._drag_mode){var t=this._mouse_coords(e);if(this._is_pos_changed(this._drag_pos,t)){var n,i;if(this._edit_id!=this._drag_id&&this._close_not_saved(),!this._drag_mode)return;var r=null;if(this._drag_pos&&!this._drag_pos.has_moved&&((r=this._drag_pos).has_moved=!0),this._drag_pos=t,this._drag_pos.has_moved=!0,"create"==this._drag_mode){if(r&&(t=r),this._close_not_saved(),this.unselect(this._select_id),this._loading=!0,n=this._get_date_from_pos(t).valueOf(),!this._drag_start)return this.callEvent("onBeforeEventCreated",[e,this._drag_id])?(this._loading=!1,void(this._drag_start=n)):void(this._loading=!1);i=n,this._drag_start;var o=new Date(this._drag_start),a=new Date(i);"day"!=this._mode&&"week"!=this._mode||o.getHours()!=a.getHours()||o.getMinutes()!=a.getMinutes()||(a=new Date(this._drag_start+1e3)),this._drag_id=this.uid(),this.addEvent(o,a,this.locale.labels.new_event,this._drag_id,t.fields),this.callEvent("onEventCreated",[this._drag_id,e]),this._loading=!1,this._drag_mode="new-size"}var l,d=this.config.time_step,u=this.getEvent(this._drag_id);if(s.matrix&&(l=s.matrix[s._mode]),l=l||{x_step:1,x_unit:"day"},"move"==this._drag_mode)n=this._min_date.valueOf()+6e4*(t.y*this.config.time_step+24*t.x*60),!t.custom&&this._table_view&&(n+=1e3*this.date.time_part(u.start_date)),!this._table_view&&this._dragEventBody&&void 0===this._drag_event._move_event_shift&&(this._drag_event._move_event_shift=n-u.start_date),this._drag_event._move_event_shift&&(n-=this._drag_event._move_event_shift),n=this._correct_shift(n),t._ignores&&this.config.preserve_length&&this._table_view?(n=s._correct_drag_start_date(n),i=s._correct_drag_end_date(n,this._drag_event._event_length)):i=u.end_date.valueOf()-(u.start_date.valueOf()-n);else{if(n=u.start_date.valueOf(),i=u.end_date.valueOf(),this._table_view){var c=this._min_date.valueOf()+t.y*this.config.time_step*6e4+(t.custom?0:864e5);if("month"==this._mode)if(c=this._correct_shift(c,!1),this._drag_from_start){var h=864e5;c<=s.date.date_part(new Date(i+h-1)).valueOf()&&(n=c-h)}else i=c;else this.config.preserve_length?t.resize_from_start?n=s._correct_drag_start_date(c):i=s._correct_drag_end_date(c,0):t.resize_from_start?n=c:i=c}else{var f=this.date.date_part(new Date(u.end_date.valueOf()-1)).valueOf(),p=new Date(f),m=this.config.first_hour,g=60/d*(this.config.last_hour-m);this.config.time_step=1;var _=this._mouse_coords(e);this.config.time_step=d;var v=t.y*d*6e4,b=Math.min(t.y+1,g)*d*6e4,y=6e4*_.y;i=Math.abs(v-y)>Math.abs(b-y)?f+b:f+v,i+=6e4*(new Date(i).getTimezoneOffset()-p.getTimezoneOffset()),this._els.dhx_cal_data[0].style.cursor="s-resize","week"!=this._mode&&"day"!=this._mode||(i=this._correct_shift(i))}if("new-size"==this._drag_mode)if(i<=this._drag_start){var x=t.shift||(this._table_view&&!t.custom?864e5:0);n=i-(t.shift?0:x),i=this._drag_start+(x||6e4*d)}else n=this._drag_start;else i<=n&&(i=n+6e4*d)}var w=new Date(i-1),S=new Date(n);if("move"==this._drag_mode&&s.config.limit_drag_out&&(+S<+s._min_date||+i>+s._max_date)){if(+u.start_date<+s._min_date||+u.end_date>+s._max_date)S=new Date(u.start_date),i=new Date(u.end_date);else{var N=i-S;+S<+s._min_date?(S=new Date(s._min_date),t._ignores&&this.config.preserve_length&&this._table_view?(S=new Date(s._correct_drag_start_date(S)),l._start_correction&&(S=new Date(S.valueOf()+l._start_correction)),i=new Date(1*S+this._get_fictional_event_length(S,this._drag_event._event_length,l))):i=new Date(+S+N)):(i=new Date(s._max_date),t._ignores&&this.config.preserve_length&&this._table_view?(l._end_correction&&(i=new Date(i.valueOf()-l._end_correction)),i=new Date(1*i-this._get_fictional_event_length(i,0,l,!0)),S=new Date(1*i-this._get_fictional_event_length(i,this._drag_event._event_length,l,!0)),this._ignores_detected&&(S=s.date.add(S,l.x_step,l.x_unit),i=new Date(1*i-this._get_fictional_event_length(i,0,l,!0)),i=s.date.add(i,l.x_step,l.x_unit))):S=new Date(+i-N))}w=new Date(i-1)}if(!this._table_view&&this._dragEventBody&&!s.config.all_timed&&(!s._get_section_view()&&t.x!=this._get_event_sday({start_date:new Date(n),end_date:new Date(n)})||new Date(n).getHours()<this.config.first_hour)){N=i-S;if("move"==this._drag_mode){h=this._min_date.valueOf()+24*t.x*60*6e4;(S=new Date(h)).setHours(this.config.first_hour),i=new Date(S.valueOf()+N),w=new Date(i-1)}}if(!this._table_view&&!s.config.all_timed&&(!s.getView()&&t.x!=this._get_event_sday({start_date:new Date(i),end_date:new Date(i)})||new Date(i).getHours()>=this.config.last_hour)){N=i-S,h=this._min_date.valueOf()+24*t.x*60*6e4;(i=s.date.date_part(new Date(h))).setHours(this.config.last_hour),w=new Date(i-1),"move"==this._drag_mode&&(S=new Date(+i-N))}if(this._table_view||w.getDate()==S.getDate()&&w.getHours()<this.config.last_hour||s._allow_dnd)if(u.start_date=S,u.end_date=new Date(i),this.config.update_render){var E=s._els.dhx_cal_data[0].scrollTop;this.update_view(),s._els.dhx_cal_data[0].scrollTop=E}else this.updateEvent(this._drag_id);this._table_view&&this.for_rendered(this._drag_id,function(e){e.className+=" dhx_in_move dhx_cal_event_drag"}),this.callEvent("onEventDrag",[this._drag_id,this._drag_mode,e])}}else if(s.checkEvent("onMouseMove")){var C=this._locate_event(e.target||e.srcElement);this.callEvent("onMouseMove",[C,e])}},s._on_mouse_down=function(e,t){if(2!=e.button&&!this.config.readonly&&!this._drag_mode){t=t||e.target||e.srcElement;var n=s._getClassName(t).split(" ")[0];switch(this.config.drag_event_body&&"dhx_body"==n&&t.parentNode&&-1===t.parentNode.className.indexOf("dhx_cal_select_menu")&&(n="dhx_event_move",this._dragEventBody=!0),n){case"dhx_cal_event_line":case"dhx_cal_event_clear":this._table_view&&(this._drag_mode="move");break;case"dhx_event_move":case"dhx_wa_ev_body":this._drag_mode="move";break;case"dhx_event_resize":this._drag_mode="resize",s._getClassName(t).indexOf("dhx_event_resize_end")<0?s._drag_from_start=!0:s._drag_from_start=!1;break;case"dhx_scale_holder":case"dhx_scale_holder_now":case"dhx_month_body":case"dhx_matrix_cell":case"dhx_marked_timespan":this._drag_mode="create";break;case"":if(t.parentNode)return s._on_mouse_down(e,t.parentNode);break;default:if((!s.checkEvent("onMouseDown")||s.callEvent("onMouseDown",[n,e]))&&t.parentNode&&t!=this&&"dhx_body"!=n)return s._on_mouse_down(e,t.parentNode);this._drag_mode=null,this._drag_id=null}if(this._drag_mode){var i=this._locate_event(t);if(this.config["drag_"+this._drag_mode]&&this.callEvent("onBeforeDrag",[i,this._drag_mode,e])){if(this._drag_id=i,(this._edit_id!=this._drag_id||this._edit_id&&"create"==this._drag_mode)&&this._close_not_saved(),!this._drag_mode)return;this._drag_event=s._lame_clone(this.getEvent(this._drag_id)||{}),this._drag_pos=this._mouse_coords(e)}else this._drag_mode=this._drag_id=0}this._drag_start=null}},s._get_private_properties=function(e){var t={};for(var n in e)0===n.indexOf("_")&&(t[n]=!0);return t},s._clear_temporary_properties=function(e,t){var n=this._get_private_properties(e),i=this._get_private_properties(t);for(var r in i)n[r]||delete t[r]},s._on_mouse_up=function(e){if(!e||2!=e.button||!this._mobile){if(this._drag_mode&&this._drag_id){this._els.dhx_cal_data[0].style.cursor="default";var t=this._drag_id,n=this._drag_mode,i=!this._drag_pos||this._drag_pos.has_moved;delete this._drag_event._move_event_shift;var r=this.getEvent(this._drag_id);if(i&&(this._drag_event._dhx_changed||!this._drag_event.start_date||r.start_date.valueOf()!=this._drag_event.start_date.valueOf()||r.end_date.valueOf()!=this._drag_event.end_date.valueOf())){var o="new-size"==this._drag_mode;if(this.callEvent("onBeforeEventChanged",[r,e,o,this._drag_event]))if(this._drag_id=this._drag_mode=null,o&&this.config.edit_on_create){if(this.unselect(),this._new_event=new Date,this._table_view||this.config.details_on_create||!this.config.select||!this.isOneDayEvent(this.getEvent(t)))return s.callEvent("onDragEnd",[t,n,e]),this.showLightbox(t);this._drag_pos=!0,this._select_id=this._edit_id=t}else this._new_event||this.callEvent(o?"onEventAdded":"onEventChanged",[t,this.getEvent(t)]);else o?this.deleteEvent(r.id,!0):(this._drag_event._dhx_changed=!1,this._clear_temporary_properties(r,this._drag_event),s._lame_copy(r,this._drag_event),this.updateEvent(r.id))}this._drag_pos&&(this._drag_pos.has_moved||!0===this._drag_pos)&&(this._drag_id=this._drag_mode=null,this.render_view_data()),s.callEvent("onDragEnd",[t,n,e])}this._drag_id=null,this._drag_mode=null,this._drag_pos=null}},s._trigger_dyn_loading=function(){return!(!this._load_mode||!this._load()||(this._render_wait=!0,0))},s.update_view=function(){this._reset_ignores(),this._update_nav_bar(this.config.header,this.$container.querySelector(".dhx_cal_navline"));var e=this[this._mode+"_view"];if(e?e.call(this,!0):this._reset_scale(),this._trigger_dyn_loading())return!0;this.render_view_data()},s.isViewExists=function(e){return!!(s[e+"_view"]||s.date[e+"_start"]&&s.templates[e+"_date"]&&s.templates[e+"_scale_date"])},s._set_aria_buttons_attrs=function(){for(var e=["dhx_cal_next_button","dhx_cal_prev_button","dhx_cal_tab","dhx_cal_today_button"],t=0;t<e.length;t++)for(var n=this._els[e[t]],i=0;n&&i<n.length;i++){var r=n[i].getAttribute("name"),o=this.locale.labels[e[t]];r&&(o=this.locale.labels[r]||o),"dhx_cal_next_button"==e[t]?o=this.locale.labels.next:"dhx_cal_prev_button"==e[t]&&(o=this.locale.labels.prev),this._waiAria.headerButtonsAttributes(n[i],o||"")}},s.updateView=function(e,t){if(!this.$container)throw new Error("The scheduler is not initialized. \n **scheduler.updateView** or **scheduler.setCurrentView** can be called only after **scheduler.init**");e=e||this._date,t=t||this._mode;var n="dhx_cal_data",i=this._obj,r="dhx_scheduler_"+this._mode,o="dhx_scheduler_"+t;this._mode&&-1!=i.className.indexOf(r)?i.className=i.className.replace(r,o):i.className+=" "+o;var a,s="dhx_multi_day",l=!(this._mode!=t||!this.config.preserve_scroll)&&this._els[n][0].scrollTop;this._els[s]&&this._els[s][0]&&(a=this._els[s][0].scrollTop),this[this._mode+"_view"]&&t&&this._mode!=t&&this[this._mode+"_view"](!1),this._close_not_saved(),this._els[s]&&(this._els[s][0].parentNode.removeChild(this._els[s][0]),this._els[s]=null),this._mode=t,this._date=e,this._table_view="month"==this._mode,this._dy_shift=0,this.update_view(),this._set_aria_buttons_attrs();var d=this._els.dhx_cal_tab;if(d)for(var u=0;u<d.length;u++){var c=d[u];c.getAttribute("name")==this._mode+"_tab"?(c.classList.add("active"),this._waiAria.headerToggleState(c,!0)):(c.classList.remove("active"),this._waiAria.headerToggleState(c,!1))}"number"==typeof l&&(this._els[n][0].scrollTop=l),"number"==typeof a&&this._els[s]&&this._els[s][0]&&(this._els[s][0].scrollTop=a)},s.setCurrentView=function(e,t){this.callEvent("onBeforeViewChange",[this._mode,this._date,t||this._mode,e||this._date])&&(this.updateView(e,t),this.callEvent("onViewChange",[this._mode,this._date]))},s.render=function(e,t){s.setCurrentView(e,t)},s._render_x_header=function(e,t,n,i,r){r=r||0;var o=document.createElement("div");o.className="dhx_scale_bar",this.templates[this._mode+"_scalex_class"]&&(o.className+=" "+this.templates[this._mode+"_scalex_class"](n));var a=this._cols[e]-1;"month"==this._mode&&0===e&&this.config.left_border&&(o.className+=" dhx_scale_bar_border",t+=1),this.set_xy(o,a,this.xy.scale_height-2,t,r);var s=this.templates[this._mode+"_scale_date"](n,this._mode);o.innerHTML=s,this._waiAria.dayHeaderAttr(o,s),i.appendChild(o)},s._get_columns_num=function(e,t){var n=7;if(!s._table_view){var i=s.date["get_"+s._mode+"_end"];i&&(t=i(e)),n=Math.round((t.valueOf()-e.valueOf())/864e5)}return n},s._get_timeunit_start=function(){return this.date[this._mode+"_start"](new Date(this._date.valueOf()))},s._get_view_end=function(){var e=this._get_timeunit_start(),t=s.date.add(e,1,this._mode);if(!s._table_view){var n=s.date["get_"+s._mode+"_end"];n&&(t=n(e))}return t},s._calc_scale_sizes=function(e,t,n){var i=this.config.rtl,r=e,o=this._get_columns_num(t,n);this._process_ignores(t,o,"day",1);for(var a=o-this._ignores_detected,s=0;s<o;s++)this._ignores[s]?(this._cols[s]=0,a++):this._cols[s]=Math.floor(r/(a-s)),r-=this._cols[s],this._colsS[s]=(this._cols[s-1]||0)+(this._colsS[s-1]||(this._table_view?0:(i?this.xy.scroll_width:this.xy.scale_width)+2));this._colsS.col_length=o,this._colsS[o]=this._cols[o-1]+this._colsS[o-1]||0},s._set_scale_col_size=function(e,t,n){var i=this.config;this.set_xy(e,t-1,i.hour_size_px*(i.last_hour-i.first_hour),n+this.xy.scale_width+1,0)},s._render_scales=function(e,t){var n=new Date(s._min_date),i=new Date(s._max_date),r=this.date.date_part(s._currentDate()),o=parseInt(e.style.width,10),a=new Date(this._min_date),l=this._get_columns_num(n,i);this._calc_scale_sizes(o,n,i);var d=0;e.innerHTML="";for(var u=0;u<l;u++){if(this._ignores[u]||this._render_x_header(u,d,a,e),!this._table_view){var c=document.createElement("div"),h="dhx_scale_holder";a.valueOf()==r.valueOf()&&(h="dhx_scale_holder_now"),c.setAttribute("data-column-index",u),this._ignores_detected&&this._ignores[u]&&(h+=" dhx_scale_ignore"),c.className=h+" "+this.templates.week_date_class(a,r),this._waiAria.dayColumnAttr(c,a),this._set_scale_col_size(c,this._cols[u],d),t.appendChild(c),this.callEvent("onScaleAdd",[c,a])}d+=this._cols[u],a=this.date.add(a,1,"day"),a=this.date.day_start(a)}},s._getNavDateElement=function(){return this.$container.querySelector(".dhx_cal_date")},s._reset_scale=function(){if(this.templates[this._mode+"_date"]){var e=this._els.dhx_cal_header[0],t=this._els.dhx_cal_data[0],n=this.config;e.innerHTML="",t.innerHTML="";var i=(n.readonly||!n.drag_resize?" dhx_resize_denied":"")+(n.readonly||!n.drag_move?" dhx_move_denied":"");t.className="dhx_cal_data"+i,this._scales={},this._cols=[],this._colsS={height:0},this._dy_shift=0,this.set_sizes();var r,o,a=this._get_timeunit_start(),l=s._get_view_end();r=o=this._table_view?s.date.week_start(a):a,this._min_date=r;var d=this.templates[this._mode+"_date"](a,l,this._mode),u=this._getNavDateElement();if(u&&(u.innerHTML=d,this._waiAria.navBarDateAttr(u,d)),this._max_date=l,s._render_scales(e,t),this._table_view)this._reset_month_scale(t,a,o);else if(this._reset_hours_scale(t,a,o),n.multi_day){var c="dhx_multi_day";this._els[c]&&(this._els[c][0].parentNode.removeChild(this._els[c][0]),this._els[c]=null);var h=this._els.dhx_cal_navline[0].offsetHeight+this._els.dhx_cal_header[0].offsetHeight+1,f=document.createElement("div");f.className=c,f.style.visibility="hidden";var p=this._colsS[this._colsS.col_length],m=n.rtl?this.xy.scale_width:this.xy.scroll_width,g=Math.max(p+m-2,0);this.set_xy(f,g,0,0,h),t.parentNode.insertBefore(f,t);var _=f.cloneNode(!0);_.className=c+"_icon",_.style.visibility="hidden",this.set_xy(_,this.xy.scale_width,0,0,h),f.appendChild(_),this._els[c]=[f,_],this._els[c][0].onclick=this._click.dhx_cal_data}}},s._reset_hours_scale=function(e,t,n){var i=document.createElement("div");i.className="dhx_scale_holder";for(var r=new Date(1980,1,1,this.config.first_hour,0,0),o=1*this.config.first_hour;o<this.config.last_hour;o++){var a=document.createElement("div");a.className="dhx_scale_hour",a.style.height=this.config.hour_size_px+"px";var l=this.xy.scale_width;this.config.left_border&&(a.className+=" dhx_scale_hour_border"),a.style.width=l+"px";var d=s.templates.hour_scale(r);a.innerHTML=d,this._waiAria.hourScaleAttr(a,d),i.appendChild(a),r=this.date.add(r,1,"hour")}e.appendChild(i),this.config.scroll_hour&&(e.scrollTop=this.config.hour_size_px*(this.config.scroll_hour-this.config.first_hour))},s._currentDate=function(){return s.config.now_date?new Date(s.config.now_date):new Date},s._reset_ignores=function(){this._ignores={},this._ignores_detected=0},s._process_ignores=function(e,t,n,i,r){this._reset_ignores();var o=s["ignore_"+this._mode];if(o)for(var a=new Date(e),l=0;l<t;l++)o(a)&&(this._ignores_detected+=1,this._ignores[l]=!0,r&&t++),a=s.date.add(a,i,n),s.date[n+"_start"]&&(a=s.date[n+"_start"](a))},s._render_month_scale=function(e,t,n,i){function r(e){var t=s._colsS.height;return void 0!==s._colsS.heights[e+1]&&(t=s._colsS.heights[e+1]-(s._colsS.heights[e]||0)),t}var o=s.date.add(t,1,"month"),a=new Date(n),l=s._currentDate();this.date.date_part(l),this.date.date_part(n),i=i||Math.ceil(Math.round((o.valueOf()-n.valueOf())/864e5)/7);for(var d=[],u=0;u<=7;u++){var c=(this._cols[u]||0)-1;0===u&&this.config.left_border&&(c-=1),d[u]=c+"px"}var h=0,f=document.createElement("table");f.setAttribute("cellpadding","0"),f.setAttribute("cellspacing","0");var p=document.createElement("tbody");f.appendChild(p);var m=[];for(u=0;u<i;u++){var g=document.createElement("tr");p.appendChild(g);for(var _=Math.max(r(u)-s.xy.month_head_height,0),v=0;v<7;v++){var b=document.createElement("td");g.appendChild(b);var y="";n<t?y="dhx_before":n>=o?y="dhx_after":n.valueOf()==l.valueOf()&&(y="dhx_now"),this._ignores_detected&&this._ignores[v]&&(y+=" dhx_scale_ignore"),b.className=y+" "+this.templates.month_date_class(n,l),b.setAttribute("data-cell-date",s.templates.format_date(n));var x="dhx_month_body",w="dhx_month_head";if(0===v&&this.config.left_border&&(x+=" dhx_month_body_border",w+=" dhx_month_head_border"),this._ignores_detected&&this._ignores[v])b.appendChild(document.createElement("div")),b.appendChild(document.createElement("div"));else{this._waiAria.monthCellAttr(b,n);var S=document.createElement("div");S.className=w,S.innerHTML=this.templates.month_day(n),b.appendChild(S);var N=document.createElement("div");N.className=x,N.style.height=_+"px",N.style.width=d[v],b.appendChild(N)}m.push(n);var E=n.getDate();(n=this.date.add(n,1,"day")).getDate()-E>1&&(n=new Date(n.getFullYear(),n.getMonth(),E+1,12,0))}s._colsS.heights[u]=h,h+=r(u)}this._min_date=a,this._max_date=n,e.innerHTML="",e.appendChild(f),this._scales={};var C=e.getElementsByTagName("div");for(u=0;u<m.length;u++){e=C[2*u+1];var k=m[u];this._scales[+k]=e}for(u=0;u<m.length;u++){k=m[u];this.callEvent("onScaleAdd",[this._scales[+k],k])}return this._max_date},s._reset_month_scale=function(e,t,n,i){var r=s.date.add(t,1,"month"),o=s._currentDate();this.date.date_part(o),this.date.date_part(n),i=i||Math.ceil(Math.round((r.valueOf()-n.valueOf())/864e5)/7);var a=Math.floor(e.clientHeight/i)-this.xy.month_head_height;return this._colsS.height=a+this.xy.month_head_height,this._colsS.heights=[],s._render_month_scale(e,t,n,i)},s.getView=function(e){return e||(e=s.getState().mode),s.matrix&&s.matrix[e]?s.matrix[e]:s._props&&s._props[e]?s._props[e]:null},s.getLabel=function(e,t){for(var n=this.config.lightbox.sections,i=0;i<n.length;i++)if(n[i].map_to==e)for(var r=n[i].options,o=0;o<r.length;o++)if(r[o].key==t)return r[o].label;return""},s.updateCollection=function(e,t){var n=s.serverList(e);return!!n&&(n.splice(0,n.length),n.push.apply(n,t||[]),s.callEvent("onOptionsLoad",[]),s.resetLightbox(),s.hideCover(),!0)},s._lame_clone=function(e,t){var n,i,r;for(t=t||[],n=0;n<t.length;n+=2)if(e===t[n])return t[n+1];if(e&&"object"==typeof e){for(r=Object.create(e),i=[Array,Date,Number,String,Boolean],n=0;n<i.length;n++)e instanceof i[n]&&(r=n?new i[n](e):new i[n]);for(n in t.push(e,r),e)Object.prototype.hasOwnProperty.apply(e,[n])&&(r[n]=s._lame_clone(e[n],t))}return r||e},s._lame_copy=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},s._get_date_from_pos=function(e){var t=this._min_date.valueOf()+6e4*(e.y*this.config.time_step+24*(this._table_view?0:e.x)*60);return new Date(this._correct_shift(t))},s.getActionData=function(e){var t=this._mouse_coords(e);return{date:this._get_date_from_pos(t),section:t.section}},s._focus=function(e,t){if(e&&e.focus)if(this._mobile)window.setTimeout(function(){e.focus()},10);else try{t&&e.select&&e.offsetWidth&&e.select(),e.focus()}catch(e){}},s._get_real_event_length=function(e,t,n){var i,r=t-e,o=n._start_correction+n._end_correction||0,a=this["ignore_"+this._mode],l=0;n.render?(l=this._get_date_index(n,e),i=this._get_date_index(n,t)):i=Math.round(r/60/60/1e3/24);for(var d=!0;l<i;){var u=s.date.add(t,-n.x_step,n.x_unit);a&&a(t)&&(!d||d&&a(u))?r-=t-u:(d=!1,r-=o),t=u,i--}return r},s._get_fictional_event_length=function(e,t,n,i){var r=new Date(e),o=i?-1:1;if(n._start_correction||n._end_correction){var a;a=i?60*r.getHours()+r.getMinutes()-60*(n.first_hour||0):60*(n.last_hour||0)-(60*r.getHours()+r.getMinutes());var l=60*(n.last_hour-n.first_hour),d=Math.ceil((t/6e4-a)/l);d<0&&(d=0),t+=d*(1440-l)*60*1e3}var u,c=new Date(1*e+t*o),h=this["ignore_"+this._mode],f=0;for(n.render?(f=this._get_date_index(n,r),u=this._get_date_index(n,c)):u=Math.round(t/60/60/1e3/24);f*o<=u*o;){var p=s.date.add(r,n.x_step*o,n.x_unit);h&&h(r)&&(t+=(p-r)*o,u+=o),r=p,f+=o}return t},s._get_section_view=function(){return this.getView()},s._get_section_property=function(){return this.matrix&&this.matrix[this._mode]?this.matrix[this._mode].y_property:this._props&&this._props[this._mode]?this._props[this._mode].map_to:null},s._is_initialized=function(){var e=this.getState();return this._obj&&e.date&&e.mode},s._is_lightbox_open=function(){var e=this.getState();return null!==e.lightbox_id&&void 0!==e.lightbox_id},s._getClassName=function(e){if(!e)return"";var t=e.className||"";return t.baseVal&&(t=t.baseVal),t.indexOf||(t=""),t||""},s.event=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n)},s.eventRemove=function(e,t,n){e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n)},function(){function e(e){var t=!1,n=!1;if(window.getComputedStyle){var i=window.getComputedStyle(e,null);t=i.display,n=i.visibility}else e.currentStyle&&(t=e.currentStyle.display,n=e.currentStyle.visibility);var r=!1,o=s._locate_css({target:e},"dhx_form_repeat",!1);return o&&(r=!("0px"!=o.style.height)),r=r||!e.offsetHeight,"none"!=t&&"hidden"!=n&&!r}function t(e){return!isNaN(e.getAttribute("tabindex"))&&1*e.getAttribute("tabindex")>=0}function n(e){return!{a:!0,area:!0}[e.nodeName.loLowerCase()]||!!e.getAttribute("href")}function i(e){return!{input:!0,select:!0,textarea:!0,button:!0,object:!0}[e.nodeName.toLowerCase()]||!e.hasAttribute("disabled")}s._getFocusableNodes=function(r){for(var o=r.querySelectorAll(["a[href]","area[href]","input","select","textarea","button","iframe","object","embed","[tabindex]","[contenteditable]"].join(", ")),a=Array.prototype.slice.call(o,0),s=0;s<a.length;s++)a[s].$position=s;a.sort(function(e,t){return 0===e.tabIndex&&0!==t.tabIndex?1:0!==e.tabIndex&&0===t.tabIndex?-1:e.tabIndex===t.tabIndex?e.$position-t.$position:e.tabIndex<t.tabIndex?-1:1});for(s=0;s<a.length;s++){var l=a[s];(t(l)||i(l)||n(l))&&e(l)||(a.splice(s,1),s--)}return a}}(),s._trim=function(e){return(String.prototype.trim||function(){return this.replace(/^\s+|\s+$/g,"")}).apply(e)},s._isDate=function(e){return!(!e||"object"!=typeof e||!(e.getFullYear&&e.getMonth&&e.getDate))},s._isObject=function(e){return e&&"object"==typeof e},function(){function e(e){return(e+"").replace(i," ").replace(r," ")}function t(e){return(e+"").replace(o,"&#39;")}function n(){return!s.config.wai_aria_attributes}var i=new RegExp("<(?:.|\n)*?>","gm"),r=new RegExp(" +","gm"),o=new RegExp("'","gm");for(var a in s._waiAria={getAttributeString:function(n){var i=[" "];for(var r in n)if("function"!=typeof n[r]&&"object"!=typeof n[r]){var o=t(e(n[r]));i.push(r+"='"+o+"'")}return i.push(" "),i.join(" ")},setAttributes:function(t,n){for(var i in n)t.setAttribute(i,e(n[i]));return t},labelAttr:function(e,t){return this.setAttributes(e,{"aria-label":t})},label:function(e){return s._waiAria.getAttributeString({"aria-label":e})},hourScaleAttr:function(e,t){this.labelAttr(e,t)},monthCellAttr:function(e,t){this.labelAttr(e,s.templates.day_date(t))},navBarDateAttr:function(e,t){this.labelAttr(e,t)},dayHeaderAttr:function(e,t){this.labelAttr(e,t)},dayColumnAttr:function(e,t){this.dayHeaderAttr(e,s.templates.day_date(t))},headerButtonsAttributes:function(e,t){return this.setAttributes(e,{role:"button","aria-label":t})},headerToggleState:function(e,t){return this.setAttributes(e,{"aria-pressed":t?"true":"false"})},getHeaderCellAttr:function(e){return s._waiAria.getAttributeString({"aria-label":e})},eventAttr:function(e,t){this._eventCommonAttr(e,t)},_eventCommonAttr:function(t,n){n.setAttribute("aria-label",e(s.templates.event_text(t.start_date,t.end_date,t))),s.config.readonly&&n.setAttribute("aria-readonly",!0),t.$dataprocessor_class&&n.setAttribute("aria-busy",!0),n.setAttribute("aria-selected",s.getState().select_id==t.id?"true":"false")},setEventBarAttr:function(e,t){this._eventCommonAttr(e,t)},_getAttributes:function(e,t){var n={setAttribute:function(e,t){this[e]=t}};return e.apply(this,[t,n]),n},eventBarAttrString:function(e){return this.getAttributeString(this._getAttributes(this.setEventBarAttr,e))},agendaHeadAttrString:function(){return this.getAttributeString({role:"row"})},agendaHeadDateString:function(e){return this.getAttributeString({role:"columnheader","aria-label":e})},agendaHeadDescriptionString:function(e){return this.agendaHeadDateString(e)},agendaDataAttrString:function(){return this.getAttributeString({role:"grid"})},agendaEventAttrString:function(e){var t=this._getAttributes(this._eventCommonAttr,e);return t.role="row",this.getAttributeString(t)},agendaDetailsBtnString:function(){return this.getAttributeString({role:"button","aria-label":s.locale.labels.icon_details})},gridAttrString:function(){return this.getAttributeString({role:"grid"})},gridRowAttrString:function(e){return this.agendaEventAttrString(e)},gridCellAttrString:function(e,t,n){return this.getAttributeString({role:"gridcell","aria-label":[void 0===t.label?t.id:t.label,": ",n]})},mapAttrString:function(){return this.gridAttrString()},mapRowAttrString:function(e){return this.gridRowAttrString(e)},mapDetailsBtnString:function(){return this.agendaDetailsBtnString()},minicalHeader:function(e,t){this.setAttributes(e,{id:t+"","aria-live":"assertice","aria-atomic":"true"})},minicalGrid:function(e,t){this.setAttributes(e,{"aria-labelledby":t+"",role:"grid"})},minicalRow:function(e){this.setAttributes(e,{role:"row"})},minicalDayCell:function(e,t){var n=t.valueOf()<s._max_date.valueOf()&&t.valueOf()>=s._min_date.valueOf();this.setAttributes(e,{role:"gridcell","aria-label":s.templates.day_date(t),"aria-selected":n?"true":"false"})},minicalHeadCell:function(e){this.setAttributes(e,{role:"columnheader"})},weekAgendaDayCell:function(e,t){var n=e.querySelector(".dhx_wa_scale_bar"),i=e.querySelector(".dhx_wa_day_data"),r=s.uid()+"";this.setAttributes(n,{id:r}),this.setAttributes(i,{"aria-labelledby":r})},weekAgendaEvent:function(e,t){this.eventAttr(t,e)},lightboxHiddenAttr:function(e){e.setAttribute("aria-hidden","true")},lightboxVisibleAttr:function(e){e.setAttribute("aria-hidden","false")},lightboxSectionButtonAttrString:function(e){return this.getAttributeString({role:"button","aria-label":e,tabindex:"0"})},yearHeader:function(e,t){this.setAttributes(e,{id:t+""})},yearGrid:function(e,t){this.minicalGrid(e,t)},yearHeadCell:function(e){return this.minicalHeadCell(e)},yearRow:function(e){return this.minicalRow(e)},yearDayCell:function(e){this.setAttributes(e,{role:"gridcell"})},lightboxAttr:function(e){e.setAttribute("role","dialog"),e.setAttribute("aria-hidden","true"),e.firstChild.setAttribute("role","heading")},lightboxButtonAttrString:function(e){return this.getAttributeString({role:"button","aria-label":s.locale.labels[e],tabindex:"0"})},eventMenuAttrString:function(e){return this.getAttributeString({role:"button","aria-label":s.locale.labels[e]})},lightboxHeader:function(e,t){e.setAttribute("aria-label",t)},lightboxSelectAttrString:function(e){var t="";switch(e){case"%Y":t=s.locale.labels.year;break;case"%m":t=s.locale.labels.month;break;case"%d":t=s.locale.labels.day;break;case"%H:%i":t=s.locale.labels.hour+" "+s.locale.labels.minute}return s._waiAria.getAttributeString({"aria-label":t})},messageButtonAttrString:function(e){return"tabindex='0' role='button' aria-label='"+e+"'"},messageInfoAttr:function(e){e.setAttribute("role","alert")},messageModalAttr:function(e,t){e.setAttribute("role","dialog"),t&&e.setAttribute("aria-labelledby",t)},quickInfoAttr:function(e){e.setAttribute("role","dialog")},quickInfoHeaderAttrString:function(){return" role='heading' "},quickInfoHeader:function(e,t){e.setAttribute("aria-label",t)},quickInfoButtonAttrString:function(e){return s._waiAria.getAttributeString({role:"button","aria-label":e,tabindex:"0"})},tooltipAttr:function(e){e.setAttribute("role","tooltip")},tooltipVisibleAttr:function(e){e.setAttribute("aria-hidden","false")},tooltipHiddenAttr:function(e){e.setAttribute("aria-hidden","true")}},s._waiAria)s._waiAria[a]=function(e){return function(){return n()?" ":e.apply(this,arguments)}}(s._waiAria[a])}(),s.utils={mixin:function(e,t,n){for(var i in t)(void 0===e[i]||n)&&(e[i]=t[i]);return e},copy:function e(t){var n,i;if(t&&"object"==typeof t)switch(!0){case function(e){return!(!e||"object"!=typeof e||!(e.getFullYear&&e.getMonth&&e.getDate))}(t):i=new Date(t);break;case function(e){return Array.isArray?Array.isArray(e):e&&void 0!==e.length&&e.pop&&e.push}(t):for(i=new Array(t.length),n=0;n<t.length;n++)i[n]=e(t[n]);break;case function(e){return e&&"object"==typeof e&&"function String() { [native code] }"===Function.prototype.toString.call(e.constructor)}(t):i=new String(t);break;case function(e){return e&&"object"==typeof e&&"function Number() { [native code] }"===Function.prototype.toString.call(e.constructor)}(t):i=new Number(t);break;case function(e){return e&&"object"==typeof e&&"function Boolean() { [native code] }"===Function.prototype.toString.call(e.constructor)}(t):i=new Boolean(t);break;default:for(n in i={},t)Object.prototype.hasOwnProperty.apply(t,[n])&&(i[n]=e(t[n]))}return i||t}},s.$domHelpers={getAbsoluteLeft:function(e){return this.getOffset(e).left},getAbsoluteTop:function(e){return this.getOffset(e).top},getOffsetSum:function(e){for(var t=0,n=0;e;)t+=parseInt(e.offsetTop),n+=parseInt(e.offsetLeft),e=e.offsetParent;return{top:t,left:n}},getOffsetRect:function(e){var t=e.getBoundingClientRect(),n=0,i=0;if(/Mobi/.test(navigator.userAgent)){var r=document.createElement("div");r.style.position="absolute",r.style.left="0px",r.style.top="0px",r.style.width="1px",r.style.height="1px",document.body.appendChild(r);var o=r.getBoundingClientRect();n=t.top-o.top,i=t.left-o.left,r.parentNode.removeChild(r)}else{var a=document.body,s=document.documentElement,l=window.pageYOffset||s.scrollTop||a.scrollTop,d=window.pageXOffset||s.scrollLeft||a.scrollLeft,u=s.clientTop||a.clientTop||0,c=s.clientLeft||a.clientLeft||0;n=t.top+l-u,i=t.left+d-c}return{top:Math.round(n),left:Math.round(i)}},getOffset:function(e){return e.getBoundingClientRect?this.getOffsetRect(e):this.getOffsetSum(e)},closest:function(e,t){return e&&t?h(e,t):null},insertAfter:function(e,t){t.nextSibling?t.parentNode.insertBefore(e,t.nextSibling):t.parentNode.appendChild(e)}},Element.prototype.closest)h=function(e,t){return e.closest(t)};else{var g=Element.prototype.matches||Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector;h=function(e,t){var n=e;do{if(g.call(n,t))return n;n=n.parentElement||n.parentNode}while(null!==n&&1===n.nodeType);return null}}s.$env={isIE:navigator.userAgent.indexOf("MSIE")>=0||navigator.userAgent.indexOf("Trident")>=0,isIE6:!window.XMLHttpRequest&&navigator.userAgent.indexOf("MSIE")>=0,isIE7:navigator.userAgent.indexOf("MSIE 7.0")>=0&&navigator.userAgent.indexOf("Trident")<0,isIE8:navigator.userAgent.indexOf("MSIE 8.0")>=0&&navigator.userAgent.indexOf("Trident")>=0,isOpera:navigator.userAgent.indexOf("Opera")>=0,isChrome:navigator.userAgent.indexOf("Chrome")>=0,isKHTML:navigator.userAgent.indexOf("Safari")>=0||navigator.userAgent.indexOf("Konqueror")>=0,isFF:navigator.userAgent.indexOf("Firefox")>=0,isIPad:navigator.userAgent.search(/iPad/gi)>=0,isEdge:-1!=navigator.userAgent.indexOf("Edge")},s.$ajax={_obj:s,cache:!0,method:"get",parse:function(e){return"string"!=typeof e?e:(e=e.replace(/^[\s]+/,""),window.DOMParser&&!s.$env.isIE?t=(new window.DOMParser).parseFromString(e,"text/xml"):window.ActiveXObject!==window.undefined&&((t=new window.ActiveXObject("Microsoft.XMLDOM")).async="false",t.loadXML(e)),t);var t},xmltop:function(e,t,n){if(void 0===t.status||t.status<400){var i=t.responseXML?t.responseXML||t:this.parse(t.responseText||t);if(i&&null!==i.documentElement&&!i.getElementsByTagName("parsererror").length)return i.getElementsByTagName(e)[0]}return-1!==n&&this._obj.callEvent("onLoadXMLError",["Incorrect XML",arguments[1],n]),document.createElement("DIV")},xpath:function(e,t){if(t.nodeName||(t=t.responseXML||t),s.$env.isIE)return t.selectNodes(e)||[];for(var n,i=[],r=(t.ownerDocument||t).evaluate(e,t,null,XPathResult.ANY_TYPE,null);n=r.iterateNext();)i.push(n);return i},query:function(e){this._call(e.method||"GET",e.url,e.data||"",e.async||!0,e.callback,null,e.headers)},get:function(e,t){this._call("GET",e,null,!0,t)},getSync:function(e){return this._call("GET",e,null,!1)},put:function(e,t,n){this._call("PUT",e,t,!0,n)},del:function(e,t,n){this._call("DELETE",e,t,!0,n)},post:function(e,t,n){1==arguments.length?t="":2!=arguments.length||"function"!=typeof t&&"function"!=typeof window[t]?t=String(t):(n=t,t=""),this._call("POST",e,t,!0,n)},postSync:function(e,t){return t=null===t?"":String(t),this._call("POST",e,t,!1)},getLong:function(e,t){this._call("GET",e,null,!0,t,{url:e})},postLong:function(e,t,n){2!=arguments.length||"function"!=typeof t&&(window[t],0)||(n=t,t=""),this._call("POST",e,t,!0,n,{url:e,postData:t})},_call:function(e,t,n,i,r,o,a){var s=this._obj,l=window.XMLHttpRequest&&!s.$env.isIE?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),d=null!==navigator.userAgent.match(/AppleWebKit/)&&null!==navigator.userAgent.match(/Qt/)&&null!==navigator.userAgent.match(/Safari/);if(i&&(l.onreadystatechange=function(){if(4==l.readyState||d&&3==l.readyState){if((200!=l.status||""===l.responseText)&&!s.callEvent("onAjaxError",[l]))return;window.setTimeout(function(){"function"==typeof r&&r.apply(window,[{xmlDoc:l,filePath:t}]),o&&(void 0!==o.postData?this.postLong(o.url,o.postData,r):this.getLong(o.url,r)),r=null,l=null},1)}}),"GET"!=e||this.cache||(t+=(t.indexOf("?")>=0?"&":"?")+"dhxr"+(new Date).getTime()+"=1"),l.open(e,t,i),a)for(var u in a)l.setRequestHeader(u,a[u]);else"POST"==e.toUpperCase()||"PUT"==e||"DELETE"==e?l.setRequestHeader("Content-Type","application/x-www-form-urlencoded"):"GET"==e&&(n=null);if(l.setRequestHeader("X-Requested-With","XMLHttpRequest"),l.send(n),!i)return{xmlDoc:l,filePath:t}},urlSeparator:function(e){return-1!=e.indexOf("?")?"&":"?"}};var _,v,b=function(e,t){for(var n="var temp=date.match(/[a-zA-Z]+|[0-9]+/g);",i=e.match(/%[a-zA-Z]/g),r=0;r<i.length;r++)switch(i[r]){case"%j":case"%d":n+="set[2]=temp["+r+"]||1;";break;case"%n":case"%m":n+="set[1]=(temp["+r+"]||1)-1;";break;case"%y":n+="set[0]=temp["+r+"]*1+(temp["+r+"]>50?1900:2000);";break;case"%g":case"%G":case"%h":case"%H":n+="set[3]=temp["+r+"]||0;";break;case"%i":n+="set[4]=temp["+r+"]||0;";break;case"%Y":n+="set[0]=temp["+r+"]||0;";break;case"%a":case"%A":n+="set[3]=set[3]%12+((temp["+r+"]||'').toLowerCase()=='am'?0:12);";break;case"%s":n+="set[5]=temp["+r+"]||0;";break;case"%M":n+="set[1]=this.locale.date.month_short_hash[temp["+r+"]]||0;";break;case"%F":n+="set[1]=this.locale.date.month_full_hash[temp["+r+"]]||0;"}var o="set[0],set[1],set[2],set[3],set[4],set[5]";return t&&(o=" Date.UTC("+o+")"),new Function("date","var set=[0,0,1,0,0,0]; "+n+" return new Date("+o+");")};s.date={init:function(){for(var e=s.locale.date.month_short,t=s.locale.date.month_short_hash={},n=0;n<e.length;n++)t[e[n]]=n;for(e=s.locale.date.month_full,t=s.locale.date.month_full_hash={},n=0;n<e.length;n++)t[e[n]]=n},_bind_host_object:function(e){return e.bind?e.bind(s):function(){return e.apply(s,arguments)}},date_part:function(e){var t=new Date(e);return e.setHours(0),e.setMinutes(0),e.setSeconds(0),e.setMilliseconds(0),e.getHours()&&(e.getDate()<t.getDate()||e.getMonth()<t.getMonth()||e.getFullYear()<t.getFullYear())&&e.setTime(e.getTime()+36e5*(24-e.getHours())),e},time_part:function(e){return(e.valueOf()/1e3-60*e.getTimezoneOffset())%86400},week_start:function(e){var t=e.getDay();return s.config.start_on_monday&&(0===t?t=6:t--),this.date_part(this.add(e,-1*t,"day"))},month_start:function(e){return e.setDate(1),this.date_part(e)},year_start:function(e){return e.setMonth(0),this.month_start(e)},day_start:function(e){return this.date_part(e)},_add_days:function(e,t){var n=new Date(e.valueOf());if(n.setDate(n.getDate()+t),t==Math.round(t)&&t>0){var i=(+n-+e)%864e5;if(i&&e.getTimezoneOffset()==n.getTimezoneOffset()){var r=i/36e5;n.setTime(n.getTime()+60*(24-r)*60*1e3)}}return t>=0&&!e.getHours()&&n.getHours()&&(n.getDate()<e.getDate()||n.getMonth()<e.getMonth()||n.getFullYear()<e.getFullYear())&&n.setTime(n.getTime()+36e5*(24-n.getHours())),n},add:function(e,t,n){var i=new Date(e.valueOf());switch(n){case"day":i=s.date._add_days(i,t);break;case"week":i=s.date._add_days(i,7*t);break;case"month":i.setMonth(i.getMonth()+t);break;case"year":i.setYear(i.getFullYear()+t);break;case"hour":i.setTime(i.getTime()+60*t*60*1e3);break;case"minute":i.setTime(i.getTime()+60*t*1e3);break;default:return s.date["add_"+n](e,t,n)}return i},to_fixed:function(e){return e<10?"0"+e:e},copy:function(e){return new Date(e.valueOf())},date_to_str:function(e,t){e=e.replace(/%[a-zA-Z]/g,function(e){switch(e){case"%d":return'"+this.date.to_fixed(date.getDate())+"';case"%m":return'"+this.date.to_fixed((date.getMonth()+1))+"';case"%j":return'"+date.getDate()+"';case"%n":return'"+(date.getMonth()+1)+"';case"%y":return'"+this.date.to_fixed(date.getFullYear()%100)+"';case"%Y":return'"+date.getFullYear()+"';case"%D":return'"+this.locale.date.day_short[date.getDay()]+"';case"%l":return'"+this.locale.date.day_full[date.getDay()]+"';case"%M":return'"+this.locale.date.month_short[date.getMonth()]+"';case"%F":return'"+this.locale.date.month_full[date.getMonth()]+"';case"%h":return'"+this.date.to_fixed((date.getHours()+11)%12+1)+"';case"%g":return'"+((date.getHours()+11)%12+1)+"';case"%G":return'"+date.getHours()+"';case"%H":return'"+this.date.to_fixed(date.getHours())+"';case"%i":return'"+this.date.to_fixed(date.getMinutes())+"';case"%a":return'"+(date.getHours()>11?"pm":"am")+"';case"%A":return'"+(date.getHours()>11?"PM":"AM")+"';case"%s":return'"+this.date.to_fixed(date.getSeconds())+"';case"%W":return'"+this.date.to_fixed(this.date.getISOWeek(date))+"';default:return e}}),t&&(e=e.replace(/date\.get/g,"date.getUTC"));var n=new Function("date",'return "'+e+'";');return s.date._bind_host_object(n)},str_to_date:function(e,t,n){var i=b(e,t),r=/^[0-9]{4}(\-|\/)[0-9]{2}(\-|\/)[0-9]{2} ?(([0-9]{1,2}:[0-9]{1,2})(:[0-9]{1,2})?)?$/,o=/^[0-9]{2}\/[0-9]{2}\/[0-9]{4} ?(([0-9]{1,2}:[0-9]{2})(:[0-9]{1,2})?)?$/,a=/^[0-9]{2}\-[0-9]{2}\-[0-9]{4} ?(([0-9]{1,2}:[0-9]{1,2})(:[0-9]{1,2})?)?$/,l=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,d=b("%Y-%m-%d %H:%i:%s",t),u=b("%m/%d/%Y %H:%i:%s",t),c=b("%d-%m-%Y %H:%i:%s",t);return function(e){if(!n&&!s.config.parse_exact_format){if(e&&e.getISOWeek)return new Date(e);if("number"==typeof e)return new Date(e);if(function(e){return r.test(String(e))}(e))return d(e);if(function(e){return o.test(String(e))}(e))return u(e);if(function(e){return a.test(String(e))}(e))return c(e);if(function(e){return l.test(e)}(e))return new Date(e)}return i.call(s,e)}},getISOWeek:function(e){if(!e)return!1;var t=(e=this.date_part(new Date(e))).getDay();0===t&&(t=7);var n=new Date(e.valueOf());n.setDate(e.getDate()+(4-t));var i=n.getFullYear(),r=Math.round((n.getTime()-new Date(i,0,1).getTime())/864e5);return 1+Math.floor(r/7)},getUTCISOWeek:function(e){return this.getISOWeek(this.convert_to_utc(e))},convert_to_utc:function(e){return new Date(e.getUTCFullYear(),e.getUTCMonth(),e.getUTCDate(),e.getUTCHours(),e.getUTCMinutes(),e.getUTCSeconds())}},s.locale={date:{month_full:["January","February","March","April","May","June","July","August","September","October","November","December"],month_short:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],day_full:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],day_short:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},labels:{dhx_cal_today_button:"Today",day_tab:"Day",week_tab:"Week",month_tab:"Month",new_event:"New event",icon_save:"Save",icon_cancel:"Cancel",icon_details:"Details",icon_edit:"Edit",icon_delete:"Delete",confirm_closing:"",confirm_deleting:"Event will be deleted permanently, are you sure?",section_description:"Description",section_time:"Time period",full_day:"Full day",confirm_recurring:"Do you want to edit the whole set of repeated events?",section_recurring:"Repeat event",button_recurring:"Disabled",button_recurring_open:"Enabled",button_edit_series:"Edit series",button_edit_occurrence:"Edit occurrence",agenda_tab:"Agenda",date:"Date",description:"Description",year_tab:"Year",week_agenda_tab:"Agenda",grid_tab:"Grid",drag_to_create:"Drag to create",drag_to_move:"Drag to move",message_ok:"OK",message_cancel:"Cancel",next:"Next",prev:"Previous",year:"Year",month:"Month",day:"Day",hour:"Hour",minute:"Minute",repeat_radio_day:"Daily",repeat_radio_week:"Weekly",repeat_radio_month:"Monthly",repeat_radio_year:"Yearly",repeat_radio_day_type:"Every",repeat_text_day_count:"day",repeat_radio_day_type2:"Every workday",repeat_week:" Repeat every",repeat_text_week_count:"week next days:",repeat_radio_month_type:"Repeat",repeat_radio_month_start:"On",repeat_text_month_day:"day every",repeat_text_month_count:"month",repeat_text_month_count2_before:"every",repeat_text_month_count2_after:"month",repeat_year_label:"On",select_year_day2:"of",repeat_text_year_day:"day",select_year_month:"month",repeat_radio_end:"No end date",repeat_text_occurences_count:"occurrences",repeat_radio_end2:"After",repeat_radio_end3:"End by",month_for_recurring:["January","February","March","April","May","June","July","August","September","October","November","December"],day_for_recurring:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}},s.config={default_date:"%j %M %Y",month_date:"%F %Y",load_date:"%Y-%m-%d",week_date:"%l",day_date:"%D, %F %j",hour_date:"%H:%i",month_day:"%d",date_format:"%Y-%m-%d %H:%i",api_date:"%d-%m-%Y %H:%i",parse_exact_format:!1,preserve_length:!0,time_step:5,start_on_monday:!0,first_hour:0,last_hour:24,readonly:!1,drag_resize:!0,drag_move:!0,drag_create:!0,drag_event_body:!0,dblclick_create:!0,edit_on_create:!0,details_on_create:!1,header:null,resize_month_events:!1,resize_month_timed:!1,responsive_lightbox:!1,rtl:!1,cascade_event_display:!1,cascade_event_count:4,cascade_event_margin:30,multi_day:!0,multi_day_height_limit:0,drag_lightbox:!0,preserve_scroll:!0,select:!0,server_utc:!1,touch:!0,touch_tip:!0,touch_drag:500,touch_swipe_dates:!1,quick_info_detached:!0,positive_closing:!1,drag_highlight:!0,limit_drag_out:!1,icons_edit:["icon_save","icon_cancel"],icons_select:["icon_details","icon_edit","icon_delete"],buttons_left:["dhx_save_btn","dhx_cancel_btn"],buttons_right:["dhx_delete_btn"],lightbox:{sections:[{name:"description",map_to:"text",type:"textarea",focus:!0},{name:"time",height:72,type:"time",map_to:"auto"}]},highlight_displayed_event:!0,left_border:!1,ajax_error:"alert",delay_render:0,timeline_swap_resize:!0,wai_aria_attributes:!0,wai_aria_application_role:!0},s.config.buttons_left.$inital=s.config.buttons_left.join(),s.config.buttons_right.$inital=s.config.buttons_right.join(),s._helpers={parseDate:function(e){return(s.templates.xml_date||s.templates.parse_date)(e)},formatDate:function(e){return(s.templates.xml_format||s.templates.format_date)(e)}},s.templates={},s.init_templates=function(){var e=s.locale.labels;e.dhx_save_btn=e.icon_save,e.dhx_cancel_btn=e.icon_cancel,e.dhx_delete_btn=e.icon_delete;var t=s.date.date_to_str,n=s.config;(function(e,t){for(var n in t)e[n]||(e[n]=t[n])})(s.templates,{day_date:t(n.default_date),month_date:t(n.month_date),week_date:function(e,t){return n.rtl?s.templates.day_date(s.date.add(t,-1,"day"))+" &ndash; "+s.templates.day_date(e):s.templates.day_date(e)+" &ndash; "+s.templates.day_date(s.date.add(t,-1,"day"))},day_scale_date:t(n.default_date),month_scale_date:t(n.week_date),week_scale_date:t(n.day_date),hour_scale:t(n.hour_date),time_picker:t(n.hour_date),event_date:t(n.hour_date),month_day:t(n.month_day),load_format:t(n.load_date),format_date:t(n.date_format,n.server_utc),parse_date:s.date.str_to_date(n.date_format,n.server_utc),api_date:s.date.str_to_date(n.api_date,!1,!1),event_header:function(e,t,n){return s.templates.event_date(e)+" - "+s.templates.event_date(t)},event_text:function(e,t,n){return n.text},event_class:function(e,t,n){return""},month_date_class:function(e){return""},week_date_class:function(e){return""},event_bar_date:function(e,t,n){return s.templates.event_date(e)+" "},event_bar_text:function(e,t,n){return n.text},month_events_link:function(e,t){return"<a>View more("+t+" events)</a>"},drag_marker_class:function(e,t,n){return""},drag_marker_content:function(e,t,n){return""},tooltip_date_format:s.date.date_to_str("%Y-%m-%d %H:%i"),tooltip_text:function(e,t,n){return"<b>Event:</b> "+n.text+"<br/><b>Start date:</b> "+s.templates.tooltip_date_format(e)+"<br/><b>End date:</b> "+s.templates.tooltip_date_format(t)}}),this.callEvent("onTemplatesReady",[])},s.uid=function(){return this._seed||(this._seed=(new Date).valueOf()),this._seed++},s._events={},s.clearAll=function(){this._events={},this._loaded={},this._edit_id=null,this._select_id=null,this._drag_id=null,this._drag_mode=null,this._drag_pos=null,this._new_event=null,this.clear_view(),this.callEvent("onClearAll",[])},s.addEvent=function(e,t,n,i,r){if(!arguments.length)return this.addEventNow();var o=e;1!=arguments.length&&((o=r||{}).start_date=e,o.end_date=t,o.text=n,o.id=i),o.id=o.id||s.uid(),o.text=o.text||"","string"==typeof o.start_date&&(o.start_date=this.templates.api_date(o.start_date)),"string"==typeof o.end_date&&(o.end_date=this.templates.api_date(o.end_date));var a=6e4*(this.config.event_duration||this.config.time_step);o.start_date.valueOf()==o.end_date.valueOf()&&o.end_date.setTime(o.end_date.valueOf()+a),o._timed=this.isOneDayEvent(o);var l=!this._events[o.id];return this._events[o.id]=o,this.event_updated(o),this._loading||this.callEvent(l?"onEventAdded":"onEventChanged",[o.id,o]),o.id},s.deleteEvent=function(e,t){var n=this._events[e];(t||this.callEvent("onBeforeEventDelete",[e,n])&&this.callEvent("onConfirmedBeforeEventDelete",[e,n]))&&(n&&(this._select_id=null,delete this._events[e],this.event_updated(n),this._drag_id==n.id&&(this._drag_id=null,this._drag_mode=null,this._drag_pos=null)),this.callEvent("onEventDeleted",[e,n]))},s.getEvent=function(e){return this._events[e]},s.setEvent=function(e,t){t.id||(t.id=e),this._events[e]=t},s.for_rendered=function(e,t){for(var n=this._rendered.length-1;n>=0;n--)this._rendered[n].getAttribute("event_id")==e&&t(this._rendered[n],n)},s.changeEventId=function(e,t){if(e!=t){var n=this._events[e];n&&(n.id=t,this._events[t]=n,delete this._events[e]),this.for_rendered(e,function(e){e.setAttribute("event_id",t)}),this._select_id==e&&(this._select_id=t),this._edit_id==e&&(this._edit_id=t),this.callEvent("onEventIdChange",[e,t])}},function(){for(var e=["text","Text","start_date","StartDate","end_date","EndDate"],t=function(e){return function(t){return s.getEvent(t)[e]}},n=function(e){return function(t,n){var i=s.getEvent(t);i[e]=n,i._changed=!0,i._timed=this.isOneDayEvent(i),s.event_updated(i,!0)}},i=0;i<e.length;i+=2)s["getEvent"+e[i+1]]=t(e[i]),s["setEvent"+e[i+1]]=n(e[i])}(),s.event_updated=function(e,t){this.is_visible_events(e)?this.render_view_data():this.clear_event(e.id)},s.is_visible_events=function(e){if(!this._min_date||!this._max_date)return!1;if(e.start_date.valueOf()<this._max_date.valueOf()&&this._min_date.valueOf()<e.end_date.valueOf()){var t=e.start_date.getHours(),n=e.end_date.getHours()+e.end_date.getMinutes()/60,i=this.config.last_hour,r=this.config.first_hour;return!(!this._table_view&&(n>i||n<r)&&(t>=i||t<r)&&!((e.end_date.valueOf()-e.start_date.valueOf())/36e5>24-(this.config.last_hour-this.config.first_hour)||t<i&&n>=r))}return!1},s.isOneDayEvent=function(e){var t=new Date(e.end_date.valueOf()-1);return e.start_date.getFullYear()===t.getFullYear()&&e.start_date.getMonth()===t.getMonth()&&e.start_date.getDate()===t.getDate()&&e.end_date.valueOf()-e.start_date.valueOf()<864e5},s.get_visible_events=function(e){var t=[];for(var n in this._events)this.is_visible_events(this._events[n])&&(e&&!this._events[n]._timed||this.filter_event(n,this._events[n])&&t.push(this._events[n]));return t},s.filter_event=function(e,t){var n=this["filter_"+this._mode];return!n||n(e,t)},s._is_main_area_event=function(e){return!!e._timed},s.render_view_data=function(e,t){var n=!1;if(!e){if(n=!0,this._not_render)return void(this._render_wait=!0);this._render_wait=!1,this.clear_view(),e=this.get_visible_events(!(this._table_view||this.config.multi_day))}for(var i=0,r=e.length;i<r;i++)this._recalculate_timed(e[i]);if(this.config.multi_day&&!this._table_view){var o=[],a=[];for(i=0;i<e.length;i++)this._is_main_area_event(e[i])?o.push(e[i]):a.push(e[i]);if(!this._els.dhx_multi_day){var l=s._commonErrorMessages.unknownView(this._mode);throw new Error(l)}this._rendered_location=this._els.dhx_multi_day[0],this._table_view=!0,this.render_data(a,t),this._table_view=!1,this._rendered_location=this._els.dhx_cal_data[0],this._table_view=!1,this.render_data(o,t)}else{var d=document.createDocumentFragment(),u=this._els.dhx_cal_data[0];this._rendered_location=d,this.render_data(e,t),u.appendChild(d),this._rendered_location=u}n&&this.callEvent("onDataRender",[])},s._view_month_day=function(e){var t=s.getActionData(e).date;s.callEvent("onViewMoreClick",[t])&&s.setCurrentView(t,"day")},s._render_month_link=function(e){for(var t=this._rendered_location,n=this._lame_clone(e),i=e._sday;i<e._eday;i++){n._sday=i,n._eday=i+1;var r=s.date,o=s._min_date;o=r.add(o,n._sweek,"week"),o=r.add(o,n._sday,"day");var a=s.getEvents(o,r.add(o,1,"day")).length,l=this._get_event_bar_pos(n),d=l.x2-l.x,u=document.createElement("div");u.onclick=function(e){s._view_month_day(e||event)},u.className="dhx_month_link",u.style.top=l.y+"px",u.style.left=l.x+"px",u.style.width=d+"px",u.innerHTML=s.templates.month_events_link(o,a),this._rendered.push(u),t.appendChild(u)}},s._recalculate_timed=function(e){var t;e&&((t="object"!=typeof e?this._events[e]:e)&&(t._timed=s.isOneDayEvent(t)))},s.attachEvent("onEventChanged",s._recalculate_timed),s.attachEvent("onEventAdded",s._recalculate_timed),s.render_data=function(e,t){e=this._pre_render_events(e,t);for(var n={},i=0;i<e.length;i++)if(this._table_view)if("month"!=s._mode)this.render_event_bar(e[i]);else{var r=s.config.max_month_events;r!==1*r||e[i]._sorder<r?this.render_event_bar(e[i]):void 0!==r&&e[i]._sorder==r&&s._render_month_link(e[i])}else{var o=e[i],a=s.locate_holder(o._sday);if(!a)continue;n[o._sday]||(n[o._sday]={real:a,buffer:document.createDocumentFragment(),width:a.clientWidth});var l=n[o._sday];this.render_event(o,l.buffer,l.width)}for(var i in n){(l=n[i]).real&&l.buffer&&l.real.appendChild(l.buffer)}},s._get_first_visible_cell=function(e){for(var t=0;t<e.length;t++)if(-1==(e[t].className||"").indexOf("dhx_scale_ignore"))return e[t];return e[0]},s._pre_render_events=function(e,t){var n=this.xy.bar_height,i=this._colsS.heights,r=this._colsS.heights=[0,0,0,0,0,0,0],o=this._els.dhx_cal_data[0];if(e=this._table_view?this._pre_render_events_table(e,t):this._pre_render_events_line(e,t),this._table_view)if(t)this._colsS.heights=i;else{var a=o.firstChild;if(a.rows){for(var l=0;l<a.rows.length;l++){r[l]++;var d=a.rows[l].cells,u=this._colsS.height-this.xy.month_head_height;if(r[l]*n>u){var c=u;1*this.config.max_month_events!==this.config.max_month_events||r[l]<=this.config.max_month_events?c=r[l]*n:(this.config.max_month_events+1)*n>u&&(c=(this.config.max_month_events+1)*n);for(var h=0;h<d.length;h++)d[h].childNodes[1].style.height=c+"px"}r[l]=(r[l-1]||0)+s._get_first_visible_cell(d).offsetHeight}if(r.unshift(0),a.parentNode.offsetHeight<a.parentNode.scrollHeight&&!s._colsS.scroll_fix&&s.xy.scroll_width){var f=s._colsS,p=f[f.col_length],m=f.heights.slice();p-=s.xy.scroll_width||0,this._calc_scale_sizes(p,this._min_date,this._max_date),s._colsS.heights=m,this.set_xy(this._els.dhx_cal_header[0],p,this.xy.scale_height),s._render_scales(this._els.dhx_cal_header[0]),s._render_month_scale(this._els.dhx_cal_data[0],this._get_timeunit_start(),this._min_date),f.scroll_fix=!0}}else if(e.length||"visible"!=this._els.dhx_multi_day[0].style.visibility||(r[0]=-1),e.length||-1==r[0]){var g=(a.parentNode.childNodes,(r[0]+1)*n+1),_=g,v=g+"px";this.config.multi_day_height_limit&&(v=(_=Math.min(g,this.config.multi_day_height_limit))+"px"),o.style.top=this._els.dhx_cal_navline[0].offsetHeight+this._els.dhx_cal_header[0].offsetHeight+_+"px",o.style.height=this._obj.offsetHeight-parseInt(o.style.top,10)-(this.xy.margin_top||0)+"px";var b=this._els.dhx_multi_day[0];b.style.height=v,b.style.visibility=-1==r[0]?"hidden":"visible";var y=this._els.dhx_multi_day[1];y.style.height=v,y.style.visibility=-1==r[0]?"hidden":"visible",y.className=r[0]?"dhx_multi_day_icon":"dhx_multi_day_icon_small",this._dy_shift=(r[0]+1)*n,this.config.multi_day_height_limit&&(this._dy_shift=Math.min(this.config.multi_day_height_limit,this._dy_shift)),r[0]=0,_!=g&&(o.style.top=parseInt(o.style.top)+2+"px",b.style.overflowY="auto",y.style.position="fixed",y.style.top="",y.style.left="")}}return e},s._get_event_sday=function(e){var t=this.date.day_start(new Date(e.start_date));return Math.round((t.valueOf()-this._min_date.valueOf())/864e5)},s._get_event_mapped_end_date=function(e){var t=e.end_date;if(this.config.separate_short_events){var n=(e.end_date-e.start_date)/6e4;n<this._min_mapped_duration&&(t=this.date.add(t,this._min_mapped_duration-n,"minute"))}return t},s._pre_render_events_line=function(e,t){e.sort(function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});var n=[],i=[];this._min_mapped_duration=Math.ceil(60*this.xy.min_event_height/this.config.hour_size_px);for(var r=0;r<e.length;r++){var o=e[r],a=o.start_date,s=o.end_date,l=a.getHours(),d=s.getHours();if(o._sday=this._get_event_sday(o),this._ignores[o._sday])e.splice(r,1),r--;else{if(n[o._sday]||(n[o._sday]=[]),!t){o._inner=!1;for(var u=n[o._sday];u.length;){var c=u[u.length-1];if(!(this._get_event_mapped_end_date(c).valueOf()<=o.start_date.valueOf()))break;u.splice(u.length-1,1)}for(var h=u.length,f=!1,p=0;p<u.length;p++){c=u[p];if(this._get_event_mapped_end_date(c).valueOf()<=o.start_date.valueOf()){f=!0,o._sorder=c._sorder,h=p,o._inner=!0;break}}if(u.length&&(u[u.length-1]._inner=!0),!f)if(u.length)if(u.length<=u[u.length-1]._sorder){if(u[u.length-1]._sorder)for(p=0;p<u.length;p++){for(var m=!1,g=0;g<u.length;g++)if(u[g]._sorder==p){m=!0;break}if(!m){o._sorder=p;break}}else o._sorder=0;o._inner=!0}else{var _=u[0]._sorder;for(p=1;p<u.length;p++)u[p]._sorder>_&&(_=u[p]._sorder);o._sorder=_+1,o._inner=!1}else o._sorder=0;u.splice(h,h==u.length?0:1,o),u.length>(u.max_count||0)?(u.max_count=u.length,o._count=u.length):o._count=o._count?o._count:1}(l<this.config.first_hour||d>=this.config.last_hour)&&(i.push(o),e[r]=o=this._copy_event(o),l<this.config.first_hour&&(o.start_date.setHours(this.config.first_hour),o.start_date.setMinutes(0)),d>=this.config.last_hour&&(o.end_date.setMinutes(0),o.end_date.setHours(this.config.last_hour)),o.start_date>o.end_date||l==this.config.last_hour)&&(e.splice(r,1),r--)}}if(!t){for(r=0;r<e.length;r++)e[r]._count=n[e[r]._sday].max_count;for(r=0;r<i.length;r++)i[r]._count=n[i[r]._sday].max_count}return e},s._time_order=function(e){e.sort(function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e._timed&&!t._timed?1:!e._timed&&t._timed?-1:e.id>t.id?1:-1:e.start_date>t.start_date?1:-1})},s._is_any_multiday_cell_visible=function(e,t,n){var i=this._cols.length,r=!1,o=e,a=!0,l=new Date(t);for(s.date.day_start(new Date(t)).valueOf()!=t.valueOf()&&(l=s.date.day_start(l),l=s.date.add(l,1,"day"));o<l;){a=!1;var d=this.locate_holder_day(o,!1,n)%i;if(!this._ignores[d]){r=!0;break}o=s.date.add(o,1,"day")}return a||r},s._pre_render_events_table=function(e,t){this._time_order(e);for(var n,i=[],r=[[],[],[],[],[],[],[]],o=this._colsS.heights,a=this._cols.length,l={},d=0;d<e.length;d++){var u=e[d],c=u.id;l[c]||(l[c]={first_chunk:!0,last_chunk:!0});var h=l[c],f=n||u.start_date,p=u.end_date;f<this._min_date&&(h.first_chunk=!1,f=this._min_date),p>this._max_date&&(h.last_chunk=!1,p=this._max_date);var m=this.locate_holder_day(f,!1,u);if(u._sday=m%a,!this._ignores[u._sday]||!u._timed){var g=this.locate_holder_day(p,!0,u)||a;if(u._eday=g%a||a,u._length=g-m,u._sweek=Math.floor((this._correct_shift(f.valueOf(),1)-this._min_date.valueOf())/(864e5*a)),s._is_any_multiday_cell_visible(f,p,u)){var _,v=r[u._sweek];for(_=0;_<v.length&&!(v[_]._eday<=u._sday);_++);if(u._sorder&&t||(u._sorder=_),u._sday+u._length<=a)n=null,i.push(u),v[_]=u,o[u._sweek]=v.length-1,u._first_chunk=h.first_chunk,u._last_chunk=h.last_chunk;else{var b=this._copy_event(u);b.id=u.id,b._length=a-u._sday,b._eday=a,b._sday=u._sday,b._sweek=u._sweek,b._sorder=u._sorder,b.end_date=this.date.add(f,b._length,"day"),b._first_chunk=h.first_chunk,h.first_chunk&&(h.first_chunk=!1),i.push(b),v[_]=b,n=b.end_date,o[u._sweek]=v.length-1,d--}}}}return i},s._copy_dummy=function(){var e=new Date(this.start_date),t=new Date(this.end_date);this.start_date=e,this.end_date=t},s._copy_event=function(e){return this._copy_dummy.prototype=e,new this._copy_dummy},s._rendered=[],s.clear_view=function(){for(var e=0;e<this._rendered.length;e++){var t=this._rendered[e];t.parentNode&&t.parentNode.removeChild(t)}this._rendered=[]},s.updateEvent=function(e){var t=this.getEvent(e);this.clear_event(e),t&&this.is_visible_events(t)&&this.filter_event(e,t)&&(this._table_view||this.config.multi_day||t._timed)&&(this.config.update_render?this.render_view_data():"month"!=this.getState().mode||this.getState().drag_id||this.isOneDayEvent(t)?this.render_view_data([t],!0):this.render_view_data())},s.clear_event=function(e){this.for_rendered(e,function(e,t){e.parentNode&&e.parentNode.removeChild(e),s._rendered.splice(t,1)})},s._y_from_date=function(e){var t=60*e.getHours()+e.getMinutes();return Math.round((60*t*1e3-60*this.config.first_hour*60*1e3)*this.config.hour_size_px/36e5)%(24*this.config.hour_size_px)},s._calc_event_y=function(e,t){t=t||0;var n=60*e.start_date.getHours()+e.start_date.getMinutes(),i=60*e.end_date.getHours()+e.end_date.getMinutes()||60*s.config.last_hour;return{top:this._y_from_date(e.start_date),height:Math.max(t,(i-n)*this.config.hour_size_px/60)}},s.render_event=function(e,t,n){var i=s.xy.menu_width,r=this.config.use_select_menu_space?0:i;if(!(e._sday<0)){var o=s.locate_holder(e._sday);if(o){t=t||o;var a=this._calc_event_y(e,s.xy.min_event_height),l=a.top,d=a.height,u=e._count||1,c=e._sorder||0;n=n||o.clientWidth;var h=Math.floor((n-r)/u),f=c*h+1;if(e._inner||(h*=u-c),this.config.cascade_event_display){var p=this.config.cascade_event_count,m=this.config.cascade_event_margin;f=c%p*m;var g=e._inner?(u-c-1)%p*m/2:0;h=Math.floor(n-r-f-g)}var _=this._render_v_bar(e,r+f,l,h,d,e._text_style,s.templates.event_header(e.start_date,e.end_date,e),s.templates.event_text(e.start_date,e.end_date,e));if(this._waiAria.eventAttr(e,_),this._rendered.push(_),t.appendChild(_),f=f+parseInt(this.config.rtl?o.style.right:o.style.left,10)+r,this._edit_id==e.id){_.style.zIndex=1,h=Math.max(h-4,s.xy.editor_width),(_=document.createElement("div")).setAttribute("event_id",e.id),this._waiAria.eventAttr(e,_),_.className="dhx_cal_event dhx_cal_editor",this.config.rtl&&f++,this.set_xy(_,h,d-20,f,l+(s.xy.event_header_height||14)),e.color&&(_.style.backgroundColor=e.color);var v=s.templates.event_class(e.start_date,e.end_date,e);v&&(_.className+=" "+v);var b=document.createElement("div");this.set_xy(b,h-6,d-26),b.style.cssText+=";margin:2px 2px 2px 2px;overflow:hidden;",_.appendChild(b),this._els.dhx_cal_data[0].appendChild(_),this._rendered.push(_),b.innerHTML="<textarea class='dhx_cal_editor'>"+e.text+"</textarea>",this._editor=b.querySelector("textarea"),this._quirks7&&(this._editor.style.height=d-12+"px"),this._editor.onkeydown=function(e){if((e||event).shiftKey)return!0;var t=(e||event).keyCode;t==s.keys.edit_save&&s.editStop(!0),t==s.keys.edit_cancel&&s.editStop(!1),t!=s.keys.edit_save&&t!=s.keys.edit_cancel||e.preventDefault&&e.preventDefault()},this._editor.onselectstart=function(e){return(e||event).cancelBubble=!0,!0},s._focus(this._editor,!0),this._els.dhx_cal_data[0].scrollLeft=0}if(0!==this.xy.menu_width&&this._select_id==e.id){this.config.cascade_event_display&&this._drag_mode&&(_.style.zIndex=1);for(var y,x=this.config["icons_"+(this._edit_id==e.id?"edit":"select")],w="",S=e.color?"background-color: "+e.color+";":"",N=e.textColor?"color: "+e.textColor+";":"",E=0;E<x.length;E++)y=this._waiAria.eventMenuAttrString(x[E]),w+="<div class='dhx_menu_icon "+x[E]+"' style='"+S+N+"' title='"+this.locale.labels[x[E]]+"'"+y+"></div>";var C=this._render_v_bar(e,f-i+1,l,i,20*x.length+26-2,"","<div style='"+S+N+"' class='dhx_menu_head'></div>",w,!0);C.style.left=f-i+1,this._els.dhx_cal_data[0].appendChild(C),this._rendered.push(C)}this.config.drag_highlight&&this._drag_id==e.id&&this.highlightEventPosition(e)}}},s._render_v_bar=function(e,t,n,i,r,o,a,l,d){var u=document.createElement("div"),c=e.id,h=d?"dhx_cal_event dhx_cal_select_menu":"dhx_cal_event",f=s.getState();f.drag_id==e.id&&(h+=" dhx_cal_event_drag"),f.select_id==e.id&&(h+=" dhx_cal_event_selected");var p=s.templates.event_class(e.start_date,e.end_date,e);p&&(h=h+" "+p),this.config.cascade_event_display&&(h+=" dhx_cal_event_cascade");var m=e.color?"background-color:"+e.color+";":"",g=e.textColor?"color:"+e.textColor+";":"",_=s._border_box_events(),v=i-2,b=_?v:i-4,y=_?v:i-6,x=_?v:i-(this._quirks?4:14),w=_?v-2:i-8,S=_?r-this.xy.event_header_height-1:r-(this._quirks?20:30)+1,N='<div event_id="'+c+'" class="'+h+'" style="position:absolute; top:'+n+"px; "+(this.config.rtl?"right:":"left:")+t+"px; width:"+b+"px; height:"+r+"px;"+(o||"")+'"></div>';u.innerHTML=N;var E=u.cloneNode(!0).firstChild;if(!d&&s.renderEvent(E,e,i,r,a,l))return E;E=u.firstChild;var C='<div class="dhx_event_move dhx_header" style=" width:'+y+"px;"+m+'" >&nbsp;</div>';C+='<div class="dhx_event_move dhx_title" style="'+m+g+'">'+a+"</div>",C+='<div class="dhx_body" style=" width:'+x+"px; height:"+S+"px;"+m+g+'">'+l+"</div>";var k="dhx_event_resize dhx_footer";return(d||!1===e._drag_resize)&&(k="dhx_resize_denied "+k),C+='<div class="'+k+'" style=" width:'+w+"px;"+(d?" margin-top:-1px;":"")+m+g+'" ></div>',E.innerHTML=C,E},s.renderEvent=function(){return!1},s.locate_holder=function(e){return"day"==this._mode?this._els.dhx_cal_data[0].firstChild:this._els.dhx_cal_data[0].childNodes[e]},s.locate_holder_day=function(e,t){var n=Math.floor((this._correct_shift(e,1)-this._min_date)/864e5);return t&&this.date.time_part(e)&&n++,n},s._get_dnd_order=function(e,t,n){if(!this._drag_event)return e;this._drag_event._orig_sorder?e=this._drag_event._orig_sorder:this._drag_event._orig_sorder=e;for(var i=t*e;i+t>n;)e--,i-=t;return Math.max(e,0)},s._get_event_bar_pos=function(e){var t=this.config.rtl,n=this._colsS,i=n[e._sday],r=n[e._eday];t&&(i=n[n.col_length]-n[e._eday]+n[0],r=n[n.col_length]-n[e._sday]+n[0]),r==i&&(r=n[e._eday+1]);var o=this.xy.bar_height,a=e._sorder;if(e.id==this._drag_id){var l=n.heights[e._sweek+1]-n.heights[e._sweek]-this.xy.month_head_height;a=s._get_dnd_order(a,o,l)}var d=a*o;return{x:i,x2:r,y:n.heights[e._sweek]+(n.height?this.xy.month_scale_height+2:2)+d}},s.render_event_bar=function(e){var t=this._rendered_location,n=this._get_event_bar_pos(e),i=n.y,r=n.x,o=n.x2,a="";if(o){var l=s.config.resize_month_events&&"month"==this._mode&&(!e._timed||s.config.resize_month_timed),d=document.createElement("div"),u=e.hasOwnProperty("_first_chunk")&&e._first_chunk,c=e.hasOwnProperty("_last_chunk")&&e._last_chunk,h=l&&(e._timed||u),f=l&&(e._timed||c),p=!0,m="dhx_cal_event_clear";e._timed&&!l||(p=!1,m="dhx_cal_event_line"),u&&(m+=" dhx_cal_event_line_start"),c&&(m+=" dhx_cal_event_line_end"),h&&(a+="<div class='dhx_event_resize dhx_event_resize_start'></div>"),f&&(a+="<div class='dhx_event_resize dhx_event_resize_end'></div>");var g=s.templates.event_class(e.start_date,e.end_date,e);g&&(m+=" "+g);var _=e.color?"background:"+e.color+";":"",v=["position:absolute","top:"+i+"px","left:"+r+"px","width:"+(o-r-3-(p?1:0))+"px",e.textColor?"color:"+e.textColor+";":"",_,e._text_style||""].join(";"),b="<div event_id='"+e.id+"' class='"+m+"' style='"+v+"'"+this._waiAria.eventBarAttrString(e)+">";l&&(b+=a),"month"==s.getState().mode&&(e=s.getEvent(e.id)),e._timed&&(b+=s.templates.event_bar_date(e.start_date,e.end_date,e)),b+=s.templates.event_bar_text(e.start_date,e.end_date,e)+"</div>",b+="</div>",d.innerHTML=b,this._rendered.push(d.firstChild),t.appendChild(d.firstChild)}},s._locate_event=function(e){for(var t=null;e&&!t&&e.getAttribute;)t=e.getAttribute("event_id"),e=e.parentNode;return t},s._locate_css=function(e,t,n){void 0===n&&(n=!0);for(var i=e.target||e.srcElement,r="";i;){if(r=s._getClassName(i)){var o=r.indexOf(t);if(o>=0){if(!n)return i;var a=0===o||!s._trim(r.charAt(o-1)),l=o+t.length>=r.length||!s._trim(r.charAt(o+t.length));if(a&&l)return i}}i=i.parentNode}return null},s.edit=function(e){this._edit_id!=e&&(this.editStop(!1,e),this._edit_id=e,this.updateEvent(e))},s.editStop=function(e,t){if(!t||this._edit_id!=t){var n=this.getEvent(this._edit_id);n&&(e&&(n.text=this._editor.value),this._edit_id=null,this._editor=null,this.updateEvent(n.id),this._edit_stop_event(n,e))}},s._edit_stop_event=function(e,t){this._new_event?(t?this.callEvent("onEventAdded",[e.id,e]):e&&this.deleteEvent(e.id,!0),this._new_event=null):t&&this.callEvent("onEventChanged",[e.id,e])},s.getEvents=function(e,t){var n=[];for(var i in this._events){var r=this._events[i];r&&(!e&&!t||r.start_date<t&&r.end_date>e)&&n.push(r)}return n},s.getRenderedEvent=function(e){if(e){for(var t=s._rendered,n=0;n<t.length;n++){var i=t[n];if(i.getAttribute("event_id")==e)return i}return null}},s.showEvent=function(e,t){function n(){i.color=a,i.textColor=l}e&&"object"==typeof e&&(t=e.mode,h=e.section,e=e.section);var i="number"==typeof e||"string"==typeof e?s.getEvent(e):e;if(t=t||s._mode,i&&(!this.checkEvent("onBeforeEventDisplay")||this.callEvent("onBeforeEventDisplay",[i,t]))){var r=s.config.scroll_hour;s.config.scroll_hour=i.start_date.getHours();var o=s.config.preserve_scroll;s.config.preserve_scroll=!1;var a=i.color,l=i.textColor;if(s.config.highlight_displayed_event&&(i.color=s.config.displayed_event_color,i.textColor=s.config.displayed_event_text_color),s.setCurrentView(new Date(i.start_date),t),s.config.scroll_hour=r,s.config.preserve_scroll=o,s.matrix&&s.matrix[t]){var d=s.getView(),u=d.y_property,c=s.getEvent(i.id);if(c){if(!h){var h=c[u];Array.isArray(h)?h=h[0]:"string"==typeof h&&s.config.section_delimiter&&h.indexOf(s.config.section_delimiter)>-1&&(h=h.split(s.config.section_delimiter)[0])}var f=d.posFromSection(h),p=d.posFromDate(c.start_date),m=s.$container.querySelector(".dhx_timeline_data_wrapper");if(p-=(m.offsetWidth-d.dx)/2,f=f-m.offsetHeight/2+d.dy/2,d._smartRenderingEnabled())var g=d.attachEvent("onScroll",function(){n(),d.detachEvent(g)});d.scrollTo({left:p,top:f}),d._smartRenderingEnabled()||n()}}else n();s.callEvent("onAfterEventDisplay",[i,t])}},s._append_drag_marker=function(e){if(!e.parentNode){var t=s._els.dhx_cal_data[0].lastChild,n=s._getClassName(t);n.indexOf("dhx_scale_holder")<0&&t.previousSibling&&(t=t.previousSibling),n=s._getClassName(t),t&&0===n.indexOf("dhx_scale_holder")&&t.appendChild(e)}},s._update_marker_position=function(e,t){var n=s._calc_event_y(t,0);e.style.top=n.top+"px",e.style.height=n.height+"px"},s.highlightEventPosition=function(e){var t=document.createElement("div");t.setAttribute("event_id",e.id),this._rendered.push(t),this._update_marker_position(t,e);var n=this.templates.drag_marker_class(e.start_date,e.end_date,e),i=this.templates.drag_marker_content(e.start_date,e.end_date,e);t.className="dhx_drag_marker",n&&(t.className+=" "+n),i&&(t.innerHTML=i),this._append_drag_marker(t)},s._loaded={},s._load=function(e,t){function n(e){s.on_load(e),s.callEvent("onLoadEnd",[])}if(e=e||this._load_url){var i;if(e+=(-1==e.indexOf("?")?"?":"&")+"timeshift="+(new Date).getTimezoneOffset(),this.config.prevent_cache&&(e+="&uid="+this.uid()),t=t||this._date,this._load_mode){var r=this.templates.load_format;for(t=this.date[this._load_mode+"_start"](new Date(t.valueOf()));t>this._min_date;)t=this.date.add(t,-1,this._load_mode);i=t;for(var o=!0;i<this._max_date;)i=this.date.add(i,1,this._load_mode),this._loaded[r(t)]&&o?t=this.date.add(t,1,this._load_mode):o=!1;var a=i;do{i=a,a=this.date.add(i,-1,this._load_mode)}while(a>t&&this._loaded[r(a)]);if(i<=t)return!1;for(s.$ajax.get(e+"&from="+r(t)+"&to="+r(i),n);t<i;)this._loaded[r(t)]=!0,t=this.date.add(t,1,this._load_mode)}else s.$ajax.get(e,n);return this.callEvent("onXLS",[]),this.callEvent("onLoadStart",[]),!0}},s._parsers={},s._parsers.xml={canParse:function(e,t){if(t.responseXML&&t.responseXML.firstChild)return!0;try{var n=s.$ajax.parse(t.responseText),i=s.$ajax.xmltop("data",n);if(i&&"data"===i.tagName)return!0}catch(e){}return!1},parse:function(e){var t;if(e.xmlDoc.responseXML||(e.xmlDoc.responseXML=s.$ajax.parse(e.xmlDoc.responseText)),"data"!=(t=s.$ajax.xmltop("data",e.xmlDoc)).tagName)return null;var n=t.getAttribute("dhx_security");n&&(window.dhtmlx&&(dhtmlx.security_key=n),s.security_key=n);for(var i=s.$ajax.xpath("//coll_options",e.xmlDoc),r=0;r<i.length;r++){var o=i[r].getAttribute("for"),a=s.serverList[o];a||(s.serverList[o]=a=[]),a.splice(0,a.length);for(var l=s.$ajax.xpath(".//item",i[r]),d=0;d<l.length;d++){for(var u=l[d].attributes,c={key:l[d].getAttribute("value"),label:l[d].getAttribute("label")},h=0;h<u.length;h++){var f=u[h];"value"!=f.nodeName&&"label"!=f.nodeName&&(c[f.nodeName]=f.nodeValue)}a.push(c)}}i.length&&s.callEvent("onOptionsLoad",[]);var p=s.$ajax.xpath("//userdata",e.xmlDoc);for(r=0;r<p.length;r++){var m=s._xmlNodeToJSON(p[r]);s._userdata[m.name]=m.text}var g=[];t=s.$ajax.xpath("//event",e.xmlDoc);for(r=0;r<t.length;r++){var _=g[r]=s._xmlNodeToJSON(t[r]);s._init_event(_)}return g}},s.json=s._parsers.json={canParse:function(e){if(e&&"object"==typeof e)return!0;if("string"==typeof e)try{var t=JSON.parse(e);return"[object Object]"===Object.prototype.toString.call(t)||"[object Array]"===Object.prototype.toString.call(t)}catch(e){return!1}return!1},parse:function(e){var t=[];"string"==typeof e&&(e=JSON.parse(e)),t=(t="[object Array]"===Object.prototype.toString.call(e)?e:e?e.data:[])||[],e.dhx_security&&(window.dhtmlx&&(dhtmlx.security_key=e.dhx_security),s.security_key=e.dhx_security);var n=e&&e.collections?e.collections:{},i=!1;for(var r in n)if(n.hasOwnProperty(r)){i=!0;var o=n[r],a=s.serverList[r];a||(s.serverList[r]=a=[]),a.splice(0,a.length);for(var l=0;l<o.length;l++){var d=o[l],u={key:d.value,label:d.label};for(var c in d)if(d.hasOwnProperty(c)){if("value"==c||"label"==c)continue;u[c]=d[c]}a.push(u)}}i&&s.callEvent("onOptionsLoad",[]);for(var h=[],f=0;f<t.length;f++){var p=t[f];s._init_event(p),h.push(p)}return h}},s.ical=s._parsers.ical={canParse:function(e){return"string"==typeof e&&new RegExp("^BEGIN:VCALENDAR").test(e)},parse:function(e){var t=e.match(RegExp(this.c_start+"[^\f]*"+this.c_end,""));if(t.length){t[0]=t[0].replace(/[\r\n]+ /g,""),t[0]=t[0].replace(/[\r\n]+(?=[a-z \t])/g," "),t[0]=t[0].replace(/\;[^:\r\n]*:/g,":");for(var n,i=[],r=RegExp("(?:"+this.e_start+")([^\f]*?)(?:"+this.e_end+")","g");null!==(n=r.exec(t));){for(var o,a={},s=/[^\r\n]+[\r\n]+/g;null!==(o=s.exec(n[1]));)this.parse_param(o.toString(),a);a.uid&&!a.id&&(a.id=a.uid),i.push(a)}return i}},parse_param:function(e,t){var n=e.indexOf(":");if(-1!=n){var i=e.substr(0,n).toLowerCase(),r=e.substr(n+1).replace(/\\\,/g,",").replace(/[\r\n]+$/,"");"summary"==i?i="text":"dtstart"==i?(i="start_date",r=this.parse_date(r,0,0)):"dtend"==i&&(i="end_date",r=this.parse_date(r,0,0)),t[i]=r}},parse_date:function(e,t,n){var i=e.split("T"),r=!1;i[1]&&(t=i[1].substr(0,2),n=i[1].substr(2,2),r=!("Z"!=i[1][6]));var o=i[0].substr(0,4),a=parseInt(i[0].substr(4,2),10)-1,l=i[0].substr(6,2);return s.config.server_utc||r?new Date(Date.UTC(o,a,l,t,n)):new Date(o,a,l,t,n)},c_start:"BEGIN:VCALENDAR",e_start:"BEGIN:VEVENT",e_end:"END:VEVENT",c_end:"END:VCALENDAR"},s.on_load=function(e){this.callEvent("onBeforeParse",[]);var t,n=!1,i=!1;for(var r in this._parsers){var o=this._parsers[r];if(o.canParse(e.xmlDoc.responseText,e.xmlDoc)){try{var a=e.xmlDoc.responseText;"xml"===r&&(a=e),(t=o.parse(a))||(n=!0)}catch(e){n=!0}i=!0;break}}if(!i)if(this._process&&this[this._process])try{t=this[this._process].parse(e.xmlDoc.responseText)}catch(e){n=!0}else n=!0;(n||e.xmlDoc.status&&e.xmlDoc.status>=400)&&(this.callEvent("onLoadError",[e.xmlDoc]),t=[]),this._process_loading(t),this.callEvent("onXLE",[]),this.callEvent("onParse",[])},s._process_loading=function(e){this._loading=!0,this._not_render=!0;for(var t=0;t<e.length;t++)this.callEvent("onEventLoading",[e[t]])&&this.addEvent(e[t]);this._not_render=!1,this._render_wait&&this.render_view_data(),this._loading=!1,this._after_call&&this._after_call(),this._after_call=null},s._init_event=function(e){e.text=e.text||e._tagvalue||"",e.start_date=s._init_date(e.start_date),e.end_date=s._init_date(e.end_date)},s._init_date=function(e){return e?"string"==typeof e?s._helpers.parseDate(e):new Date(e):null},s.json={},s.json.parse=function(e){var t=[];"string"==typeof e&&(e=JSON.parse(e)),t=(t="[object Array]"===Object.prototype.toString.call(e)?e:e?e.data:[])||[],e.dhx_security&&(window.dhtmlx&&(dhtmlx.security_key=e.dhx_security),s.security_key=e.dhx_security);var n=e&&e.collections?e.collections:{},i=!1;for(var r in n)if(n.hasOwnProperty(r)){i=!0;var o=n[r],a=s.serverList[r];a||(s.serverList[r]=a=[]),a.splice(0,a.length);for(var l=0;l<o.length;l++){var d=o[l],u={key:d.value,label:d.label};for(var c in d)if(d.hasOwnProperty(c)){if("value"==c||"label"==c)continue;u[c]=d[c]}a.push(u)}}i&&s.callEvent("onOptionsLoad",[]);for(var h=[],f=0;f<t.length;f++){var p=t[f];s._init_event(p),h.push(p)}return h},s.parse=function(e,t){this._process=t,this.on_load({xmlDoc:{responseText:e}})},s.load=function(e,t){"string"==typeof t&&(this._process=t,t=arguments[2]),this._load_url=e,this._after_call=t,this._load(e,this._date)},s.setLoadMode=function(e){"all"==e&&(e=""),this._load_mode=e},s.serverList=function(e,t){return t?(this.serverList[e]=t.slice(0),this.serverList[e]):(this.serverList[e]=this.serverList[e]||[],this.serverList[e])},s._userdata={},s._xmlNodeToJSON=function(e){for(var t={},n=0;n<e.attributes.length;n++)t[e.attributes[n].name]=e.attributes[n].value;for(n=0;n<e.childNodes.length;n++){var i=e.childNodes[n];1==i.nodeType&&(t[i.tagName]=i.firstChild?i.firstChild.nodeValue:"")}return t.text||(t.text=e.firstChild?e.firstChild.nodeValue:""),t},s.attachEvent("onXLS",function(){var e;!0===this.config.show_loading&&((e=this.config.show_loading=document.createElement("div")).className="dhx_loading",e.style.left=Math.round((this._x-128)/2)+"px",e.style.top=Math.round((this._y-15)/2)+"px",this._obj.appendChild(e))}),s.attachEvent("onXLE",function(){var e=this.config.show_loading;e&&"object"==typeof e&&(e.parentNode&&e.parentNode.removeChild(e),this.config.show_loading=!0)}),s._lightbox_controls={},s.formSection=function(e){for(var t=this.config.lightbox.sections,n=0;n<t.length&&t[n].name!=e;n++);var i=t[n];s._lightbox||s.getLightbox();var r=document.getElementById(i.id),o=r.nextSibling,a={section:i,header:r,node:o,getValue:function(e){return s.form_blocks[i.type].get_value(o,e||{},i)},setValue:function(e,t){return s.form_blocks[i.type].set_value(o,e,t||{},i)}},l=s._lightbox_controls["get_"+i.type+"_control"];return l?l(a):a},s._lightbox_controls.get_template_control=function(e){return e.control=e.node,e},s._lightbox_controls.get_select_control=function(e){return e.control=e.node.getElementsByTagName("select")[0],e},s._lightbox_controls.get_textarea_control=function(e){return e.control=e.node.getElementsByTagName("textarea")[0],e},s._lightbox_controls.get_time_control=function(e){return e.control=e.node.getElementsByTagName("select"),e},s._lightbox_controls.defaults={template:{height:30},textarea:{height:200},select:{height:23},time:{height:20}},s.form_blocks={template:{render:function(e){var t=s._lightbox_controls.defaults.template,n=t?t.height:30;return"<div class='dhx_cal_ltext dhx_cal_template' style='height:"+(e.height||n||30)+"px;'></div>"},set_value:function(e,t,n,i){e.innerHTML=t||""},get_value:function(e,t,n){return e.innerHTML||""},focus:function(e){}},textarea:{render:function(e){var t=s._lightbox_controls.defaults.textarea,n=t?t.height:200;return"<div class='dhx_cal_ltext' style='height:"+(e.height||n||"130")+"px;'><textarea></textarea></div>"},set_value:function(e,t,n){s.form_blocks.textarea._get_input(e).value=t||""},get_value:function(e,t){return s.form_blocks.textarea._get_input(e).value},focus:function(e){var t=s.form_blocks.textarea._get_input(e);s._focus(t,!0)},_get_input:function(e){return e.getElementsByTagName("textarea")[0]}},select:{render:function(e){for(var t=s._lightbox_controls.defaults.select,n=t?t.height:23,i="<div class='dhx_cal_ltext' style='height:"+((e.height||n||"23")+"px")+";'><select style='width:100%;'>",r=0;r<e.options.length;r++)i+="<option value='"+e.options[r].key+"'>"+e.options[r].label+"</option>";return i+"</select></div>"},set_value:function(e,t,n,i){var r=e.firstChild;!r._dhx_onchange&&i.onchange&&(r.onchange=i.onchange,r._dhx_onchange=!0),void 0===t&&(t=(r.options[0]||{}).value),r.value=t||""},get_value:function(e,t){return e.firstChild.value},focus:function(e){var t=e.firstChild;s._focus(t,!0)}},time:{render:function(e){e.time_format||(e.time_format=["%H:%i","%d","%m","%Y"]),e._time_format_order={};var t=e.time_format,n=s.config,i=s.date.date_part(s._currentDate()),r=1440,o=0;s.config.limit_time_select&&(r=60*n.last_hour+1,o=60*n.first_hour,i.setHours(n.first_hour));for(var a="",l=0;l<t.length;l++){var d=t[l];l>0&&(a+=" ");var u="",c="";switch(d){case"%Y":var h,f,p;u="dhx_lightbox_year_select",e._time_format_order[3]=l,e.year_range&&(isNaN(e.year_range)?e.year_range.push&&(f=e.year_range[0],p=e.year_range[1]):h=e.year_range),h=h||10;var m=m||Math.floor(h/2);f=f||i.getFullYear()-m,p=p||f+h;for(var g=f;g<p;g++)c+="<option value='"+g+"'>"+g+"</option>";break;case"%m":u="dhx_lightbox_month_select",e._time_format_order[2]=l;for(g=0;g<12;g++)c+="<option value='"+g+"'>"+this.locale.date.month_full[g]+"</option>";break;case"%d":u="dhx_lightbox_day_select",e._time_format_order[1]=l;for(g=1;g<32;g++)c+="<option value='"+g+"'>"+g+"</option>";break;case"%H:%i":u="dhx_lightbox_time_select",e._time_format_order[0]=l;g=o;var _=i.getDate();for(e._time_values=[];g<r;)c+="<option value='"+g+"'>"+this.templates.time_picker(i)+"</option>",e._time_values.push(g),i.setTime(i.valueOf()+60*this.config.time_step*1e3),g=24*(i.getDate()!=_?1:0)*60+60*i.getHours()+i.getMinutes()}if(c){var v=s._waiAria.lightboxSelectAttrString(d);a+="<select class='"+u+"' "+(e.readonly?"disabled='disabled'":"")+v+">"+c+"</select> "}}var b=s._lightbox_controls.defaults.select;return"<div style='height:"+((b?b.height:23)||30)+"px;padding-top:0px;font-size:inherit;' class='dhx_section_time'>"+a+"<span style='font-weight:normal; font-size:10pt;'> &nbsp;&ndash;&nbsp; </span>"+a+"</div>"},set_value:function(e,t,n,i){function r(e,t,n){for(var r=i._time_values,o=60*n.getHours()+n.getMinutes(),a=o,s=!1,l=0;l<r.length;l++){var d=r[l];if(d===o){s=!0;break}d<o&&(a=d)}e[t+u[0]].value=s?o:a,s||a||(e[t+u[0]].selectedIndex=-1),e[t+u[1]].value=n.getDate(),e[t+u[2]].value=n.getMonth(),e[t+u[3]].value=n.getFullYear()}var o,a,l=s.config,d=e.getElementsByTagName("select"),u=i._time_format_order;if(l.full_day){if(!e._full_day){var c="<label class='dhx_fullday'><input type='checkbox' name='full_day' value='true'> "+s.locale.labels.full_day+"&nbsp;</label></input>";s.config.wide_form||(c=e.previousSibling.innerHTML+c),e.previousSibling.innerHTML=c,e._full_day=!0}var h=e.previousSibling.getElementsByTagName("input")[0];h.checked=0===s.date.time_part(n.start_date)&&0===s.date.time_part(n.end_date),d[u[0]].disabled=h.checked,d[u[0]+d.length/2].disabled=h.checked,h.onclick=function(){if(h.checked){var t={};s.form_blocks.time.get_value(e,t,i),o=s.date.date_part(t.start_date),(+(a=s.date.date_part(t.end_date))==+o||+a>=+o&&(0!==n.end_date.getHours()||0!==n.end_date.getMinutes()))&&(a=s.date.add(a,1,"day"))}else o=null,a=null;d[u[0]].disabled=h.checked,d[u[0]+d.length/2].disabled=h.checked,r(d,0,o||n.start_date),r(d,4,a||n.end_date)}}if(l.auto_end_date&&l.event_duration)for(var f=function(){l.auto_end_date&&l.event_duration&&(o=new Date(d[u[3]].value,d[u[2]].value,d[u[1]].value,0,d[u[0]].value),a=new Date(o.getTime()+60*s.config.event_duration*1e3),r(d,4,a))},p=0;p<4;p++)d[p].onchange=f;r(d,0,n.start_date),r(d,4,n.end_date)},get_value:function(e,t,n){var i=e.getElementsByTagName("select"),r=n._time_format_order;if(t.start_date=new Date(i[r[3]].value,i[r[2]].value,i[r[1]].value,0,i[r[0]].value),t.end_date=new Date(i[r[3]+4].value,i[r[2]+4].value,i[r[1]+4].value,0,i[r[0]+4].value),!i[r[3]].value||!i[r[3]+4].value){var o=s.getEvent(s._lightbox_id);o&&(t.start_date=o.start_date,t.end_date=o.end_date)}return t.end_date<=t.start_date&&(t.end_date=s.date.add(t.start_date,s.config.time_step,"minute")),{start_date:new Date(t.start_date),end_date:new Date(t.end_date)}},focus:function(e){s._focus(e.getElementsByTagName("select")[0])}}},s._setLbPosition=function(e){if(e){var t=window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop,n=window.pageXOffset||document.body.scrollLeft||document.documentElement.scrollLeft,i=window.innerHeight||document.documentElement.clientHeight;e.style.top=t?Math.round(t+Math.max((i-e.offsetHeight)/2,0))+"px":Math.round(Math.max((i-e.offsetHeight)/2,0)+9)+"px",document.documentElement.scrollWidth>document.body.offsetWidth?e.style.left=Math.round(n+(document.body.offsetWidth-e.offsetWidth)/2)+"px":e.style.left=Math.round((document.body.offsetWidth-e.offsetWidth)/2)+"px"}},s.showCover=function(e){e&&(e.style.display="block",this._setLbPosition(e)),s.config.responsive_lightbox&&(document.documentElement.classList.add("dhx_cal_overflow_container"),document.body.classList.add("dhx_cal_overflow_container")),this.show_cover()},s.showLightbox=function(e){if(e){if(!this.callEvent("onBeforeLightbox",[e]))return void(this._new_event&&(this._new_event=null));var t=this.getLightbox();this.showCover(t),this._fill_lightbox(e,t),this._waiAria.lightboxVisibleAttr(t),this.callEvent("onLightbox",[e])}},s._fill_lightbox=function(e,t){var n=this.getEvent(e),i=t.getElementsByTagName("span"),r=[];if(s.templates.lightbox_header){r.push("");var o=s.templates.lightbox_header(n.start_date,n.end_date,n);r.push(o),i[1].innerHTML="",i[2].innerHTML=o}else{var a=this.templates.event_header(n.start_date,n.end_date,n),l=(this.templates.event_bar_text(n.start_date,n.end_date,n)||"").substr(0,70);r.push(a),r.push(l),i[1].innerHTML=a,i[2].innerHTML=l}this._waiAria.lightboxHeader(t,r.join(" "));for(var d=this.config.lightbox.sections,u=0;u<d.length;u++){var c=d[u],h=s._get_lightbox_section_node(c),f=this.form_blocks[c.type],p=void 0!==n[c.map_to]?n[c.map_to]:c.default_value;f.set_value.call(this,h,p,n,c),d[u].focus&&f.focus.call(this,h)}s._lightbox_id=e},s._get_lightbox_section_node=function(e){return document.getElementById(e.id).nextSibling},s._lightbox_out=function(e){for(var t=this.config.lightbox.sections,n=0;n<t.length;n++){var i=document.getElementById(t[n].id);i=i?i.nextSibling:i;var r=this.form_blocks[t[n].type].get_value.call(this,i,e,t[n]);"auto"!=t[n].map_to&&(e[t[n].map_to]=r)}return e},s._empty_lightbox=function(e){var t=s._lightbox_id,n=this.getEvent(t);this.getLightbox(),this._lame_copy(n,e),this.setEvent(n.id,n),this._edit_stop_event(n,!0),this.render_view_data()},s.hide_lightbox=function(e){s.endLightbox(!1,this.getLightbox())},s.hideCover=function(e){e&&(e.style.display="none"),this.hide_cover(),s.config.responsive_lightbox&&(document.documentElement.classList.remove("dhx_cal_overflow_container"),document.body.classList.remove("dhx_cal_overflow_container"))},s.hide_cover=function(){this._cover&&this._cover.parentNode.removeChild(this._cover),this._cover=null},s.show_cover=function(){this._cover||(this._cover=document.createElement("div"),this._cover.className="dhx_cal_cover",document.body.appendChild(this._cover))},s.save_lightbox=function(){var e=this._lightbox_out({},this._lame_copy(this.getEvent(this._lightbox_id)));this.checkEvent("onEventSave")&&!this.callEvent("onEventSave",[this._lightbox_id,e,this._new_event])||(this._empty_lightbox(e),this.hide_lightbox())},s.startLightbox=function(e,t){this._lightbox_id=e,this._custom_lightbox=!0,this._temp_lightbox=this._lightbox,this._lightbox=t,this.showCover(t)},s.endLightbox=function(e,t){t=t||s.getLightbox();var n=s.getEvent(this._lightbox_id);n&&this._edit_stop_event(n,e),e&&s.render_view_data(),this.hideCover(t),this._custom_lightbox&&(this._lightbox=this._temp_lightbox,this._custom_lightbox=!1),this._temp_lightbox=this._lightbox_id=null,this._waiAria.lightboxHiddenAttr(t),this.callEvent("onAfterLightbox",[])},s.resetLightbox=function(){s._lightbox&&!s._custom_lightbox&&s._lightbox.parentNode.removeChild(s._lightbox),s._lightbox=null},s.cancel_lightbox=function(){this._lightbox_id&&this.callEvent("onEventCancel",[this._lightbox_id,this._new_event]),this.hide_lightbox()},s.hideLightbox=s.cancel_lightbox,s._init_lightbox_events=function(){this.getLightbox().onclick=function(e){var t=e?e.target:event.srcElement;if(t.className||(t=t.previousSibling),!(t&&t.className&&s._getClassName(t).indexOf("dhx_btn_set")>-1)||(t=t.querySelector("[dhx_button]"))){var n=s._getClassName(t);if(t&&n)switch(n){case"dhx_save_btn":s.save_lightbox();break;case"dhx_delete_btn":var i=s.locale.labels.confirm_deleting;s._dhtmlx_confirm(i,s.locale.labels.title_confirm_deleting,function(){s.deleteEvent(s._lightbox_id),s._new_event=null,s.hide_lightbox()});break;case"dhx_cancel_btn":s.cancel_lightbox();break;default:var r,o;if(t.getAttribute("dhx_button"))s.callEvent("onLightboxButton",[n,t,e]);else-1!=n.indexOf("dhx_custom_button")&&(-1!=n.indexOf("dhx_custom_button_")?(r=t.parentNode.getAttribute("index"),o=t.parentNode.parentNode):(r=t.getAttribute("index"),o=t.parentNode,t=t.firstChild)),r&&s.form_blocks[s.config.lightbox.sections[r].type].button_click(r,t,o,o.nextSibling)}}},this.getLightbox().onkeydown=function(e){var t=e||window.event,n=e.target||e.srcElement,i=n.querySelector("[dhx_button]");switch(i||(i=n.parentNode.querySelector(".dhx_custom_button, .dhx_readonly")),(e||t).keyCode){case 32:if((e||t).shiftKey)return;i&&i.click&&i.click();break;case s.keys.edit_save:if((e||t).shiftKey)return;i&&i.click?i.click():s.save_lightbox();break;case s.keys.edit_cancel:s.cancel_lightbox()}}},s.setLightboxSize=function(){var e=this._lightbox;if(e){var t=e.childNodes[1];t.style.height="0px",t.style.height=t.scrollHeight+"px",e.style.height=t.scrollHeight+s.xy.lightbox_additional_height+"px",t.style.height=t.scrollHeight+"px"}},s._init_dnd_events=function(){s.event(document.body,"mousemove",s._move_while_dnd),s.event(document.body,"mouseup",s._finish_dnd),s._init_dnd_events=function(){}},s._move_while_dnd=function(e){if(s._dnd_start_lb){document.dhx_unselectable||(document.body.className+=" dhx_unselectable",document.dhx_unselectable=!0);var t=s.getLightbox(),n=e&&e.target?[e.pageX,e.pageY]:[event.clientX,event.clientY];t.style.top=s._lb_start[1]+n[1]-s._dnd_start_lb[1]+"px",t.style.left=s._lb_start[0]+n[0]-s._dnd_start_lb[0]+"px"}},s._ready_to_dnd=function(e){var t=s.getLightbox();s._lb_start=[parseInt(t.style.left,10),parseInt(t.style.top,10)],s._dnd_start_lb=e&&e.target?[e.pageX,e.pageY]:[event.clientX,event.clientY]},s._finish_dnd=function(){s._lb_start&&(s._lb_start=s._dnd_start_lb=!1,document.body.className=document.body.className.replace(" dhx_unselectable",""),document.dhx_unselectable=!1)},s.getLightbox=function(){if(!this._lightbox){var e=document.createElement("div");e.className="dhx_cal_light",s.config.wide_form&&(e.className+=" dhx_cal_light_wide"),s.form_blocks.recurring&&(e.className+=" dhx_cal_light_rec"),s.config.rtl&&(e.className+=" dhx_cal_light_rtl"),s.config.responsive_lightbox&&(e.className+=" dhx_cal_light_responsive"),/msie|MSIE 6/.test(navigator.userAgent)&&(e.className+=" dhx_ie6"),e.style.visibility="hidden";for(var t=this._lightbox_template,n=this.config.buttons_left,i=0;i<n.length;i++)t+="<div "+this._waiAria.lightboxButtonAttrString(n[i])+" class='dhx_btn_set dhx_"+(s.config.rtl?"right":"left")+"_btn_set "+n[i]+"_set'><div dhx_button='1' class='"+n[i]+"'></div><div>"+s.locale.labels[n[i]]+"</div></div>";n=this.config.buttons_right;var r=s.config.rtl;for(i=0;i<n.length;i++)t+="<div "+this._waiAria.lightboxButtonAttrString(n[i])+" class='dhx_btn_set dhx_"+(r?"left":"right")+"_btn_set "+n[i]+"_set' style='float:"+(r?"left":"right")+";'><div dhx_button='1' class='"+n[i]+"'></div><div>"+s.locale.labels[n[i]]+"</div></div>";t+="</div>",e.innerHTML=t,s.config.drag_lightbox&&(e.firstChild.onmousedown=s._ready_to_dnd,e.firstChild.onselectstart=function(){return!1},e.firstChild.style.cursor="move",s._init_dnd_events()),this._waiAria.lightboxAttr(e),document.body.insertBefore(e,document.body.firstChild),this._lightbox=e;var o=this.config.lightbox.sections;t="";for(i=0;i<o.length;i++){var a=this.form_blocks[o[i].type];if(a){o[i].id="area_"+this.uid();var l="";if(o[i].button)l="<div "+s._waiAria.lightboxSectionButtonAttrString(this.locale.labels["button_"+o[i].button])+" class='dhx_custom_button' index='"+i+"'><div class='dhx_custom_button_"+o[i].button+"'></div><div>"+this.locale.labels["button_"+o[i].button]+"</div></div>";this.config.wide_form&&(t+="<div class='dhx_wrap_section'>");var d=this.locale.labels["section_"+o[i].name];"string"!=typeof d&&(d=o[i].name),t+="<div id='"+o[i].id+"' class='dhx_cal_lsection'>"+l+"<label>"+d+"</label></div>"+a.render.call(this,o[i]),t+="</div>"}}var u=e.getElementsByTagName("div");for(i=0;i<u.length;i++){var c=u[i];if("dhx_cal_larea"==s._getClassName(c)){c.innerHTML=t;break}}s._bindLightboxLabels(o),this.setLightboxSize(),this._init_lightbox_events(this),e.style.display="none",e.style.visibility="visible"}return this._lightbox},s._bindLightboxLabels=function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.id&&document.getElementById(n.id)){for(var i=document.getElementById(n.id).querySelector("label"),r=s._get_lightbox_section_node(n);r&&!r.querySelector;)r=r.nextSibling;var o=!0;if(r){var a=r.querySelector("input, select, textarea");a&&(n.inputId=a.id||"input_"+s.uid(),a.id||(a.id=n.inputId),i.setAttribute("for",n.inputId),o=!1)}o&&s.form_blocks[n.type].focus&&(i.onclick=function(e){return function(){var t=s.form_blocks[e.type],n=s._get_lightbox_section_node(e);t&&t.focus&&t.focus.call(s,n)}}(n))}}},s.attachEvent("onEventIdChange",function(e,t){this._lightbox_id==e&&(this._lightbox_id=t)}),s._lightbox_template="<div class='dhx_cal_ltitle'><span class='dhx_mark'>&nbsp;</span><span class='dhx_time'></span><span class='dhx_title'></span></div><div class='dhx_cal_larea'></div>",s._init_touch_events=function(){if((this.config.touch&&(-1!=navigator.userAgent.indexOf("Mobile")||-1!=navigator.userAgent.indexOf("iPad")||-1!=navigator.userAgent.indexOf("Android")||-1!=navigator.userAgent.indexOf("Touch"))&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&(this.xy.scroll_width=0,this._mobile=!0),this.config.touch){var e=!0;try{document.createEvent("TouchEvent")}catch(t){e=!1}e?this._touch_events(["touchmove","touchstart","touchend"],function(e){return e.touches&&e.touches.length>1?null:e.touches[0]?{target:e.target,pageX:e.touches[0].pageX,pageY:e.touches[0].pageY,clientX:e.touches[0].clientX,clientY:e.touches[0].clientY}:e},function(){return!1}):window.PointerEvent||window.navigator.pointerEnabled?this._touch_events(["pointermove","pointerdown","pointerup"],function(e){return"mouse"==e.pointerType?null:e},function(e){return!e||"mouse"==e.pointerType}):window.navigator.msPointerEnabled&&this._touch_events(["MSPointerMove","MSPointerDown","MSPointerUp"],function(e){return e.pointerType==e.MSPOINTER_TYPE_MOUSE?null:e},function(e){return!e||e.pointerType==e.MSPOINTER_TYPE_MOUSE})}},s._touch_events=function(e,t,n){function i(e,t,i){e.addEventListener(t,function(e){return!!s._is_lightbox_open()||(n(e)?void 0:i(e))},{passive:!1})}function r(e){n(e)||(s._hide_global_tip(),d&&(s._on_mouse_up(t(e||event)),s._temp_touch_block=!1),s._drag_id=null,s._drag_mode=null,s._drag_pos=null,s._pointerDragId=null,clearTimeout(l),d=c=!1,u=!0)}var o,a,l,d,u,c,h=(-1!=navigator.userAgent.indexOf("Android")&&navigator.userAgent.indexOf("WebKit"),0);i(document.body,e[0],function(e){if(!n(e)){var i=t(e);if(i){if(d)return function(e){if(!n(e)){var t=s.getState().drag_mode,i=!!s.matrix&&s.matrix[s._mode],r=s.render_view_data;"create"==t&&i&&(s.render_view_data=function(){for(var e=s.getState().drag_id,t=s.getEvent(e),n=i.y_property,r=s.getEvents(t.start_date,t.end_date),o=0;o<r.length;o++)r[o][n]!=t[n]&&(r.splice(o,1),o--);t._sorder=r.length-1,t._count=r.length,this.render_data([t],s.getState().mode)}),s._on_mouse_move(e),"create"==t&&i&&(s.render_view_data=r),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0}}(i),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,s._update_global_tip(),!1;if(a=t(e),c)return a?void((o.target!=a.target||Math.abs(o.pageX-a.pageX)>5||Math.abs(o.pageY-a.pageY)>5)&&(u=!0,clearTimeout(l))):void(u=!0)}}}),i(this._els.dhx_cal_data[0],"touchcancel",r),i(this._els.dhx_cal_data[0],"contextmenu",function(e){if(!n(e))return c?(e&&e.preventDefault&&e.preventDefault(),(e||event).cancelBubble=!0,!1):void 0}),i(this._obj,e[1],function(e){if(document&&document.body&&document.body.classList.add("dhx_cal_touch_active"),!n(e)){var i;if(s._pointerDragId=e.pointerId,d=u=!1,c=!0,!(i=a=t(e)))return void(u=!0);var r=new Date;if(!u&&!d&&r-h<250)return s._click.dhx_cal_data(i),window.setTimeout(function(){i.type="dblclick",s._on_dbl_click(i)},50),e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,s._block_next_stop=!0,!1;if(h=r,!u&&!d&&s.config.touch_drag){var f=s._locate_event(document.activeElement),p=s._locate_event(i.target),m=o?s._locate_event(o.target):null;if(f&&p&&f==p&&f!=m)return e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,s._ignore_next_click=!1,s._click.dhx_cal_data(i),o=i,!1;l=setTimeout(function(){d=!0;var e=o.target,t=s._getClassName(e);e&&-1!=t.indexOf("dhx_body")&&(e=e.previousSibling),s._on_mouse_down(o,e),s._drag_mode&&"create"!=s._drag_mode&&s.for_rendered(s._drag_id,function(e,t){e.style.display="none",s._rendered.splice(t,1)}),s.config.touch_tip&&s._show_global_tip(),s.updateEvent(s._drag_id)},s.config.touch_drag),o=i}}}),i(this._els.dhx_cal_data[0],e[2],function(e){if(document&&document.body&&document.body.classList.remove("dhx_cal_touch_active"),!n(e))return s.config.touch_swipe_dates&&!d&&function(e,t,n,i){if(!e||!t)return!1;for(var r=e.target;r&&r!=s._obj;)r=r.parentNode;if(r!=s._obj)return!1;if(s.matrix&&s.matrix[s.getState().mode]&&s.matrix[s.getState().mode].scrollable)return!1;var o=Math.abs(e.pageY-t.pageY),a=Math.abs(e.pageX-t.pageX);return o<i&&a>n&&(!o||a/o>3)&&(e.pageX>t.pageX?s._click.dhx_cal_next_button():s._click.dhx_cal_prev_button(),!0)}(o,a,200,100)&&(s._block_next_stop=!0),d&&(s._ignore_next_click=!0,setTimeout(function(){s._ignore_next_click=!1},100)),r(e),s._block_next_stop?(s._block_next_stop=!1,e.preventDefault&&e.preventDefault(),e.cancelBubble=!0,!1):void 0}),s.event(document.body,e[2],r)},s._show_global_tip=function(){s._hide_global_tip();var e=s._global_tip=document.createElement("div");e.className="dhx_global_tip",s._update_global_tip(1),document.body.appendChild(e)},s._update_global_tip=function(e){var t=s._global_tip;if(t){var n="";if(s._drag_id&&!e){var i=s.getEvent(s._drag_id);i&&(n="<div>"+(i._timed?s.templates.event_header(i.start_date,i.end_date,i):s.templates.day_date(i.start_date,i.end_date,i))+"</div>")}"create"==s._drag_mode||"new-size"==s._drag_mode?t.innerHTML=(s.locale.labels.drag_to_create||"Drag to create")+n:t.innerHTML=(s.locale.labels.drag_to_move||"Drag to move")+n}},s._hide_global_tip=function(){var e=s._global_tip;e&&e.parentNode&&(e.parentNode.removeChild(e),s._global_tip=0)},s._dp_init=function(e){e._methods=["_set_event_text_style","","_dp_change_event_id","_dp_hook_delete"],this._dp_change_event_id=function(e,t){s.getEvent(e)&&s.changeEventId(e,t)},this._dp_hook_delete=function(t,n){if(s.getEvent(t))return n&&t!=n&&("true_deleted"==this.getUserData(t,e.action_param)&&this.setUserData(t,e.action_param,"updated"),this.changeEventId(t,n)),this.deleteEvent(n,!0)},this.attachEvent("onEventAdded",function(t){!this._loading&&this._validId(t)&&e.setUpdated(t,!0,"inserted")}),this.attachEvent("onConfirmedBeforeEventDelete",function(t){if(this._validId(t)){var n=e.getState(t);return"inserted"==n||this._new_event?(e.setUpdated(t,!1),!0):"deleted"!=n&&("true_deleted"==n||(e.setUpdated(t,!0,"deleted"),!1))}}),this.attachEvent("onEventChanged",function(t){!this._loading&&this._validId(t)&&e.setUpdated(t,!0,"updated")}),s.attachEvent("onClearAll",function(){e._in_progress={},e._invalid={},e.updatedRows=[],e._waitMode=0});var t=function(e,n,i){for(var r in i=i||"",n=n||{},e)0!==r.indexOf("_")&&(e[r]&&e[r].getUTCFullYear?n[i+r]=this.obj._helpers.formatDate(e[r]):e[r]&&"object"==typeof e[r]?t.call(this,e[r],n,i+r+"."):n[i+r]=e[r]);return n},n=function(e){var t=s.utils.copy(e);for(var i in t)0===i.indexOf("_")?delete t[i]:t[i]&&(t[i].getUTCFullYear?t[i]=this.obj._helpers.formatDate(t[i]):"object"==typeof t[i]&&(t[i]=n(t[i])));return t};e._getRowData=function(e,i){var r=this.obj.getEvent(e);return"JSON"==this._tMode?n.call(this,r):t.call(this,r)},e._clearUpdateFlag=function(){},e.attachEvent("insertCallback",s._update_callback),e.attachEvent("updateCallback",s._update_callback),e.attachEvent("deleteCallback",function(e,t){this.obj.getEvent(t)?(this.obj.setUserData(t,this.action_param,"true_deleted"),this.obj.deleteEvent(t)):this.obj._add_rec_marker&&this.obj._update_callback(e,t)})},s._validId=function(e){return!0},s.setUserData=function(e,t,n){if(e){var i=this.getEvent(e);i&&(i[t]=n)}else this._userdata[t]=n},s.getUserData=function(e,t){if(e){var n=this.getEvent(e);return n?n[t]:null}return this._userdata[t]},s._set_event_text_style=function(e,t){if(s.getEvent(e)){this.for_rendered(e,function(e){e.style.cssText+=";"+t});var n=this.getEvent(e);n._text_style=t,this.event_updated(n)}},s._update_callback=function(e,t){var n=s._xmlNodeToJSON(e.firstChild);"none"==n.rec_type&&(n.rec_pattern="none"),n.text=n.text||n._tagvalue,n.start_date=s._helpers.parseDate(n.start_date),n.end_date=s._helpers.parseDate(n.end_date),s.addEvent(n),s._add_rec_marker&&s.setCurrentView()},s.getRootView=function(){return{view:{render:function(){return{tag:"div",type:1,attrs:{style:"width:100%;height:100%;"},hooks:{didInsert:function(){s.setCurrentView()}},body:[{el:this.el,type:1}]}},init:function(){var e=document.createElement("DIV");e.id="scheduler_"+s.uid(),e.style.width="100%",e.style.height="100%",e.classList.add("dhx_cal_container"),e.cmp="grid",e.innerHTML='<div class="dhx_cal_navline"><div class="dhx_cal_prev_button">&nbsp;</div><div class="dhx_cal_next_button">&nbsp;</div><div class="dhx_cal_today_button"></div><div class="dhx_cal_date"></div><div class="dhx_cal_tab" name="day_tab"></div><div class="dhx_cal_tab" name="week_tab"></div><div class="dhx_cal_tab" name="month_tab"></div></div><div class="dhx_cal_header"></div><div class="dhx_cal_data"></div>',s.init(e),this.el=e}},type:4}},s._skin_settings={fix_tab_position:[1,0],use_select_menu_space:[1,0],wide_form:[1,0],hour_size_px:[44,42],displayed_event_color:["#ff4a4a","ffc5ab"],displayed_event_text_color:["#ffef80","7e2727"]},s._skin_xy={lightbox_additional_height:[90,50],nav_height:[59,22],bar_height:[24,20]},s._is_material_skin=function(){return s.skin?(s.skin+"").indexOf("material")>-1:function(){if(void 0===_){var e=document.createElement("div");e.style.position="absolute",e.style.left="-9999px",e.style.top="-9999px",e.innerHTML="<div class='dhx_cal_container'><div class='dhx_cal_scale_placeholder'></div><div>",document.body.appendChild(e);var t=window.getComputedStyle(e.querySelector(".dhx_cal_scale_placeholder")).getPropertyValue("position");_="absolute"===t,setTimeout(function(){_=null},500)}return _}()},window.addEventListener("DOMContentLoaded",a),window.addEventListener("load",a),s._border_box_events=function(){return o()},s._configure=function(e,t,n){for(var i in t)void 0===e[i]&&(e[i]=t[i][n])},s._skin_init=function(){if(!s.skin)for(var e=document.getElementsByTagName("link"),t=0;t<e.length;t++){var n=e[t].href.match("dhtmlxscheduler_([a-z]+).css");if(n){s.skin=n[1];break}}var i=0;if(!s.skin||"classic"!==s.skin&&"glossy"!==s.skin||(i=1),s._is_material_skin()){var r=s.config.buttons_left.$inital,o=s.config.buttons_right.$inital;if(r&&s.config.buttons_left.slice().join()==r&&o&&s.config.buttons_right.slice().join()==o){var a=s.config.buttons_left.slice();s.config.buttons_left=s.config.buttons_right.slice(),s.config.buttons_right=a}s.xy.event_header_height=18,s.xy.week_agenda_scale_height=35,s.xy.map_icon_width=38,s._lightbox_controls.defaults.textarea.height=64,s._lightbox_controls.defaults.time.height="auto"}if(this._configure(s.config,s._skin_settings,i),this._configure(s.xy,s._skin_xy,i),"flat"===s.skin&&(s.xy.scale_height=35,s.templates.hour_scale=function(e){var t=e.getMinutes();return t=t<10?"0"+t:t,"<span class='dhx_scale_h'>"+e.getHours()+"</span><span class='dhx_scale_m'>&nbsp;"+t+"</span>"}),!i){var l=s.config.minicalendar;l&&(l.padding=14),s.templates.event_bar_date=function(e,t,n){return"\u2022 <b>"+s.templates.event_date(e)+"</b> "},s.attachEvent("onTemplatesReady",function(){var e=s.date.date_to_str("%d");s.templates._old_month_day||(s.templates._old_month_day=s.templates.month_day);var t=s.templates._old_month_day;if(s.templates.month_day=function(n){if("month"==this._mode){var i=e(n);return 1==n.getDate()&&(i=s.locale.date.month_full[n.getMonth()]+" "+i),+n==+s.date.date_part(this._currentDate())&&(i=s.locale.labels.dhx_cal_today_button+" "+i),i}return t.call(this,n)},s.config.fix_tab_position){var n=s._els.dhx_cal_navline[0].getElementsByTagName("div"),i=null,r=211,o=[14,75,136],a=14;s._is_material_skin()&&(o=[16,103,192],r=294,a=-1);for(var l=0;l<n.length;l++){var d=n[l],u=d.getAttribute("name");if(u){switch(d.style.right="auto",u){case"day_tab":d.style.left=o[0]+"px",d.className+=" dhx_cal_tab_first";break;case"week_tab":d.style.left=o[1]+"px";break;case"month_tab":d.style.left=o[2]+"px",d.className+=" dhx_cal_tab_last";break;default:d.style.left=r+"px",d.className+=" dhx_cal_tab_standalone",r=r+a+d.offsetWidth}d.className+=" "+u}else 0===(d.className||"").indexOf("dhx_minical_icon")&&d.parentNode==s._els.dhx_cal_navline[0]&&(i=d)}i&&(i.style.left=r+"px")}}),s._skin_init=function(){}}},window.jQuery&&function(e){var t=0,n=[];e.fn.dhx_scheduler=function(i){if("string"!=typeof i){var r=[];return this.each(function(){if(this&&this.getAttribute)if(this.getAttribute("dhxscheduler"))r.push(window[this.getAttribute("dhxscheduler")]);else{var e="scheduler";t&&(e="scheduler"+(t+1),window[e]=Scheduler.getSchedulerInstance());var n=window[e];for(var o in this.setAttribute("dhxscheduler",e),i)"data"!=o&&(n.config[o]=i[o]);this.getElementsByTagName("div").length||(this.innerHTML='<div class="dhx_cal_navline"><div class="dhx_cal_prev_button">&nbsp;</div><div class="dhx_cal_next_button">&nbsp;</div><div class="dhx_cal_today_button"></div><div class="dhx_cal_date"></div><div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div><div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div><div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div></div><div class="dhx_cal_header"></div><div class="dhx_cal_data"></div>',this.className+=" dhx_cal_container"),n.init(this,n.config.date,n.config.mode),i.data&&n.parse(i.data),r.push(n),t++}}),1===r.length?r[0]:r}if(n[i])return n[i].apply(this,[]);e.error("Method "+i+" does not exist on jQuery.dhx_scheduler")}}(jQuery),function(){function e(e,t,n){t&&(e._date=t),n&&(e._mode=n)}var t=s.setCurrentView,n=s.updateView,i=null,r=null,o=function(t,o){var a=this;window.clearTimeout(r),window.clearTimeout(i);var l=a._date,d=a._mode;e(this,t,o),r=setTimeout(function(){a.callEvent("onBeforeViewChange",[d,l,o||a._mode,t||a._date])?(n.call(a,t,o),a.callEvent("onViewChange",[a._mode,a._date]),window.clearTimeout(i),r=0):e(a,l,d)},s.config.delay_render)},a=function(t,o){var a=this,l=arguments;e(this,t,o),window.clearTimeout(i),i=setTimeout(function(){r||n.apply(a,l)},s.config.delay_render)};s.attachEvent("onSchedulerReady",function(){s.config.delay_render?(s.setCurrentView=o,s.updateView=a):(s.setCurrentView=t,s.updateView=n)})}();for(var y=0;y<Scheduler._schedulerPlugins.length;y++)Scheduler._schedulerPlugins[y](s);return s._internal_id=Scheduler._seed++,Scheduler.$syncFactory&&Scheduler.$syncFactory(s),s},window.scheduler=Scheduler.getSchedulerInstance(),window.Scheduler={plugin:scheduler.bind(Scheduler.plugin,Scheduler)},dhtmlx&&dhtmlx.attaches&&(dhtmlx.attaches.attachScheduler=function(e,t,n,i){n=n||'<div class="dhx_cal_tab" name="day_tab" style="right:204px;"></div><div class="dhx_cal_tab" name="week_tab" style="right:140px;"></div><div class="dhx_cal_tab" name="month_tab" style="right:76px;"></div>';var r=document.createElement("DIV");return r.id="dhxSchedObj_"+this._genStr(12),r.innerHTML='<div id="'+r.id+'" class="dhx_cal_container" style="width:100%; height:100%;"><div class="dhx_cal_navline"><div class="dhx_cal_prev_button">&nbsp;</div><div class="dhx_cal_next_button">&nbsp;</div><div class="dhx_cal_today_button"></div><div class="dhx_cal_date"></div>'+n+'</div><div class="dhx_cal_header"></div><div class="dhx_cal_data"></div></div>',document.body.appendChild(r.firstChild),this.attachObject(r.id,!1,!0),this.vs[this.av].sched=i,this.vs[this.av].schedId=r.id,i.setSizes=i.updateView,i.destructor=function(){},i.init(r.id,e,t),this.vs[this._viewRestore()].sched})}(),
/*

@license
dhtmlxScheduler v.5.3.13 Standard

To use dhtmlxScheduler in non-GPL projects (and get Pro version of the product), please obtain Commercial/Enterprise or Ultimate license on our site https://dhtmlx.com/docs/products/dhtmlxScheduler/#licensing or contact us at sales@dhtmlx.com

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){e.locale={date:{month_full:["Janvier","F\xe9vrier","Mars","Avril","Mai","Juin","Juillet","Ao\xfbt","Septembre","Octobre","Novembre","D\xe9cembre"],month_short:["Jan","F\xe9v","Mar","Avr","Mai","Juin","Juil","Ao\xfb","Sep","Oct","Nov","D\xe9c"],day_full:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"],day_short:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"]},labels:{dhx_cal_today_button:"Aujourd'hui",day_tab:"Jour",week_tab:"Semaine",month_tab:"Mois",new_event:"Nouvel \xe9v\xe9nement",icon_save:"Enregistrer",icon_cancel:"Annuler",icon_details:"D\xe9tails",icon_edit:"Modifier",icon_delete:"Effacer",confirm_closing:"",confirm_deleting:"L'\xe9v\xe9nement sera effac\xe9 sans appel, \xeates-vous s\xfbr ?",section_description:"Description",section_time:"P\xe9riode",full_day:"Journ\xe9e compl\xe8te",confirm_recurring:"Voulez-vous \xe9diter toute une s\xe9rie d'\xe9v\xe8nements r\xe9p\xe9t\xe9s?",section_recurring:"P\xe9riodicit\xe9",button_recurring:"D\xe9sactiv\xe9",button_recurring_open:"Activ\xe9",button_edit_series:"Modifier la s\xe9rie",button_edit_occurrence:"Modifier une copie",agenda_tab:"Jour",date:"Date",description:"Description",year_tab:"Ann\xe9e",week_agenda_tab:"Jour",grid_tab:"Grille",drag_to_create:"Drag to create",drag_to_move:"Drag to move",message_ok:"OK",message_cancel:"Cancel",next:"Next",prev:"Previous",year:"Year",month:"Month",day:"Day",hour:"Hour",minute:"Minute",repeat_radio_day:"Quotidienne",repeat_radio_week:"Hebdomadaire",repeat_radio_month:"Mensuelle",repeat_radio_year:"Annuelle",repeat_radio_day_type:"Chaque",repeat_text_day_count:"jour",repeat_radio_day_type2:"Chaque journ\xe9e de travail",repeat_week:" R\xe9p\xe9ter toutes les",repeat_text_week_count:"semaine:",repeat_radio_month_type:"R\xe9p\xe9ter",repeat_radio_month_start:"Le",repeat_text_month_day:"jour chaque",repeat_text_month_count:"mois",repeat_text_month_count2_before:"chaque",repeat_text_month_count2_after:"mois",repeat_year_label:"Le",select_year_day2:"du",repeat_text_year_day:"jour",select_year_month:"mois",repeat_radio_end:"Pas de date d&quot;ach\xe8vement",repeat_text_occurences_count:"occurrences",repeat_radio_end3:"Fin",repeat_radio_end2:"Apr\xe8s",month_for_recurring:["Janvier","F\xe9vrier","Mars","Avril","Mai","Juin","Juillet","Ao\xfbt","Septembre","Octobre","Novembre","D\xe9cembre"],day_for_recurring:["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"]}}}),
/*

@license
dhtmlxScheduler v.5.3.13 Standard

To use dhtmlxScheduler in non-GPL projects (and get Pro version of the product), please obtain Commercial/Enterprise or Ultimate license on our site https://dhtmlx.com/docs/products/dhtmlxScheduler/#licensing or contact us at sales@dhtmlx.com

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){window.dhtmlXTooltip=e.dhtmlXTooltip=e.tooltip={},dhtmlXTooltip.config={className:"dhtmlXTooltip tooltip",timeout_to_display:50,timeout_to_hide:50,delta_x:15,delta_y:-20},dhtmlXTooltip.tooltip=document.createElement("div"),dhtmlXTooltip.tooltip.className=dhtmlXTooltip.config.className,e._waiAria.tooltipAttr(dhtmlXTooltip.tooltip),dhtmlXTooltip.show=function(t,n){if(!this._mobile||e.config.touch_tooltip){var i=dhtmlXTooltip,r=this.tooltip,o=r.style;i.tooltip.className=i.config.className;var a=this.position(t),s=t.target||t.srcElement;if(!this.isTooltip(s)){var l=a.x+(i.config.delta_x||0),d=a.y-(i.config.delta_y||0);o.visibility="hidden",o.removeAttribute?(o.removeAttribute("right"),o.removeAttribute("bottom")):(o.removeProperty("right"),o.removeProperty("bottom")),o.left="0",o.top="0",e.config.rtl&&(r.className+=" dhtmlXTooltip_rtl"),this.tooltip.innerHTML=n,document.body.appendChild(this.tooltip);var u=this.tooltip.offsetWidth,c=this.tooltip.offsetHeight;document.documentElement.clientWidth-l-u<0?(o.removeAttribute?o.removeAttribute("left"):o.removeProperty("left"),o.right=document.documentElement.clientWidth-l+2*(i.config.delta_x||0)+"px"):o.left=l<0?a.x+Math.abs(i.config.delta_x||0)+"px":l+"px",document.documentElement.clientHeight-d-c<0?(o.removeAttribute?o.removeAttribute("top"):o.removeProperty("top"),o.bottom=document.documentElement.clientHeight-d-2*(i.config.delta_y||0)+"px"):o.top=d<0?a.y+Math.abs(i.config.delta_y||0)+"px":d+"px",e._waiAria.tooltipVisibleAttr(this.tooltip),o.visibility="visible",this.tooltip.onmouseleave=function(t){t=t||window.event;for(var n=e.dhtmlXTooltip,i=t.relatedTarget;i!=e._obj&&i;)i=i.parentNode;i!=e._obj&&n.delay(n.hide,n,[],n.config.timeout_to_hide)},e.callEvent("onTooltipDisplayed",[this.tooltip,this.tooltip.event_id])}}},dhtmlXTooltip._clearTimeout=function(){this.tooltip._timeout_id&&window.clearTimeout(this.tooltip._timeout_id)},dhtmlXTooltip.hide=function(){if(this.tooltip.parentNode){e._waiAria.tooltipHiddenAttr(this.tooltip);var t=this.tooltip.event_id;this.tooltip.event_id=null,this.tooltip.onmouseleave=null,this.tooltip.parentNode.removeChild(this.tooltip),e.callEvent("onAfterTooltip",[t])}this._clearTimeout()},dhtmlXTooltip.delay=function(e,t,n,i){this._clearTimeout(),this.tooltip._timeout_id=setTimeout(function(){var i=e.apply(t,n);return e=t=n=null,i},i||this.config.timeout_to_display)},dhtmlXTooltip.isTooltip=function(e){for(var t=!1;e&&!t;)t=e.className==this.tooltip.className,e=e.parentNode;return t},dhtmlXTooltip.position=function(e){return{x:(e=e||window.event).clientX,y:e.clientY}},e.attachEvent("onMouseMove",function(t,n){var i=window.event||n,r=i.target||i.srcElement,o=dhtmlXTooltip,a=o.isTooltip(r),s=o.isTooltipTarget&&o.isTooltipTarget(r);if(t&&e.getState().editor_id!=t||a||s){var l,d;if(t||o.tooltip.event_id){var u=e.getEvent(t)||e.getEvent(o.tooltip.event_id);if(!u)return;if(o.tooltip.event_id=u.id,!(l=e.templates.tooltip_text(u.start_date,u.end_date,u)))return o.hide()}if(s&&(l=""),e.$env.isIE)for(var c in d={pageX:void 0,pageY:void 0,clientX:void 0,clientY:void 0,target:void 0,srcElement:void 0})d[c]=i[c];if(!e.callEvent("onBeforeTooltip",[t])||!l)return;o.delay(o.show,o,[d||i,l])}else o.delay(o.hide,o,[],o.config.timeout_to_hide)}),e.attachEvent("onBeforeDrag",function(){return dhtmlXTooltip.hide(),!0}),e.attachEvent("onEventDeleted",function(){return dhtmlXTooltip.hide(),!0})}),
/*

@license
dhtmlxScheduler v.5.3.13 Standard

To use dhtmlxScheduler in non-GPL projects (and get Pro version of the product), please obtain Commercial/Enterprise or Ultimate license on our site https://dhtmlx.com/docs/products/dhtmlxScheduler/#licensing or contact us at sales@dhtmlx.com

(c) XB Software Ltd.

*/
Scheduler.plugin(function(e){e.config.year_x=4,e.config.year_y=3,e.xy.year_top=0,e.templates.year_date=function(t){return e.date.date_to_str(e.locale.labels.year_tab+" %Y")(t)},e.templates.year_month=e.date.date_to_str("%F"),e.templates.year_scale_date=e.date.date_to_str("%D"),e.templates.year_tooltip=function(e,t,n){return n.text},function(){var t=function(){return"year"==e._mode};e.dblclick_dhx_month_head=function(n){if(t()){var i=n.target||n.srcElement,r=e._getClassName(i.parentNode);if(-1!=r.indexOf("dhx_before")||-1!=r.indexOf("dhx_after"))return!1;for(var o=i;o&&(!o.hasAttribute||!o.hasAttribute("date"));)o=o.parentNode;if(o){var a=this._helpers.parseDate(o.getAttribute("date"));a.setDate(parseInt(i.innerHTML,10));var s=this.date.add(a,1,"day");!this.config.readonly&&this.config.dblclick_create&&this.addEventNow(a.valueOf(),s.valueOf(),n)}}};var n=e.changeEventId;e.changeEventId=function(){n.apply(this,arguments),t()&&this.year_view(!0)};var i=e.render_data,r=e.date.date_to_str("%Y/%m/%d"),o=e.date.str_to_date("%Y/%m/%d");e.render_data=function(e){if(!t())return i.apply(this,arguments);for(var n=0;n<e.length;n++)this._year_render_event(e[n])};var a=e.clear_view;e.clear_view=function(){if(!t())return a.apply(this,arguments);var n=e._year_marked_cells,i=null;for(var r in n)n.hasOwnProperty(r)&&((i=n[r]).className="dhx_month_head",i.removeAttribute("date"));e._year_marked_cells={}},e._hideToolTip=function(){this._tooltip&&(this._tooltip.style.display="none",this._tooltip.date=new Date(9999,1,1))},e._showToolTip=function(t,n,i,r){if(this._tooltip){if(this._tooltip.date.valueOf()==t.valueOf())return;this._tooltip.innerHTML=""}else{var o=this._tooltip=document.createElement("div");o.className="dhx_year_tooltip",this.config.rtl&&(o.className+=" dhx_tooltip_rtl"),document.body.appendChild(o),o.onclick=e._click.dhx_cal_data}for(var a=this.getEvents(t,this.date.add(t,1,"day")),s="",l=0;l<a.length;l++){var d=a[l];if(this.filter_event(d.id,d)){var u=d.color?"background:"+d.color+";":"",c=d.textColor?"color:"+d.textColor+";":"";s+="<div class='dhx_tooltip_line' style='"+u+c+"' event_id='"+a[l].id+"'>",s+="<div class='dhx_tooltip_date' style='"+u+c+"'>"+(a[l]._timed?this.templates.event_date(a[l].start_date):"")+"</div>",s+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",s+=this.templates.year_tooltip(a[l].start_date,a[l].end_date,a[l])+"</div>"}}this._tooltip.style.display="",this._tooltip.style.top="0px",document.body.offsetWidth-n.left-this._tooltip.offsetWidth<0?this._tooltip.style.left=n.left-this._tooltip.offsetWidth+"px":this._tooltip.style.left=n.left+r.offsetWidth+"px",this._tooltip.date=t,this._tooltip.innerHTML=s,document.body.offsetHeight-n.top-this._tooltip.offsetHeight<0?this._tooltip.style.top=n.top-this._tooltip.offsetHeight+r.offsetHeight+"px":this._tooltip.style.top=n.top+"px"},e._year_view_tooltip_handler=function(n){if(t()){var i=(n=n||event).target||n.srcElement;"a"==i.tagName.toLowerCase()&&(i=i.parentNode),-1!=e._getClassName(i).indexOf("dhx_year_event")?e._showToolTip(o(i.getAttribute("date")),e.$domHelpers.getOffset(i),n,i):e._hideToolTip()}},e._init_year_tooltip=function(){e._detachDomEvent(e._els.dhx_cal_data[0],"mouseover",e._year_view_tooltip_handler),e.event(e._els.dhx_cal_data[0],"mouseover",e._year_view_tooltip_handler)},e._get_year_cell=function(e){var t=e.getMonth()+12*(e.getFullYear()-this._min_date.getFullYear())-this.week_starts._month,n=this._els.dhx_cal_data[0].childNodes[t],i=this.week_starts[t]+e.getDate()-1;return n.querySelectorAll(".dhx_year_body tr")[Math.floor(i/7)].querySelectorAll("td")[i%7].querySelector(".dhx_month_head")},e._year_marked_cells={},e._mark_year_date=function(t,n){var i=r(t),o=this._get_year_cell(t);if(o){var a=this.templates.event_class(n.start_date,n.end_date,n);e._year_marked_cells[i]||(o.className="dhx_month_head dhx_year_event",o.setAttribute("date",i),e._year_marked_cells[i]=o),o.className+=a?" "+a:""}},e._unmark_year_date=function(e){var t=this._get_year_cell(e);t&&(t.className="dhx_month_head")},e._year_render_event=function(e){var t=e.start_date;for(t=t.valueOf()<this._min_date.valueOf()?this._min_date:this.date.date_part(new Date(t));t<e.end_date;)if(this._mark_year_date(t,e),(t=this.date.add(t,1,"day")).valueOf()>=this._max_date.valueOf())return},e.year_view=function(t){var n;if(t&&(n=e.xy.scale_height,e.xy.scale_height=-1),e._els.dhx_cal_header[0].style.display=t?"none":"",e.set_sizes(),t&&(e.xy.scale_height=n),e._table_view=t,!this._load_mode||!this._load())if(t){if(e._init_year_tooltip(),e._reset_year_scale(),e._load_mode&&e._load())return void(e._render_wait=!0);e.render_view_data()}else e._hideToolTip()},e._reset_year_scale=function(){this._cols=[],this._colsS={};var t=[],n=this._els.dhx_cal_data[0],i=this.config;n.scrollTop=0,n.innerHTML="";var r=Math.floor(parseInt(n.style.width)/i.year_x),o=Math.floor((parseInt(n.style.height)-e.xy.year_top)/i.year_y);o<190&&(o=190,r=Math.floor((parseInt(n.style.width)-e.xy.scroll_width)/i.year_x));var a=r-11,s=0,l=document.createElement("div"),d=this.date.week_start(e._currentDate());this._process_ignores(d,7,"day",1);for(var u=7-(this._ignores_detected||0),c=0,h=0;h<7;h++)this._ignores&&this._ignores[h]||(this._cols[h]=Math.floor(a/(u-c)),this._render_x_header(h,s,d,l),a-=this._cols[h],s+=this._cols[h],c++),d=this.date.add(d,1,"day");l.lastChild.className+=" dhx_scale_bar_last";for(h=0;h<l.childNodes.length;h++)this._waiAria.yearHeadCell(l.childNodes[h]);var f=this.date[this._mode+"_start"](this.date.copy(this._date)),p=f,m=null;for(h=0;h<i.year_y;h++)for(var g=0;g<i.year_x;g++){(m=document.createElement("div")).className="dhx_year_box",m.style.cssText="position:absolute;",m.setAttribute("date",this._helpers.formatDate(f)),m.innerHTML="<div class='dhx_year_month'></div><div class='dhx_year_grid'><div class='dhx_year_week'>"+l.innerHTML+"</div><div class='dhx_year_body'></div></div>";var _=m.querySelector(".dhx_year_month"),v=m.querySelector(".dhx_year_grid"),b=m.querySelector(".dhx_year_week"),y=m.querySelector(".dhx_year_body"),x=e.uid();this._waiAria.yearHeader(_,x),this._waiAria.yearGrid(v,x),_.innerHTML=this.templates.year_month(f);for(var w=this.date.week_start(f),S=(this._reset_month_scale(y,f,w,6),y.querySelectorAll("td")),N=0;N<S.length;N++)this._waiAria.yearDayCell(S[N]);n.appendChild(m),b.style.height=b.childNodes[0].offsetHeight+"px";var E=Math.round((o-190)/2);m.style.marginTop=E+"px",this.set_xy(m,r-10,o-E-10,r*g+5,o*h+5+e.xy.year_top),t[h*i.year_x+g]=(f.getDay()-(this.config.start_on_monday?1:0)+7)%7,f=this.date.add(f,1,"month")}var C=this._getNavDateElement();C&&(C.innerHTML=this.templates[this._mode+"_date"](p,f,this._mode)),this.week_starts=t,t._month=p.getMonth(),this._min_date=p,this._max_date=f};var s=e.getActionData;e.getActionData=function(n){if(!t())return s.apply(e,arguments);var i=n?n.target:event.srcElement,r=e._get_year_month_date(i),o=e._get_year_month_cell(i),a=e._get_year_day_indexes(o);return a&&r?(r=e.date.add(r,a.week,"week"),r=e.date.add(r,a.day,"day")):r=null,{date:r,section:null}},e._get_year_day_indexes=function(t){var n=e._get_year_el_node(t,this._locate_year_month_table);if(!n)return null;for(var i=0,r=0,o=(i=0,n.rows.length);i<o;i++){for(var a=n.rows[i].getElementsByTagName("td"),s=(r=0,a.length);r<s&&a[r]!=t;r++);if(r<s)break}return i<o?{day:r,week:i}:null},e._get_year_month_date=function(t){if(!(t=e._get_year_el_node(t,e._locate_year_month_root)))return null;var n=t.getAttribute("date");return n?e.date.week_start(e.date.month_start(o(n))):null},e._locate_year_month_day=function(t){return-1!=e._getClassName(t).indexOf("dhx_year_event")&&t.hasAttribute&&t.hasAttribute("date")};var l=e._locate_event;e._locate_event=function(t){var n=l.apply(e,arguments);if(!n){var i=e._get_year_el_node(t,e._locate_year_month_day);if(!i||!i.hasAttribute("date"))return null;var r=o(i.getAttribute("date")),a=e.getEvents(r,e.date.add(r,1,"day"));if(!a.length)return null;n=a[0].id}return n},e._locate_year_month_cell=function(e){return"td"==e.nodeName.toLowerCase()},e._locate_year_month_table=function(e){return"table"==e.nodeName.toLowerCase()},e._locate_year_month_root=function(e){return e.hasAttribute&&e.hasAttribute("date")},e._get_year_month_cell=function(e){return this._get_year_el_node(e,this._locate_year_month_cell)},e._get_year_month_table=function(e){return this._get_year_el_node(e,this._locate_year_month_table)},e._get_year_month_root=function(e){return this._get_year_el_node(this._get_year_month_table(e),this._locate_year_month_root)},e._get_year_el_node=function(e,t){for(;e&&!t(e);)e=e.parentNode;return e}}()}),function(){function e(e,t){for(var n in t)e[n]||(e[n]=t[n]);return e}function t(e,t){var n={};return(e=t._els[e])&&e[0]?(n.x=e[0].scrollWidth,n.y=e[0].scrollHeight):(n.x=0,n.y=0),n}function n(n){function i(){var e=n.getState().mode;return n.matrix&&n.matrix[e]?n.matrix[e]:null}n.exportToPDF=function(t){(t=e(t||{},{name:"calendar.pdf",format:"A4",orientation:"landscape",dpi:96,zoom:1,rtl:n.config.rtl})).html=this._export_html(t),t.mode=this.getState().mode,this._send_to_export(t,"pdf")},n.exportToPNG=function(t){(t=e(t||{},{name:"calendar.png",format:"A4",orientation:"landscape",dpi:96,zoom:1,rtl:n.config.rtl})).html=this._export_html(t),t.mode=this.getState().mode,this._send_to_export(t,"png")},n.exportToICal=function(t){t=e(t||{},{name:"calendar.ical",data:this._serialize_plain(null,t)}),this._send_to_export(t,"ical")},n.exportToExcel=function(t){t=e(t||{},{name:"calendar.xlsx",title:"Events",data:this._serialize_plain(this.templates.xml_format,t),columns:this._serialize_columns()}),this._send_to_export(t,"excel")},n._plain_export_copy=function(e,t){var n={};for(var i in e)n[i]=e[i];return n.start_date=t(n.start_date),n.end_date=t(n.end_date),n.$text=this.templates.event_text(e.start_date,e.end_date,e),n},n._serialize_plain=function(e,t){var i;e=e||n.date.date_to_str("%Y%m%dT%H%i%s",!0),i=t&&t.start&&t.end?n.getEvents(t.start,t.end):n.getEvents();for(var r=[],o=0;o<i.length;o++)r[o]=this._plain_export_copy(i[o],e);return r},n._serialize_columns=function(){return[{id:"start_date",header:"Start Date",width:30},{id:"end_date",header:"End Date",width:30},{id:"$text",header:"Text",width:100}]},n._send_to_export=function(e,t){e.version||(e.version=n.version),e.skin||(e.skin=n.skin);var i=this._create_hidden_form();i.firstChild.action=e.server||"https://export.dhtmlx.com/scheduler",i.firstChild.childNodes[0].value=JSON.stringify(e),i.firstChild.childNodes[1].value=t,i.firstChild.submit()},n._create_hidden_form=function(){if(!this._hidden_export_form){var e=this._hidden_export_form=document.createElement("div");e.style.display="none",e.innerHTML="<form method='POST' target='_blank'><input type='text' name='data'><input type='hidden' name='type' value=''></form>",document.body.appendChild(e)}return this._hidden_export_form},n._get_export_size=function(e,n,i,r,o,a,s){r=parseInt(r)/25.4||4;var l={A5:{x:148,y:210},A4:{x:210,y:297},A3:{x:297,y:420},A2:{x:420,y:594},A1:{x:594,y:841},A0:{x:841,y:1189}},d=t("dhx_cal_data",this).x,u={y:t("dhx_cal_data",this).y+t("dhx_cal_header",this).y+t("dhx_multi_day",this).y};return u.x="full"===e?d:Math.floor(("landscape"===n?l[e].y:l[e].x)*r),s&&(u.x*=parseFloat(s.x)||1,u.y*=parseFloat(s.y)||1),u},n._export_html=function(e){var t,r,o,a=(t=void 0,r=void 0,(o=i())&&(r=o.scrollable,t=o.smart_rendering),{nav_height:n.xy.nav_height,scroll_width:n.xy.scroll_width,style_width:n._obj.style.width,style_height:n._obj.style.height,timeline_scrollable:r,timeline_smart_rendering:t}),s=n._get_export_size(e.format,e.orientation,e.zoom,e.dpi,e.header,e.footer,e.scales),l="";try{!function(e,t){n._obj.style.width=e.x+"px",n._obj.style.height=e.y+"px",n.xy.nav_height=0,n.xy.scroll_width=0;var r=i();(t.timeline_scrollable||t.timeline_smart_rendering)&&(r.scrollable=!1,r.smart_rendering=!1)}(s,a),n.setCurrentView(),l=n._obj.innerHTML}catch(e){console.error(e)}finally{!function(e){n.xy.scroll_width=e.scroll_width,n.xy.nav_height=e.nav_height,n._obj.style.width=e.style_width,n._obj.style.height=e.style_height;var t=i();(e.timeline_scrollable||e.timeline_smart_rendering)&&(t.scrollable=e.timeline_scrollable,t.smart_rendering=e.timeline_smart_rendering)}(a),n.setCurrentView()}return l}}n(scheduler),window.Scheduler&&Scheduler.plugin&&Scheduler.plugin(n)}();
/*

 This is a generated file. DO NOT EDIT.

 Copyright (C) 2010-2015 KO GmbH <copyright@kogmbh.com>

 @licstart
 The code in this file is free software: you can redistribute it and/or modify it
 under the terms of the GNU Affero General Public License (GNU AGPL)
 as published by the Free Software Foundation, either version 3 of
 the License, or (at your option) any later version.

 The code in this file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of
 MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 GNU Affero General Public License for more details.

 You should have received a copy of the GNU Affero General Public License
 along with WebODF.  If not, see <http://www.gnu.org/licenses/>.

 As additional permission under GNU AGPL version 3 section 7, you
 may distribute UNMODIFIED VERSIONS OF THIS file without the copy of the GNU AGPL normally
 required by section 4, provided you include this license notice and a URL
 through which recipients can access the Corresponding Source.

 As a special exception to the AGPL, any HTML file which merely makes function
 calls to this code, and for that purpose includes it in unmodified form by reference or in-line shall be
 deemed a separate work for copyright law purposes. In addition, the copyright
 holders of this code give you permission to combine this code with free
 software libraries that are released under the GNU LGPL. You may copy and
 distribute such a system following the terms of the GNU AGPL for this code
 and the LGPL for the libraries. If you modify this code, you may extend this
 exception to your version of the code, but you are not obligated to do so.
 If you do not wish to do so, delete this exception statement from your
 version.

 This license applies to this entire compilation.
 @licend

 @source: http://www.webodf.org/
 @source: https://github.com/kogmbh/WebODF/
*/
var webodf_version="0.5.9";function Runtime(){}Runtime.prototype.getVariable=function(e){},Runtime.prototype.toJson=function(e){},Runtime.prototype.fromJson=function(e){},Runtime.prototype.byteArrayFromString=function(e,t){},Runtime.prototype.byteArrayToString=function(e,t){},Runtime.prototype.read=function(e,t,n,i){},Runtime.prototype.readFile=function(e,t,n){},Runtime.prototype.readFileSync=function(e,t){},Runtime.prototype.loadXML=function(e,t){},Runtime.prototype.writeFile=function(e,t,n){},Runtime.prototype.deleteFile=function(e,t){},Runtime.prototype.log=function(e,t){},Runtime.prototype.setTimeout=function(e,t){},Runtime.prototype.clearTimeout=function(e){},Runtime.prototype.libraryPaths=function(){},Runtime.prototype.currentDirectory=function(){},Runtime.prototype.setCurrentDirectory=function(e){},Runtime.prototype.type=function(){},Runtime.prototype.getDOMImplementation=function(){},Runtime.prototype.parseXML=function(e){},Runtime.prototype.exit=function(e){},Runtime.prototype.getWindow=function(){},Runtime.prototype.requestAnimationFrame=function(e){},Runtime.prototype.cancelAnimationFrame=function(e){},Runtime.prototype.assert=function(e,t){};var IS_COMPILED_CODE=!0;function BrowserRuntime(){function e(e){var t,n,i=e.length,r=0;for(t=0;t<i;t+=1)r+=1+(128<(n=e.charCodeAt(t)))+(2048<n),55040<n&&57344>n&&(r+=1,t+=1);return r}function t(e,t,n){var i,r,o=e.length;for(t=new Uint8Array(new ArrayBuffer(t)),n?(t[0]=239,t[1]=187,t[2]=191,r=3):r=0,n=0;n<o;n+=1)128>(i=e.charCodeAt(n))?(t[r]=i,r+=1):2048>i?(t[r]=192|i>>>6,t[r+1]=128|63&i,r+=2):55040>=i||57344<=i?(t[r]=224|i>>>12&15,t[r+1]=128|i>>>6&63,t[r+2]=128|63&i,r+=3):(n+=1,i=65536+(i-55296<<10|e.charCodeAt(n)-56320),t[r]=240|i>>>18&7,t[r+1]=128|i>>>12&63,t[r+2]=128|i>>>6&63,t[r+3]=128|63&i,r+=4);return t}function n(e){var t,n=e.length,i=new Uint8Array(new ArrayBuffer(n));for(t=0;t<n;t+=1)i[t]=255&e.charCodeAt(t);return i}function i(e,t){var n;void 0!==t?n=e:t=e,console.log(t),s.enableAlerts&&"alert"===n&&alert(t)}function r(i,r,o){if(0!==o.status||o.responseText)if(200===o.status||0===o.status){if(o.response&&"string"!=typeof o.response)"binary"===r?(o=o.response,o=new Uint8Array(o)):o=String(o.response);else if("binary"===r)if(null!==o.responseBody&&"undefined"!==String(typeof VBArray)){var a=(o=new VBArray(o.responseBody).toArray()).length;for(r=new Uint8Array(new ArrayBuffer(a)),i=0;i<a;i+=1)r[i]=o[i];o=r}else{if((i=o.getResponseHeader("Content-Length"))&&(i=parseInt(i,10)),i&&i!==o.responseText.length)e:{r=!1;var s=e(a=o.responseText);if("number"==typeof i){if(i!==s&&i!==s+3){a=void 0;break e}r=s+3===i,s=i}a=t(a,s,r)}void 0===a&&(a=n(o.responseText)),o=a}else o=o.responseText;o={err:null,data:o}}else o={err:o.responseText||o.statusText,data:null};else o={err:"File "+i+" is empty.",data:null};return o}function o(e,t,n){var i=new XMLHttpRequest;return i.open("GET",e,n),i.overrideMimeType&&("binary"!==t?i.overrideMimeType("text/plain; charset="+t):i.overrideMimeType("text/plain; charset=x-user-defined")),i}function a(e,t,n){var i=o(e,t,!0);i.onreadystatechange=function(){var o;4===i.readyState&&(o=r(e,t,i),n(o.err,o.data))};try{i.send(null)}catch(e){n(e.message,null)}}var s=this;this.byteArrayFromString=function(i,r){var o;return"utf8"===r?o=t(i,e(i),!1):("binary"!==r&&s.log("unknown encoding: "+r),o=n(i)),o},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.readFile=a,this.read=function(e,t,n,i){a(e,"binary",function(e,r){var o=null;if(r){if("string"==typeof r)throw"This should not happen.";o=r.subarray(t,t+n)}i(e,o)})},this.readFileSync=function(e,t){var n,i=o(e,t,!1);try{if(i.send(null),(n=r(e,t,i)).err)throw n.err;if(null===n.data)throw"No data read from "+e+"."}catch(e){throw e}return n.data},this.writeFile=function(e,t,n){var i,r=new XMLHttpRequest;r.open("PUT",e,!0),r.onreadystatechange=function(){4===r.readyState&&(0!==r.status||r.responseText?200<=r.status&&300>r.status||0===r.status?n(null):n("Status "+String(r.status)+": "+r.responseText||r.statusText):n("File "+e+" is empty."))},i=t.buffer&&!r.sendAsBinary?t.buffer:s.byteArrayToString(t,"binary");try{r.sendAsBinary?r.sendAsBinary(i):r.send(i)}catch(e){s.log("HUH? "+e+" "+t),n(e.message)}},this.deleteFile=function(e,t){var n=new XMLHttpRequest;n.open("DELETE",e,!0),n.onreadystatechange=function(){4===n.readyState&&(200>n.status&&300<=n.status?t(n.responseText):t(null))},n.send(null)},this.loadXML=function(e,t){var n=new XMLHttpRequest;n.open("GET",e,!0),n.overrideMimeType&&n.overrideMimeType("text/xml"),n.onreadystatechange=function(){4===n.readyState&&(0!==n.status||n.responseText?200===n.status||0===n.status?t(null,n.responseXML):t(n.responseText,null):t("File "+e+" is empty.",null))};try{n.send(null)}catch(e){t(e.message,null)}},this.log=i,this.enableAlerts=!0,this.assert=Runtime.assert,this.setTimeout=function(e,t){return setTimeout(function(){e()},t)},this.clearTimeout=function(e){clearTimeout(e)},this.libraryPaths=function(){return["lib"]},this.setCurrentDirectory=function(){},this.currentDirectory=function(){return""},this.type=function(){return"BrowserRuntime"},this.getDOMImplementation=function(){return window.document.implementation},this.parseXML=function(e){return(new DOMParser).parseFromString(e,"text/xml")},this.exit=function(e){i("Calling exit with code "+String(e)+", but exit() is not implemented.")},this.getWindow=function(){return window},this.requestAnimationFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.msRequestAnimationFrame;return t?(t.bind(window),t(e)):setTimeout(e,15)},this.cancelAnimationFrame=function(e){var t=window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.msCancelAnimationFrame;t?(t.bind(window),t(e)):clearTimeout(e)}}function NodeJSRuntime(){function e(e){var t,n=e.length,i=new Uint8Array(new ArrayBuffer(n));for(t=0;t<n;t+=1)i[t]=e[t];return i}function t(t,n,i){function r(n,r){return n?i(n,null):r?"string"==typeof r?i(n,r):void i(n,e(r)):i("No data for "+t+".",null)}t=a.resolve(s,t),"binary"!==n?o.readFile(t,n,r):o.readFile(t,null,r)}var n,i,r=this,o=require("fs"),a=require("path"),s="";this.byteArrayFromString=function(e,t){var n,i=new Buffer(e,t),r=i.length,o=new Uint8Array(new ArrayBuffer(r));for(n=0;n<r;n+=1)o[n]=i[n];return o},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.readFile=t,this.loadXML=function(e,n){t(e,"utf-8",function(t,i){return t?n(t,null):i?void n(null,r.parseXML(i)):n("No data for "+e+".",null)})},this.writeFile=function(e,t,n){t=new Buffer(t),e=a.resolve(s,e),o.writeFile(e,t,"binary",function(e){n(e||null)})},this.deleteFile=function(e,t){e=a.resolve(s,e),o.unlink(e,t)},this.read=function(t,n,i,r){t=a.resolve(s,t),o.open(t,"r+",666,function(t,a){if(t)r(t,null);else{var s=new Buffer(i);o.read(a,s,0,i,n,function(t){o.close(a),r(t,e(s))})}})},this.readFileSync=function(t,n){var i;if(null===(i=o.readFileSync(t,"binary"===n?null:n)))throw"File "+t+" could not be read.";return"binary"===n&&(i=e(i)),i},this.log=function(e,t){var n;void 0!==t?n=e:t=e,"alert"===n&&process.stderr.write("\n!!!!! ALERT !!!!!\n"),process.stderr.write(t+"\n"),"alert"===n&&process.stderr.write("!!!!! ALERT !!!!!\n")},this.assert=Runtime.assert,this.setTimeout=function(e,t){return setTimeout(function(){e()},t)},this.clearTimeout=function(e){clearTimeout(e)},this.libraryPaths=function(){return[__dirname]},this.setCurrentDirectory=function(e){s=e},this.currentDirectory=function(){return s},this.type=function(){return"NodeJSRuntime"},this.getDOMImplementation=function(){return i},this.parseXML=function(e){return n.parseFromString(e,"text/xml")},this.exit=process.exit,this.getWindow=function(){return null},this.requestAnimationFrame=function(e){return setTimeout(e,15)},this.cancelAnimationFrame=function(e){clearTimeout(e)},n=new(require("xmldom").DOMParser),i=r.parseXML("<a/>").implementation}function RhinoRuntime(){var e,t,n=this,i={},r=i.javax.xml.parsers.DocumentBuilderFactory.newInstance(),o="";r.setValidating(!1),r.setNamespaceAware(!0),r.setExpandEntityReferences(!1),r.setSchema(null),t=i.org.xml.sax.EntityResolver({resolveEntity:function(e,t){var n=new i.java.io.FileReader(t);return new i.org.xml.sax.InputSource(n)}}),(e=r.newDocumentBuilder()).setEntityResolver(t),this.byteArrayFromString=function(e,t){var n,i=e.length,r=new Uint8Array(new ArrayBuffer(i));for(n=0;n<i;n+=1)r[n]=255&e.charCodeAt(n);return r},this.byteArrayToString=Runtime.byteArrayToString,this.getVariable=Runtime.getVariable,this.fromJson=Runtime.fromJson,this.toJson=Runtime.toJson,this.loadXML=function(t,n){var r=new i.java.io.File(t),o=null;try{o=e.parse(r)}catch(e){return print(e),n(e,null)}n(null,o)},this.readFile=function(e,t,r){o&&(e=o+"/"+e);var a="binary"===t?"latin1":t;new i.java.io.File(e).isFile()?((e=readFile(e,a))&&"binary"===t&&(e=n.byteArrayFromString(e,"binary")),r(null,e)):r(e+" is not a file.",null)},this.writeFile=function(e,t,n){o&&(e=o+"/"+e),e=new i.java.io.FileOutputStream(e);var r,a=t.length;for(r=0;r<a;r+=1)e.write(t[r]);e.close(),n(null)},this.deleteFile=function(e,t){o&&(e=o+"/"+e);var n=new i.java.io.File(e),r=e+Math.random();r=new i.java.io.File(r);n.rename(r)?(r.deleteOnExit(),t(null)):t("Could not delete "+e)},this.read=function(e,t,n,r){var a;o&&(e=o+"/"+e),a=e;var s="binary";new i.java.io.File(a).isFile()?("binary"===s&&(s="latin1"),a=readFile(a,s)):a=null,a?r(null,this.byteArrayFromString(a.substring(t,t+n),"binary")):r("Cannot read "+e,null)},this.readFileSync=function(e,t){if(!t)return"";var n=readFile(e,t);if(null===n)throw"File could not be read.";return n},this.log=function(e,t){var n;void 0!==t?n=e:t=e,"alert"===n&&print("\n!!!!! ALERT !!!!!"),print(t),"alert"===n&&print("!!!!! ALERT !!!!!")},this.assert=Runtime.assert,this.setTimeout=function(e){return e(),0},this.clearTimeout=function(){},this.libraryPaths=function(){return["lib"]},this.setCurrentDirectory=function(e){o=e},this.currentDirectory=function(){return o},this.type=function(){return"RhinoRuntime"},this.getDOMImplementation=function(){return e.getDOMImplementation()},this.parseXML=function(t){return t=new i.java.io.StringReader(t),t=new i.org.xml.sax.InputSource(t),e.parse(t)},this.exit=quit,this.getWindow=function(){return null},this.requestAnimationFrame=function(e){return e(),0},this.cancelAnimationFrame=function(){}}Runtime.byteArrayToString=function(e,t){var n;return"utf8"===t?n=function(e){var t,n,i,r,o,a="",s=e.length,l=[];for(t=3<=s&&239===e[0]&&187===e[1]&&191===e[2]?3:0;t<s;t+=1)128>(n=e[t])?l.push(n):(i=e[t+=1],194<=n&&224>n?l.push((31&n)<<6|63&i):(r=e[t+=1],224<=n&&240>n?l.push((15&n)<<12|(63&i)<<6|63&r):(o=e[t+=1],240<=n&&245>n&&(n=(7&n)<<18|(63&i)<<12|(63&r)<<6|63&o,n-=65536,l.push(55296+(n>>10),56320+(1023&n)))))),1e3<=l.length&&(a+=String.fromCharCode.apply(null,l),l.length=0);return a+String.fromCharCode.apply(null,l)}(e):("binary"!==t&&this.log("Unsupported encoding: "+t),n=function(e){var t,n="",i=e.length;for(t=0;t<i;t+=1)n+=String.fromCharCode(255&e[t]);return n}(e)),n},Runtime.getVariable=function(g){try{return eval(g)}catch(e){}},Runtime.toJson=function(e){return JSON.stringify(e)},Runtime.fromJson=function(e){return JSON.parse(e)},Runtime.getFunctionName=function(e){return void 0===e.name?(e=/function\s+(\w+)/.exec(e))&&e[1]:e.name},Runtime.assert=function(e,t){if(!e)throw this.log("alert","ASSERTION FAILED:\n"+t),Error(t)},Runtime.create=function(){return"undefined"!==String(typeof window)?new BrowserRuntime:"undefined"!==String(typeof require)?new NodeJSRuntime:new RhinoRuntime};var runtime=Runtime.create(),core={},gui={},xmldom={},odf={},ops={},webodf={};function makeBase64(){function e(e){var t,n=e.length,i=new Uint8Array(new ArrayBuffer(n));for(t=0;t<n;t+=1)i[t]=255&e.charCodeAt(t);return i}function t(e){var t,n,i="",r=e.length-2;for(n=0;n<r;n+=3)i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t=e[n]<<16|e[n+1]<<8|e[n+2])>>>18],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>12&63],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>6&63],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t];return n===r+1?(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t=e[n]<<4)>>>6],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t],i+="=="):n===r&&(i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[(t=e[n]<<10|e[n+1]<<2)>>>12],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[t>>>6&63],i+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"[63&t],i+="="),i}function n(e){var t,n,i=(e=e.replace(/[^A-Za-z0-9+\/]+/g,"")).length,r=new Uint8Array(new ArrayBuffer(3*i)),o=e.length%4,a=0;for(t=0;t<i;t+=4)n=(v[e.charAt(t)]||0)<<18|(v[e.charAt(t+1)]||0)<<12|(v[e.charAt(t+2)]||0)<<6|(v[e.charAt(t+3)]||0),r[a]=n>>16,r[a+1]=n>>8&255,r[a+2]=255&n,a+=3;return i=3*i-[0,0,2,1][o],r.subarray(0,i)}function i(e){var t,n,i=e.length,r=0,o=new Uint8Array(new ArrayBuffer(3*i));for(t=0;t<i;t+=1)128>(n=e[t])?o[r++]=n:(2048>n?o[r++]=192|n>>>6:(o[r++]=224|n>>>12&15,o[r++]=128|n>>>6&63),o[r++]=128|63&n);return o.subarray(0,r)}function r(e){var t,n,i,r,o=e.length,a=new Uint8Array(new ArrayBuffer(o)),s=0;for(t=0;t<o;t+=1)128>(n=e[t])?a[s++]=n:(i=e[t+=1],224>n?a[s++]=(31&n)<<6|63&i:(r=e[t+=1],a[s++]=(15&n)<<12|(63&i)<<6|63&r));return a.subarray(0,s)}function o(n){return t(e(n))}function a(e){return String.fromCharCode.apply(String,n(e))}function s(t){return r(e(t))}function l(e){e=r(e);for(var t="",n=0;n<e.length;)t+=String.fromCharCode.apply(String,e.subarray(n,n+45e3)),n+=45e3;return t}function d(e,t,n){var i,r,o,a="";for(o=t;o<n;o+=1)128>(t=255&e.charCodeAt(o))?a+=String.fromCharCode(t):(o+=1,i=255&e.charCodeAt(o),224>t?a+=String.fromCharCode((31&t)<<6|63&i):(o+=1,r=255&e.charCodeAt(o),a+=String.fromCharCode((15&t)<<12|(63&i)<<6|63&r)));return a}function u(e,t){var n="",i=0;1e5>e.length?t(d(e,0,e.length),!0):("string"!=typeof e&&(e=e.slice()),function r(){var o=i+1e5;o>e.length&&(o=e.length),n+=d(e,i,o),o=(i=o)===e.length,t(n,o)&&!o&&runtime.setTimeout(r,0)}())}function c(t){return i(e(t))}function h(e){return String.fromCharCode.apply(String,i(e))}function f(t){return String.fromCharCode.apply(String,i(e(t)))}var p,m,g,_,v=function(e){var t,n,i={};for(t=0,n=e.length;t<n;t+=1)i[e.charAt(t)]=t;return i}("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"),b=runtime.getWindow();return b&&b.btoa?(g=b.btoa,p=function(e){return g(f(e))}):(g=o,p=function(e){return t(c(e))}),b&&b.atob?(_=b.atob,m=function(e){return d(e=_(e),0,e.length)}):(_=a,m=function(e){return l(n(e))}),core.Base64=function(){return this.convertByteArrayToBase64=this.convertUTF8ArrayToBase64=t,this.convertBase64ToByteArray=this.convertBase64ToUTF8Array=n,this.convertUTF16ArrayToByteArray=this.convertUTF16ArrayToUTF8Array=i,this.convertByteArrayToUTF16Array=this.convertUTF8ArrayToUTF16Array=r,this.convertUTF8StringToBase64=o,this.convertBase64ToUTF8String=a,this.convertUTF8StringToUTF16Array=s,this.convertByteArrayToUTF16String=this.convertUTF8ArrayToUTF16String=l,this.convertUTF8StringToUTF16String=u,this.convertUTF16StringToByteArray=this.convertUTF16StringToUTF8Array=c,this.convertUTF16ArrayToUTF8String=h,this.convertUTF16StringToUTF8String=f,this.convertUTF16StringToBase64=p,this.convertBase64ToUTF16String=m,this.fromBase64=a,this.toBase64=o,this.atob=_,this.btoa=g,this.utob=f,this.btou=u,this.encode=p,this.encodeURI=function(e){return p(e).replace(/[+\/]/g,function(e){return"+"===e?"-":"_"}).replace(/\\=+$/,"")},this.decode=function(e){return m(e.replace(/[\-_]/g,function(e){return"-"===e?"+":"/"}))},this},core.Base64}function createXPathSingleton(){function e(e,t,n){return-1!==e&&(e<t||-1===t)&&(e<n||-1===n)}function t(t){for(var n,i=[],r=0,o=t.length;r<o;){var a=t,s=o,l=i,u="",c=[],h=a.indexOf("[",r),f=a.indexOf("/",r),p=a.indexOf("=",r);if(e(f,h,p)?(u=a.substring(r,f),r=f+1):e(h,f,p)?(u=a.substring(r,h),r=d(a,h,c)):e(p,f,h)?(u=a.substring(r,p),r=p):(u=a.substring(r,s),r=s),l.push({location:u,predicates:c}),r<o&&"="===t[r]){if(2<(n=t.substring(r+1,o)).length&&("'"===n[0]||'"'===n[0]))n=n.slice(1,n.length-1);else try{n=parseInt(n,10)}catch(e){}r=o}}return{steps:i,value:n}}function n(){var e=null,t=!1;this.setNode=function(t){e=t},this.reset=function(){t=!1},this.next=function(){var n=t?null:e;return t=!0,n}}function i(e,t,n){this.reset=function(){e.reset()},this.next=function(){for(var i=e.next();i&&(i.nodeType===Node.ELEMENT_NODE&&(i=i.getAttributeNodeNS(t,n)),!i);)i=e.next();return i}}function r(e,t){var n=e.next(),i=null;this.reset=function(){e.reset(),n=e.next(),i=null},this.next=function(){for(;n;){if(i)if(t&&i.firstChild)i=i.firstChild;else{for(;!i.nextSibling&&i!==n;)i=i.parentNode;i===n?n=e.next():i=i.nextSibling}else do{(i=n.firstChild)||(n=e.next())}while(n&&!i);if(i&&i.nodeType===Node.ELEMENT_NODE)return i}return null}}function o(e,t){this.reset=function(){e.reset()},this.next=function(){for(var n=e.next();n&&!t(n);)n=e.next();return n}}function a(e,t,n){var i=n((t=t.split(":",2))[0]),r=t[1];return new o(e,function(e){return e.localName===r&&e.namespaceURI===i})}function s(e,t,i){var r=new n,a=l(r,t,i),s=t.value;return new o(e,void 0===s?function(e){return r.setNode(e),a.reset(),null!==a.next()}:function(e){return r.setNode(e),a.reset(),!!(e=a.next())&&e.nodeValue===s})}var l,d;return d=function(e,n,i){for(var r=n,o=e.length,a=0;r<o;)"]"===e[r]?0>=--a&&i.push(t(e.substring(n,r))):"["===e[r]&&(0>=a&&(n=r+1),a+=1),r+=1;return r},l=function(e,t,n){var o,l,d,u;for(o=0;o<t.steps.length;o+=1){if(""===(l=(d=t.steps[o]).location))e=new r(e,!1);else if("@"===l[0]){if(!(u=n((l=l.substr(1).split(":",2))[0])))throw"No namespace associated with the prefix "+l[0];e=new i(e,u,l[1])}else"."!==l&&(e=new r(e,!1),-1!==l.indexOf(":")&&(e=a(e,l,n)));for(l=0;l<d.predicates.length;l+=1)e=s(e,u=d.predicates[l],n)}return e},{getODFElementsWithXPath:function(e,i,r){var o=e.ownerDocument,a=[],s=null;if(o&&"function"==typeof o.evaluate)for(s=(r=o.evaluate(i,e,r,XPathResult.UNORDERED_NODE_ITERATOR_TYPE,null)).iterateNext();null!==s;)s.nodeType===Node.ELEMENT_NODE&&a.push(s),s=r.iterateNext();else{for((a=new n).setNode(e),e=t(i),a=l(a,e,r),e=[],r=a.next();r;)e.push(r),r=a.next();a=e}return a}}}function RootFilter(e,t,n){var i=core.PositionFilter.FilterResult.FILTER_ACCEPT,r=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(o){var a;return o=o.container(),a="string"==typeof e?t[e].getNode():e,n(o)===n(a)?i:r}}webodf.Version="undefined"!==String(typeof webodf_version)?webodf_version:"From Source",function(){function g(e,t,n){var i,r,o=e+"/manifest.json";runtime.log("Loading manifest: "+o);try{i=runtime.readFileSync(o,"utf-8")}catch(e){if(!n)throw console.log(String(e)),e;return void runtime.log("No loadable manifest found.")}for(r in n=JSON.parse(i))n.hasOwnProperty(r)&&(t[r]={dir:e,deps:n[r]})}function k(e,t,n){var i=[],r={},o={};return e.forEach(function e(a){if(!o[a]&&!n(a)){if(r[a])throw"Circular dependency detected for "+a+".";if(r[a]=!0,!t[a])throw"Missing dependency information for class "+a+".";var s,l=t[a],d=l.deps,u=d.length;for(s=0;s<u;s+=1)e(d[s]);r[a]=!1,o[a]=!0,i.push(l.dir+"/"+a.replace(".","/")+".js")}}),i}function d(e,t){return t+"\n//# sourceURL="+e}function b(b){var f,e;for(f=0;f<b.length;f+=1)e=runtime.readFileSync(b[f],"utf-8"),e=d(b[f],e),eval(e)}function f(e){e=e.split(".");var t,n=p,i=e.length;for(t=0;t<i;t+=1){if(!n.hasOwnProperty(e[t]))return!1;n=n[e[t]]}return!0}var n,p={core:core,gui:gui,xmldom:xmldom,odf:odf,ops:ops};runtime.loadClasses=function(e,t){if(IS_COMPILED_CODE||0===e.length)return t&&t();var i;if(!(i=n)){i=[];var r,o=runtime.libraryPaths();for(runtime.currentDirectory()&&-1===o.indexOf(runtime.currentDirectory())&&g(runtime.currentDirectory(),i,!0),r=0;r<o.length;r+=1)g(o[r],i)}if(0===(e=k(e,n=i,f)).length)return t&&t();if("BrowserRuntime"===runtime.type()&&t){var a,s;for(i=e,o=document.currentScript||document.documentElement.lastChild,r=document.createDocumentFragment(),s=0;s<i.length;s+=1)(a=document.createElement("script")).type="text/javascript",a.charset="utf-8",a.async=!1,a.setAttribute("src",i[s]),r.appendChild(a);t&&(a.onload=t),o.parentNode.insertBefore(r,o)}else b(e),t&&t()},runtime.loadClass=function(e,t){runtime.loadClasses([e],t)}}(),function(){var e=function(e){return e};runtime.getTranslator=function(){return e},runtime.setTranslator=function(t){e=t},runtime.tr=function(t){var n=e(t);return n&&"string"===String(typeof n)?n:t}}(),function(g){function k(d){if(d.length){var b=d[0];runtime.readFile(b,"utf8",function(f,n){function g(){var b;(b=eval(k))&&runtime.exit(b)}var r="",r=b.lastIndexOf("/"),k=n,r=-1!==r?b.substring(0,r):".";runtime.setCurrentDirectory(r),f?(runtime.log(f),runtime.exit(1)):null===k?(runtime.log("No code found for "+b),runtime.exit(1)):g.apply(null,d)})}}g=g?Array.prototype.slice.call(g):[],"NodeJSRuntime"===runtime.type()?k(process.argv.slice(2)):"RhinoRuntime"===runtime.type()?k(g):k(g.slice(1))}("undefined"!==String(typeof arguments)&&arguments),core.Async={forEach:function(e,t,n){function i(e){a!==o&&(e?(a=o,n(e)):(a+=1)===o&&n(null))}var r,o=e.length,a=0;for(r=0;r<o;r+=1)t(e[r],i)},destroyAll:function(e,t){!function n(i,r){r?t(r):i<e.length?e[i](function(e){n(i+1,e)}):t()}(0,void 0)}},core.Base64=makeBase64(),core.CSSUnits=function(){var e=this,t={in:1,cm:2.54,mm:25.4,pt:72,pc:12,px:96};this.convert=function(e,n,i){return e*t[i]/t[n]},this.convertMeasure=function(t,n){var i,r;return t&&n&&(i=parseFloat(t),r=t.replace(i.toString(),""),i=e.convert(i,r,n)),i},this.getUnits=function(e){return e.substr(e.length-2,e.length)}},function(){function e(){var e,t,i,r,o,a,s,l,d;return void 0===n&&(a=(t=(e=runtime.getWindow())&&e.document).documentElement,s=t.body,n={rangeBCRIgnoresElementBCR:!1,unscaledRangeClientRects:!1,elementBCRIgnoresBodyScroll:!1},t&&((r=t.createElement("div")).style.position="absolute",r.style.left="-99999px",r.style.transform="scale(2)",r.style["-webkit-transform"]="scale(2)",o=t.createElement("div"),r.appendChild(o),s.appendChild(r),(e=t.createRange()).selectNode(o),n.rangeBCRIgnoresElementBCR=0===e.getClientRects().length,o.appendChild(t.createTextNode("Rect transform test")),t=o.getBoundingClientRect(),i=e.getBoundingClientRect(),n.unscaledRangeClientRects=2<Math.abs(t.height-i.height),r.style.transform="",r.style["-webkit-transform"]="",t=a.style.overflow,i=s.style.overflow,l=s.style.height,d=s.scrollTop,a.style.overflow="visible",s.style.overflow="visible",s.style.height="200%",s.scrollTop=s.scrollHeight,n.elementBCRIgnoresBodyScroll=e.getBoundingClientRect().top!==o.getBoundingClientRect().top,s.scrollTop=d,s.style.height=l,s.style.overflow=i,a.style.overflow=t,e.detach(),s.removeChild(r),e=Object.keys(n).map(function(e){return e+":"+String(n[e])}).join(", "),runtime.log("Detected browser quirks - "+e))),n}function t(e,t,n){for(e=e?e.firstElementChild:null;e;){if(e.localName===n&&e.namespaceURI===t)return e;e=e.nextElementSibling}return null}var n;core.DomUtilsImpl=function(){function n(e,t){for(var n,i=0;e.parentNode!==t;)runtime.assert(null!==e.parentNode,"parent is null"),e=e.parentNode;for(n=t.firstChild;n!==e;)i+=1,n=n.nextSibling;return i}function i(e,t){return 0>=e.compareBoundaryPoints(Range.START_TO_START,t)&&0<=e.compareBoundaryPoints(Range.END_TO_END,t)}function r(e,t){return 0>=e.compareBoundaryPoints(Range.END_TO_START,t)&&0<=e.compareBoundaryPoints(Range.START_TO_END,t)}function o(e,t){var n=null;return e.nodeType===Node.TEXT_NODE&&(0===e.length?(e.parentNode.removeChild(e),t.nodeType===Node.TEXT_NODE&&(n=t)):(t.nodeType===Node.TEXT_NODE&&(e.appendData(t.data),t.parentNode.removeChild(t)),n=e)),n}function a(e){for(var t=e.parentNode;e.firstChild;)t.insertBefore(e.firstChild,e);return t.removeChild(e),t}function s(e,t){return e===t||Boolean(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_CONTAINED_BY)}function l(t,n){return e().unscaledRangeClientRects?t:t/n}var d=null;this.splitBoundaries=function(e){var t,i,r,o,a=[];if(e.startContainer.nodeType===Node.TEXT_NODE||e.endContainer.nodeType===Node.TEXT_NODE){if(i=e.endContainer,r=e.endContainer.nodeType!==Node.TEXT_NODE&&e.endOffset===e.endContainer.childNodes.length,(o=e.endOffset)<(t=e.endContainer).childNodes.length)for(t=t.childNodes.item(o),o=0;t.firstChild;)t=t.firstChild;else for(;t.lastChild;)o=(t=t.lastChild).nodeType===Node.TEXT_NODE?t.textContent.length:t.childNodes.length;if(t===i&&(i=null),e.setEnd(t,o),o=e.endContainer,0!==e.endOffset&&o.nodeType===Node.TEXT_NODE&&(t=o,e.endOffset!==t.length&&(a.push(t.splitText(e.endOffset)),a.push(t))),o=e.startContainer,0!==e.startOffset&&o.nodeType===Node.TEXT_NODE&&(t=o,e.startOffset!==t.length&&(o=t.splitText(e.startOffset),a.push(t),a.push(o),e.setStart(o,0))),null!==i){for(o=e.endContainer;o.parentNode&&o.parentNode!==i;)o=o.parentNode;r=r?i.childNodes.length:n(o,i),e.setEnd(i,r)}}return a},this.containsRange=i,this.rangesIntersect=r,this.rangeIntersection=function(e,t){var n;return r(e,t)&&(n=e.cloneRange(),-1===e.compareBoundaryPoints(Range.START_TO_START,t)&&n.setStart(t.startContainer,t.startOffset),1===e.compareBoundaryPoints(Range.END_TO_END,t)&&n.setEnd(t.endContainer,t.endOffset)),n},this.getNodesInRange=function(e,t,n){var i,r,o=[],a=(a=e.commonAncestorContainer).nodeType===Node.TEXT_NODE?a.parentNode:a;if(n=e.startContainer.ownerDocument.createTreeWalker(a,n,t,!1),e.endContainer.childNodes[e.endOffset-1]?(i=e.endContainer.childNodes[e.endOffset-1],r=Node.DOCUMENT_POSITION_PRECEDING|Node.DOCUMENT_POSITION_CONTAINED_BY):(i=e.endContainer,r=Node.DOCUMENT_POSITION_PRECEDING),e.startContainer.childNodes[e.startOffset])e=e.startContainer.childNodes[e.startOffset],n.currentNode=e;else{var s=e.startContainer;e.startOffset===(s.nodeType===Node.TEXT_NODE?s.length:s.childNodes.length)?(e=e.startContainer,n.currentNode=e,n.lastChild(),e=n.nextNode()):(e=e.startContainer,n.currentNode=e)}if(e){if((e=n.currentNode)!==a)for(e=e.parentNode;e&&e!==a;)t(e)===NodeFilter.FILTER_REJECT&&(n.currentNode=e),e=e.parentNode;switch(t(e=n.currentNode)){case NodeFilter.FILTER_REJECT:for(e=n.nextSibling();!e&&n.parentNode();)e=n.nextSibling();break;case NodeFilter.FILTER_SKIP:e=n.nextNode()}for(;e&&(0===(t=i.compareDocumentPosition(e))||0!=(t&r));)o.push(e),e=n.nextNode()}return o},this.normalizeTextNodes=function(e){e&&e.nextSibling&&(e=o(e,e.nextSibling)),e&&e.previousSibling&&o(e.previousSibling,e)},this.rangeContainsNode=function(e,t){var n,r=t.ownerDocument.createRange(),o=t.ownerDocument.createRange();return r.setStart(e.startContainer,e.startOffset),r.setEnd(e.endContainer,e.endOffset),o.selectNodeContents(t),n=i(r,o),r.detach(),o.detach(),n},this.mergeIntoParent=a,this.removeUnwantedNodes=function e(t,n){var i,r=t.parentNode,o=t.firstChild,s=n(t);if(s===NodeFilter.FILTER_SKIP)return r;for(;o;)i=o.nextSibling,e(o,n),o=i;return r&&s===NodeFilter.FILTER_REJECT&&a(t),r},this.removeAllChildNodes=function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},this.getElementsByTagNameNS=function(e,t,n){var i=[];for(e=e.getElementsByTagNameNS(t,n),i.length=n=e.length,t=0;t<n;t+=1)i[t]=e.item(t);return i},this.getElementsByTagName=function(e,t){var n,i,r,o=[];for(n=e.getElementsByTagName(t),o.length=r=n.length,i=0;i<r;i+=1)o[i]=n.item(i);return o},this.containsNode=function(e,t){return e===t||e.contains(t)},this.comparePoints=function(e,t,i,r){if(e===i)return r-t;var o=e.compareDocumentPosition(i);return 2===o?o=-1:4===o?o=1:10===o?o=(t=n(e,i))<r?1:-1:o=(r=n(i,e))<t?-1:1,o},this.adaptRangeDifferenceToZoomLevel=l,this.translateRect=function(e,t,n){return{top:l(e.top-t.top,n),left:l(e.left-t.left,n),bottom:l(e.bottom-t.top,n),right:l(e.right-t.left,n),width:l(e.width,n),height:l(e.height,n)}},this.getBoundingClientRect=function(t){var n,i=t.ownerDocument,r=e(),o=i.body;return!1!==r.unscaledRangeClientRects&&!r.rangeBCRIgnoresElementBCR||t.nodeType!==Node.ELEMENT_NODE?(d?n=d:d=n=i.createRange(),(r=n).selectNode(t),r.getBoundingClientRect()):(t=t.getBoundingClientRect(),r.elementBCRIgnoresBodyScroll?{left:t.left+o.scrollLeft,right:t.right+o.scrollLeft,top:t.top+o.scrollTop,bottom:t.bottom+o.scrollTop,width:t.width,height:t.height}:t)},this.mapKeyValObjOntoNode=function(e,t,n){Object.keys(t).forEach(function(i){var r=(o=i.split(":"))[1],o=n(o[0]),a=t[i];o?((r=e.getElementsByTagNameNS(o,r)[0])||(r=e.ownerDocument.createElementNS(o,i),e.appendChild(r)),r.textContent=a):runtime.log("Key ignored: "+i)})},this.removeKeyElementsFromNode=function(e,t,n){t.forEach(function(t){var i=t.split(":"),r=i[1];(i=n(i[0]))?(r=e.getElementsByTagNameNS(i,r)[0])?r.parentNode.removeChild(r):runtime.log("Element for "+t+" not found."):runtime.log("Property Name ignored: "+t)})},this.getKeyValRepresentationOfNode=function(e,t){for(var n,i={},r=e.firstElementChild;r;)(n=t(r.namespaceURI))&&(i[n+":"+r.localName]=r.textContent),r=r.nextElementSibling;return i},this.mapObjOntoNode=function e(t,n,i){Object.keys(n).forEach(function(r){var o,a=(o=r.split(":"))[1],s=i(o[0]),l=typeof(o=n[r]);"object"===l?Object.keys(o).length&&(r=s?t.getElementsByTagNameNS(s,a)[0]||t.ownerDocument.createElementNS(s,r):t.getElementsByTagName(a)[0]||t.ownerDocument.createElement(r),t.appendChild(r),e(r,o,i)):s&&(runtime.assert("number"===l||"string"===l,"attempting to map unsupported type '"+l+"' (key: "+r+")"),t.setAttributeNS(s,r,String(o)))})},this.cloneEvent=function(e){var t=Object.create(null);return Object.keys(e.constructor.prototype).forEach(function(n){t[n]=e[n]}),t.prototype=e.constructor.prototype,t},this.getDirectChild=t,function(e){var t,n;null!==(n=runtime.getWindow())&&(t=n.navigator.appVersion.toLowerCase(),n=-1===t.indexOf("chrome")&&(-1!==t.indexOf("applewebkit")||-1!==t.indexOf("safari")),t=-1!==t.indexOf("msie")||-1!==t.indexOf("trident"),n||t)&&(e.containsNode=s)}(this)},core.DomUtils=new core.DomUtilsImpl}(),core.Cursor=function(e,t){function n(e){e.parentNode&&(l.push(e.previousSibling),l.push(e.nextSibling),e.parentNode.removeChild(e))}function i(e,t,n){if(t.nodeType===Node.TEXT_NODE){runtime.assert(Boolean(t),"putCursorIntoTextNode: invalid container");var i=t.parentNode;runtime.assert(Boolean(i),"putCursorIntoTextNode: container without parent"),runtime.assert(0<=n&&n<=t.length,"putCursorIntoTextNode: offset is out of bounds"),0===n?i.insertBefore(e,t):(n!==t.length&&t.splitText(n),i.insertBefore(e,t.nextSibling))}else t.nodeType===Node.ELEMENT_NODE&&t.insertBefore(e,t.childNodes.item(n));l.push(e.previousSibling),l.push(e.nextSibling)}var r,o,a=e.createElementNS("urn:webodf:names:cursor","cursor"),s=e.createElementNS("urn:webodf:names:cursor","anchor"),l=[],d=e.createRange(),u=core.DomUtils;this.getNode=function(){return a},this.getAnchorNode=function(){return s.parentNode?s:a},this.getSelectedRange=function(){return o?(d.setStartBefore(a),d.collapse(!0)):(d.setStartAfter(r?s:a),d.setEndBefore(r?a:s)),d},this.setSelectedRange=function(e,t){d&&d!==e&&d.detach(),d=e,r=!1!==t,(o=e.collapsed)?(n(s),n(a),i(a,e.startContainer,e.startOffset)):(n(s),n(a),i(r?a:s,e.endContainer,e.endOffset),i(r?s:a,e.startContainer,e.startOffset)),l.forEach(u.normalizeTextNodes),l.length=0},this.hasForwardSelection=function(){return r},this.remove=function(){n(a),l.forEach(u.normalizeTextNodes),l.length=0},a.setAttributeNS("urn:webodf:names:cursor","memberId",t),s.setAttributeNS("urn:webodf:names:cursor","memberId",t)},core.Destroyable=function(){},core.Destroyable.prototype.destroy=function(e){},core.EventSource=function(){},core.EventSource.prototype.subscribe=function(e,t){},core.EventSource.prototype.unsubscribe=function(e,t){},core.EventNotifier=function(e){function t(e){runtime.assert(!n.hasOwnProperty(e),'Duplicated event ids: "'+e+'" registered more than once.'),n[e]=[]}var n={};this.emit=function(e,t){var i,r;for(runtime.assert(n.hasOwnProperty(e),'unknown event fired "'+e+'"'),r=n[e],i=0;i<r.length;i+=1)r[i](t)},this.subscribe=function(e,t){runtime.assert(n.hasOwnProperty(e),'tried to subscribe to unknown event "'+e+'"'),n[e].push(t)},this.unsubscribe=function(e,t){var i;runtime.assert(n.hasOwnProperty(e),'tried to unsubscribe from unknown event "'+e+'"'),i=n[e].indexOf(t),runtime.assert(-1!==i,'tried to unsubscribe unknown callback from event "'+e+'"'),-1!==i&&n[e].splice(i,1)},this.register=t,e&&e.forEach(t)},core.ScheduledTask=function(e,t,n){function i(){a&&(n(o),a=!1)}function r(){i(),e.apply(void 0,s),s=null}var o,a=!1,s=[],l=!1;this.trigger=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),s=Array.prototype.slice.call(arguments),a||(a=!0,o=t(r))},this.triggerImmediate=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),s=Array.prototype.slice.call(arguments),r()},this.processRequests=function(){a&&r()},this.cancel=i,this.restart=function(){runtime.assert(!1===l,"Can't trigger destroyed ScheduledTask instance"),i(),a=!0,o=t(r)},this.destroy=function(e){i(),l=!0,e()}},function(){var e;core.Task={},core.Task.SUPPRESS_MANUAL_PROCESSING=!1,core.Task.processTasks=function(){core.Task.SUPPRESS_MANUAL_PROCESSING||e.performRedraw()},core.Task.createRedrawTask=function(t){return new core.ScheduledTask(t,e.requestRedrawTask,e.cancelRedrawTask)},core.Task.createTimeoutTask=function(e,t){return new core.ScheduledTask(e,function(e){return runtime.setTimeout(e,t)},runtime.clearTimeout)},e=new function(){var e={};this.requestRedrawTask=function(t){var n=runtime.requestAnimationFrame(function(){t(),delete e[n]});return e[n]=t,n},this.performRedraw=function(){Object.keys(e).forEach(function(t){e[t](),runtime.cancelAnimationFrame(parseInt(t,10))}),e={}},this.cancelRedrawTask=function(t){runtime.cancelAnimationFrame(t),delete e[t]}}}(),core.EventSubscriptions=function(){function e(e,t,i){e.subscribe(t,i),n.push({eventSource:e,eventid:t,callback:i})}function t(){var e=[];n.forEach(function(e){e.eventSource.unsubscribe(e.eventid,e.callback)}),n.length=0,Object.keys(r).forEach(function(t){r[t].forEach(function(t){e.push(t.task.destroy)}),delete r[t]}),core.Async.destroyAll(e,function(){}),i=new core.EventNotifier}var n=[],i=new core.EventNotifier,r={},o=0;this.addSubscription=e,this.addFrameSubscription=function(t,n,a){var s,l,d,u;for(r.hasOwnProperty(n)||(r[n]=[]),d=r[n],u=0;u<d.length;u+=1)if(d[u].eventSource===t){s=d[u];break}s||(l="s"+o,o+=1,i.register(l),s={frameEventId:l,eventSource:t,task:core.Task.createRedrawTask(function(){i.emit(l,void 0)})},d.push(s),e(t,n,s.task.trigger)),i.subscribe(s.frameEventId,a)},this.unsubscribeAll=t,this.destroy=function(e){t(),e()}},core.LazyProperty=function(e){var t,n=!1;this.value=function(){return n||(t=e(),n=!0),t},this.reset=function(){n=!1}},core.LoopWatchDog=function(e,t){var n=Date.now(),i=0;this.check=function(){if(e&&Date.now()-n>e)throw runtime.log("alert","watchdog timeout"),"timeout!";if(0<t&&(i+=1)>t)throw runtime.log("alert","watchdog loop overflow"),"loop overflow"}},core.NodeFilterChain=function(e){var t=NodeFilter.FILTER_REJECT,n=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(i){var r;for(r=0;r<e.length;r+=1)if(e[r].acceptNode(i)===t)return t;return n}},core.PositionIterator=function(e,t,n,i){function r(){var e=s.currentNode,t=e.nodeType;l=t===c?e.length-1:t===h?1:0}function o(){if(null===s.previousSibling()){if(!s.parentNode()||s.currentNode===e)return s.firstChild(),!1;l=0}else r();return!0}function a(){var t,n=s.currentNode;if(t=d(n),n!==e)for(n=n.parentNode;n&&n!==e;)d(n)===p&&(s.currentNode=n,t=p),n=n.parentNode;return t===p?(l=s.currentNode.nodeType===c?n.length:1,n=u.nextPosition()):n=t===f||u.nextPosition(),n&&runtime.assert(d(s.currentNode)===f,"moveToAcceptedNode did not result in walker being on an accepted node"),n}var s,l,d,u=this,c=Node.TEXT_NODE,h=Node.ELEMENT_NODE,f=NodeFilter.FILTER_ACCEPT,p=NodeFilter.FILTER_REJECT;this.nextPosition=function(){var t=s.currentNode,n=t.nodeType;if(t===e)return!1;if(0===l&&n===h)null===s.firstChild()&&(l=1);else if(n===c&&l+1<t.length)l+=1;else if(null!==s.nextSibling())l=0;else{if(!s.parentNode())return!1;l=1}return!0},this.previousPosition=function(){var t=!0,n=s.currentNode;return 0===l?t=o():n.nodeType===c?--l:null!==s.lastChild()?r():n===e?t=!1:l=0,t},this.previousNode=o,this.container=function(){var e=s.currentNode,t=e.nodeType;return 0===l&&t!==c&&(e=e.parentNode),e},this.rightNode=function(){var e=s.currentNode,t=e.nodeType;if(t===c&&l===e.length)for(e=e.nextSibling;e&&d(e)!==f;)e=e.nextSibling;else t===h&&1===l&&(e=null);return e},this.leftNode=function(){var e=s.currentNode;if(0===l)for(e=e.previousSibling;e&&d(e)!==f;)e=e.previousSibling;else if(e.nodeType===h)for(e=e.lastChild;e&&d(e)!==f;)e=e.previousSibling;return e},this.getCurrentNode=function(){return s.currentNode},this.unfilteredDomOffset=function(){if(s.currentNode.nodeType===c)return l;var e=0,t=s.currentNode;for(t=1===l?t.lastChild:t.previousSibling;t;)e+=1,t=t.previousSibling;return e},this.getPreviousSibling=function(){var e=s.currentNode,t=s.previousSibling();return s.currentNode=e,t},this.getNextSibling=function(){var e=s.currentNode,t=s.nextSibling();return s.currentNode=e,t},this.setPositionBeforeElement=function(e){return runtime.assert(Boolean(e),"setPositionBeforeElement called without element"),s.currentNode=e,l=0,a()},this.setUnfilteredPosition=function(e,t){return runtime.assert(Boolean(e),"PositionIterator.setUnfilteredPosition called without container"),s.currentNode=e,e.nodeType===c?(l=t,runtime.assert(t<=e.length,"Error in setPosition: "+t+" > "+e.length),runtime.assert(0<=t,"Error in setPosition: "+t+" < 0"),t===e.length&&(s.nextSibling()?l=0:s.parentNode()?l=1:runtime.assert(!1,"Error in setUnfilteredPosition: position not valid."))):t<e.childNodes.length?(s.currentNode=e.childNodes.item(t),l=0):l=1,a()},this.moveToEnd=function(){s.currentNode=e,l=1},this.moveToEndOfNode=function(e){e.nodeType===c?u.setUnfilteredPosition(e,e.length):(s.currentNode=e,l=1)},this.isBeforeNode=function(){return 0===l},this.getNodeFilter=function(){return d},d=(n?new function(e){this.acceptNode=function(t){return!t||t.nodeType===c&&0===t.length?p:e.acceptNode(t)}}(n):new function(){this.acceptNode=function(e){return!e||e.nodeType===c&&0===e.length?p:f}}).acceptNode,d.acceptNode=d,t=t||NodeFilter.SHOW_ALL,runtime.assert(e.nodeType!==Node.TEXT_NODE,"Internet Explorer doesn't allow tree walker roots to be text nodes"),s=e.ownerDocument.createTreeWalker(e,t,d,i),l=0,null===s.firstChild()&&(l=1)},core.PositionFilter=function(){},core.PositionFilter.FilterResult={FILTER_ACCEPT:1,FILTER_REJECT:2,FILTER_SKIP:3},core.PositionFilter.prototype.acceptPosition=function(e){},core.PositionFilterChain=function(){var e=[],t=core.PositionFilter.FilterResult.FILTER_ACCEPT,n=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(i){var r;for(r=0;r<e.length;r+=1)if(e[r].acceptPosition(i)===n)return n;return t},this.addFilter=function(t){e.push(t)}},core.StepDirection={PREVIOUS:1,NEXT:2},core.StepIterator=function(e,t){function n(){d=null,c=u=void 0}function i(){return void 0===c&&(c=e.acceptPosition(t)===h),c}function r(e,i){return n(),t.setUnfilteredPosition(e,i)}function o(){return d||(d=t.container()),d}function a(){return void 0===u&&(u=t.unfilteredDomOffset()),u}function s(){for(n();t.nextPosition();)if(n(),i())return!0;return!1}function l(){for(n();t.previousPosition();)if(n(),i())return!0;return!1}var d,u,c,h=core.PositionFilter.FilterResult.FILTER_ACCEPT,f=core.StepDirection.NEXT;this.isStep=i,this.setPosition=r,this.container=o,this.offset=a,this.nextStep=s,this.previousStep=l,this.advanceStep=function(e){return e===f?s():l()},this.roundToClosestStep=function(){var e,t,n=i();return n||(e=o(),t=a(),(n=l())||(r(e,t),n=s())),n},this.roundToPreviousStep=function(){var e=i();return e||(e=l()),e},this.roundToNextStep=function(){var e=i();return e||(e=s()),e},this.leftNode=function(){return t.leftNode()},this.snapshot=function(){return new core.StepIterator.StepSnapshot(o(),a())},this.restore=function(e){r(e.container,e.offset)}},core.StepIterator.StepSnapshot=function(e,t){this.container=e,this.offset=t},core.Utils=function(){function e(t,n){if(n&&Array.isArray(n)){if(t=t||[],!Array.isArray(t))throw"Destination is not an array.";t=t.concat(n.map(function(t){return e(null,t)}))}else if(n&&"object"==typeof n){if("object"!=typeof(t=t||{}))throw"Destination is not an object.";Object.keys(n).forEach(function(i){t[i]=e(t[i],n[i])})}else t=n;return t}this.hashString=function(e){var t,n,i=0;for(t=0,n=e.length;t<n;t+=1)i=(i<<5)-i+e.charCodeAt(t),i|=0;return i},this.mergeObjects=function(t,n){return Object.keys(n).forEach(function(i){t[i]=e(t[i],n[i])}),t}},core.Zip=function(e,t){function n(e,t){var n=a.file(e);n?t(null,n.asUint8Array()):t(e+" not found.",null)}function i(e,t){n(e,function(e,n){if(e||null===n)return t(e,null);var i=runtime.byteArrayToString(n,"utf8");t(null,i)})}function r(e,t){try{e(a.generate({type:"uint8array",compression:"STORE"}))}catch(e){t(e.message)}}function o(e,t){r(function(n){runtime.writeFile(e,n,t)},t)}var a,s=this,l=new core.Base64;this.load=n,this.save=function(e,t,n,i){a.file(e,t,{date:i,compression:n?"DEFLATE":"STORE"})},this.remove=function(e){var t=null!==a.file(e);return a.remove(e),t},this.write=function(t){o(e,t)},this.writeAs=o,this.createByteArray=r,this.loadContentXmlAsFragments=function(e,t){i(e,function(e,n){if(e)return t.rootElementReady(e);t.rootElementReady(null,n,!0)})},this.loadAsString=i,this.loadAsDOM=function(e,t){i(e,function(e,n){if(e||null===n)t(e,null);else{var i=(new DOMParser).parseFromString(n,"text/xml");t(null,i)}})},this.loadAsDataURL=function(e,t,i){n(e,function(e,n){if(e||!n)return i(e,null);var r,o=0;for(t||(t=80===n[1]&&78===n[2]&&71===n[3]?"image/png":255===n[0]&&216===n[1]&&255===n[2]?"image/jpeg":71===n[0]&&73===n[1]&&70===n[2]?"image/gif":""),r="data:"+t+";base64,";o<n.length;)r+=l.convertUTF8ArrayToBase64(n.subarray(o,Math.min(o+45e3,n.length))),o+=45e3;i(null,r)})},this.getEntries=function(){return Object.keys(a.files).map(function(e){return{filename:e,date:a.files[e].date}})},a=new externs.JSZip,null!==t&&runtime.readFile(e,"binary",function(n,i){if("string"==typeof i&&(n="file was read as a string. Should be Uint8Array."),n||!i||0===i.length)t("File '"+e+"' cannot be read. Err: "+(n||"[none]"),s);else try{a.load(i,{checkCRC32:!1}),t(null,s)}catch(e){t(e.message,s)}})},core.SimpleClientRect=null,gui.CommonConstraints={EDIT:{ANNOTATIONS:{ONLY_DELETE_OWN:"onlyDeleteOwn"},REVIEW_MODE:"reviewMode"}},gui.SessionConstraints=function(){function e(e){t.hasOwnProperty(e)||(t[e]=!1,n.register(e))}var t={},n=new core.EventNotifier;this.registerConstraint=e,this.subscribe=function(t,i){e(t),n.subscribe(t,i)},this.unsubscribe=function(e,t){n.unsubscribe(e,t)},this.setState=function(e,i){runtime.assert(!0===t.hasOwnProperty(e),"No such constraint"),t[e]!==i&&(t[e]=i,n.emit(e,i))},this.getState=function(e){return runtime.assert(!0===t.hasOwnProperty(e),"No such constraint"),t[e]}},gui.BlacklistNamespaceNodeFilter=function(e){var t={},n=NodeFilter.FILTER_REJECT,i=NodeFilter.FILTER_ACCEPT;this.acceptNode=function(e){return!e||t.hasOwnProperty(e.namespaceURI)?n:i},e.forEach(function(e){t[e]=!0})},odf.Namespaces={namespaceMap:{config:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",db:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dc:"http://purl.org/dc/elements/1.1/",dr3d:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",draw:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chart:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fo:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",form:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",math:"http://www.w3.org/1998/Math/MathML",meta:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",number:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",office:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentation:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",style:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svg:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",table:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",text:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xforms:"http://www.w3.org/2002/xforms",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},prefixMap:{},configns:"urn:oasis:names:tc:opendocument:xmlns:config:1.0",dbns:"urn:oasis:names:tc:opendocument:xmlns:database:1.0",dcns:"http://purl.org/dc/elements/1.1/",dr3dns:"urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0",drawns:"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0",chartns:"urn:oasis:names:tc:opendocument:xmlns:chart:1.0",fons:"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0",formns:"urn:oasis:names:tc:opendocument:xmlns:form:1.0",mathns:"http://www.w3.org/1998/Math/MathML",metans:"urn:oasis:names:tc:opendocument:xmlns:meta:1.0",numberns:"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0",officens:"urn:oasis:names:tc:opendocument:xmlns:office:1.0",presentationns:"urn:oasis:names:tc:opendocument:xmlns:presentation:1.0",stylens:"urn:oasis:names:tc:opendocument:xmlns:style:1.0",svgns:"urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0",tablens:"urn:oasis:names:tc:opendocument:xmlns:table:1.0",textns:"urn:oasis:names:tc:opendocument:xmlns:text:1.0",xformsns:"http://www.w3.org/2002/xforms",xlinkns:"http://www.w3.org/1999/xlink",xmlns:"http://www.w3.org/XML/1998/namespace"},function(){var e,t=odf.Namespaces.namespaceMap,n=odf.Namespaces.prefixMap;for(e in t)t.hasOwnProperty(e)&&(n[t[e]]=e)}(),odf.Namespaces.forEachPrefix=function(e){var t,n=odf.Namespaces.namespaceMap;for(t in n)n.hasOwnProperty(t)&&e(t,n[t])},odf.Namespaces.lookupNamespaceURI=function(e){var t=null;return odf.Namespaces.namespaceMap.hasOwnProperty(e)&&(t=odf.Namespaces.namespaceMap[e]),t},odf.Namespaces.lookupPrefix=function(e){var t=odf.Namespaces.prefixMap;return t.hasOwnProperty(e)?t[e]:null},odf.Namespaces.lookupNamespaceURI.lookupNamespaceURI=odf.Namespaces.lookupNamespaceURI,odf.OdfSchemaImpl=function(){var e=[["config:config-item","uncategorized"],["form:item","object"],["form:option","uncategorized"],["math:math","field"],["meta:user-defined","uncategorized"],["number:currency-symbol","uncategorized"],["number:embedded-text","uncategorized"],["number:text","uncategorized"],["presentation:date-time-decl","uncategorized"],["presentation:footer-decl","uncategorized"],["presentation:header-decl","uncategorized"],["svg:desc","text"],["svg:title","text"],["table:desc","uncategorized"],["table:title","uncategorized"],["text:a","text"],["text:author-initials","field"],["text:author-name","field"],["text:bibliography-mark","field"],["text:bookmark-ref","field"],["text:chapter","field"],["text:character-count","field"],["text:conditional-text","field"],["text:creation-date","field"],["text:creation-time","field"],["text:creator","field"],["text:database-display","field"],["text:database-name","field"],["text:database-row-number","field"],["text:date","field"],["text:dde-connection","field"],["text:description","field"],["text:editing-cycles","field"],["text:editing-duration","field"],["text:execute-macro","uncategorized"],["text:expression","uncategorized"],["text:file-name","field"],["text:h","text"],["text:hidden-paragraph","text"],["text:hidden-text","text"],["text:image-count","field"],["text:index-entry-span","uncategorized"],["text:index-title-template","uncategorized"],["text:initial-creator","field"],["text:keywords","field"],["text:linenumbering-separator","style"],["text:measure","uncategorized"],["text:meta","uncategorized"],["text:meta-field","uncategorized"],["text:modification-date","field"],["text:modification-time","field"],["text:note-citation","field"],["text:note-continuation-notice-backward","style"],["text:note-continuation-notice-forward","style"],["text:note-ref","field"],["text:object-count","field"],["text:p","text"],["text:page-continuation","uncategorized"],["text:page-count","field"],["text:page-number","field"],["text:page-variable-get","field"],["text:page-variable-set","field"],["text:paragraph-count","field"],["text:placeholder","field"],["text:print-date","field"],["text:print-time","field"],["text:printed-by","field"],["text:reference-ref","field"],["text:ruby-base","text"],["text:ruby-text","text"],["text:script","text"],["text:sender-city","field"],["text:sender-company","field"],["text:sender-country","field"],["text:sender-email","field"],["text:sender-fax","field"],["text:sender-firstname","field"],["text:sender-initials","field"],["text:sender-lastname","field"],["text:sender-phone-private","field"],["text:sender-phone-work","field"],["text:sender-position","field"],["text:sender-postal-code","field"],["text:sender-state-or-province","field"],["text:sender-street","field"],["text:sender-title","field"],["text:sequence","uncategorized"],["text:sequence-ref","uncategorized"],["text:sheet-name","uncategorized"],["text:span","text"],["text:subject","field"],["text:table-count","field"],["text:table-formula","deprecated"],["text:template-name","uncategorized"],["text:text-input","field"],["text:time","field"],["text:title","field"],["text:user-defined","field"],["text:user-field-get","field"],["text:user-field-input","field"],["text:variable-get","field"],["text:variable-input","field"],["text:variable-set","field"],["text:word-count","field"],["xforms:model","uncategorized"]],t={};this.isTextContainer=function(e,n){return"text"===t[e+":"+n]},this.isField=function(e,n){return"field"===t[e+":"+n]},this.getFields=function(){return e.filter(function(e){return"field"===e[1]}).map(function(e){return e[0]})},e.forEach(function(e){var n=e[1],i=e[0].split(":");e=i[0],i=i[1];var r=odf.Namespaces.lookupNamespaceURI(e);r?t[r+":"+i]=n:runtime.log("DEBUG: OdfSchema - unknown prefix '"+e+"'")})},odf.OdfSchema=new odf.OdfSchemaImpl,odf.OdfUtilsImpl=function(){function e(e){return"image"===(e&&e.localName)&&e.namespaceURI===D}function t(e){return null!==e&&e.nodeType===Node.ELEMENT_NODE&&"frame"===e.localName&&e.namespaceURI===D&&"as-char"===e.getAttributeNS(O,"anchor-type")}function n(e){var t;return(t="annotation"===(e&&e.localName)&&e.namespaceURI===odf.Namespaces.officens)||(t="div"===(e&&e.localName)&&"annotationWrapper"===e.className),t}function i(e){return"a"===(e&&e.localName)&&e.namespaceURI===O}function r(e){var t=e&&e.localName;return("p"===t||"h"===t)&&e.namespaceURI===O}function o(e,t){for(e&&void 0!==t&&!r(e)&&e.childNodes.item(t)&&(e=e.childNodes.item(t));e&&!r(e);)e=e.parentNode;return e}function a(e,t){for(;e&&e!==t;){if(e.namespaceURI===odf.Namespaces.officens&&"annotation"===e.localName)return e;e=e.parentNode}return null}function s(e){return/^[ \t\r\n]+$/.test(e)}function l(e){if(null===e||e.nodeType!==Node.ELEMENT_NODE)return!1;var t=e.localName;return I.isTextContainer(e.namespaceURI,t)||"span"===t&&"webodf-annotationHighlight"===e.className}function d(e){return null!==e&&e.nodeType===Node.ELEMENT_NODE&&I.isField(e.namespaceURI,e.localName)}function u(e){var t=e&&e.localName,n=!1;return t&&((e=e.namespaceURI)===O&&(n="s"===t||"tab"===t||"line-break"===t)),n}function c(e){return u(e)||d(e)||t(e)||n(e)}function h(e){var t=e&&e.localName,n=!1;return t&&((e=e.namespaceURI)===O&&(n="s"===t)),n}function f(e){return-1!==M.indexOf(e.namespaceURI)}function p(e){for(;null!==e.firstChild&&l(e);)e=e.firstChild;return e}function m(e){for(;null!==e.lastChild&&l(e);)e=e.lastChild;return e}function g(e){for(;!r(e)&&null===e.previousSibling;)e=e.parentNode;return r(e)?null:m(e.previousSibling)}function _(e){for(;!r(e)&&null===e.nextSibling;)e=e.parentNode;return r(e)?null:p(e.nextSibling)}function v(e){for(var t=!1;e;)if(e.nodeType===Node.TEXT_NODE){if(0!==e.length)return!s(e.data.substr(e.length-1,1));e=g(e)}else c(e)?(t=!1===h(e),e=null):e=g(e);return t}function b(e){var t=!1;for(e=e&&p(e);e;){if(0<(e.nodeType===Node.TEXT_NODE?e.length:0)&&!s(e.data)){t=!0;break}if(c(e)){t=!0;break}e=_(e)}return t}function y(e,t){return!!s(e.data.substr(t))&&!b(_(e))}function x(e,t){var n,i=e.data;return!(!s(i[t])||c(e.parentNode))&&(0<t?s(i[t-1])||(n=!0):v(g(e))&&(n=!0),!0===n&&!y(e,t))}function w(e){return(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px)|(%))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null}function S(e){return(e=w(e))&&(0>e.value||"%"===e.unit)?null:e}function N(e){return(e=w(e))&&"%"!==e.unit?null:e}function E(e){switch(e.namespaceURI){case odf.Namespaces.drawns:case odf.Namespaces.svgns:case odf.Namespaces.dr3dns:return!1;case odf.Namespaces.textns:switch(e.localName){case"note-body":case"ruby-text":return!1}break;case odf.Namespaces.officens:switch(e.localName){case"annotation":case"binary-data":case"event-listeners":return!1}break;default:switch(e.localName){case"cursor":case"editinfo":return!1}}return!0}function C(e){return Boolean(o(e)&&(!s(e.textContent)||x(e,0)))}function k(e,t){for(;0<t.length&&!P.rangeContainsNode(e,t[0]);)t.shift();for(;0<t.length&&!P.rangeContainsNode(e,t[t.length-1]);)t.pop()}function T(e,t,i){var r;return r=P.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return u(e.parentNode)||d(e.parentNode)||n(e)?t=NodeFilter.FILTER_REJECT:e.nodeType===Node.TEXT_NODE?(i||C(e))&&(t=NodeFilter.FILTER_ACCEPT):c(e)?t=NodeFilter.FILTER_ACCEPT:(E(e)||l(e))&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),t||k(e,r),r}function A(e,t,i){for(;e;){if(i(e)){t[0]!==e&&t.unshift(e);break}if(n(e))break;e=e.parentNode}}var O=odf.Namespaces.textns,D=odf.Namespaces.drawns,R=odf.Namespaces.xlinkns,P=core.DomUtils,M=[odf.Namespaces.dbns,odf.Namespaces.dcns,odf.Namespaces.dr3dns,odf.Namespaces.drawns,odf.Namespaces.chartns,odf.Namespaces.formns,odf.Namespaces.numberns,odf.Namespaces.officens,odf.Namespaces.presentationns,odf.Namespaces.stylens,odf.Namespaces.svgns,odf.Namespaces.tablens,odf.Namespaces.textns],I=odf.OdfSchema;this.isImage=e,this.isCharacterFrame=t,this.isInlineRoot=n,this.isTextSpan=function(e){return"span"===(e&&e.localName)&&e.namespaceURI===O},this.isHyperlink=i,this.getHyperlinkTarget=function(e){return e.getAttributeNS(R,"href")||""},this.isParagraph=r,this.getParagraphElement=o,this.getParentAnnotation=a,this.isWithinAnnotation=function(e,t){return Boolean(a(e,t))},this.getAnnotationCreator=function(e){return e.getElementsByTagNameNS(odf.Namespaces.dcns,"creator")[0].textContent},this.isListItem=function(e){return"list-item"===(e&&e.localName)&&e.namespaceURI===O},this.isLineBreak=function(e){return"line-break"===(e&&e.localName)&&e.namespaceURI===O},this.isODFWhitespace=s,this.isGroupingElement=l,this.isFieldElement=d,this.isCharacterElement=u,this.isAnchoredAsCharacterElement=c,this.isSpaceElement=h,this.isODFNode=f,this.hasNoODFContent=function e(t){if(u(t)||d(t))return!1;if(l(t.parentNode)&&t.nodeType===Node.TEXT_NODE)return 0===t.textContent.length;for(t=t.firstChild;t;){if(f(t)||!e(t))return!1;t=t.nextSibling}return!0},this.firstChild=p,this.lastChild=m,this.previousNode=g,this.nextNode=_,this.scanLeftForNonSpace=v,this.lookLeftForCharacter=function(e){var t,n=t=0;return e.nodeType===Node.TEXT_NODE&&(n=e.length),0<n?t=s((t=e.data).substr(n-1,1))?1===n?v(g(e))?2:0:s(t.substr(n-2,1))?0:2:1:c(e)&&(t=1),t},this.lookRightForCharacter=function(e){var t=!1,n=0;return e&&e.nodeType===Node.TEXT_NODE&&(n=e.length),0<n?t=!s(e.data.substr(0,1)):c(e)&&(t=!0),t},this.scanLeftForAnyCharacter=function(e){var t=!1;for(e=e&&m(e);e;){if(0<(e.nodeType===Node.TEXT_NODE?e.length:0)&&!s(e.data)){t=!0;break}if(c(e)){t=!0;break}e=g(e)}return t},this.scanRightForAnyCharacter=b,this.isTrailingWhitespace=y,this.isSignificantWhitespace=x,this.isDowngradableSpaceElement=function(e){return!!h(e)&&(v(g(e))&&b(_(e)))},this.parseLength=w,this.parseNonNegativeLength=S,this.parseFoFontSize=function(e){var t;return(t=(t=w(e))&&(0>=t.value||"%"===t.unit)?null:t)||N(e)},this.parseFoLineHeight=function(e){return S(e)||N(e)},this.isTextContentContainingNode=E,this.getTextNodes=function(e,t){var n;return n=P.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return e.nodeType===Node.TEXT_NODE?C(e)&&(t=NodeFilter.FILTER_ACCEPT):E(e)&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT),t||k(e,n),n},this.getTextElements=T,this.getParagraphElements=function(e){var t;return t=P.getNodesInRange(e,function(e){var t=NodeFilter.FILTER_REJECT;return r(e)?t=NodeFilter.FILTER_ACCEPT:(E(e)||l(e))&&(t=NodeFilter.FILTER_SKIP),t},NodeFilter.SHOW_ELEMENT),A(e.startContainer,t,r),t},this.getImageElements=function(t){var n;return n=P.getNodesInRange(t,function(t){var n=NodeFilter.FILTER_SKIP;return e(t)&&(n=NodeFilter.FILTER_ACCEPT),n},NodeFilter.SHOW_ELEMENT),A(t.startContainer,n,e),n},this.getHyperlinkElements=function(e){var t=[],n=e.cloneRange();return e.collapsed&&e.endContainer.nodeType===Node.ELEMENT_NODE&&(e=function(e,t){var n=e;if(t<n.childNodes.length-1)n=n.childNodes[t+1];else{for(;!n.nextSibling;)n=n.parentNode;n=n.nextSibling}for(;n.firstChild;)n=n.firstChild;return n}(e.endContainer,e.endOffset),e.nodeType===Node.TEXT_NODE&&n.setEnd(e,1)),T(n,!0,!1).forEach(function(e){for(e=e.parentNode;!r(e);){if(i(e)&&-1===t.indexOf(e)){t.push(e);break}e=e.parentNode}}),n.detach(),t},this.getNormalizedFontFamilyName=function(e){return/^(["'])(?:.|[\n\r])*?\1$/.test(e)||(e=e.replace(/^[ \t\r\n\f]*((?:.|[\n\r])*?)[ \t\r\n\f]*$/,"$1"),/[ \t\r\n\f]/.test(e)&&(e="'"+e.replace(/[ \t\r\n\f]+/g," ")+"'")),e}},odf.OdfUtils=new odf.OdfUtilsImpl,gui.OdfTextBodyNodeFilter=function(){var e=odf.OdfUtils,t=Node.TEXT_NODE,n=NodeFilter.FILTER_REJECT,i=NodeFilter.FILTER_ACCEPT,r=odf.Namespaces.textns;this.acceptNode=function(o){if(o.nodeType===t){if(!e.isGroupingElement(o.parentNode))return n}else if(o.namespaceURI===r&&"tracked-changes"===o.localName)return n;return i}},xmldom.LSSerializerFilter=function(){},xmldom.LSSerializerFilter.prototype.acceptNode=function(e){},odf.OdfNodeFilter=function(){this.acceptNode=function(e){return"http://www.w3.org/1999/xhtml"===e.namespaceURI?NodeFilter.FILTER_SKIP:e.namespaceURI&&e.namespaceURI.match(/^urn:webodf:/)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}},xmldom.XPathIterator=function(){},xmldom.XPathIterator.prototype.next=function(){},xmldom.XPathIterator.prototype.reset=function(){},xmldom.XPath=createXPathSingleton(),odf.StyleInfo=function(){function e(t,n){var i,r,o,a,s,l=0;for((i=d[t.localName])&&(o=i[t.namespaceURI])&&(l=o.length),i=0;i<l;i+=1)a=(r=o[i]).ns,s=r.localname,(r=t.getAttributeNS(a,s))&&t.setAttributeNS(a,x[a]+s,n+r);for(o=t.firstElementChild;o;)e(o,n),o=o.nextElementSibling}function t(e,n){var i,r,o,a,s,l=0;for((i=d[e.localName])&&(o=i[e.namespaceURI])&&(l=o.length),i=0;i<l;i+=1)a=(r=o[i]).ns,s=r.localname,(r=e.getAttributeNS(a,s))&&(r=r.replace(n,""),e.setAttributeNS(a,x[a]+s,r));for(o=e.firstElementChild;o;)t(o,n),o=o.nextElementSibling}function n(e,t){var n,i,r,o,a,s=0;for((n=d[e.localName])&&(r=n[e.namespaceURI])&&(s=r.length),n=0;n<s;n+=1)i=(o=r[n]).ns,a=o.localname,(i=e.getAttributeNS(i,a))&&(t=t||{},o=o.keyname,t.hasOwnProperty(o)?t[o][i]=1:((a={})[i]=1,t[o]=a));return t}function i(e,t){var r;for(n(e,t),r=e.firstChild;r;)r.nodeType===Node.ELEMENT_NODE&&i(r,t),r=r.nextSibling}function r(e,t,n){this.key=e,this.name=t,this.family=n,this.requires={}}function o(e,t,n){var i=e+'"'+t,o=n[i];return o||(o=n[i]=new r(i,e,t)),o}function a(e,t,n){var i,r,s,l,u,c=0;if(i=e.getAttributeNS(v,"name"),l=e.getAttributeNS(v,"family"),i&&l&&(t=o(i,l,n)),t)for((i=d[e.localName])&&(s=i[e.namespaceURI])&&(c=s.length),i=0;i<c;i+=1)r=(l=s[i]).ns,u=l.localname,(r=e.getAttributeNS(r,u))&&(l=o(r,l=l.keyname,n),t.requires[l.key]=l);for(e=e.firstElementChild;e;)a(e,t,n),e=e.nextElementSibling;return n}function s(e,t){var n=t[e.family];n||(n=t[e.family]={}),n[e.name]=1,Object.keys(e.requires).forEach(function(n){s(e.requires[n],t)})}function l(e,t){var n=a(e,null,{});Object.keys(n).forEach(function(e){e=n[e];var i=t[e.family];i&&i.hasOwnProperty(e.name)&&s(e,t)})}var d,u=odf.Namespaces.chartns,c=odf.Namespaces.dbns,h=odf.Namespaces.dr3dns,f=odf.Namespaces.drawns,p=odf.Namespaces.formns,m=odf.Namespaces.numberns,g=odf.Namespaces.officens,_=odf.Namespaces.presentationns,v=odf.Namespaces.stylens,b=odf.Namespaces.tablens,y=odf.Namespaces.textns,x={"urn:oasis:names:tc:opendocument:xmlns:chart:1.0":"chart:","urn:oasis:names:tc:opendocument:xmlns:database:1.0":"db:","urn:oasis:names:tc:opendocument:xmlns:dr3d:1.0":"dr3d:","urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":"draw:","urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":"fo:","urn:oasis:names:tc:opendocument:xmlns:form:1.0":"form:","urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":"number:","urn:oasis:names:tc:opendocument:xmlns:office:1.0":"office:","urn:oasis:names:tc:opendocument:xmlns:presentation:1.0":"presentation:","urn:oasis:names:tc:opendocument:xmlns:style:1.0":"style:","urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0":"svg:","urn:oasis:names:tc:opendocument:xmlns:table:1.0":"table:","urn:oasis:names:tc:opendocument:xmlns:text:1.0":"chart:","http://www.w3.org/XML/1998/namespace":"xml:"},w={text:[{ens:v,en:"tab-stop",ans:v,a:"leader-text-style"},{ens:v,en:"drop-cap",ans:v,a:"style-name"},{ens:y,en:"notes-configuration",ans:y,a:"citation-body-style-name"},{ens:y,en:"notes-configuration",ans:y,a:"citation-style-name"},{ens:y,en:"a",ans:y,a:"style-name"},{ens:y,en:"alphabetical-index",ans:y,a:"style-name"},{ens:y,en:"linenumbering-configuration",ans:y,a:"style-name"},{ens:y,en:"list-level-style-number",ans:y,a:"style-name"},{ens:y,en:"ruby-text",ans:y,a:"style-name"},{ens:y,en:"span",ans:y,a:"style-name"},{ens:y,en:"a",ans:y,a:"visited-style-name"},{ens:v,en:"text-properties",ans:v,a:"text-line-through-text-style"},{ens:y,en:"alphabetical-index-source",ans:y,a:"main-entry-style-name"},{ens:y,en:"index-entry-bibliography",ans:y,a:"style-name"},{ens:y,en:"index-entry-chapter",ans:y,a:"style-name"},{ens:y,en:"index-entry-link-end",ans:y,a:"style-name"},{ens:y,en:"index-entry-link-start",ans:y,a:"style-name"},{ens:y,en:"index-entry-page-number",ans:y,a:"style-name"},{ens:y,en:"index-entry-span",ans:y,a:"style-name"},{ens:y,en:"index-entry-tab-stop",ans:y,a:"style-name"},{ens:y,en:"index-entry-text",ans:y,a:"style-name"},{ens:y,en:"index-title-template",ans:y,a:"style-name"},{ens:y,en:"list-level-style-bullet",ans:y,a:"style-name"},{ens:y,en:"outline-level-style",ans:y,a:"style-name"}],paragraph:[{ens:f,en:"caption",ans:f,a:"text-style-name"},{ens:f,en:"circle",ans:f,a:"text-style-name"},{ens:f,en:"connector",ans:f,a:"text-style-name"},{ens:f,en:"control",ans:f,a:"text-style-name"},{ens:f,en:"custom-shape",ans:f,a:"text-style-name"},{ens:f,en:"ellipse",ans:f,a:"text-style-name"},{ens:f,en:"frame",ans:f,a:"text-style-name"},{ens:f,en:"line",ans:f,a:"text-style-name"},{ens:f,en:"measure",ans:f,a:"text-style-name"},{ens:f,en:"path",ans:f,a:"text-style-name"},{ens:f,en:"polygon",ans:f,a:"text-style-name"},{ens:f,en:"polyline",ans:f,a:"text-style-name"},{ens:f,en:"rect",ans:f,a:"text-style-name"},{ens:f,en:"regular-polygon",ans:f,a:"text-style-name"},{ens:g,en:"annotation",ans:f,a:"text-style-name"},{ens:p,en:"column",ans:p,a:"text-style-name"},{ens:v,en:"style",ans:v,a:"next-style-name"},{ens:b,en:"body",ans:b,a:"paragraph-style-name"},{ens:b,en:"even-columns",ans:b,a:"paragraph-style-name"},{ens:b,en:"even-rows",ans:b,a:"paragraph-style-name"},{ens:b,en:"first-column",ans:b,a:"paragraph-style-name"},{ens:b,en:"first-row",ans:b,a:"paragraph-style-name"},{ens:b,en:"last-column",ans:b,a:"paragraph-style-name"},{ens:b,en:"last-row",ans:b,a:"paragraph-style-name"},{ens:b,en:"odd-columns",ans:b,a:"paragraph-style-name"},{ens:b,en:"odd-rows",ans:b,a:"paragraph-style-name"},{ens:y,en:"notes-configuration",ans:y,a:"default-style-name"},{ens:y,en:"alphabetical-index-entry-template",ans:y,a:"style-name"},{ens:y,en:"bibliography-entry-template",ans:y,a:"style-name"},{ens:y,en:"h",ans:y,a:"style-name"},{ens:y,en:"illustration-index-entry-template",ans:y,a:"style-name"},{ens:y,en:"index-source-style",ans:y,a:"style-name"},{ens:y,en:"object-index-entry-template",ans:y,a:"style-name"},{ens:y,en:"p",ans:y,a:"style-name"},{ens:y,en:"table-index-entry-template",ans:y,a:"style-name"},{ens:y,en:"table-of-content-entry-template",ans:y,a:"style-name"},{ens:y,en:"table-index-entry-template",ans:y,a:"style-name"},{ens:y,en:"user-index-entry-template",ans:y,a:"style-name"},{ens:v,en:"page-layout-properties",ans:v,a:"register-truth-ref-style-name"}],chart:[{ens:u,en:"axis",ans:u,a:"style-name"},{ens:u,en:"chart",ans:u,a:"style-name"},{ens:u,en:"data-label",ans:u,a:"style-name"},{ens:u,en:"data-point",ans:u,a:"style-name"},{ens:u,en:"equation",ans:u,a:"style-name"},{ens:u,en:"error-indicator",ans:u,a:"style-name"},{ens:u,en:"floor",ans:u,a:"style-name"},{ens:u,en:"footer",ans:u,a:"style-name"},{ens:u,en:"grid",ans:u,a:"style-name"},{ens:u,en:"legend",ans:u,a:"style-name"},{ens:u,en:"mean-value",ans:u,a:"style-name"},{ens:u,en:"plot-area",ans:u,a:"style-name"},{ens:u,en:"regression-curve",ans:u,a:"style-name"},{ens:u,en:"series",ans:u,a:"style-name"},{ens:u,en:"stock-gain-marker",ans:u,a:"style-name"},{ens:u,en:"stock-loss-marker",ans:u,a:"style-name"},{ens:u,en:"stock-range-line",ans:u,a:"style-name"},{ens:u,en:"subtitle",ans:u,a:"style-name"},{ens:u,en:"title",ans:u,a:"style-name"},{ens:u,en:"wall",ans:u,a:"style-name"}],section:[{ens:y,en:"alphabetical-index",ans:y,a:"style-name"},{ens:y,en:"bibliography",ans:y,a:"style-name"},{ens:y,en:"illustration-index",ans:y,a:"style-name"},{ens:y,en:"index-title",ans:y,a:"style-name"},{ens:y,en:"object-index",ans:y,a:"style-name"},{ens:y,en:"section",ans:y,a:"style-name"},{ens:y,en:"table-of-content",ans:y,a:"style-name"},{ens:y,en:"table-index",ans:y,a:"style-name"},{ens:y,en:"user-index",ans:y,a:"style-name"}],ruby:[{ens:y,en:"ruby",ans:y,a:"style-name"}],table:[{ens:c,en:"query",ans:c,a:"style-name"},{ens:c,en:"table-representation",ans:c,a:"style-name"},{ens:b,en:"background",ans:b,a:"style-name"},{ens:b,en:"table",ans:b,a:"style-name"}],"table-column":[{ens:c,en:"column",ans:c,a:"style-name"},{ens:b,en:"table-column",ans:b,a:"style-name"}],"table-row":[{ens:c,en:"query",ans:c,a:"default-row-style-name"},{ens:c,en:"table-representation",ans:c,a:"default-row-style-name"},{ens:b,en:"table-row",ans:b,a:"style-name"}],"table-cell":[{ens:c,en:"column",ans:c,a:"default-cell-style-name"},{ens:b,en:"table-column",ans:b,a:"default-cell-style-name"},{ens:b,en:"table-row",ans:b,a:"default-cell-style-name"},{ens:b,en:"body",ans:b,a:"style-name"},{ens:b,en:"covered-table-cell",ans:b,a:"style-name"},{ens:b,en:"even-columns",ans:b,a:"style-name"},{ens:b,en:"covered-table-cell",ans:b,a:"style-name"},{ens:b,en:"even-columns",ans:b,a:"style-name"},{ens:b,en:"even-rows",ans:b,a:"style-name"},{ens:b,en:"first-column",ans:b,a:"style-name"},{ens:b,en:"first-row",ans:b,a:"style-name"},{ens:b,en:"last-column",ans:b,a:"style-name"},{ens:b,en:"last-row",ans:b,a:"style-name"},{ens:b,en:"odd-columns",ans:b,a:"style-name"},{ens:b,en:"odd-rows",ans:b,a:"style-name"},{ens:b,en:"table-cell",ans:b,a:"style-name"}],graphic:[{ens:h,en:"cube",ans:f,a:"style-name"},{ens:h,en:"extrude",ans:f,a:"style-name"},{ens:h,en:"rotate",ans:f,a:"style-name"},{ens:h,en:"scene",ans:f,a:"style-name"},{ens:h,en:"sphere",ans:f,a:"style-name"},{ens:f,en:"caption",ans:f,a:"style-name"},{ens:f,en:"circle",ans:f,a:"style-name"},{ens:f,en:"connector",ans:f,a:"style-name"},{ens:f,en:"control",ans:f,a:"style-name"},{ens:f,en:"custom-shape",ans:f,a:"style-name"},{ens:f,en:"ellipse",ans:f,a:"style-name"},{ens:f,en:"frame",ans:f,a:"style-name"},{ens:f,en:"g",ans:f,a:"style-name"},{ens:f,en:"line",ans:f,a:"style-name"},{ens:f,en:"measure",ans:f,a:"style-name"},{ens:f,en:"page-thumbnail",ans:f,a:"style-name"},{ens:f,en:"path",ans:f,a:"style-name"},{ens:f,en:"polygon",ans:f,a:"style-name"},{ens:f,en:"polyline",ans:f,a:"style-name"},{ens:f,en:"rect",ans:f,a:"style-name"},{ens:f,en:"regular-polygon",ans:f,a:"style-name"},{ens:g,en:"annotation",ans:f,a:"style-name"}],presentation:[{ens:h,en:"cube",ans:_,a:"style-name"},{ens:h,en:"extrude",ans:_,a:"style-name"},{ens:h,en:"rotate",ans:_,a:"style-name"},{ens:h,en:"scene",ans:_,a:"style-name"},{ens:h,en:"sphere",ans:_,a:"style-name"},{ens:f,en:"caption",ans:_,a:"style-name"},{ens:f,en:"circle",ans:_,a:"style-name"},{ens:f,en:"connector",ans:_,a:"style-name"},{ens:f,en:"control",ans:_,a:"style-name"},{ens:f,en:"custom-shape",ans:_,a:"style-name"},{ens:f,en:"ellipse",ans:_,a:"style-name"},{ens:f,en:"frame",ans:_,a:"style-name"},{ens:f,en:"g",ans:_,a:"style-name"},{ens:f,en:"line",ans:_,a:"style-name"},{ens:f,en:"measure",ans:_,a:"style-name"},{ens:f,en:"page-thumbnail",ans:_,a:"style-name"},{ens:f,en:"path",ans:_,a:"style-name"},{ens:f,en:"polygon",ans:_,a:"style-name"},{ens:f,en:"polyline",ans:_,a:"style-name"},{ens:f,en:"rect",ans:_,a:"style-name"},{ens:f,en:"regular-polygon",ans:_,a:"style-name"},{ens:g,en:"annotation",ans:_,a:"style-name"}],"drawing-page":[{ens:f,en:"page",ans:f,a:"style-name"},{ens:_,en:"notes",ans:f,a:"style-name"},{ens:v,en:"handout-master",ans:f,a:"style-name"},{ens:v,en:"master-page",ans:f,a:"style-name"}],"list-style":[{ens:y,en:"list",ans:y,a:"style-name"},{ens:y,en:"numbered-paragraph",ans:y,a:"style-name"},{ens:y,en:"list-item",ans:y,a:"style-override"},{ens:v,en:"style",ans:v,a:"list-style-name"}],data:[{ens:v,en:"style",ans:v,a:"data-style-name"},{ens:v,en:"style",ans:v,a:"percentage-data-style-name"},{ens:_,en:"date-time-decl",ans:v,a:"data-style-name"},{ens:y,en:"creation-date",ans:v,a:"data-style-name"},{ens:y,en:"creation-time",ans:v,a:"data-style-name"},{ens:y,en:"database-display",ans:v,a:"data-style-name"},{ens:y,en:"date",ans:v,a:"data-style-name"},{ens:y,en:"editing-duration",ans:v,a:"data-style-name"},{ens:y,en:"expression",ans:v,a:"data-style-name"},{ens:y,en:"meta-field",ans:v,a:"data-style-name"},{ens:y,en:"modification-date",ans:v,a:"data-style-name"},{ens:y,en:"modification-time",ans:v,a:"data-style-name"},{ens:y,en:"print-date",ans:v,a:"data-style-name"},{ens:y,en:"print-time",ans:v,a:"data-style-name"},{ens:y,en:"table-formula",ans:v,a:"data-style-name"},{ens:y,en:"time",ans:v,a:"data-style-name"},{ens:y,en:"user-defined",ans:v,a:"data-style-name"},{ens:y,en:"user-field-get",ans:v,a:"data-style-name"},{ens:y,en:"user-field-input",ans:v,a:"data-style-name"},{ens:y,en:"variable-get",ans:v,a:"data-style-name"},{ens:y,en:"variable-input",ans:v,a:"data-style-name"},{ens:y,en:"variable-set",ans:v,a:"data-style-name"}],"page-layout":[{ens:_,en:"notes",ans:v,a:"page-layout-name"},{ens:v,en:"handout-master",ans:v,a:"page-layout-name"},{ens:v,en:"master-page",ans:v,a:"page-layout-name"}]},S=xmldom.XPath;this.collectUsedFontFaces=function e(t,n){function i(e){(e=o.getAttributeNS(v,e))&&(t[e]=!0)}var r,o,a=["font-name","font-name-asian","font-name-complex"];for(r=n&&n.firstElementChild;r;)o=r,a.forEach(i),e(t,o),r=r.nextElementSibling},this.changeFontFaceNames=function e(t,n){function i(e){var t=o.getAttributeNS(v,e);t&&n.hasOwnProperty(t)&&o.setAttributeNS(v,"style:"+e,n[t])}var r,o,a=["font-name","font-name-asian","font-name-complex"];for(r=t&&t.firstElementChild;r;)o=r,a.forEach(i),e(o,n),r=r.nextElementSibling},this.UsedStyleList=function(e,t){var n={};this.uses=function(e){var t=e.localName,i=e.getAttributeNS(f,"name")||e.getAttributeNS(v,"name");return e="style"===t?e.getAttributeNS(v,"family"):e.namespaceURI===m?"data":t,!!(e=n[e])&&0<e[i]},i(e,n),t&&l(t,n)},this.getStyleName=function(e,t){var n,i,r=d[t.localName];if(r&&(r=r[t.namespaceURI]))for(i=0;i<r.length;i+=1)if(r[i].keyname===e&&(r=r[i],t.hasAttributeNS(r.ns,r.localname))){n=t.getAttributeNS(r.ns,r.localname);break}return n},this.hasDerivedStyles=function(e,t,n){var i=n.getAttributeNS(v,"name");return n=n.getAttributeNS(v,"family"),!!S.getODFElementsWithXPath(e,'//style:*[@style:parent-style-name="'+i+'"][@style:family="'+n+'"]',t).length},this.prefixStyleNames=function(t,n,i){var r;if(t){for(r=t.firstChild;r;){if(r.nodeType===Node.ELEMENT_NODE){var o=r,a=n,s=o.getAttributeNS(f,"name"),l=void 0;s?l=f:(s=o.getAttributeNS(v,"name"))&&(l=v),l&&o.setAttributeNS(l,x[l]+"name",a+s)}r=r.nextSibling}e(t,n),i&&e(i,n)}},this.removePrefixFromStyleNames=function(e,n,i){var r=new RegExp("^"+n);if(e){for(n=e.firstChild;n;){if(n.nodeType===Node.ELEMENT_NODE){var o=n,a=r,s=o.getAttributeNS(f,"name"),l=void 0;s?l=f:(s=o.getAttributeNS(v,"name"))&&(l=v),l&&(s=s.replace(a,""),o.setAttributeNS(l,x[l]+"name",s))}n=n.nextSibling}t(e,r),i&&t(i,r)}},this.determineStylesForNode=n,d=function(){var e,t,n,i,r,o,a,s,l,d={};for(n in w)if(w.hasOwnProperty(n))for(t=(i=w[n]).length,e=0;e<t;e+=1)s=(r=i[e]).en,l=r.ens,d.hasOwnProperty(s)?o=d[s]:d[s]=o={},o.hasOwnProperty(l)?a=o[l]:o[l]=a=[],a.push({ns:r.ans,localname:r.a,keyname:n});return d}()},"function"!=typeof Object.create&&(Object.create=function(e){var t=function(){};return t.prototype=e,new t}),xmldom.LSSerializer=function(){function e(e){var t=e||{},n=function(e){var t,n={};for(t in e)e.hasOwnProperty(t)&&(n[e[t]]=t);return n}(e),i=[t],r=[n],o=0;this.push=function(){t=i[o+=1]=Object.create(t),n=r[o]=Object.create(n)},this.pop=function(){i.pop(),r.pop(),--o,t=i[o],n=r[o]},this.getLocalNamespaceDefinitions=function(){return n},this.getQName=function(e){var i,r=e.namespaceURI,o=0;if(!r)return e.localName;if(i=n[r])return i+":"+e.localName;do{if(i||!e.prefix?(i="ns"+o,o+=1):i=e.prefix,t[i]===r)break;if(!t[i]){t[i]=r,n[r]=i;break}i=null}while(null===i);return i+":"+e.localName}}function t(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&apos;").replace(/"/g,"&quot;")}function n(e,r){var o,a="",s=i.filter?i.filter.acceptNode(r):NodeFilter.FILTER_ACCEPT;if(s===NodeFilter.FILTER_ACCEPT&&r.nodeType===Node.ELEMENT_NODE){e.push(),o=e.getQName(r);var l,d,u,c,h=r.attributes,f="";for(l="<"+o,d=h.length,u=0;u<d;u+=1)"http://www.w3.org/2000/xmlns/"!==(c=h.item(u)).namespaceURI&&((i.filter?i.filter.acceptNode(c):NodeFilter.FILTER_ACCEPT)===NodeFilter.FILTER_ACCEPT&&(f+=" "+e.getQName(c)+'="'+(c="string"==typeof c.value?t(c.value):c.value)+'"'));for(u in d=e.getLocalNamespaceDefinitions())d.hasOwnProperty(u)&&((h=d[u])?"xmlns"!==h&&(l+=" xmlns:"+d[u]+'="'+u+'"'):l+=' xmlns="'+u+'"');a+=l+(f+">")}if(s===NodeFilter.FILTER_ACCEPT||s===NodeFilter.FILTER_SKIP){for(s=r.firstChild;s;)a+=n(e,s),s=s.nextSibling;r.nodeValue&&(a+=t(r.nodeValue))}return o&&(a+="</"+o+">",e.pop()),a}var i=this;this.filter=null,this.writeToString=function(t,i){return t?n(new e(i),t):""}},function(){function e(e){var t,n=s.length;for(t=0;t<n;t+=1)if("urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&e.localName===s[t])return t;return-1}function t(e,t){var n=new r.UsedStyleList(e,t),i=new odf.OdfNodeFilter;this.acceptNode=function(e){var r=i.acceptNode(e);return r===NodeFilter.FILTER_ACCEPT&&e.parentNode===t&&e.nodeType===Node.ELEMENT_NODE&&(r=n.uses(e)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT),r}}function n(e,n){var i=new t(e,n);this.acceptNode=function(e){var t=i.acceptNode(e);return t!==NodeFilter.FILTER_ACCEPT||!e.parentNode||e.parentNode.namespaceURI!==odf.Namespaces.textns||"s"!==e.parentNode.localName&&"tab"!==e.parentNode.localName||(t=NodeFilter.FILTER_REJECT),t}}function i(t,n){if(n){var i,r=e(n),o=t.firstChild;if(-1!==r){for(;o&&!(-1!==(i=e(o))&&i>r);)o=o.nextSibling;t.insertBefore(n,o)}}}var r=new odf.StyleInfo,o=core.DomUtils,a=odf.Namespaces.stylens,s="meta settings scripts font-face-decls styles automatic-styles master-styles body".split(" "),l=Date.now()+"_webodf_",d=new core.Base64;odf.ODFElement=function(){},odf.ODFDocumentElement=function(){},odf.ODFDocumentElement.prototype=new odf.ODFElement,odf.ODFDocumentElement.prototype.constructor=odf.ODFDocumentElement,odf.ODFDocumentElement.prototype.fontFaceDecls=null,odf.ODFDocumentElement.prototype.manifest=null,odf.ODFDocumentElement.prototype.settings=null,odf.ODFDocumentElement.namespaceURI="urn:oasis:names:tc:opendocument:xmlns:office:1.0",odf.ODFDocumentElement.localName="document",odf.AnnotationElement=function(){},odf.OdfPart=function(e,t,n,i){var r=this;this.size=0,this.type=null,this.name=e,this.container=n,this.url=null,this.mimetype=t,this.onstatereadychange=this.document=null,this.EMPTY=0,this.LOADING=1,this.DONE=2,this.state=this.EMPTY,this.data="",this.load=function(){null!==i&&(this.mimetype=t,i.loadAsDataURL(e,t,function(e,t){e&&runtime.log(e),r.url=t,r.onchange&&r.onchange(r),r.onstatereadychange&&r.onstatereadychange(r)}))}},odf.OdfPart.prototype.load=function(){},odf.OdfPart.prototype.getUrl=function(){return this.data?"data:;base64,"+d.toBase64(this.data):null},odf.OdfContainer=function e(s,u){function c(e){for(var t,n=e.firstChild;n;)t=n.nextSibling,n.nodeType===Node.ELEMENT_NODE?c(n):n.nodeType===Node.PROCESSING_INSTRUCTION_NODE&&e.removeChild(n),n=t}function h(e){var t,n,i={},r=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_ELEMENT,null,!1);for(e=r.nextNode();e;)"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&("annotation"===e.localName?(t=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))&&(i.hasOwnProperty(t)?runtime.log("Warning: annotation name used more than once with <office:annotation/>: '"+t+"'"):i[t]=e):"annotation-end"===e.localName&&((t=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","name"))?i.hasOwnProperty(t)?(n=i[t]).annotationEndElement?runtime.log("Warning: annotation name used more than once with <office:annotation-end/>: '"+t+"'"):n.annotationEndElement=e:runtime.log("Warning: annotation end without an annotation start, name: '"+t+"'"):runtime.log("Warning: annotation end without a name found"))),e=r.nextNode()}function f(e,t){for(var n=e&&e.firstChild;n;)n.nodeType===Node.ELEMENT_NODE&&n.setAttributeNS("urn:webodf:names:scope","scope",t),n=n.nextSibling}function p(e,t){for(var n=(n=B.rootElement.meta)&&n.firstChild;n&&(n.namespaceURI!==e||n.localName!==t);)n=n.nextSibling;for(n=n&&n.firstChild;n&&n.nodeType!==Node.TEXT_NODE;)n=n.nextSibling;return n?n.data:null}function m(e){var t={};for(e=e.firstChild;e;)e.nodeType===Node.ELEMENT_NODE&&e.namespaceURI===a&&"font-face"===e.localName&&(t[e.getAttributeNS(a,"name")]=e),e=e.nextSibling;return t}function g(e,t){var n,i,r,o=null;if(e)for(n=(o=e.cloneNode(!0)).firstElementChild;n;)i=n.nextElementSibling,(r=n.getAttributeNS("urn:webodf:names:scope","scope"))&&r!==t&&o.removeChild(n),n=i;return o}function _(e,t){var n,i,o,s=null,l={};if(e)for(t.forEach(function(e){r.collectUsedFontFaces(l,e)}),n=(s=e.cloneNode(!0)).firstElementChild;n;)i=n.nextElementSibling,o=n.getAttributeNS(a,"name"),l[o]||s.removeChild(n),n=i;return s}function v(e){var t,n=B.rootElement.ownerDocument;if(e){c(e.documentElement);try{t=n.importNode(e.documentElement,!0)}catch(e){}}return t}function b(e){B.state=e,B.onchange&&B.onchange(B),B.onstatereadychange&&B.onstatereadychange(B)}function y(e){L=null,B.rootElement=e,e.fontFaceDecls=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),e.styles=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),e.automaticStyles=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),e.masterStyles=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),e.body=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body"),e.meta=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),e.settings=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),e.scripts=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","scripts"),h(e)}function x(t){var n,a=v(t),s=B.rootElement;a&&"document-styles"===a.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===a.namespaceURI?(s.fontFaceDecls=o.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),i(s,s.fontFaceDecls),n=o.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),s.styles=n||t.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","styles"),i(s,s.styles),n=o.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),s.automaticStyles=n||t.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),f(s.automaticStyles,"document-styles"),i(s,s.automaticStyles),a=o.getDirectChild(a,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),s.masterStyles=a||t.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","master-styles"),i(s,s.masterStyles),r.prefixStyleNames(s.automaticStyles,l,s.masterStyles)):b(e.INVALID)}function w(t){var n,s,l,d;if((t=v(t))&&"document-content"===t.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===t.namespaceURI){if(n=B.rootElement,l=o.getDirectChild(t,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","font-face-decls"),n.fontFaceDecls&&l){var u,c,h,p,g={};for(s=m(d=n.fontFaceDecls),p=m(l),l=l.firstElementChild;l;){if(u=l.nextElementSibling,l.namespaceURI===a&&"font-face"===l.localName)if(c=l.getAttributeNS(a,"name"),s.hasOwnProperty(c)){if(!l.isEqualNode(s[c])){var _=s,y=p,x=0,w=void 0;for(w=h=(h=c).replace(/\d+$/,"");_.hasOwnProperty(w)||y.hasOwnProperty(w);)w=h+(x+=1);h=w,l.setAttributeNS(a,"style:name",h),d.appendChild(l),s[h]=l,delete p[c],g[c]=h}}else d.appendChild(l),s[c]=l,delete p[c];l=u}d=g}else l&&(n.fontFaceDecls=l,i(n,l));if(f(s=o.getDirectChild(t,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","automatic-styles"),"document-content"),d&&r.changeFontFaceNames(s,d),n.automaticStyles&&s)for(d=s.firstChild;d;)n.automaticStyles.appendChild(d),d=s.firstChild;else s&&(n.automaticStyles=s,i(n,s));if(null===(t=o.getDirectChild(t,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","body")))throw"<office:body/> tag is mising.";n.body=t,i(n,n.body)}else b(e.INVALID)}function S(e){var t;(e=v(e))&&"document-meta"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&((t=B.rootElement).meta=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),i(t,t.meta))}function N(e){var t;(e=v(e))&&"document-settings"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===e.namespaceURI&&((t=B.rootElement).settings=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","settings"),i(t,t.settings))}function E(e){var t;if((e=v(e))&&"manifest"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===e.namespaceURI)for((t=B.rootElement).manifest=e,e=t.manifest.firstElementChild;e;)"file-entry"===e.localName&&"urn:oasis:names:tc:opendocument:xmlns:manifest:1.0"===e.namespaceURI&&(U[e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","full-path")]=e.getAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","media-type")),e=e.nextElementSibling}function C(e,t,n){var i;for(e=o.getElementsByTagName(e,t),i=0;i<e.length;i+=1)t=e[i],n.hasOwnProperty(t.namespaceURI)||t.parentNode.removeChild(t)}function k(e){C(e,"script",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:office:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:table:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:text:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0":!0}),C(e,"style",{"urn:oasis:names:tc:opendocument:xmlns:datastyle:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:drawing:1.0":!0,"urn:oasis:names:tc:opendocument:xmlns:style:1.0":!0})}function T(e){var t,n,i,r=e.firstElementChild,o=[],a=e.attributes,s=a.length;for(t=0;t<s;t+=1)n=(i=a.item(t)).localName.substr(0,2).toLowerCase(),null===i.namespaceURI&&"on"===n&&o.push(i);for(s=o.length,t=0;t<s;t+=1)e.removeAttributeNode(o[t]);for(;r;)T(r),r=r.nextElementSibling}function A(t){var n=t.shift();n?F.loadAsDOM(n.path,function(i,r){r&&(k(r),T(r.documentElement)),n.handler(r),B.state===e.INVALID?i?runtime.log("ERROR: Unable to load "+n.path+" - "+i):runtime.log("ERROR: Unable to load "+n.path):(i&&runtime.log("DEBUG: Unable to load "+n.path+" - "+i),A(t))}):(h(B.rootElement),b(e.DONE))}function O(e){var t="";return odf.Namespaces.forEachPrefix(function(e,n){t+=" xmlns:"+e+'="'+n+'"'}),'<?xml version="1.0" encoding="UTF-8"?><office:'+e+" "+t+' office:version="1.2">'}function D(e,t){var n=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:file-entry");return n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:full-path",e),n.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:manifest:1.0","manifest:media-type",t),n}function R(e,t){var n,r=(n=B.rootElement).meta;r||(n.meta=r=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0","meta"),i(n,r)),n=r,e&&o.mapKeyValObjOntoNode(n,e,odf.Namespaces.lookupNamespaceURI),t&&o.removeKeyElementsFromNode(n,t,odf.Namespaces.lookupNamespaceURI)}function P(t,n){function i(e,t){var n;t||(t=e),n=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",t),s[e]=n,s.appendChild(n)}var r=new core.Zip("",null),o="application/vnd.oasis.opendocument."+t+(!0===n?"-template":""),a=runtime.byteArrayFromString(o,"utf8"),s=B.rootElement,l=document.createElementNS("urn:oasis:names:tc:opendocument:xmlns:office:1.0",t);return r.save("mimetype",a,!1,new Date),i("meta"),i("settings"),i("scripts"),i("fontFaceDecls","font-face-decls"),i("styles"),i("automaticStyles","automatic-styles"),i("masterStyles","master-styles"),i("body"),s.body.appendChild(l),U["/"]=o,U["settings.xml"]="text/xml",U["meta.xml"]="text/xml",U["styles.xml"]="text/xml",U["content.xml"]="text/xml",b(e.DONE),r}function M(){var e,i=new Date,o="";B.rootElement.settings&&B.rootElement.settings.firstElementChild&&(e=new xmldom.LSSerializer,o=O("document-settings"),e.filter=new odf.OdfNodeFilter,o+=e.writeToString(B.rootElement.settings,odf.Namespaces.namespaceMap),o+="</office:document-settings>"),(e=o)?(e=runtime.byteArrayFromString(e,"utf8"),F.save("settings.xml",e,!0,i)):F.remove("settings.xml"),o=runtime.getWindow(),e="WebODF/"+webodf.Version,o&&(e=e+" "+o.navigator.userAgent),R({"meta:generator":e},null),e=runtime.byteArrayFromString(function(){var e=new xmldom.LSSerializer,t=O("document-meta");return e.filter=new odf.OdfNodeFilter,(t+=e.writeToString(B.rootElement.meta,odf.Namespaces.namespaceMap))+"</office:document-meta>"}(),"utf8"),F.save("meta.xml",e,!0,i),e=runtime.byteArrayFromString(function(){var e,n,i,o=odf.Namespaces.namespaceMap,a=new xmldom.LSSerializer,s=O("document-styles");return n=g(B.rootElement.automaticStyles,"document-styles"),i=B.rootElement.masterStyles.cloneNode(!0),e=_(B.rootElement.fontFaceDecls,[i,B.rootElement.styles,n]),r.removePrefixFromStyleNames(n,l,i),a.filter=new t(i,n),s+=a.writeToString(e,o),s+=a.writeToString(B.rootElement.styles,o),s+=a.writeToString(n,o),(s+=a.writeToString(i,o))+"</office:document-styles>"}(),"utf8"),F.save("styles.xml",e,!0,i),e=runtime.byteArrayFromString(function(){var e,t,i=odf.Namespaces.namespaceMap,r=new xmldom.LSSerializer,o=O("document-content");return t=g(B.rootElement.automaticStyles,"document-content"),e=_(B.rootElement.fontFaceDecls,[t]),r.filter=new n(B.rootElement.body,t),o+=r.writeToString(e,i),o+=r.writeToString(t,i),(o+=r.writeToString(B.rootElement.body,i))+"</office:document-content>"}(),"utf8"),F.save("content.xml",e,!0,i),e=runtime.byteArrayFromString(function(){var e,t=runtime.parseXML('<manifest:manifest xmlns:manifest="urn:oasis:names:tc:opendocument:xmlns:manifest:1.0" manifest:version="1.2"></manifest:manifest>'),n=t.documentElement,i=new xmldom.LSSerializer;for(e in U)U.hasOwnProperty(e)&&n.appendChild(D(e,U[e]));return i.filter=new odf.OdfNodeFilter,'<?xml version="1.0" encoding="UTF-8" standalone="yes"?>\n'+i.writeToString(t,odf.Namespaces.namespaceMap)}(),"utf8"),F.save("META-INF/manifest.xml",e,!0,i)}function I(e,t){M(),F.writeAs(e,function(e){t(e)})}var F,L,B=this,U={},z="";this.onstatereadychange=u,this.state=this.onchange=null,this.getMetadata=p,this.setRootElement=y,this.getContentElement=function(){var e;if(L||(e=B.rootElement.body,L=o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","text")||o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","presentation")||o.getDirectChild(e,"urn:oasis:names:tc:opendocument:xmlns:office:1.0","spreadsheet")),!L)throw"Could not find content element in <office:body/>.";return L},this.getDocumentType=function(){var e=B.getContentElement();return e&&e.localName},this.isTemplate=function(){return"-template"===U["/"].substr(-9)},this.setIsTemplate=function(e){var t=U["/"];e!==("-template"===t.substr(-9))&&(t=e?t+"-template":t.substr(0,t.length-9),U["/"]=t,e=runtime.byteArrayFromString(t,"utf8"),F.save("mimetype",e,!1,new Date))},this.getPart=function(e){return new odf.OdfPart(e,U[e],B,F)},this.getPartData=function(e,t){F.load(e,t)},this.setMetadata=R,this.incrementEditingCycles=function(){var e=(e=p(odf.Namespaces.metans,"editing-cycles"))?parseInt(e,10):0;return isNaN(e)&&(e=0),R({"meta:editing-cycles":e+1},null),e+1},this.createByteArray=function(e,t){M(),F.createByteArray(e,t)},this.saveAs=I,this.save=function(e){I(z,e)},this.getUrl=function(){return z},this.setBlob=function(e,t,n){n=d.convertBase64ToByteArray(n),F.save(e,n,!1,new Date),U.hasOwnProperty(e)&&runtime.log(e+" has been overwritten."),U[e]=t},this.removeBlob=function(e){var t=F.remove(e);runtime.assert(t,"file is not found: "+e),delete U[e]},this.state=e.LOADING,this.rootElement=function(e){var t,n=document.createElementNS(e.namespaceURI,e.localName);for(t in e=new e.Type)e.hasOwnProperty(t)&&(n[t]=e[t]);return n}({Type:odf.ODFDocumentElement,namespaceURI:odf.ODFDocumentElement.namespaceURI,localName:odf.ODFDocumentElement.localName}),s===odf.OdfContainer.DocumentType.TEXT?F=P("text"):s===odf.OdfContainer.DocumentType.TEXT_TEMPLATE?F=P("text",!0):s===odf.OdfContainer.DocumentType.PRESENTATION?F=P("presentation"):s===odf.OdfContainer.DocumentType.PRESENTATION_TEMPLATE?F=P("presentation",!0):s===odf.OdfContainer.DocumentType.SPREADSHEET?F=P("spreadsheet"):s===odf.OdfContainer.DocumentType.SPREADSHEET_TEMPLATE?F=P("spreadsheet",!0):(z=s,F=new core.Zip(z,function(t,n){F=n,t?function(t,n){runtime.loadXML(t,function(t,i){if(t)n(t);else if(i){k(i),T(i.documentElement);var r=v(i);r&&"document"===r.localName&&"urn:oasis:names:tc:opendocument:xmlns:office:1.0"===r.namespaceURI?(y(r),b(e.DONE)):b(e.INVALID)}else n("No DOM was loaded.")})}(z,function(n){t&&(F.error=t+"\n"+n,b(e.INVALID))}):A([{path:"styles.xml",handler:x},{path:"content.xml",handler:w},{path:"meta.xml",handler:S},{path:"settings.xml",handler:N},{path:"META-INF/manifest.xml",handler:E}])}))},odf.OdfContainer.EMPTY=0,odf.OdfContainer.LOADING=1,odf.OdfContainer.DONE=2,odf.OdfContainer.INVALID=3,odf.OdfContainer.SAVING=4,odf.OdfContainer.MODIFIED=5,odf.OdfContainer.getContainer=function(e){return new odf.OdfContainer(e,null)}}(),odf.OdfContainer.DocumentType={TEXT:1,TEXT_TEMPLATE:2,PRESENTATION:3,PRESENTATION_TEMPLATE:4,SPREADSHEET:5,SPREADSHEET_TEMPLATE:6},gui.AnnotatableCanvas=function(){},gui.AnnotatableCanvas.prototype.refreshSize=function(){},gui.AnnotatableCanvas.prototype.getZoomLevel=function(){},gui.AnnotatableCanvas.prototype.getSizer=function(){},gui.AnnotationViewManager=function(e,t,n,i){function r(e){var t=e.annotationEndElement,n=d.createRange(),i=e.getAttributeNS(odf.Namespaces.officens,"name");t&&(n.setStart(e,e.childNodes.length),n.setEnd(t,0),(e=u.getTextNodes(n,!1)).forEach(function(e){var t;e:{for(t=e.parentNode;t.namespaceURI!==odf.Namespaces.officens||"body"!==t.localName;){if("http://www.w3.org/1999/xhtml"===t.namespaceURI&&"webodf-annotationHighlight"===t.className&&t.getAttribute("annotation")===i){t=!0;break e}t=t.parentNode}t=!1}t||((t=d.createElement("span")).className="webodf-annotationHighlight",t.setAttribute("annotation",i),e.parentNode.replaceChild(t,e),t.appendChild(e))})),n.detach()}function o(t){var i=e.getSizer();t?(n.style.display="inline-block",i.style.paddingRight=c.getComputedStyle(n).width):(n.style.display="none",i.style.paddingRight=0),e.refreshSize()}function a(){var t;for(t=0;t<l.length;t+=1){var i=(d=l[t]).parentNode,r=(u=i.nextElementSibling).nextElementSibling,o=i.parentNode,a=0,s=(a=l[l.indexOf(d)-1],void 0),d=e.getZoomLevel();i.style.left=(n.getBoundingClientRect().left-o.getBoundingClientRect().left)/d+"px",i.style.width=n.getBoundingClientRect().width/d+"px",u.style.width=parseFloat(i.style.left)-30+"px",a?(s=a.parentNode.getBoundingClientRect(),20>=(o.getBoundingClientRect().top-s.bottom)/d?i.style.top=Math.abs(o.getBoundingClientRect().top-s.bottom)/d+20+"px":i.style.top="0px"):i.style.top="0px",r.style.left=u.getBoundingClientRect().width/d+"px";var u=r.style,c=(o=r.getBoundingClientRect().left/d,a=r.getBoundingClientRect().top/d,0),h=0;c=(c=(s=i.getBoundingClientRect().left/d)-o)*c,h=(h=i.getBoundingClientRect().top/d-a)*h,o=Math.sqrt(c+h);u.width=o+"px",a=Math.asin((i.getBoundingClientRect().top-r.getBoundingClientRect().top)/(d*parseFloat(r.style.width))),r.style.transform="rotate("+a+"rad)",r.style.MozTransform="rotate("+a+"rad)",r.style.WebkitTransform="rotate("+a+"rad)",r.style.msTransform="rotate("+a+"rad)"}}function s(e){var t=l.indexOf(e);"div"===(i=e.parentNode.parentNode).localName&&(i.parentNode.insertBefore(e,i),i.parentNode.removeChild(i)),e=e.getAttributeNS(odf.Namespaces.officens,"name"),e=d.querySelectorAll('span.webodf-annotationHighlight[annotation="'+e+'"]');for(var n,i=0;i<e.length;i+=1){for(n=e.item(i);n.firstChild;)n.parentNode.insertBefore(n.firstChild,n);n.parentNode.removeChild(n)}-1!==t&&l.splice(t,1),0===l.length&&o(!1)}var l=[],d=t.ownerDocument,u=odf.OdfUtils,c=runtime.getWindow();runtime.assert(Boolean(c),"Expected to be run in an environment which has a global window, like a browser."),this.rerenderAnnotations=a,this.rehighlightAnnotations=function(){l.forEach(function(e){r(e)})},this.getMinimumHeightForAnnotationPane=function(){return"none"!==n.style.display&&0<l.length?(l[l.length-1].parentNode.getBoundingClientRect().bottom-n.getBoundingClientRect().top)/e.getZoomLevel()+"px":null},this.addAnnotations=function(e){0!==e.length&&(o(!0),e.forEach(function(e){l.push(e);var t,n=d.createElement("div"),o=d.createElement("div"),a=d.createElement("div"),s=d.createElement("div");n.className="annotationWrapper",n.setAttribute("creator",u.getAnnotationCreator(e)),e.parentNode.insertBefore(n,e),o.className="annotationNote",o.appendChild(e),i&&((t=d.createElement("div")).className="annotationRemoveButton",o.appendChild(t)),a.className="annotationConnector horizontal",s.className="annotationConnector angular",n.appendChild(o),n.appendChild(a),n.appendChild(s),e.annotationEndElement&&r(e)}),l.sort(function(e,t){return 0!=(e.compareDocumentPosition(t)&Node.DOCUMENT_POSITION_FOLLOWING)?-1:1}),a())},this.forgetAnnotation=s,this.forgetAnnotations=function(){for(;l.length;)s(l[0])}},gui.Viewport=function(){},gui.Viewport.prototype.scrollIntoView=function(e,t){},gui.SingleScrollViewport=function(e){this.scrollIntoView=function(t,n){var i,r,o,a;a=e.offsetHeight-e.clientHeight,o=e.offsetWidth-e.clientWidth;var s=e.getBoundingClientRect();t&&s&&(i=s.left+5,r=s.top+5,o=s.right-(o+5),a=s.bottom-(a+5),n||t.top<r?e.scrollTop-=r-t.top:(t.top>a||t.bottom>a)&&(e.scrollTop=t.bottom-t.top<=a-r?e.scrollTop+(t.bottom-a):e.scrollTop+(t.top-r)),t.left<i?e.scrollLeft-=i-t.left:t.right>o&&(e.scrollLeft=t.right-t.left<=o-i?e.scrollLeft+(t.right-o):e.scrollLeft-(i-t.left)))}},function(){function e(t,n,r,o,a){var s,l,d=0;for(l in t)if(t.hasOwnProperty(l)){if(d===r){s=l;break}d+=1}s?n.getPartData(t[s].href,function(l,d){if(l)runtime.log(l);else if(d){var u="@font-face { font-family: "+(t[s].family||s)+"; src: url(data:application/x-font-ttf;charset=binary;base64,"+i.convertUTF8ArrayToBase64(d)+') format("truetype"); }';try{o.insertRule(u,o.cssRules.length)}catch(e){runtime.log("Problem inserting rule in CSS: "+runtime.toJson(e)+"\nRule: "+u)}}else runtime.log("missing font data for "+t[s].href);e(t,n,r+1,o,a)}):a&&a()}var t=xmldom.XPath,n=odf.OdfUtils,i=new core.Base64;odf.FontLoader=function(){this.loadFonts=function(i,r){for(var o=i.rootElement.fontFaceDecls;r.cssRules.length;)r.deleteRule(r.cssRules.length-1);if(o){var a,s,l,d,u={};if(o)for(o=t.getODFElementsWithXPath(o,"style:font-face[svg:font-face-src]",odf.Namespaces.lookupNamespaceURI),a=0;a<o.length;a+=1)l=(s=o[a]).getAttributeNS(odf.Namespaces.stylens,"name"),d=n.getNormalizedFontFamilyName(s.getAttributeNS(odf.Namespaces.svgns,"font-family")),0<(s=t.getODFElementsWithXPath(s,"svg:font-face-src/svg:font-face-uri",odf.Namespaces.lookupNamespaceURI)).length&&(s=s[0].getAttributeNS(odf.Namespaces.xlinkns,"href"),u[l]={href:s,family:d});e(u,i,0,r)}}}}(),odf.Formatting=function(){function e(e){return(e=w[e])?y.mergeObjects({},e):{}}function t(){for(var e,t,n={},i=(i=c.rootElement.fontFaceDecls)&&i.firstElementChild;i;)(e=i.getAttributeNS(p,"name"))&&((t=i.getAttributeNS(f,"font-family"))||0<i.getElementsByTagNameNS(f,"font-face-uri").length)&&(n[e]=t),i=i.nextElementSibling;return n}function n(e){for(var t=c.rootElement.styles.firstElementChild;t;){if(t.namespaceURI===p&&"default-style"===t.localName&&t.getAttributeNS(p,"family")===e)return t;t=t.nextElementSibling}return null}function i(e,t,n){var i,r,o;for(n=n||[c.rootElement.automaticStyles,c.rootElement.styles],o=0;o<n.length;o+=1)for(i=(i=n[o]).firstElementChild;i;){if(r=i.getAttributeNS(p,"name"),i.namespaceURI===p&&"style"===i.localName&&i.getAttributeNS(p,"family")===t&&r===e||"list-style"===t&&i.namespaceURI===m&&"list-style"===i.localName&&r===e||"data"===t&&i.namespaceURI===g&&r===e)return i;i=i.nextElementSibling}return null}function r(e){for(var t,n,i,r,o={},a=e.firstElementChild;a;){if(a.namespaceURI===p)for(i=o[a.nodeName]={},n=a.attributes,t=0;t<n.length;t+=1)i[(r=n.item(t)).name]=r.value;a=a.nextElementSibling}for(n=e.attributes,t=0;t<n.length;t+=1)o[(r=n.item(t)).name]=r.value;return o}function o(t,o){for(var a,s=c.rootElement.styles,l={},d=t.getAttributeNS(p,"family"),u=t;u;)a=r(u),l=y.mergeObjects(a,l),u=(a=u.getAttributeNS(p,"parent-style-name"))?i(a,d,[s]):null;return(u=n(d))&&(a=r(u),l=y.mergeObjects(a,l)),!1!==o&&(a=e(d),l=y.mergeObjects(a,l)),l}function a(e,t){for(var n,i=e.nodeType===Node.TEXT_NODE?e.parentNode:e,r=[],o="",a=!1;i&&!v.isInlineRoot(i)&&i.parentNode!==c.rootElement;)!a&&v.isGroupingElement(i)&&(a=!0),(n=h.determineStylesForNode(i))&&r.push(n),i=i.parentNode;return a&&(r.forEach(function(e){Object.keys(e).forEach(function(t){Object.keys(e[t]).forEach(function(e){o+="|"+t+":"+e+"|"})})}),t&&(t[o]=r)),a?r:void 0}function s(e){var t={orderedStyles:[],styleProperties:{}};return e.forEach(function(e){Object.keys(e).forEach(function(n){var r,a=Object.keys(e[n])[0],s={name:a,family:n,displayName:void 0,isCommonStyle:!1};(r=i(a,n))?(n=o(r),t.styleProperties=y.mergeObjects(n,t.styleProperties),s.displayName=r.getAttributeNS(p,"display-name")||void 0,s.isCommonStyle=r.parentNode===c.rootElement.styles):runtime.log("No style element found for '"+a+"' of family '"+n+"'"),t.orderedStyles.push(s)})}),t}function l(e,t){var n={},i=[];return t||(t={}),e.forEach(function(e){a(e,n)}),Object.keys(n).forEach(function(e){t[e]||(t[e]=s(n[e])),i.push(t[e])}),i}function d(e){for(var t=c.rootElement.masterStyles.firstElementChild;t&&(t.namespaceURI!==p||"master-page"!==t.localName||t.getAttributeNS(p,"name")!==e);)t=t.nextElementSibling;return t}function u(e,t){var n;return e&&(n=x.convertMeasure(e,"px")),void 0===n&&t&&(n=x.convertMeasure(t,"px")),n}var c,h=new odf.StyleInfo,f=odf.Namespaces.svgns,p=odf.Namespaces.stylens,m=odf.Namespaces.textns,g=odf.Namespaces.numberns,_=odf.Namespaces.fons,v=odf.OdfUtils,b=core.DomUtils,y=new core.Utils,x=new core.CSSUnits,w={paragraph:{"style:paragraph-properties":{"fo:text-align":"left"}}};this.getSystemDefaultStyleAttributes=e,this.setOdfContainer=function(e){c=e},this.getFontMap=t,this.getAvailableParagraphStyles=function(){for(var e,t,n=[],i=(i=c.rootElement.styles)&&i.firstElementChild;i;)"style"===i.localName&&i.namespaceURI===p&&("paragraph"===(e=i.getAttributeNS(p,"family"))&&(e=i.getAttributeNS(p,"name"),t=i.getAttributeNS(p,"display-name")||e,e&&t&&n.push({name:e,displayName:t}))),i=i.nextElementSibling;return n},this.isStyleUsed=function(e){var t,n=c.rootElement;return t=h.hasDerivedStyles(n,odf.Namespaces.lookupNamespaceURI,e),e=new h.UsedStyleList(n.styles).uses(e)||new h.UsedStyleList(n.automaticStyles).uses(e)||new h.UsedStyleList(n.body).uses(e),t||e},this.getDefaultStyleElement=n,this.getStyleElement=i,this.getStyleAttributes=r,this.getInheritedStyleAttributes=o,this.getFirstCommonParentStyleNameOrSelf=function(e){var t,n=c.rootElement.styles;return(t=i(e,"paragraph",[c.rootElement.automaticStyles]))&&!(e=t.getAttributeNS(p,"parent-style-name"))?null:(t=i(e,"paragraph",[n]))?e:null},this.hasParagraphStyle=function(e){return Boolean(i(e,"paragraph"))},this.getAppliedStyles=l,this.getAppliedStylesForElement=function(e,t){return l([e],t)[0]},this.updateStyle=function(e,n){var i,r;b.mapObjOntoNode(e,n,odf.Namespaces.lookupNamespaceURI),(i=(i=n["style:text-properties"])&&i["style:font-name"])&&!t().hasOwnProperty(i)&&((r=e.ownerDocument.createElementNS(p,"style:font-face")).setAttributeNS(p,"style:name",i),r.setAttributeNS(f,"svg:font-family",i),c.rootElement.fontFaceDecls.appendChild(r))},this.createDerivedStyleObject=function(e,t,n){var o=i(e,t);return runtime.assert(Boolean(o),"No style element found for '"+e+"' of family '"+t+"'"),(e=o.parentNode===c.rootElement.styles?{"style:parent-style-name":e}:r(o))["style:family"]=t,y.mergeObjects(e,n),e},this.getDefaultTabStopDistance=function(){for(var e,t=(t=n("paragraph"))&&t.firstElementChild;t;)t.namespaceURI===p&&"paragraph-properties"===t.localName&&(e=t.getAttributeNS(p,"tab-stop-distance")),t=t.nextElementSibling;return e||(e="1.25cm"),v.parseNonNegativeLength(e)},this.getMasterPageElement=d,this.getContentSize=function(e,t){var n,r,o,a,s,l,h,f,m,g;e:{if(r=i(e,t),runtime.assert("paragraph"===t||"table"===t,"styleFamily must be either paragraph or table"),r&&((r=r.getAttributeNS(p,"master-page-name"))&&((n=d(r))||runtime.log("WARN: No master page definition found for "+r)),n||(n=d("Standard")),n||(n=c.rootElement.masterStyles.getElementsByTagNameNS(p,"master-page")[0])||runtime.log("WARN: Document has no master pages defined"),n))for(r=n.getAttributeNS(p,"page-layout-name"),o=c.rootElement.automaticStyles.getElementsByTagNameNS(p,"page-layout"),a=0;a<o.length;a+=1)if((n=o.item(a)).getAttributeNS(p,"name")===r)break e;n=null}return n||(n=b.getDirectChild(c.rootElement.styles,p,"default-page-layout")),(n=b.getDirectChild(n,p,"page-layout-properties"))?("landscape"===n.getAttributeNS(p,"print-orientation")?(r="29.7cm",o="21.001cm"):(r="21.001cm",o="29.7cm"),r=u(n.getAttributeNS(_,"page-width"),r),o=u(n.getAttributeNS(_,"page-height"),o),void 0===(a=u(n.getAttributeNS(_,"margin")))?(a=u(n.getAttributeNS(_,"margin-left"),"2cm"),s=u(n.getAttributeNS(_,"margin-right"),"2cm"),l=u(n.getAttributeNS(_,"margin-top"),"2cm"),h=u(n.getAttributeNS(_,"margin-bottom"),"2cm")):a=s=l=h=a,void 0===(f=u(n.getAttributeNS(_,"padding")))?(f=u(n.getAttributeNS(_,"padding-left"),"0cm"),m=u(n.getAttributeNS(_,"padding-right"),"0cm"),g=u(n.getAttributeNS(_,"padding-top"),"0cm"),n=u(n.getAttributeNS(_,"padding-bottom"),"0cm")):f=m=g=n=f):(r=u("21.001cm"),o=u("29.7cm"),a=s=l=h=a=u("2cm"),f=m=g=n=f=u("0cm")),{width:r-a-s-f-m,height:o-l-h-g-n}}},function(){var e=odf.Namespaces.stylens,t=odf.Namespaces.textns,n={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"};odf.StyleTreeNode=function(e){this.derivedStyles={},this.element=e},odf.StyleTree=function(i,r){function o(n){var i,r,o,a={};if(!n)return a;for(n=n.firstElementChild;n;)(r=n.namespaceURI!==e||"style"!==n.localName&&"default-style"!==n.localName?n.namespaceURI===t&&"list-style"===n.localName?"list":n.namespaceURI!==e||"page-layout"!==n.localName&&"default-page-layout"!==n.localName?void 0:"page":n.getAttributeNS(e,"family"))&&((i=n.getAttributeNS(e,"name"))||(i=""),a.hasOwnProperty(r)?o=a[r]:a[r]=o={},o[i]=n),n=n.nextElementSibling;return a}function a(e,t){if(e.hasOwnProperty(t))return e[t];var n,i=null,r=Object.keys(e);for(n=0;n<r.length&&!(i=a(e[r[n]].derivedStyles,t));n+=1);return i}function s(t,n,i){var r,o,l;return n.hasOwnProperty(t)?(l=null,(o=(r=new odf.StyleTreeNode(n[t])).element.getAttributeNS(e,"parent-style-name"))&&(l=a(i,o)||s(o,n,i)),l?l.derivedStyles[t]=r:i[t]=r,delete n[t],r):null}function l(e,t){e&&Object.keys(e).forEach(function(n){s(n,e,t)})}var d,u,c,h={};this.getStyleTree=function(){return h},u=o(i),c=o(r),Object.keys(n).forEach(function(e){d=h[e]={},l(u[e],d),l(c[e],d)})}}(),function(){function e(e,t){try{e.insertRule(t,e.cssRules.length)}catch(e){runtime.log("cannot load rule: "+t+" - "+e)}}function t(e,t){this.listCounterCount=0,this.contentRules=e,this.counterIdStack=[],this.continuedCounterIdStack=t}function n(n){function i(t,r,a,l){var d=r.namespaceURI===o&&"list"===r.localName,u=r.namespaceURI===o&&"list-item"===r.localName;if(d||u){if(d){var c,h,f;d=a+=1;for(l.listCounterCount+=1,u=t+"-level"+d+"-"+l.listCounterCount,r.setAttributeNS("urn:webodf:names:helper","counter-id",u),(c=l.continuedCounterIdStack.shift())||(s+=u+" 1 ",h='text|list[webodfhelper|counter-id="'+u+'"] > text|list-item:first-child > :not(text|list):first-child:before',h+="{",h+="counter-increment: "+(c=u)+" 0;",e(n,h+="}"));l.counterIdStack.length>=d;)l.counterIdStack.pop();for(l.counterIdStack.push(c),f=l.contentRules[d.toString()]||"",h=1;h<=d;h+=1)f=f.replace(h+"webodf-listLevel",l.counterIdStack[h-1]);h='text|list[webodfhelper|counter-id="'+u+'"] > text|list-item > :not(text|list):first-child:before',h+="{",h+=f,h+="counter-increment: "+c+";",e(n,h+="}")}for(r=r.firstElementChild;r;)i(t,r,a,l),r=r.nextElementSibling}else l.continuedCounterIdStack=[]}var r=0,s="",l={};this.createCounterRules=function(e,n,o){var s=n.getAttributeNS(a,"id"),d=[];o&&(o=o.getAttributeNS("urn:webodf:names:helper","counter-id"),d=l[o].slice(0)),e=new t(e,d),s?s="Y"+s:s="X"+(r+=1),i(s,n,0,e),l[s+"-level1-1"]=e.counterIdStack},this.initialiseCreatedCounters=function(){var t;t="office|document{counter-reset: "+s+";",e(n,t+="}")}}var i=odf.Namespaces.fons,r=odf.Namespaces.stylens,o=odf.Namespaces.textns,a=odf.Namespaces.xmlns,s={1:"decimal",a:"lower-latin",A:"upper-latin",i:"lower-roman",I:"upper-roman"};odf.ListStyleToCss=function(){function t(e){var t=h.parseLength(e);return t?c.convert(t.value,t.unit,"px"):(runtime.log("Could not parse value '"+e+"'."),0)}function l(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function d(e,t){var n;return e&&(n=e.getAttributeNS(o,"style-name")),n===t}function u(e,t,i){t=t.getElementsByTagNameNS(o,"list"),e=new n(e);var u,c,h,f,p,m,g,_={};for(g=0;g<t.length;g+=1)if(m=(u=t.item(g)).getAttributeNS(o,"style-name")){h=u.getAttributeNS(o,"continue-numbering"),f=u.getAttributeNS(o,"continue-list"),(p=u.getAttributeNS(a,"id"))&&(_[p]=u),p=i[m].element.firstElementChild;for(var v=void 0,b={};p;){v=(v=p.getAttributeNS(o,"level"))&&parseInt(v,10);var y=p,x="",w=void 0,S=void 0,N=w=void 0;if("list-level-style-number"===y.localName){x=(k=y).getAttributeNS(r,"num-format"),w=k.getAttributeNS(r,"num-suffix")||"",S=k.getAttributeNS(r,"num-prefix")||"";var E="",C=k.getAttributeNS(o,"level"),k=k.getAttributeNS(o,"display-levels");if(S&&(E+='"'+l(S)+'"\n'),s.hasOwnProperty(x))for(C=C?parseInt(C,10):1,k=k?parseInt(k,10):1;0<k;)E+=" counter("+(C-k+1)+"webodf-listLevel,"+s[x]+")",1<k&&(E+='"."'),--k;else E=x?E+' "'+x+'"':E+' ""';x="content:"+E+' "'+l(w)+'"'}else"list-level-style-image"===y.localName?x="content: none":"list-level-style-bullet"===y.localName&&(x='content: "'+l(x=y.getAttributeNS(o,"bullet-char"))+'"');(w=y.getElementsByTagNameNS(r,"list-level-properties")[0])&&("label-alignment"===(S=w.getAttributeNS(o,"list-level-position-and-space-mode"))&&((w=w.getElementsByTagNameNS(r,"list-level-label-alignment")[0])&&(N=w.getAttributeNS(o,"label-followed-by")),"space"===N&&(x+=' "\\a0"'))),b[v]="\n"+x+";\n",p=p.nextElementSibling}p=b,h&&!f&&d(c,m)?e.createCounterRules(p,u,c):f&&d(_[f],m)?e.createCounterRules(p,u,_[f]):e.createCounterRules(p,u),c=u}e.initialiseCreatedCounters()}var c=new core.CSSUnits,h=odf.OdfUtils;this.applyListStyles=function(n,a,s){var l;(l=a.list)&&Object.keys(l).forEach(function(a){for(var s=l[a].element.firstElementChild;s;){if(s.namespaceURI===o){var d=n,u=s,c='text|list[text|style-name="'+a+'"]',h=u.getAttributeNS(o,"level"),f=void 0,p=void 0,m=p=void 0,g=void 0,_=void 0,v=f=void 0,b=void 0,y=void 0,x=void 0;for(g=void 0,m=(p=u.getElementsByTagNameNS(r,"list-level-properties")[0])&&p.getAttributeNS(o,"list-level-position-and-space-mode"),g=p&&p.getElementsByTagNameNS(r,"list-level-label-alignment")[0],f=h=h&&parseInt(h,10);1<f;)c+=" > text|list-item > text|list",--f;switch(f=p&&p.getAttributeNS(i,"text-align")||"left"){case"end":f="right";break;case"start":f="left"}"label-alignment"===m?(_=g&&g.getAttributeNS(i,"margin-left")||"0px",y=g&&g.getAttributeNS(i,"text-indent")||"0px",x=g&&g.getAttributeNS(o,"label-followed-by"),g=t(_)):(_=p&&p.getAttributeNS(o,"space-before")||"0px",v=p&&p.getAttributeNS(o,"min-label-width")||"0px",b=p&&p.getAttributeNS(o,"min-label-distance")||"0px",g=t(_)+t(v)),p=c+" > text|list-item",p+="{",p+="margin-left: "+g+"px;",e(d,p+="}"),p=c+" > text|list-item > text|list",p+="{",p+="margin-left: "+-g+"px;",e(d,p+="}"),p=c+" > text|list-item > :not(text|list):first-child:before",p+="{",p+="text-align: "+f+";",p+="display: inline-block;","label-alignment"===m?(p+="margin-left: "+y+";","listtab"===x&&(p+="padding-right: 0.2cm;")):(p+="min-width: "+v+";",p+="margin-left: "+(0===parseFloat(v)?"":"-")+v+";",p+="padding-right: "+b+";"),e(d,p+="}")}s=s.nextElementSibling}}),u(n,s,l)}}}(),odf.LazyStyleProperties=function(e,t){var n={};this.value=function(i){var r;return n.hasOwnProperty(i)?r=n[i]:(void 0===(r=t[i]())&&e&&(r=e.value(i)),n[i]=r),r},this.reset=function(t){e=t,n={}}},odf.StyleParseUtils=function(){function e(e){var t,n;return"px"===(n=(e=(e=/(-?[0-9]*[0-9][0-9]*(\.[0-9]*)?|0+\.[0-9]*[1-9][0-9]*|\.[0-9]*[1-9][0-9]*)((cm)|(mm)|(in)|(pt)|(pc)|(px))/.exec(e))?{value:parseFloat(e[1]),unit:e[3]}:null)&&e.unit)?t=e.value:"cm"===n?t=e.value/2.54*96:"mm"===n?t=e.value/25.4*96:"in"===n?t=96*e.value:"pt"===n?t=e.value/.75:"pc"===n&&(t=16*e.value),t}var t=odf.Namespaces.stylens;this.parseLength=e,this.parsePositiveLengthOrPercent=function(t,n,i){var r,o;return t&&(r=parseFloat(t.substr(0,t.indexOf("%"))),isNaN(r)&&(r=void 0)),void 0!==r?(i&&(o=i.value(n)),r=void 0===o?void 0:o/100*r):r=e(t),r},this.getPropertiesElement=function(e,n,i){for(n=i?i.nextElementSibling:n.firstElementChild;null!==n&&(n.localName!==e||n.namespaceURI!==t);)n=n.nextElementSibling;return n},this.parseAttributeList=function(e){return e&&(e=e.replace(/^\s*(.*?)\s*$/g,"$1")),e&&0<e.length?e.split(/\s+/):[]}},odf.Style2CSS=function(){function e(t,n,i){var r,o=[];i=i.derivedStyles;var a,s=y[t];for(r in void 0===s?n=null:(a=n?"["+s+'|style-name="'+n+'"]':"","presentation"===s&&(s="draw",a=n?'[presentation|style-name="'+n+'"]':""),n=s+"|"+x[t].join(a+","+s+"|")+a),null!==n&&o.push(n),i)i.hasOwnProperty(r)&&(n=e(t,r,i[r]),o=o.concat(n));return o}function t(e){var t,n="";n=null;return"default-style"===e.localName?null:(n=e.getAttributeNS(f,"parent-style-name"),t=e.getAttributeNS(f,"family"),F.getODFElementsWithXPath(l,n?"//style:*[@style:name='"+n+"'][@style:family='"+t+"']":"//style:default-style[@style:family='"+t+"']",odf.Namespaces.lookupNamespaceURI)[0])}function n(e,n){var i,r,o,a="";for(i=0;i<n.length;i+=1)if(r=n[i],o=e.getAttributeNS(r[0],r[1])){if(o=o.trim(),R.hasOwnProperty(r[1])){var s=o,l=void 0;o=void 0,-1!==(d=s.indexOf(" "))?(l=s.substring(0,d),o=s.substring(d)):(l=s,o=""),(l=I.parseLength(l))&&"pt"===l.unit&&.75>l.value&&(s="0.75pt"+o),o=s}else if(P.hasOwnProperty(r[1])){s=e;var d=r[0],u=(l=r[1],I.parseLength(o)),c=void 0,h=void 0,p=void 0,m=void 0;p=void 0;if(u&&"%"===u.unit){for(c=u.value/100,h=t(s.parentNode),m="0";h;){if((p=v.getDirectChild(h,f,"paragraph-properties"))&&(p=I.parseLength(p.getAttributeNS(d,l)))){if("%"!==p.unit){m=p.value*c+p.unit;break}c*=p.value/100}h=t(h)}o=m}}r[2]&&(a+=r[2]+":"+o+";")}return a}function i(e,t,n,i){return t+t+n+n+i+i}function r(e,t){var n=[e],i=t.derivedStyles;return Object.keys(i).forEach(function(e){e=r(e,i[e]),n=n.concat(e)}),n}function o(e,t,n,i){function o(t,n){var i,r=[];t.forEach(function(e){a.forEach(function(t){r.push('draw|page[webodfhelper|page-style-name="'+t+'"] draw|frame[presentation|class="'+e+'"]')})}),0<r.length&&(i=r.join(",")+"{visibility:"+n+";}",e.insertRule(i,e.cssRules.length))}var a=r(t,i),s=[],l=[];["page-number","date-time","header","footer"].forEach(function(e){var t;"true"===(t=n.getAttributeNS(_,"display-"+e))?s.push(e):"false"===t&&l.push(e)}),o(s,"visible"),o(l,"hidden")}function a(r,l,p,y){var x,R;if("page"===l){var P,F,B,U=y.element,z="";if(F=P="",p=v.getDirectChild(U,f,"page-layout-properties"))if(B=U.getAttributeNS(f,"name"),z+=n(p,O),(P=v.getDirectChild(p,f,"background-image"))&&(F=P.getAttributeNS(g,"href"))&&(z=z+"background-image: url('odfkit:"+F+"');"+n(P,S)),"presentation"===s)for(U=(U=v.getDirectChild(U.parentNode.parentNode,h,"master-styles"))&&U.firstElementChild;U;)U.namespaceURI===f&&"master-page"===U.localName&&U.getAttributeNS(f,"page-layout-name")===B&&(P='draw|page[draw|master-page-name="'+(F=U.getAttributeNS(f,"name"))+'"] {'+z+"}",F='office|body, draw|page[draw|master-page-name="'+F+'"] {'+n(p,D)+" }",r.insertRule(P,r.cssRules.length),r.insertRule(F,r.cssRules.length)),U=U.nextElementSibling;else"text"===s&&(P="office|text {"+z+"}",F="office|body {width: "+p.getAttributeNS(c,"page-width")+";}",r.insertRule(P,r.cssRules.length),r.insertRule(F,r.cssRules.length))}else{if(z=e(l,p,y).join(","),B="",U=v.getDirectChild(y.element,f,"text-properties")){var j=U,H=R="";switch(P="",F=1,U=""+n(j,w),"solid"===(x=j.getAttributeNS(f,"text-underline-style"))&&(R+=" underline"),"solid"===(x=j.getAttributeNS(f,"text-line-through-style"))&&(R+=" line-through"),R.length&&(U=U+"text-decoration:"+R+";\ntext-decoration-line:"+R+";\n",U+="-moz-text-decoration-line:"+R+";\n"),x=j.getAttributeNS(f,"text-line-through-type")){case"double":H+=" double";break;case"single":H+=" single"}if(H&&(U+="text-decoration-style:"+H+";\n",U+="-moz-text-decoration-style:"+H+";\n"),(R=j.getAttributeNS(f,"font-name")||j.getAttributeNS(c,"font-family"))&&(U+="font-family: "+((x=M[R])||R)+";"),(x=j.getAttributeNS(f,"text-position"))&&(U+="vertical-align: "+(x=(R=b.parseAttributeList(x))[0])+"\n; ",(R=R[1])&&(F=parseFloat(R)/100)),j.hasAttributeNS(c,"font-size")||1!==F){for(j=j.parentNode;j;){if(x=(x=v.getDirectChild(j,f,"text-properties"))?I.parseFoFontSize(x.getAttributeNS(c,"font-size")):null){if("%"!==x.unit){P="font-size: "+x.value*F+x.unit+";";break}F*=x.value/100}j=t(j)}P||(P="font-size: "+parseFloat(d)*F+L.getUnits(d)+";")}B+=U+=P}(U=v.getDirectChild(y.element,f,"paragraph-properties"))&&(U=""+n(P=U,N),(F=v.getDirectChild(P,f,"background-image"))&&(j=F.getAttributeNS(g,"href"))&&(U=U+"background-image: url('odfkit:"+j+"');"+n(F,S)),(P=P.getAttributeNS(c,"line-height"))&&"normal"!==P&&(U="%"!==(P=I.parseFoLineHeight(P)).unit?U+"line-height: "+P.value+P.unit+";":U+"line-height: "+P.value/100+";"),B+=U),(U=v.getDirectChild(y.element,f,"graphic-properties"))&&(U=""+n(j=U,E),P=j.getAttributeNS(u,"opacity"),F=j.getAttributeNS(u,"fill"),j=j.getAttributeNS(u,"fill-color"),"solid"===F||"hatch"===F?j&&"none"!==j?(P=isNaN(parseFloat(P))?1:parseFloat(P)/100,F=j.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,i),(j=(F=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(F))?{r:parseInt(F[1],16),g:parseInt(F[2],16),b:parseInt(F[3],16)}:null)&&(U+="background-color: rgba("+j.r+","+j.g+","+j.b+","+P+");")):U+="background: none;":"none"===F&&(U+="background: none;"),B+=U),(U=v.getDirectChild(y.element,f,"drawing-page-properties"))&&(F=""+n(P=U,E),"true"===P.getAttributeNS(_,"background-visible")&&(F+="background: none;"),B+=F,o(r,p,U,y)),(U=v.getDirectChild(y.element,f,"table-cell-properties"))&&(B=(p=B)+(B=""+n(U,C))),(U=v.getDirectChild(y.element,f,"table-row-properties"))&&(B=(p=B)+(B=""+n(U,T))),(U=v.getDirectChild(y.element,f,"table-column-properties"))&&(B=(p=B)+(B=""+n(U,k))),(U=v.getDirectChild(y.element,f,"table-properties"))&&(p=B,B=""+n(U,A),"collapsing"===(U=U.getAttributeNS(m,"border-model"))?B+="border-collapse:collapse;":"separating"===U&&(B+="border-collapse:separate;"),B=p+B),0!==B.length&&r.insertRule(z+"{"+B+"}",r.cssRules.length)}for(var X in y.derivedStyles)y.derivedStyles.hasOwnProperty(X)&&a(r,l,X,y.derivedStyles[X])}var s,l,d,u=odf.Namespaces.drawns,c=odf.Namespaces.fons,h=odf.Namespaces.officens,f=odf.Namespaces.stylens,p=odf.Namespaces.svgns,m=odf.Namespaces.tablens,g=odf.Namespaces.xlinkns,_=odf.Namespaces.presentationns,v=core.DomUtils,b=new odf.StyleParseUtils,y={graphic:"draw","drawing-page":"draw",paragraph:"text",presentation:"presentation",ruby:"text",section:"text",table:"table","table-cell":"table","table-column":"table","table-row":"table",text:"text",list:"text",page:"office"},x={graphic:"circle connected control custom-shape ellipse frame g line measure page page-thumbnail path polygon polyline rect regular-polygon".split(" "),paragraph:"alphabetical-index-entry-template h illustration-index-entry-template index-source-style object-index-entry-template p table-index-entry-template table-of-content-entry-template user-index-entry-template".split(" "),presentation:"caption circle connector control custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),"drawing-page":"caption circle connector control page custom-shape ellipse frame g line measure page-thumbnail path polygon polyline rect regular-polygon".split(" "),ruby:["ruby","ruby-text"],section:"alphabetical-index bibliography illustration-index index-title object-index section table-of-content table-index user-index".split(" "),table:["background","table"],"table-cell":"body covered-table-cell even-columns even-rows first-column first-row last-column last-row odd-columns odd-rows table-cell".split(" "),"table-column":["table-column"],"table-row":["table-row"],text:"a index-entry-chapter index-entry-link-end index-entry-link-start index-entry-page-number index-entry-span index-entry-tab-stop index-entry-text index-title-template linenumbering-configuration list-level-style-number list-level-style-bullet outline-level-style span".split(" "),list:["list-item"]},w=[[c,"color","color"],[c,"background-color","background-color"],[c,"font-weight","font-weight"],[c,"font-style","font-style"]],S=[[f,"repeat","background-repeat"]],N=[[c,"background-color","background-color"],[c,"text-align","text-align"],[c,"text-indent","text-indent"],[c,"padding","padding"],[c,"padding-left","padding-left"],[c,"padding-right","padding-right"],[c,"padding-top","padding-top"],[c,"padding-bottom","padding-bottom"],[c,"border-left","border-left"],[c,"border-right","border-right"],[c,"border-top","border-top"],[c,"border-bottom","border-bottom"],[c,"margin","margin"],[c,"margin-left","margin-left"],[c,"margin-right","margin-right"],[c,"margin-top","margin-top"],[c,"margin-bottom","margin-bottom"],[c,"border","border"]],E=[[c,"background-color","background-color"],[c,"min-height","min-height"],[u,"stroke","border"],[p,"stroke-color","border-color"],[p,"stroke-width","border-width"],[c,"border","border"],[c,"border-left","border-left"],[c,"border-right","border-right"],[c,"border-top","border-top"],[c,"border-bottom","border-bottom"]],C=[[c,"background-color","background-color"],[c,"border-left","border-left"],[c,"border-right","border-right"],[c,"border-top","border-top"],[c,"border-bottom","border-bottom"],[c,"border","border"]],k=[[f,"column-width","width"]],T=[[f,"row-height","height"],[c,"keep-together",null]],A=[[f,"width","width"],[c,"margin-left","margin-left"],[c,"margin-right","margin-right"],[c,"margin-top","margin-top"],[c,"margin-bottom","margin-bottom"]],O=[[c,"background-color","background-color"],[c,"padding","padding"],[c,"padding-left","padding-left"],[c,"padding-right","padding-right"],[c,"padding-top","padding-top"],[c,"padding-bottom","padding-bottom"],[c,"border","border"],[c,"border-left","border-left"],[c,"border-right","border-right"],[c,"border-top","border-top"],[c,"border-bottom","border-bottom"],[c,"margin","margin"],[c,"margin-left","margin-left"],[c,"margin-right","margin-right"],[c,"margin-top","margin-top"],[c,"margin-bottom","margin-bottom"]],D=[[c,"page-width","width"],[c,"page-height","height"]],R={border:!0,"border-left":!0,"border-right":!0,"border-top":!0,"border-bottom":!0,"stroke-width":!0},P={margin:!0,"margin-left":!0,"margin-right":!0,"margin-top":!0,"margin-bottom":!0},M={},I=odf.OdfUtils,F=xmldom.XPath,L=new core.CSSUnits;this.style2css=function(e,t,n,i,r){function o(e,t){u="@namespace "+e+" url("+t+");";try{n.insertRule(u,n.cssRules.length)}catch(e){}}var u,c,h;for(l=t;n.cssRules.length;)n.deleteRule(n.cssRules.length-1);for(h in odf.Namespaces.forEachPrefix(o),o("webodfhelper","urn:webodf:names:helper"),M=i,s=e,d=runtime.getWindow().getComputedStyle(document.body,null).getPropertyValue("font-size")||"12pt",y)if(y.hasOwnProperty(h))for(c in e=r[h])e.hasOwnProperty(c)&&a(n,h,c,e[c])}},function(){function e(t,n){var i=this;this.getDistance=function(e){var t=i.x-e.x;return e=i.y-e.y,Math.sqrt(t*t+e*e)},this.getCenter=function(t){return new e((i.x+t.x)/2,(i.y+t.y)/2)},i.x=t,i.y=n}gui.ZoomHelper=function(){function t(e,t,n,i){e=i?"translate3d("+e+"px, "+t+"px, 0) scale3d("+n+", "+n+", 1)":"translate("+e+"px, "+t+"px) scale("+n+")",h.style.WebkitTransform=e,h.style.MozTransform=e,h.style.msTransform=e,h.style.OTransform=e,h.style.transform=e}function n(e){e?t(-f.x,-f.y,g,!0):(t(0,0,g,!0),t(0,0,g,!1))}function i(e){if(v&&S){var t=v.style.overflow,n=v.classList.contains("webodf-customScrollbars");e&&n||!e&&!n||(e?(v.classList.add("webodf-customScrollbars"),v.style.overflow="hidden",runtime.requestAnimationFrame(function(){v.style.overflow=t})):v.classList.remove("webodf-customScrollbars"))}}function r(){t(-f.x,-f.y,g,!0),v.scrollLeft=0,v.scrollTop=0,N=b.style.overflow,b.style.overflow="visible",i(!1)}function o(){t(0,0,g,!0),v.scrollLeft=f.x,v.scrollTop=f.y,b.style.overflow=N||"",i(!0)}function a(t){return new e(t.pageX-h.offsetLeft,t.pageY-h.offsetTop)}function s(t){if(p){f.x-=t.x-p.x,f.y-=t.y-p.y;var n=f;f=new e(Math.min(Math.max(n.x,h.offsetLeft),(h.offsetLeft+h.offsetWidth)*g-v.clientWidth),Math.min(Math.max(n.y,h.offsetTop),(h.offsetTop+h.offsetHeight)*g-v.clientHeight))}p=t}function l(e){var t=e.touches.length,n=0<t?a(e.touches[0]):null;e=1<t?a(e.touches[1]):null,n&&e?(m=n.getDistance(e),_=g,p=n.getCenter(e),r(),w=x.PINCH):n&&(p=n,w=x.SCROLL)}function d(e){var t=0<(i=e.touches.length)?a(e.touches[0]):null,i=1<i?a(e.touches[1]):null;if(t&&i)if(e.preventDefault(),w===x.SCROLL)w=x.PINCH,r(),m=t.getDistance(i);else{e=t.getCenter(i),t=t.getDistance(i)/m,s(e);i=g;var l=Math.min(4,h.offsetParent.clientWidth/h.offsetWidth);g=_*t,t=(g=Math.min(Math.max(g,l),4))/i,f.x+=(t-1)*(e.x+f.x),f.y+=(t-1)*(e.y+f.y),n(!0)}else t&&(w===x.PINCH?(w=x.SCROLL,o()):s(t))}function u(){w===x.PINCH&&(y.emit(gui.ZoomHelper.signalZoomChanged,g),o(),n(!1)),w=x.NONE}function c(){v&&(v.removeEventListener("touchstart",l,!1),v.removeEventListener("touchmove",d,!1),v.removeEventListener("touchend",u,!1))}var h,f,p,m,g,_,v,b,y=new core.EventNotifier([gui.ZoomHelper.signalZoomChanged]),x={NONE:0,SCROLL:1,PINCH:2},w=x.NONE,S=runtime.getWindow().hasOwnProperty("ontouchstart"),N="";this.subscribe=function(e,t){y.subscribe(e,t)},this.unsubscribe=function(e,t){y.unsubscribe(e,t)},this.getZoomLevel=function(){return g},this.setZoomLevel=function(e){h&&(g=e,n(!1),y.emit(gui.ZoomHelper.signalZoomChanged,g))},this.destroy=function(e){c(),i(!1),e()},this.setZoomableElement=function(e){c(),v=(h=e).offsetParent,b=h.parentNode,n(!1),v&&(v.addEventListener("touchstart",l,!1),v.addEventListener("touchmove",d,!1),v.addEventListener("touchend",u,!1)),i(!0)},_=g=1,f=new e(0,0)},gui.ZoomHelper.signalZoomChanged="zoomChanged"}(),ops.Canvas=function(){},ops.Canvas.prototype.getZoomLevel=function(){},ops.Canvas.prototype.getElement=function(){},ops.Canvas.prototype.getSizer=function(){},ops.Canvas.prototype.getZoomHelper=function(){},function(){function e(){function e(i){n=!0,runtime.setTimeout(function(){try{i()}catch(e){runtime.log(String(e)+"\n"+e.stack)}n=!1,0<t.length&&e(t.pop())},10)}var t=[],n=!1;this.clearQueue=function(){t.length=0},this.addToQueue=function(i){if(0===t.length&&!n)return e(i);t.push(i)}}function t(e){function t(){for(;0<n.cssRules.length;)n.deleteRule(0);n.insertRule("#shadowContent draw|page {display:none;}",0),n.insertRule("office|presentation draw|page {display:none;}",1),n.insertRule("#shadowContent draw|page:nth-of-type("+i+") {display:block;}",2),n.insertRule("office|presentation draw|page:nth-of-type("+i+") {display:block;}",3)}var n=e.sheet,i=1;this.showFirstPage=function(){i=1,t()},this.showNextPage=function(){i+=1,t()},this.showPreviousPage=function(){1<i&&(--i,t())},this.showPage=function(e){0<e&&(i=e,t())},this.css=e,this.destroy=function(t){e.parentNode.removeChild(e),t()}}function n(e){for(var t=(e=e.sheet).cssRules;t.length;)e.deleteRule(t.length-1)}function i(e,t,n){var i=new odf.Style2CSS,r=new odf.ListStyleToCss;n=n.sheet;var o=new odf.StyleTree(e.rootElement.styles,e.rootElement.automaticStyles).getStyleTree();i.style2css(e.getDocumentType(),e.rootElement,n,t.getFontMap(),o),r.applyListStyles(n,o,e.rootElement.body)}function r(e,t,n){var i,r=null;if(e=e.rootElement.body.getElementsByTagNameNS(b,n+"-decl"),(n=t.getAttributeNS(b,"use-"+n+"-name"))&&0<e.length)for(t=0;t<e.length;t+=1)if((i=e[t]).getAttributeNS(b,"name")===n){r=i.textContent;break}return r}function o(e,t,n,i){var r=e.ownerDocument;for(t=x.getElementsByTagNameNS(e,t,n),e=0;e<t.length;e+=1)x.removeAllChildNodes(t[e]),i&&(n=t[e]).appendChild(r.createTextNode(i))}function a(e,t,n){t.setAttributeNS("urn:webodf:names:helper","styleid",e);var i,r=t.getAttributeNS(_,"anchor-type"),o=t.getAttributeNS(m,"x"),a=t.getAttributeNS(m,"y"),s=t.getAttributeNS(m,"width"),l=t.getAttributeNS(m,"height"),d=t.getAttributeNS(h,"min-height"),u=t.getAttributeNS(h,"min-width");"as-char"===r?i="display: inline-block;":r||o||a?i="position: absolute;":(s||l||d||u)&&(i="display: block;"),o&&(i+="left: "+o+";"),a&&(i+="top: "+a+";"),s&&(i+="width: "+s+";"),l&&(i+="height: "+l+";"),d&&(i+="min-height: "+d+";"),u&&(i+="min-width: "+u+";"),i&&(i="draw|"+t.localName+'[webodfhelper|styleid="'+e+'"] {'+i+"}",n.insertRule(i,n.cssRules.length))}function s(e){for(e=e.firstChild;e;){if(e.namespaceURI===f&&"binary-data"===e.localName)return"data:image/png;base64,"+e.textContent.replace(/[\r\n\s]/g,"");e=e.nextSibling}return""}function l(e,t,n,i){function r(t){t&&(t='draw|image[webodfhelper|styleid="'+e+'"] {background-image: url('+t+");}",i.insertRule(t,i.cssRules.length))}n.setAttributeNS("urn:webodf:names:helper","styleid",e);var o,a=n.getAttributeNS(v,"href");if(a)try{(o=t.getPart(a)).onchange=function(e){r(e.url)},o.load()}catch(e){runtime.log("slight problem: "+String(e))}else r(a=s(n))}function d(e,t){function n(e,n){var o=l.documentElement.namespaceURI;"video/"===n.substr(0,6)?((i=l.createElementNS(o,"video")).setAttribute("controls","controls"),r=l.createElementNS(o,"source"),e&&r.setAttribute("src",e),r.setAttribute("type",n),i.appendChild(r),t.parentNode.appendChild(i)):t.innerHtml="Unrecognised Plugin"}var i,r,o,a,l=t.ownerDocument;if(o=t.getAttributeNS(v,"href"))try{(a=e.getPart(o)).onchange=function(e){n(e.url,e.mimetype)},a.load()}catch(e){runtime.log("slight problem: "+String(e))}else runtime.log("using MP4 data fallback"),n(o=s(t),"video/mp4")}function u(e){var t=e.getElementsByTagName("head")[0],n=e.createElementNS(t.namespaceURI,"style"),i="";return n.setAttribute("type","text/css"),n.setAttribute("media","screen, print, handheld, projection"),odf.Namespaces.forEachPrefix(function(e,t){i+="@namespace "+e+" url("+t+");\n"}),i+="@namespace webodfhelper url(urn:webodf:names:helper);\n",n.appendChild(e.createTextNode(i)),t.appendChild(n),n}var c=odf.Namespaces.drawns,h=odf.Namespaces.fons,f=odf.Namespaces.officens,p=odf.Namespaces.stylens,m=odf.Namespaces.svgns,g=odf.Namespaces.tablens,_=odf.Namespaces.textns,v=odf.Namespaces.xlinkns,b=odf.Namespaces.presentationns,y=xmldom.XPath,x=core.DomUtils;odf.OdfCanvas=function(s,h){function m(e,t,n){function i(e,t,n,i){q.addToQueue(function(){l(e,t,n,i)})}var r,o;for(r=t.getElementsByTagNameNS(c,"image"),t=0;t<r.length;t+=1)o=r.item(t),i("image"+String(t),e,o,n)}function v(e,t){function n(e,t){q.addToQueue(function(){d(e,t)})}var i,r;for(r=t.getElementsByTagNameNS(c,"plugin"),i=0;i<r.length;i+=1)n(e,r.item(i))}function w(){var e;e=B.firstChild;var t=Y.getZoomLevel();e&&(B.style.WebkitTransformOrigin="0% 0%",B.style.MozTransformOrigin="0% 0%",B.style.msTransformOrigin="0% 0%",B.style.OTransformOrigin="0% 0%",B.style.transformOrigin="0% 0%",H&&((e=H.getMinimumHeightForAnnotationPane())?B.style.minHeight=e:B.style.removeProperty("min-height")),s.style.width=Math.round(t*B.offsetWidth)+"px",s.style.height=Math.round(t*B.offsetHeight)+"px",s.style.display="inline-block")}function S(e,t){var n=D.sheet;x.removeAllChildNodes(s),(B=F.createElementNS(s.namespaceURI,"div")).style.display="inline-block",B.style.background="white",B.style.setProperty("float","left","important"),B.appendChild(t),s.appendChild(B),(U=F.createElementNS(s.namespaceURI,"div")).id="annotationsPane",(R=F.createElementNS(s.namespaceURI,"div")).id="shadowContent",R.style.position="absolute",R.style.top=0,R.style.left=0,e.getContentElement().appendChild(R);var i,l,d=t.body,u=[];for(i=d.firstElementChild;i&&i!==d;)if(i.namespaceURI===c&&(u[u.length]=i),i.firstElementChild)i=i.firstElementChild;else{for(;i&&i!==d&&!i.nextElementSibling;)i=i.parentNode;i&&i.nextElementSibling&&(i=i.nextElementSibling)}for(l=0;l<u.length;l+=1)i=u[l],a("frame"+String(l),i,n);for(u=y.getODFElementsWithXPath(d,".//*[*[@text:anchor-type='paragraph']]",odf.Namespaces.lookupNamespaceURI),i=0;i<u.length;i+=1)(d=u[i]).setAttributeNS&&d.setAttributeNS("urn:webodf:names:helper","containsparagraphanchor",!0);d=L,i=R;var h,w,S,N,E,C=0;if(l=e.rootElement.ownerDocument,(u=t.body.firstElementChild)&&u.namespaceURI===f&&("presentation"===u.localName||"drawing"===u.localName))for(u=u.firstElementChild;u;){if(h=(h=u.getAttributeNS(c,"master-page-name"))?d.getMasterPageElement(h):null){for(w=u.getAttributeNS("urn:webodf:names:helper","styleid"),S=l.createElementNS(c,"draw:page"),E=h.firstElementChild,C=0;E;)"true"!==E.getAttributeNS(b,"placeholder")&&(N=E.cloneNode(!0),S.appendChild(N)),E=E.nextElementSibling,C+=1;E=N=C=void 0;var k=x.getElementsByTagNameNS(S,c,"frame");for(C=0;C<k.length;C+=1)(E=(N=k[C]).getAttributeNS(b,"class"))&&!/^(date-time|footer|header|page-number)$/.test(E)&&N.parentNode.removeChild(N);for(N=x.getElementsByTagNameNS(S,c,"*"),C=0;C<N.length;C+=1)a(w+"_"+C,N[C],n);i.appendChild(S),C=String(i.getElementsByTagNameNS(c,"page").length),o(S,_,"page-number",C),o(S,b,"header",r(e,u,"header")),o(S,b,"footer",r(e,u,"footer")),a(w,S,n),S.setAttributeNS("urn:webodf:names:helper","page-style-name",u.getAttributeNS(c,"style-name")),S.setAttributeNS(c,"draw:master-page-name",h.getAttributeNS(p,"name"))}u=u.nextElementSibling}for(d=s.namespaceURI,u=x.getElementsByTagNameNS(t.body,g,"table-cell"),i=0;i<u.length;i+=1)(l=u[i]).hasAttributeNS(g,"number-columns-spanned")&&l.setAttributeNS(d,"colspan",l.getAttributeNS(g,"number-columns-spanned")),l.hasAttributeNS(g,"number-rows-spanned")&&l.setAttributeNS(d,"rowspan",l.getAttributeNS(g,"number-rows-spanned"));!function(e){var t=e.ownerDocument;x.getElementsByTagNameNS(e,_,"line-break").forEach(function(e){e.hasChildNodes()||e.appendChild(t.createElement("br"))})}(t.body),function(e){var t=e.ownerDocument;x.getElementsByTagNameNS(e,_,"s").forEach(function(e){var n,i;if(x.removeAllChildNodes(e),e.appendChild(t.createTextNode(" ")),1<(i=parseInt(e.getAttributeNS(_,"c"),10)))for(e.removeAttributeNS(_,"c"),n=1;n<i;n+=1)e.parentNode.insertBefore(e.cloneNode(!0),e)})}(t.body),function(e){x.getElementsByTagNameNS(e,_,"tab").forEach(function(e){e.textContent="\t"})}(t.body),m(e,t.body,n),v(e,t.body),B.insertBefore(R,B.firstChild),Y.setZoomableElement(B)}function N(e){z?(U.parentNode||B.appendChild(U),H&&H.forgetAnnotations(),H=new gui.AnnotationViewManager(I,e.body,U,j),e=x.getElementsByTagNameNS(e.body,f,"annotation"),H.addAnnotations(e),w()):U.parentNode&&(B.removeChild(U),H.forgetAnnotations(),w())}function E(e){function t(){n(A),n(O),n(D),x.removeAllChildNodes(s),s.style.display="inline-block";var t=C.rootElement;s.ownerDocument.importNode(t,!0),L.setOdfContainer(C),function(e,t){(new odf.FontLoader).loadFonts(e,t.sheet)}(C,A),i(C,L,O),S(C,t),N(t),e||q.addToQueue(function(){var e=[C];if(X.hasOwnProperty("statereadychange")){var t,n=X.statereadychange;for(t=0;t<n.length;t+=1)n[t].apply(null,e)}})}C.state===odf.OdfContainer.DONE?t():(runtime.log("WARNING: refreshOdf called but ODF was not DONE."),P=runtime.setTimeout(function e(){C.state===odf.OdfContainer.DONE?t():(runtime.log("will be back later..."),P=runtime.setTimeout(e,500))},100))}runtime.assert(null!=s,"odf.OdfCanvas constructor needs DOM element"),runtime.assert(null!==s.ownerDocument&&void 0!==s.ownerDocument,"odf.OdfCanvas constructor needs DOM");var C,k,T,A,O,D,R,P,M,I=this,F=s.ownerDocument,L=new odf.Formatting,B=null,U=null,z=!1,j=!1,H=null,X={},V=!1,W=!1,q=new e,Y=new gui.ZoomHelper,Z=h||new gui.SingleScrollViewport(s.parentNode);this.refreshCSS=function(){V=!0,M.trigger()},this.refreshSize=function(){M.trigger()},this.odfContainer=function(){return C},this.setOdfContainer=function(e,t){C=e,E(!0===t)},this.load=this.load=function(e){q.clearQueue(),x.removeAllChildNodes(s),s.appendChild(s.ownerDocument.createTextNode(runtime.tr("Loading")+e+"...")),s.removeAttribute("style"),C=new odf.OdfContainer(e,function(e){C=e,E(!1)})},this.save=function(e){C.save(e)},this.addListener=function(e,t){if("click"===e){var n=e;s.addEventListener?s.addEventListener(n,t,!1):s.attachEvent?s.attachEvent("on"+n,t):s["on"+n]=t}else n=X.hasOwnProperty(e)?X[e]:X[e]=[],t&&-1===n.indexOf(t)&&n.push(t)},this.getFormatting=function(){return L},this.getAnnotationViewManager=function(){return H},this.refreshAnnotations=function(){N(C.rootElement)},this.rerenderAnnotations=function(){H&&(W=!0,M.trigger())},this.getSizer=function(){return B},this.enableAnnotations=function(e,t){e!==z&&(z=e,j=t,C&&N(C.rootElement))},this.addAnnotation=function(e){H&&(H.addAnnotations([e]),w())},this.forgetAnnotation=function(e){H&&(H.forgetAnnotation(e),w())},this.getZoomHelper=function(){return Y},this.setZoomLevel=function(e){Y.setZoomLevel(e)},this.getZoomLevel=function(){return Y.getZoomLevel()},this.fitToContainingElement=function(e,t){var n=Y.getZoomLevel(),i=s.offsetHeight/n;t/i<(n=e/(s.offsetWidth/n))&&(n=t/i),Y.setZoomLevel(n)},this.fitToWidth=function(e){var t=s.offsetWidth/Y.getZoomLevel();Y.setZoomLevel(e/t)},this.fitSmart=function(e,t){var n,i;i=Y.getZoomLevel(),n=s.offsetWidth/i,i=s.offsetHeight/i,n=e/n,void 0!==t&&t/i<n&&(n=t/i),Y.setZoomLevel(Math.min(1,n))},this.fitToHeight=function(e){var t=s.offsetHeight/Y.getZoomLevel();Y.setZoomLevel(e/t)},this.showFirstPage=function(){k.showFirstPage()},this.showNextPage=function(){k.showNextPage()},this.showPreviousPage=function(){k.showPreviousPage()},this.showPage=function(e){k.showPage(e),w()},this.getElement=function(){return s},this.getViewport=function(){return Z},this.addCssForFrameWithImage=function(e){var t=e.getAttributeNS(c,"name"),n=e.firstElementChild;a(t,e,D.sheet),n&&l(t+"img",C,n,D.sheet)},this.destroy=function(e){var t=F.getElementsByTagName("head")[0],n=[k.destroy,M.destroy];runtime.clearTimeout(P),U&&U.parentNode&&U.parentNode.removeChild(U),Y.destroy(function(){B&&(s.removeChild(B),B=null)}),function(e){var t=parseInt(e.getAttribute("webodfcss"),10);1===t?e.parentNode.removeChild(e):e.setAttribute("count",t-1)}(T),t.removeChild(A),t.removeChild(O),t.removeChild(D),core.Async.destroyAll(n,e)},T=function(e){var t,n,i=e.getElementsByTagName("head")[0];for(t=e.styleSheets.length,n=i.firstElementChild;n&&("style"!==n.localName||!n.hasAttribute("webodfcss"));)n=n.nextElementSibling;return n?(t=parseInt(n.getAttribute("webodfcss"),10),n.setAttribute("webodfcss",t+1),n):("string"===String(typeof webodf_css)?t=webodf_css:(n="webodf.css",runtime.currentDirectory&&(0<(n=runtime.currentDirectory()).length&&"/"!==n.substr(-1)&&(n+="/"),n+="../webodf.css"),t=runtime.readFileSync(n,"utf-8")),(n=e.createElementNS(i.namespaceURI,"style")).setAttribute("media","screen, print, handheld, projection"),n.setAttribute("type","text/css"),n.setAttribute("webodfcss","1"),n.appendChild(e.createTextNode(t)),i.appendChild(n),n)}(F),k=new t(u(F)),A=u(F),O=u(F),D=u(F),M=core.Task.createRedrawTask(function(){V&&(i(C,L,O),V=!1),W&&(H&&H.rerenderAnnotations(),W=!1),w()}),Y.subscribe(gui.ZoomHelper.signalZoomChanged,w)}}(),odf.StepUtils=function(){this.getContentBounds=function(e){var t,n,i=e.container();return runtime.assert(e.isStep(),"Step iterator must be on a step"),i.nodeType===Node.TEXT_NODE&&0<e.offset()?t=e.offset():(i=e.leftNode())&&i.nodeType===Node.TEXT_NODE&&(t=i.length),i&&(i.nodeType===Node.TEXT_NODE?(runtime.assert(0<t,"Empty text node found"),n={container:i,startOffset:t-1,endOffset:t}):n={container:i,startOffset:0,endOffset:i.childNodes.length}),n}},ops.MemberProperties=function(){},ops.Member=function(e,t){var n=new ops.MemberProperties;this.getMemberId=function(){return e},this.getProperties=function(){return n},this.setProperties=function(e){Object.keys(e).forEach(function(t){n[t]=e[t]})},this.removeProperties=function(e){Object.keys(e).forEach(function(e){"fullName"!==e&&"color"!==e&&"imageUrl"!==e&&n.hasOwnProperty(e)&&delete n[e]})},runtime.assert(Boolean(e),"No memberId was supplied!"),t.fullName||(t.fullName=runtime.tr("Unknown Author")),t.color||(t.color="black"),t.imageUrl||(t.imageUrl="avatar-joe.png"),n=t},ops.Document=function(){},ops.Document.prototype.getMemberIds=function(){},ops.Document.prototype.removeCursor=function(e){},ops.Document.prototype.getDocumentElement=function(){},ops.Document.prototype.getRootNode=function(){},ops.Document.prototype.getDOMDocument=function(){},ops.Document.prototype.cloneDocumentElement=function(){},ops.Document.prototype.setDocumentElement=function(e){},ops.Document.prototype.subscribe=function(e,t){},ops.Document.prototype.unsubscribe=function(e,t){},ops.Document.prototype.getCanvas=function(){},ops.Document.prototype.createRootFilter=function(e){},ops.Document.prototype.createPositionIterator=function(e){},ops.Document.prototype.hasCursor=function(e){},ops.Document.signalCursorAdded="cursor/added",ops.Document.signalCursorRemoved="cursor/removed",ops.Document.signalCursorMoved="cursor/moved",ops.Document.signalMemberAdded="member/added",ops.Document.signalMemberUpdated="member/updated",ops.Document.signalMemberRemoved="member/removed",ops.OdtCursor=function(e,t){var n,i,r=this,o={},a=new core.EventNotifier([ops.OdtCursor.signalCursorUpdated]);this.removeFromDocument=function(){i.remove()},this.subscribe=function(e,t){a.subscribe(e,t)},this.unsubscribe=function(e,t){a.unsubscribe(e,t)},this.getMemberId=function(){return e},this.getNode=function(){return i.getNode()},this.getAnchorNode=function(){return i.getAnchorNode()},this.getSelectedRange=function(){return i.getSelectedRange()},this.setSelectedRange=function(e,t){i.setSelectedRange(e,t),a.emit(ops.OdtCursor.signalCursorUpdated,r)},this.hasForwardSelection=function(){return i.hasForwardSelection()},this.getDocument=function(){return t},this.getSelectionType=function(){return n},this.setSelectionType=function(e){o.hasOwnProperty(e)?n=e:runtime.log("Invalid selection type: "+e)},this.resetSelectionType=function(){r.setSelectionType(ops.OdtCursor.RangeSelection)},i=new core.Cursor(t.getDOMDocument(),e),o[ops.OdtCursor.RangeSelection]=!0,o[ops.OdtCursor.RegionSelection]=!0,r.resetSelectionType()},ops.OdtCursor.RangeSelection="Range",ops.OdtCursor.RegionSelection="Region",ops.OdtCursor.signalCursorUpdated="cursorUpdated",function(){var e=0;ops.StepsCache=function(t,n,i){function r(e,t){var n=this;this.nodeId=e,this.steps=-1,this.node=t,this.previousBookmark=this.nextBookmark=null,this.setIteratorPosition=function(e){e.setPositionBeforeElement(t),i(n.steps,e)}}function o(e,t,n){var r=this;this.nodeId=e,this.steps=t,this.node=n,this.previousBookmark=this.nextBookmark=null,this.setIteratorPosition=function(e){e.setUnfilteredPosition(n,0),i(r.steps,e)}}function a(e,t){var n="["+e.nodeId;return t&&(n+=" => "+t.nodeId),n+"]"}function s(){if(!0===ops.StepsCache.ENABLE_CACHE_VERIFICATION){for(var e,n,i,r=f,o=new core.LoopWatchDog(0,1e5),s={};r;)o.check(),(e=r.previousBookmark)?runtime.assert(e.nextBookmark===r,"Broken bookmark link to previous @"+a(e,r)):(runtime.assert(r===f,"Broken bookmark link @"+a(r)),runtime.assert(void 0===p||f==f||f.steps<=p,"Base point is damaged @"+a(r))),(n=r.nextBookmark)&&runtime.assert(n.previousBookmark===r,"Broken bookmark link to next @"+a(r,n)),(void 0===p||r===f||r.steps<=p)&&(runtime.assert(_.containsNode(t,r.node),"Disconnected node is being reported as undamaged @"+a(r)),e&&(i=r.node.compareDocumentPosition(e.node),runtime.assert(0===i||0!=(i&b),"Bookmark order with previous does not reflect DOM order @"+a(e,r))),n&&_.containsNode(t,n.node)&&(i=r.node.compareDocumentPosition(n.node),runtime.assert(0===i||0!=(i&v),"Bookmark order with next does not reflect DOM order @"+a(r,n)))),r=r.nextBookmark;Object.keys(m).forEach(function(e){var t=m[e];(void 0===p||e<=p)&&runtime.assert(t.steps<=e,"Bookmark step of "+t.steps+" exceeds cached step lookup for "+e+" @"+a(t)),runtime.assert(!1===s.hasOwnProperty(t.nodeId),"Bookmark "+a(t)+" appears twice in cached step lookup at steps "+s[t.nodeId]+" and "+e),s[t.nodeId]=e})}}function l(e){var t="";return e.nodeType===Node.ELEMENT_NODE&&(t=e.getAttributeNS("urn:webodf:names:steps","nodeId")||""),t}function d(t){var n=e.toString();return t.setAttributeNS("urn:webodf:names:steps","nodeId",n),e+=1,n}function u(e){var t,i,r=new core.LoopWatchDog(0,1e4);for(void 0!==p&&e>p&&(e=p),t=Math.floor(e/n)*n;!i&&0<=t;)i=m[t],t-=n;for(i=i||f;i.nextBookmark&&i.nextBookmark.steps<=e;)r.check(),i=i.nextBookmark;return runtime.assert(-1===e||i.steps<=e,"Bookmark @"+a(i)+" at step "+i.steps+" exceeds requested step of "+e),i}function c(e){e.previousBookmark&&(e.previousBookmark.nextBookmark=e.nextBookmark),e.nextBookmark&&(e.nextBookmark.previousBookmark=e.previousBookmark)}function h(e){for(var n,i=null;!i&&e&&e!==t;)(n=l(e))&&(i=g[n])&&i.node!==e&&(runtime.log("Cloned node detected. Creating new bookmark"),i=null,e.removeAttributeNS("urn:webodf:names:steps","nodeId")),e=e.parentNode;return i}var f,p,m={},g={},_=core.DomUtils,v=Node.DOCUMENT_POSITION_FOLLOWING,b=Node.DOCUMENT_POSITION_PRECEDING;this.updateBookmark=function(e,i){var o,a,h,b,y=Math.ceil(e/n)*n;if(void 0!==p&&p<e){for(h=(a=u(p)).nextBookmark;h&&h.steps<=e;)o=h.nextBookmark,b=Math.ceil(h.steps/n)*n,m[b]===h&&delete m[b],_.containsNode(t,h.node)?h.steps=e+1:(c(h),delete g[h.nodeId]),h=o;p=e}else a=u(e);if(h=l(i)||d(i),(o=g[h])?o.node!==i&&(runtime.log("Cloned node detected. Creating new bookmark"),h=d(i),o=g[h]=new r(h,i)):o=g[h]=new r(h,i),(h=o).steps!==e&&((o=Math.ceil(h.steps/n)*n)!==y&&m[o]===h&&delete m[o],h.steps=e),a!==h&&a.nextBookmark!==h){if(a.steps===h.steps)for(;0!=(h.node.compareDocumentPosition(a.node)&v)&&a!==f;)a=a.previousBookmark;a!==h&&a.nextBookmark!==h&&(c(h),o=a.nextBookmark,h.nextBookmark=a.nextBookmark,h.previousBookmark=a,a.nextBookmark=h,o&&(o.previousBookmark=h))}(!(a=m[y])||h.steps>a.steps)&&(m[y]=h),s()},this.setToClosestStep=function(e,t){var n;return s(),(n=u(e)).setIteratorPosition(t),n.steps},this.setToClosestDomPoint=function(e,n,i){var r,o;if(s(),e===t&&0===n)r=f;else if(e===t&&n===t.childNodes.length)for(o in r=f,m)m.hasOwnProperty(o)&&((e=m[o]).steps>r.steps&&(r=e));else if(!(r=h(e.childNodes.item(n)||e)))for(i.setUnfilteredPosition(e,n);!r&&i.previousNode();)r=h(i.getCurrentNode());return r=r||f,void 0!==p&&r.steps>p&&(r=u(p)),r.setIteratorPosition(i),r.steps},this.damageCacheAfterStep=function(e){0>e&&(e=-1),(void 0===p||e<p)&&(p=e),s()},function(){var e=l(t)||d(t);f=new o(e,0,t)}()},ops.StepsCache.ENABLE_CACHE_VERIFICATION=!1,ops.StepsCache.Bookmark=function(){},ops.StepsCache.Bookmark.prototype.setIteratorPosition=function(e){}}(),ops.OdtStepsTranslator=function(e,t,n,i){function r(e,t,n){var i=t.getCurrentNode();t.isBeforeNode()&&s.isParagraph(i)&&(n||(e+=1),a.updateBookmark(e,i))}function o(e,t){if(!t||n.acceptPosition(e)===d)return!0;for(;e.previousPosition();)if(n.acceptPosition(e)===d){if(t(u,e.container(),e.unfilteredDomOffset()))return!0;break}for(;e.nextPosition();)if(n.acceptPosition(e)===d){if(t(c,e.container(),e.unfilteredDomOffset()))return!0;break}return!1}var a,s=odf.OdfUtils,l=core.DomUtils,d=core.PositionFilter.FilterResult.FILTER_ACCEPT,u=core.StepDirection.PREVIOUS,c=core.StepDirection.NEXT;this.convertStepsToDomPoint=function(e){var i,o;if(isNaN(e))throw new TypeError("Requested steps is not numeric ("+e+")");if(0>e)throw new RangeError("Requested steps is negative ("+e+")");for(i=a.setToClosestStep(e,t);i<e&&t.nextPosition();)(o=n.acceptPosition(t)===d)&&(i+=1),r(i,t,o);if(i!==e)throw new RangeError("Requested steps ("+e+") exceeds available steps ("+i+")");return{node:t.container(),offset:t.unfilteredDomOffset()}},this.convertDomPointToSteps=function(i,s,u){var c;if(l.containsNode(e,i)||(s=0>l.comparePoints(e,0,i,s),i=e,s=s?0:e.childNodes.length),t.setUnfilteredPosition(i,s),o(t,u)||t.setUnfilteredPosition(i,s),u=t.container(),s=t.unfilteredDomOffset(),i=a.setToClosestDomPoint(u,s,t),0>l.comparePoints(t.container(),t.unfilteredDomOffset(),u,s))return 0<i?i-1:i;for(;(t.container()!==u||t.unfilteredDomOffset()!==s)&&t.nextPosition();)(c=n.acceptPosition(t)===d)&&(i+=1),r(i,t,c);return i+0},this.prime=function(){var e,i;for(e=a.setToClosestStep(0,t);t.nextPosition();)(i=n.acceptPosition(t)===d)&&(e+=1),r(e,t,i)},this.handleStepsInserted=function(e){a.damageCacheAfterStep(e.position)},this.handleStepsRemoved=function(e){a.damageCacheAfterStep(e.position-1)},a=new ops.StepsCache(e,i,function(e,t){do{if(n.acceptPosition(t)===d){r(e,t,!0);break}r(e-1,t,!1)}while(t.nextPosition())})},ops.Operation=function(){},ops.Operation.prototype.init=function(e){},ops.Operation.prototype.execute=function(e){},ops.Operation.prototype.spec=function(){},ops.TextPositionFilter=function(){function e(e,n,i,a){var s;if(n){if(t.isInlineRoot(n)&&t.isGroupingElement(i))return o;if(1===(a=t.lookLeftForCharacter(n))||2===a&&(t.scanRightForAnyCharacter(i)||t.scanRightForAnyCharacter(t.nextNode(e))))return r}else if(t.isGroupingElement(e)&&t.isInlineRoot(function(e,t){for(;e&&t(e)!==r;)e=e.previousSibling;return e}(e.previousSibling,a)))return r;return a=null===n&&t.isParagraph(e),s=t.lookRightForCharacter(i),a?s?r:t.scanRightForAnyCharacter(i)?o:r:s?(n=n||t.previousNode(e),t.scanLeftForAnyCharacter(n)?o:r):o}var t=odf.OdfUtils,n=Node.ELEMENT_NODE,i=Node.TEXT_NODE,r=core.PositionFilter.FilterResult.FILTER_ACCEPT,o=core.PositionFilter.FilterResult.FILTER_REJECT;this.acceptPosition=function(a){var s,l,d,u=a.container(),c=u.nodeType;if(c!==n&&c!==i)return o;if(c===i){if(c=a.unfilteredDomOffset(),s=u.data,runtime.assert(c!==s.length,"Unexpected offset."),0<c){if(a=s[c-1],!t.isODFWhitespace(a))return r;if(1<c)if(a=s[c-2],t.isODFWhitespace(a)){if(!t.isODFWhitespace(s.substr(0,c)))return o}else d=r;else l=t.previousNode(u),t.scanLeftForNonSpace(l)&&(d=r);return d===r?t.isTrailingWhitespace(u,c)?o:r:(a=s[c],t.isODFWhitespace(a)||t.scanLeftForAnyCharacter(t.previousNode(u))?o:r)}l=a.leftNode(),d=u,d=e(u=u.parentNode,l,d,a.getNodeFilter())}else t.isGroupingElement(u)?d=e(u,l=a.leftNode(),d=a.rightNode(),a.getNodeFilter()):d=o;return d}},ops.OdtDocument=function(e){function t(e){return new core.PositionIterator(e,w,E,!1)}function n(){var t=e.odfContainer().getContentElement(),n=t&&t.localName;return runtime.assert("text"===n,"Unsupported content element type '"+n+"' for OdtDocument"),t}function i(){return m.getDocumentElement().ownerDocument}function r(e){for(;e&&!(e.namespaceURI===odf.Namespaces.officens&&"text"===e.localName||e.namespaceURI===odf.Namespaces.officens&&"annotation"===e.localName);)e=e.parentNode;return e}function o(e,n,i,r){var o;return r=t(r),1===i.length?o=i[0]:(o=new core.PositionFilterChain,i.forEach(o.addFilter)),(i=new core.StepIterator(o,r)).setPosition(e,n),i}function a(e){var i=t(n());return e=f.convertStepsToDomPoint(e),i.setUnfilteredPosition(e.node,e.offset),i}function s(e){return e===x}function l(t){var n=(r=t.spec()).memberid,i=new Date(r.timestamp).toISOString(),r=e.odfContainer();t.isEdit&&(n=m.getMember(n).getProperties().fullName,r.setMetadata({"dc:creator":n,"dc:date":i},null),n={setProperties:{"dc:creator":n,"dc:date":i},removedProperties:[]},p||(n.setProperties["meta:editing-cycles"]=r.incrementEditingCycles(),r.setMetadata(null,["meta:editing-duration","meta:document-statistic"])),p=t,m.emit(ops.OdtDocument.signalMetadataUpdated,n))}function d(e){var t,n,i=[],r=2;runtime.assert(e.isStep(),"positionIterator is not at a step");do{if((t=c.getContentBounds(e))&&(t=t.container,g.isDowngradableSpaceElement(t))){for(n=t.lastChild;t.firstChild;)i.push(t.firstChild),t.parentNode.insertBefore(t.firstChild,t);t.parentNode.removeChild(t),e.setPosition(n,n.nodeType===Node.TEXT_NODE?n.length:n.childNodes.length),e.roundToPreviousStep()}--r}while(0<r&&e.nextStep());i.forEach(_.normalizeTextNodes)}function u(e,t,n){return e=e.childNodes.item(t)||e,(e=g.getParagraphElement(e))&&_.containsNode(n,e)?e:n}var c,h,f,p,m=this,g=odf.OdfUtils,_=core.DomUtils,v={},b={},y=new core.EventNotifier([ops.Document.signalMemberAdded,ops.Document.signalMemberUpdated,ops.Document.signalMemberRemoved,ops.Document.signalCursorAdded,ops.Document.signalCursorRemoved,ops.Document.signalCursorMoved,ops.OdtDocument.signalParagraphChanged,ops.OdtDocument.signalParagraphStyleModified,ops.OdtDocument.signalCommonStyleCreated,ops.OdtDocument.signalCommonStyleDeleted,ops.OdtDocument.signalTableAdded,ops.OdtDocument.signalOperationStart,ops.OdtDocument.signalOperationEnd,ops.OdtDocument.signalProcessingBatchStart,ops.OdtDocument.signalProcessingBatchEnd,ops.OdtDocument.signalUndoStackChanged,ops.OdtDocument.signalStepsInserted,ops.OdtDocument.signalStepsRemoved,ops.OdtDocument.signalMetadataUpdated,ops.OdtDocument.signalAnnotationAdded]),x=core.StepDirection.NEXT,w=NodeFilter.SHOW_ALL,S=new gui.BlacklistNamespaceNodeFilter(["urn:webodf:names:cursor","urn:webodf:names:editinfo"]),N=new gui.OdfTextBodyNodeFilter,E=new core.NodeFilterChain([S,N]);this.createPositionIterator=t,this.getDocumentElement=function(){return e.odfContainer().rootElement},this.cloneDocumentElement=function(){var t=m.getDocumentElement(),n=e.getAnnotationViewManager();return n&&n.forgetAnnotations(),t=t.cloneNode(!0),e.refreshAnnotations(),m.fixCursorPositions(),t},this.setDocumentElement=function(i){var r=e.odfContainer();y.unsubscribe(ops.OdtDocument.signalStepsInserted,f.handleStepsInserted),y.unsubscribe(ops.OdtDocument.signalStepsRemoved,f.handleStepsRemoved),r.setRootElement(i),e.setOdfContainer(r,!0),e.refreshCSS(),i=n(),f=new ops.OdtStepsTranslator(i,t(i),h,500),y.subscribe(ops.OdtDocument.signalStepsInserted,f.handleStepsInserted),y.subscribe(ops.OdtDocument.signalStepsRemoved,f.handleStepsRemoved)},this.getDOMDocument=i,this.getRootElement=r,this.createStepIterator=o,this.getIteratorAtPosition=a,this.convertCursorStepToDomPoint=function(e){return f.convertStepsToDomPoint(e)},this.convertDomPointToCursorStep=function(e,t,n){var i;return n===x&&(i=s),f.convertDomPointToSteps(e,t,i)},this.convertDomToCursorRange=function(e){var t;return{position:t=f.convertDomPointToSteps(e.anchorNode,e.anchorOffset),length:(e=e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset?t:f.convertDomPointToSteps(e.focusNode,e.focusOffset))-t}},this.convertCursorToDomRange=function(e,t){var n,r,o=i().createRange();return n=f.convertStepsToDomPoint(e),t?(r=f.convertStepsToDomPoint(e+t),0<t?(o.setStart(n.node,n.offset),o.setEnd(r.node,r.offset)):(o.setStart(r.node,r.offset),o.setEnd(n.node,n.offset))):o.setStart(n.node,n.offset),o},this.upgradeWhitespacesAtPosition=function(e){var t,n=a(e),i=(n=new core.StepIterator(h,n),2);runtime.assert(n.isStep(),"positionIterator is not at a step (requested step: "+e+")");do{if((t=c.getContentBounds(n))&&(e=t.container,t=t.startOffset,e.nodeType===Node.TEXT_NODE&&g.isSignificantWhitespace(e,t))){runtime.assert(" "===e.data[t],"upgradeWhitespaceToElement: textNode.data[offset] should be a literal space");var r=e.ownerDocument.createElementNS(odf.Namespaces.textns,"text:s"),o=e.parentNode,s=e;r.appendChild(e.ownerDocument.createTextNode(" ")),1===e.length?o.replaceChild(r,e):(e.deleteData(t,1),0<t&&(t<e.length&&e.splitText(t),s=e.nextSibling),o.insertBefore(r,s)),e=r,n.setPosition(e,e.childNodes.length),n.roundToPreviousStep()}--i}while(0<i&&n.nextStep())},this.downgradeWhitespaces=d,this.downgradeWhitespacesAtPosition=function(e){e=a(e),d(e=new core.StepIterator(h,e))},this.getTextNodeAtStep=function(e,t){var n,r=a(e),o=r.container(),s=0,l=null;if(o.nodeType===Node.TEXT_NODE?(n=o,s=r.unfilteredDomOffset(),0<n.length&&(0<s&&(n=n.splitText(s)),n.parentNode.insertBefore(i().createTextNode(""),n),n=n.previousSibling,s=0)):(n=i().createTextNode(""),s=0,o.insertBefore(n,r.rightNode())),t){if(v[t]&&m.getCursorPosition(t)===e){for(l=v[t].getNode();l.nextSibling&&"cursor"===l.nextSibling.localName;)l.parentNode.insertBefore(l.nextSibling,l);0<n.length&&n.nextSibling!==l&&(n=i().createTextNode(""),s=0),l.parentNode.insertBefore(n,l)}}else for(;n.nextSibling&&"cursor"===n.nextSibling.localName;)n.parentNode.insertBefore(n.nextSibling,n);for(;n.previousSibling&&n.previousSibling.nodeType===Node.TEXT_NODE;)(r=n.previousSibling).appendData(n.data),s=r.length,(n=r).parentNode.removeChild(n.nextSibling);for(;n.nextSibling&&n.nextSibling.nodeType===Node.TEXT_NODE;)r=n.nextSibling,n.appendData(r.data),n.parentNode.removeChild(r);return{textNode:n,offset:s}},this.fixCursorPositions=function(){Object.keys(v).forEach(function(e){var t,n,i,a=v[e],s=r(a.getNode()),l=m.createRootFilter(s),d=!1;t=u((i=a.getSelectedRange()).startContainer,i.startOffset,s),n=o(i.startContainer,i.startOffset,[h,l],t),i.collapsed?s=n:(t=u(i.endContainer,i.endOffset,s),s=o(i.endContainer,i.endOffset,[h,l],t)),n.isStep()&&s.isStep()?n.container()!==s.container()||n.offset()!==s.offset()||i.collapsed&&a.getAnchorNode()===a.getNode()||(d=!0,i.setStart(n.container(),n.offset()),i.collapse(!0)):(d=!0,runtime.assert(n.roundToClosestStep(),"No walkable step found for cursor owned by "+e),i.setStart(n.container(),n.offset()),runtime.assert(s.roundToClosestStep(),"No walkable step found for cursor owned by "+e),i.setEnd(s.container(),s.offset())),d&&(a.setSelectedRange(i,a.hasForwardSelection()),m.emit(ops.Document.signalCursorMoved,a))})},this.getCursorPosition=function(e){return(e=v[e])?f.convertDomPointToSteps(e.getNode(),0):0},this.getCursorSelection=function(e){var t=0,n=0;return(e=v[e])&&(t=f.convertDomPointToSteps(e.getNode(),0),n=f.convertDomPointToSteps(e.getAnchorNode(),0)),{position:n,length:t-n}},this.getPositionFilter=function(){return h},this.getOdfCanvas=function(){return e},this.getCanvas=function(){return e},this.getRootNode=n,this.addMember=function(e){runtime.assert(void 0===b[e.getMemberId()],"This member already exists"),b[e.getMemberId()]=e},this.getMember=function(e){return b.hasOwnProperty(e)?b[e]:null},this.removeMember=function(e){delete b[e]},this.getCursor=function(e){return v[e]},this.hasCursor=function(e){return v.hasOwnProperty(e)},this.getMemberIds=function(){return Object.keys(b)},this.addCursor=function(e){runtime.assert(Boolean(e),"OdtDocument::addCursor without cursor");var t=e.getMemberId(),n=m.convertCursorToDomRange(0,0);runtime.assert("string"==typeof t,"OdtDocument::addCursor has cursor without memberid"),runtime.assert(!v[t],"OdtDocument::addCursor is adding a duplicate cursor with memberid "+t),e.setSelectedRange(n,!0),v[t]=e},this.removeCursor=function(e){var t=v[e];return!!t&&(t.removeFromDocument(),delete v[e],m.emit(ops.Document.signalCursorRemoved,e),!0)},this.moveCursor=function(e,t,n,i){e=v[e],t=m.convertCursorToDomRange(t,n),e&&(e.setSelectedRange(t,0<=n),e.setSelectionType(i||ops.OdtCursor.RangeSelection))},this.getFormatting=function(){return e.getFormatting()},this.emit=function(e,t){y.emit(e,t)},this.subscribe=function(e,t){y.subscribe(e,t)},this.unsubscribe=function(e,t){y.unsubscribe(e,t)},this.createRootFilter=function(e){return new RootFilter(e,v,r)},this.close=function(e){e()},this.destroy=function(e){e()},function(){var e=n();h=new ops.TextPositionFilter,c=new odf.StepUtils,f=new ops.OdtStepsTranslator(e,t(e),h,500),y.subscribe(ops.OdtDocument.signalStepsInserted,f.handleStepsInserted),y.subscribe(ops.OdtDocument.signalStepsRemoved,f.handleStepsRemoved),y.subscribe(ops.OdtDocument.signalOperationEnd,l),y.subscribe(ops.OdtDocument.signalProcessingBatchEnd,core.Task.processTasks)}()},ops.OdtDocument.signalParagraphChanged="paragraph/changed",ops.OdtDocument.signalTableAdded="table/added",ops.OdtDocument.signalCommonStyleCreated="style/created",ops.OdtDocument.signalCommonStyleDeleted="style/deleted",ops.OdtDocument.signalParagraphStyleModified="paragraphstyle/modified",ops.OdtDocument.signalOperationStart="operation/start",ops.OdtDocument.signalOperationEnd="operation/end",ops.OdtDocument.signalProcessingBatchStart="router/batchstart",ops.OdtDocument.signalProcessingBatchEnd="router/batchend",ops.OdtDocument.signalUndoStackChanged="undo/changed",ops.OdtDocument.signalStepsInserted="steps/inserted",ops.OdtDocument.signalStepsRemoved="steps/removed",ops.OdtDocument.signalMetadataUpdated="metadata/updated",ops.OdtDocument.signalAnnotationAdded="annotation/added",ops.OpAddAnnotation=function(){function e(e,n,i){var r=e.getTextNodeAtStep(i,t);r&&(i=(e=r.textNode).parentNode,r.offset!==e.length&&e.splitText(r.offset),i.insertBefore(n,e.nextSibling),0===e.length&&i.removeChild(e))}var t,n,i,r,o,a;this.init=function(e){t=e.memberid,n=parseInt(e.timestamp,10),i=parseInt(e.position,10),r=void 0!==e.length?parseInt(e.length,10)||0:void 0,o=e.name},this.isEdit=!0,this.group=void 0,this.execute=function(s){var l,d,u=s.getCursor(t);a=s.getDOMDocument();var c,h,f,p=new Date(n);return(c=a.createElementNS(odf.Namespaces.officens,"office:annotation")).setAttributeNS(odf.Namespaces.officens,"office:name",o),(l=a.createElementNS(odf.Namespaces.dcns,"dc:creator")).setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",t),l.textContent=s.getMember(t).getProperties().fullName,(d=a.createElementNS(odf.Namespaces.dcns,"dc:date")).appendChild(a.createTextNode(p.toISOString())),p=a.createElementNS(odf.Namespaces.textns,"text:list"),h=a.createElementNS(odf.Namespaces.textns,"text:list-item"),f=a.createElementNS(odf.Namespaces.textns,"text:p"),h.appendChild(f),p.appendChild(h),c.appendChild(l),c.appendChild(d),c.appendChild(p),void 0!==r&&((l=a.createElementNS(odf.Namespaces.officens,"office:annotation-end")).setAttributeNS(odf.Namespaces.officens,"office:name",o),c.annotationEndElement=l,e(s,l,i+r)),e(s,c,i),s.emit(ops.OdtDocument.signalStepsInserted,{position:i}),u&&(l=a.createRange(),d=c.getElementsByTagNameNS(odf.Namespaces.textns,"p")[0],l.selectNodeContents(d),u.setSelectedRange(l,!1),u.setSelectionType(ops.OdtCursor.RangeSelection),s.emit(ops.Document.signalCursorMoved,u)),s.getOdfCanvas().addAnnotation(c),s.fixCursorPositions(),s.emit(ops.OdtDocument.signalAnnotationAdded,{memberId:t,annotation:c}),!0},this.spec=function(){return{optype:"AddAnnotation",memberid:t,timestamp:n,position:i,length:r,name:o}}},ops.OpAddCursor=function(){var e,t;this.init=function(n){e=n.memberid,t=n.timestamp},this.isEdit=!1,this.group=void 0,this.execute=function(t){var n=t.getCursor(e);return!n&&(n=new ops.OdtCursor(e,t),t.addCursor(n),t.emit(ops.Document.signalCursorAdded,n),!0)},this.spec=function(){return{optype:"AddCursor",memberid:e,timestamp:t}}},ops.OpAddMember=function(){var e,t,n;this.init=function(i){e=i.memberid,t=parseInt(i.timestamp,10),n=i.setProperties},this.isEdit=!1,this.group=void 0,this.execute=function(t){var i;return!t.getMember(e)&&(i=new ops.Member(e,n),t.addMember(i),t.emit(ops.Document.signalMemberAdded,i),!0)},this.spec=function(){return{optype:"AddMember",memberid:e,timestamp:t,setProperties:n}}},ops.OpAddStyle=function(){var e,t,n,i,r,o,a=odf.Namespaces.stylens;this.init=function(a){e=a.memberid,t=a.timestamp,n=a.styleName,i=a.styleFamily,r="true"===a.isAutomaticStyle||!0===a.isAutomaticStyle,o=a.setProperties},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getOdfCanvas().odfContainer(),s=e.getFormatting(),l=e.getDOMDocument().createElementNS(a,"style:style");return!!l&&(o&&s.updateStyle(l,o),l.setAttributeNS(a,"style:family",i),l.setAttributeNS(a,"style:name",n),r?t.rootElement.automaticStyles.appendChild(l):t.rootElement.styles.appendChild(l),e.getOdfCanvas().refreshCSS(),r||e.emit(ops.OdtDocument.signalCommonStyleCreated,{name:n,family:i}),!0)},this.spec=function(){return{optype:"AddStyle",memberid:e,timestamp:t,styleName:n,styleFamily:i,isAutomaticStyle:r,setProperties:o}}},odf.ObjectNameGenerator=function(e,t){function n(e,t){var n={};this.generateName=function(){var i,r=t(),o=0;do{i=e+o,o+=1}while(n[i]||r[i]);return n[i]=!0,i}}var i=odf.Namespaces.stylens,r=odf.Namespaces.drawns,o=odf.Namespaces.xlinkns,a=(new core.Utils).hashString(t),s=null,l=null,d=null,u={},c={};this.generateStyleName=function(){return null===s&&(s=new n("auto"+a+"_",function(){return function(){var t={};return[e.rootElement.automaticStyles,e.rootElement.styles].forEach(function(e){for(e=e.firstElementChild;e;)e.namespaceURI===i&&"style"===e.localName&&(t[e.getAttributeNS(i,"name")]=!0),e=e.nextElementSibling}),t}()})),s.generateName()},this.generateFrameName=function(){var t,i,o;if(null===l){for(i=e.rootElement.body.getElementsByTagNameNS(r,"frame"),t=0;t<i.length;t+=1)o=i.item(t),u[o.getAttributeNS(r,"name")]=!0;l=new n("fr"+a+"_",function(){return u})}return l.generateName()},this.generateImageName=function(){var t,i,s;if(null===d){for(s=e.rootElement.body.getElementsByTagNameNS(r,"image"),t=0;t<s.length;t+=1)i=(i=(i=s.item(t)).getAttributeNS(o,"href")).substring(9,i.lastIndexOf(".")),c[i]=!0;d=new n("img"+a+"_",function(){return c})}return d.generateName()}},odf.TextStyleApplicator=function(e,t,n){function i(e){function n(e,t){return"object"==typeof e&&"object"==typeof t?Object.keys(e).every(function(i){return n(e[i],t[i])}):e===t}var i={};this.isStyleApplied=function(r){return r=t.getAppliedStylesForElement(r,i).styleProperties,n(e,r)}}function r(i){var r={};this.applyStyleToContainer=function(o){var a;a=o.getAttributeNS(s,"style-name");var d=o.ownerDocument;if(a=a||"",!r.hasOwnProperty(a)){var u,c=a;u=a?t.createDerivedStyleObject(a,"text",i):i,d=d.createElementNS(l,"style:style"),t.updateStyle(d,u),d.setAttributeNS(l,"style:name",e.generateStyleName()),d.setAttributeNS(l,"style:family","text"),d.setAttributeNS("urn:webodf:names:scope","scope","document-content"),n.appendChild(d),r[c]=d}a=r[a].getAttributeNS(l,"name"),o.setAttributeNS(s,"text:style-name",a)}}function o(e,t){var n,i,r,o=e.ownerDocument,l=e.parentNode,d=new core.LoopWatchDog(1e4);for((i=[]).push(e),r=e.nextSibling;r&&a.rangeContainsNode(t,r);)d.check(),i.push(r),r=r.nextSibling;if("span"!==l.localName||l.namespaceURI!==s?(n=o.createElementNS(s,"text:span"),l.insertBefore(n,e),o=!1):(e.previousSibling&&!a.rangeContainsNode(t,l.firstChild)?(n=l.cloneNode(!1),l.parentNode.insertBefore(n,l.nextSibling)):n=l,o=!0),i.forEach(function(e){e.parentNode!==n&&n.appendChild(e)}),r&&o)for(i=n.cloneNode(!1),n.parentNode.insertBefore(i,n.nextSibling);r;)d.check(),o=r.nextSibling,i.appendChild(r),r=o;return n}var a=core.DomUtils,s=odf.Namespaces.textns,l=odf.Namespaces.stylens;this.applyStyle=function(e,t,n){var a,s,l,d={};runtime.assert(n&&n.hasOwnProperty("style:text-properties"),"applyStyle without any text properties"),d["style:text-properties"]=n["style:text-properties"],s=new r(d),l=new i(d),e.forEach(function(e){!1===l.isStyleApplied(e)&&(a=o(e,t),s.applyStyleToContainer(a))})}},ops.OpApplyDirectStyling=function(){function e(e,n,i){var r=e.getOdfCanvas().odfContainer(),o=s.splitBoundaries(n),l=a.getTextNodes(n,!1);new odf.TextStyleApplicator(new odf.ObjectNameGenerator(r,t),e.getFormatting(),r.rootElement.automaticStyles).applyStyle(l,n,i),o.forEach(s.normalizeTextNodes)}var t,n,i,r,o,a=odf.OdfUtils,s=core.DomUtils;this.init=function(e){t=e.memberid,n=e.timestamp,i=parseInt(e.position,10),r=parseInt(e.length,10),o=e.setProperties},this.isEdit=!0,this.group=void 0,this.execute=function(s){var l=s.convertCursorToDomRange(i,r),d=a.getParagraphElements(l);return e(s,l,o),l.detach(),s.getOdfCanvas().refreshCSS(),s.fixCursorPositions(),d.forEach(function(e){s.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:e,memberId:t,timeStamp:n})}),s.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"ApplyDirectStyling",memberid:t,timestamp:n,position:i,length:r,setProperties:o}}},ops.OpApplyHyperlink=function(){var e,t,n,i,r,o=core.DomUtils,a=odf.OdfUtils;this.init=function(o){e=o.memberid,t=o.timestamp,n=o.position,i=o.length,r=o.hyperlink},this.isEdit=!0,this.group=void 0,this.execute=function(s){var l=s.getDOMDocument(),d=s.convertCursorToDomRange(n,i),u=o.splitBoundaries(d),c=[],h=a.getTextNodes(d,!1);return 0!==h.length&&(h.forEach(function(e){var t=a.getParagraphElement(e);runtime.assert(!1===function(e){for(;e;){if(a.isHyperlink(e))return!0;e=e.parentNode}return!1}(e),"The given range should not contain any link.");var n=r,i=l.createElementNS(odf.Namespaces.textns,"text:a");i.setAttributeNS(odf.Namespaces.xlinkns,"xlink:type","simple"),i.setAttributeNS(odf.Namespaces.xlinkns,"xlink:href",n),e.parentNode.insertBefore(i,e),i.appendChild(e),-1===c.indexOf(t)&&c.push(t)}),u.forEach(o.normalizeTextNodes),d.detach(),s.fixCursorPositions(),s.getOdfCanvas().refreshSize(),s.getOdfCanvas().rerenderAnnotations(),c.forEach(function(n){s.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:n,memberId:e,timeStamp:t})}),!0)},this.spec=function(){return{optype:"ApplyHyperlink",memberid:e,timestamp:t,position:n,length:i,hyperlink:r}}},ops.OpInsertImage=function(){var e,t,n,i,r,o,a,s,l=odf.Namespaces.drawns,d=odf.Namespaces.svgns,u=odf.Namespaces.textns,c=odf.Namespaces.xlinkns,h=odf.OdfUtils;this.init=function(l){e=l.memberid,t=l.timestamp,n=l.position,i=l.filename,r=l.frameWidth,o=l.frameHeight,a=l.frameStyleName,s=l.frameName},this.isEdit=!0,this.group=void 0,this.execute=function(f){var p,m,g=f.getOdfCanvas();if(!(_=f.getTextNodeAtStep(n,e)))return!1;p=_.textNode,m=h.getParagraphElement(p);var _=_.offset!==p.length?p.splitText(_.offset):p.nextSibling,v=(b=f.getDOMDocument()).createElementNS(l,"draw:image"),b=b.createElementNS(l,"draw:frame");return v.setAttributeNS(c,"xlink:href",i),v.setAttributeNS(c,"xlink:type","simple"),v.setAttributeNS(c,"xlink:show","embed"),v.setAttributeNS(c,"xlink:actuate","onLoad"),b.setAttributeNS(l,"draw:style-name",a),b.setAttributeNS(l,"draw:name",s),b.setAttributeNS(u,"text:anchor-type","as-char"),b.setAttributeNS(d,"svg:width",r),b.setAttributeNS(d,"svg:height",o),b.appendChild(v),p.parentNode.insertBefore(b,_),f.emit(ops.OdtDocument.signalStepsInserted,{position:n}),0===p.length&&p.parentNode.removeChild(p),g.addCssForFrameWithImage(b),g.refreshCSS(),f.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:m,memberId:e,timeStamp:t}),g.rerenderAnnotations(),!0},this.spec=function(){return{optype:"InsertImage",memberid:e,timestamp:t,filename:i,position:n,frameWidth:r,frameHeight:o,frameStyleName:a,frameName:s}}},ops.OpInsertTable=function(){function e(e,t){var n;if(1===d.length)n=d[0];else if(3===d.length)switch(e){case 0:n=d[0];break;case i-1:n=d[2];break;default:n=d[1]}else n=d[e];if(1===n.length)return n[0];if(3===n.length)switch(t){case 0:return n[0];case r-1:return n[2];default:return n[1]}return n[t]}var t,n,i,r,o,a,s,l,d,u=odf.OdfUtils;this.init=function(e){t=e.memberid,n=e.timestamp,o=e.position,i=e.initialRows,r=e.initialColumns,a=e.tableName,s=e.tableStyleName,l=e.tableColumnStyleName,d=e.tableCellStyleMatrix},this.isEdit=!0,this.group=void 0,this.execute=function(d){var c=d.getTextNodeAtStep(o),h=d.getRootNode();if(c){var f,p,m,g,_=d.getDOMDocument(),v=_.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table"),b=_.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-column");for(s&&v.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",s),a&&v.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:name",a),b.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:number-columns-repeated",r),l&&b.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",l),v.appendChild(b),m=0;m<i;m+=1){for(b=_.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-row"),g=0;g<r;g+=1)f=_.createElementNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:table-cell"),(p=e(m,g))&&f.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:table:1.0","table:style-name",p),p=_.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:p"),f.appendChild(p),b.appendChild(f);v.appendChild(b)}return c=u.getParagraphElement(c.textNode),h.insertBefore(v,c.nextSibling),d.emit(ops.OdtDocument.signalStepsInserted,{position:o}),d.getOdfCanvas().refreshSize(),d.emit(ops.OdtDocument.signalTableAdded,{tableElement:v,memberId:t,timeStamp:n}),d.getOdfCanvas().rerenderAnnotations(),!0}return!1},this.spec=function(){return{optype:"InsertTable",memberid:t,timestamp:n,position:o,initialRows:i,initialColumns:r,tableName:a,tableStyleName:s,tableColumnStyleName:l,tableCellStyleMatrix:d}}},ops.OpInsertText=function(){function e(e){return"\t"!==e&&a.isODFWhitespace(e)}var t,n,i,r,o,a=odf.OdfUtils;this.init=function(e){t=e.memberid,n=e.timestamp,i=e.position,o=e.text,r="true"===e.moveCursor||!0===e.moveCursor},this.isEdit=!0,this.group=void 0,this.execute=function(s){var l,d,u,c,h,f,p=null,m=s.getDOMDocument(),g=0,_=s.getCursor(t);if(s.upgradeWhitespacesAtPosition(i),l=s.getTextNodeAtStep(i)){for(p=(d=l.textNode).nextSibling,u=d.parentNode,c=a.getParagraphElement(d),f=0;f<o.length;f+=1){if(!(h="\t"===o[f])){var v=f;h=e((h=o)[v])&&(0===v||v===h.length-1||e(h[v-1]))}h&&(0===g?(l.offset!==d.length&&(p=d.splitText(l.offset)),0<f&&d.appendData(o.substring(0,f))):g<f&&(g=o.substring(g,f),u.insertBefore(m.createTextNode(g),p)),g=f+1,"\t"===o[f]?(h=m.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:tab")).appendChild(m.createTextNode("\t")):(" "!==o[f]&&runtime.log("WARN: InsertText operation contains non-tab, non-space whitespace character (character code "+o.charCodeAt(f)+")"),(h=m.createElementNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:s")).appendChild(m.createTextNode(" "))),u.insertBefore(h,p))}return 0===g?d.insertData(l.offset,o):g<o.length&&(l=o.substring(g),u.insertBefore(m.createTextNode(l),p)),u=d.parentNode,p=d.nextSibling,u.removeChild(d),u.insertBefore(d,p),0===d.length&&d.parentNode.removeChild(d),s.emit(ops.OdtDocument.signalStepsInserted,{position:i}),_&&r&&(s.moveCursor(t,i+o.length,0),s.emit(ops.Document.signalCursorMoved,_)),s.downgradeWhitespacesAtPosition(i),s.downgradeWhitespacesAtPosition(i+o.length),s.getOdfCanvas().refreshSize(),s.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:c,memberId:t,timeStamp:n}),s.getOdfCanvas().rerenderAnnotations(),!0}return!1},this.spec=function(){return{optype:"InsertText",memberid:t,timestamp:n,position:i,text:o,moveCursor:r}}},odf.CollapsingRules=function(e){function t(e){return n.isODFNode(e)||"br"===e.localName&&n.isLineBreak(e.parentNode)||e.nodeType===Node.TEXT_NODE&&n.isODFNode(e.parentNode)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}var n=odf.OdfUtils,i=core.DomUtils;this.mergeChildrenIntoParent=function r(o){var a;return o.nodeType===Node.TEXT_NODE?(a=o.parentNode).removeChild(o):a=i.removeUnwantedNodes(o,t),(o=a)&&(o=a,o=!n.isParagraph(o)&&o!==e&&n.hasNoODFContent(o)),o?r(a):a}},ops.OpMergeParagraph=function(){function e(e){return odf.OdfUtils.isInlineRoot(e)?NodeFilter.FILTER_SKIP:u.isGroupingElement(e)&&u.hasNoODFContent(e)?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}function t(e){if(e.nodeType===Node.TEXT_NODE){if(0===e.length)return runtime.log("WARN: Empty text node found during merge operation"),!0;if(u.isODFWhitespace(e.data)&&!1===u.isSignificantWhitespace(e,0))return!0;e="#text"}else e=(e.prefix?e.prefix+":":"")+e.localName;return runtime.log("WARN: Unexpected text element found near paragraph boundary ["+e+"]"),!1}function n(e){e.collapsed||(c.splitBoundaries(e),(e=u.getTextElements(e,!1,!0).filter(t)).forEach(function(e){e.parentNode.removeChild(e)}))}function i(e,t,n){e=e.convertCursorStepToDomPoint(t);var i=u.getParagraphElement(e.node,e.offset);return runtime.assert(Boolean(i),"Paragraph not found at step "+t),n&&n.setPosition(e.node,e.offset),i}var r,o,a,s,l,d,u=odf.OdfUtils,c=core.DomUtils,h=odf.Namespaces.textns;this.init=function(e){r=e.memberid,o=e.timestamp,a=e.moveCursor,s=e.paragraphStyleName,l=parseInt(e.sourceStartPosition,10),d=parseInt(e.destinationStartPosition,10)},this.isEdit=!0,this.group=void 0,this.execute=function(t){var u,f,p=t.getCursor(r);u=t.getRootNode();var m,g=new odf.CollapsingRules(u),_=t.createStepIterator(u,0,[t.getPositionFilter()],u);runtime.assert(d<l,"Destination paragraph ("+d+") must be before source paragraph ("+l+")"),f=i(t,d),u=i(t,l,_),_.previousStep(),runtime.assert(c.containsNode(f,_.container()),"Destination paragraph must be adjacent to the source paragraph"),m=f.ownerDocument.createRange(),_.setPosition(f,f.childNodes.length),_.roundToPreviousStep(),m.setStart(_.container(),_.offset()),m.setEnd(f,f.childNodes.length),n(m),m=f.childNodes.length;var v=u.ownerDocument.createRange();for(_.setPosition(u,0),_.roundToNextStep(),v.setStart(u,0),v.setEnd(_.container(),_.offset()),n(v),v=u.firstChild;v;)"editinfo"===v.localName?u.removeChild(v):(f.appendChild(v),c.removeUnwantedNodes(v,e)),v=u.firstChild;return runtime.assert(0===u.childNodes.length,"Source paragraph should be empty before it is removed"),g.mergeChildrenIntoParent(u),t.emit(ops.OdtDocument.signalStepsRemoved,{position:l-1}),_.setPosition(f,m),_.roundToClosestStep(),_.previousStep()||_.roundToNextStep(),t.downgradeWhitespaces(_),s?f.setAttributeNS(h,"text:style-name",s):f.removeAttributeNS(h,"style-name"),p&&a&&(t.moveCursor(r,l-1,0),t.emit(ops.Document.signalCursorMoved,p)),t.fixCursorPositions(),t.getOdfCanvas().refreshSize(),t.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:f,memberId:r,timeStamp:o}),t.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"MergeParagraph",memberid:r,timestamp:o,moveCursor:a,paragraphStyleName:s,sourceStartPosition:l,destinationStartPosition:d}}},ops.OpMoveCursor=function(){var e,t,n,i,r;this.init=function(o){e=o.memberid,t=o.timestamp,n=o.position,i=o.length||0,r=o.selectionType||ops.OdtCursor.RangeSelection},this.isEdit=!1,this.group=void 0,this.execute=function(t){var o,a=t.getCursor(e);return!!a&&(o=t.convertCursorToDomRange(n,i),a.setSelectedRange(o,0<=i),a.setSelectionType(r),t.emit(ops.Document.signalCursorMoved,a),!0)},this.spec=function(){return{optype:"MoveCursor",memberid:e,timestamp:t,position:n,length:i,selectionType:r}}},ops.OpRemoveAnnotation=function(){var e,t,n,i,r=core.DomUtils;this.init=function(r){e=r.memberid,t=r.timestamp,n=parseInt(r.position,10),i=parseInt(r.length,10)},this.isEdit=!0,this.group=void 0,this.execute=function(e){function t(e){i.parentNode.insertBefore(e,i)}for(var i,o=e.getIteratorAtPosition(n).container();o.namespaceURI!==odf.Namespaces.officens||"annotation"!==o.localName;)o=o.parentNode;return null!==o&&(o=(i=o).annotationEndElement,e.getOdfCanvas().forgetAnnotation(i),r.getElementsByTagNameNS(i,"urn:webodf:names:cursor","cursor").forEach(t),r.getElementsByTagNameNS(i,"urn:webodf:names:cursor","anchor").forEach(t),i.parentNode.removeChild(i),o&&o.parentNode.removeChild(o),e.emit(ops.OdtDocument.signalStepsRemoved,{position:0<n?n-1:n}),e.getOdfCanvas().rerenderAnnotations(),e.fixCursorPositions(),!0)},this.spec=function(){return{optype:"RemoveAnnotation",memberid:e,timestamp:t,position:n,length:i}}},ops.OpRemoveBlob=function(){var e,t,n;this.init=function(i){e=i.memberid,t=i.timestamp,n=i.filename},this.isEdit=!0,this.group=void 0,this.execute=function(e){return e.getOdfCanvas().odfContainer().removeBlob(n),!0},this.spec=function(){return{optype:"RemoveBlob",memberid:e,timestamp:t,filename:n}}},ops.OpRemoveCursor=function(){var e,t;this.init=function(n){e=n.memberid,t=n.timestamp},this.isEdit=!1,this.group=void 0,this.execute=function(t){return!!t.removeCursor(e)},this.spec=function(){return{optype:"RemoveCursor",memberid:e,timestamp:t}}},ops.OpRemoveHyperlink=function(){var e,t,n,i,r=core.DomUtils,o=odf.OdfUtils;this.init=function(r){e=r.memberid,t=r.timestamp,n=r.position,i=r.length},this.isEdit=!0,this.group=void 0,this.execute=function(a){var s=a.convertCursorToDomRange(n,i),l=o.getHyperlinkElements(s);return runtime.assert(1===l.length,"The given range should only contain a single link."),l=r.mergeIntoParent(l[0]),s.detach(),a.fixCursorPositions(),a.getOdfCanvas().refreshSize(),a.getOdfCanvas().rerenderAnnotations(),a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:o.getParagraphElement(l),memberId:e,timeStamp:t}),!0},this.spec=function(){return{optype:"RemoveHyperlink",memberid:e,timestamp:t,position:n,length:i}}},ops.OpRemoveMember=function(){var e,t;this.init=function(n){e=n.memberid,t=parseInt(n.timestamp,10)},this.isEdit=!1,this.group=void 0,this.execute=function(t){return!!t.getMember(e)&&(t.removeMember(e),t.emit(ops.Document.signalMemberRemoved,e),!0)},this.spec=function(){return{optype:"RemoveMember",memberid:e,timestamp:t}}},ops.OpRemoveStyle=function(){var e,t,n,i;this.init=function(r){e=r.memberid,t=r.timestamp,n=r.styleName,i=r.styleFamily},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getFormatting().getStyleElement(n,i);return!!t&&(t.parentNode.removeChild(t),e.getOdfCanvas().refreshCSS(),e.emit(ops.OdtDocument.signalCommonStyleDeleted,{name:n,family:i}),!0)},this.spec=function(){return{optype:"RemoveStyle",memberid:e,timestamp:t,styleName:n,styleFamily:i}}},ops.OpRemoveText=function(){var e,t,n,i,r=odf.OdfUtils,o=core.DomUtils;this.init=function(r){runtime.assert(0<=r.length,"OpRemoveText only supports positive lengths"),e=r.memberid,t=r.timestamp,n=parseInt(r.position,10),i=parseInt(r.length,10)},this.isEdit=!0,this.group=void 0,this.execute=function(a){var s,l,d,u=a.getCursor(e),c=new odf.CollapsingRules(a.getRootNode());return a.upgradeWhitespacesAtPosition(n),a.upgradeWhitespacesAtPosition(n+i),s=a.convertCursorToDomRange(n,i),o.splitBoundaries(s),l=r.getTextElements(s,!1,!0),d=r.getParagraphElement(s.startContainer,s.startOffset),runtime.assert(void 0!==d,"Attempting to remove text outside a paragraph element"),s.detach(),l.forEach(function(e){e.parentNode?(runtime.assert(o.containsNode(d,e),"RemoveText only supports removing elements within the same paragraph"),c.mergeChildrenIntoParent(e)):runtime.log("WARN: text element has already been removed from it's container")}),a.emit(ops.OdtDocument.signalStepsRemoved,{position:n}),a.downgradeWhitespacesAtPosition(n),a.fixCursorPositions(),a.getOdfCanvas().refreshSize(),a.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:d,memberId:e,timeStamp:t}),u&&(u.resetSelectionType(),a.emit(ops.Document.signalCursorMoved,u)),a.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"RemoveText",memberid:e,timestamp:t,position:n,length:i}}},ops.OpSetBlob=function(){var e,t,n,i,r;this.init=function(o){e=o.memberid,t=o.timestamp,n=o.filename,i=o.mimetype,r=o.content},this.isEdit=!0,this.group=void 0,this.execute=function(e){return e.getOdfCanvas().odfContainer().setBlob(n,i,r),!0},this.spec=function(){return{optype:"SetBlob",memberid:e,timestamp:t,filename:n,mimetype:i,content:r}}},ops.OpSetParagraphStyle=function(){var e,t,n,i,r=odf.OdfUtils;this.init=function(r){e=r.memberid,t=r.timestamp,n=r.position,i=r.styleName},this.isEdit=!0,this.group=void 0,this.execute=function(o){var a,s;return a=o.getIteratorAtPosition(n),!!(s=r.getParagraphElement(a.container()))&&(runtime.assert(function(e,t,n){var i=[e.getPositionFilter()],r=n.container();return n=n.unfilteredDomOffset(),!1===e.createStepIterator(r,n,i,t).previousStep()}(o,s,a),"SetParagraphStyle position should be the first position in the paragraph"),i?s.setAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","text:style-name",i):s.removeAttributeNS("urn:oasis:names:tc:opendocument:xmlns:text:1.0","style-name"),o.getOdfCanvas().refreshSize(),o.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:s,timeStamp:t,memberId:e}),o.getOdfCanvas().rerenderAnnotations(),!0)},this.spec=function(){return{optype:"SetParagraphStyle",memberid:e,timestamp:t,position:n,styleName:i}}},ops.OpSplitParagraph=function(){var e,t,n,i,r,o,a=odf.OdfUtils,s=odf.Namespaces.textns;this.init=function(a){e=a.memberid,t=a.timestamp,i=a.position,n=a.sourceParagraphPosition,o=a.paragraphStyleName,r="true"===a.moveCursor||!0===a.moveCursor},this.isEdit=!0,this.group=void 0,this.execute=function(n){var l,d,u,c,h,f,p,m=n.getCursor(e);if(n.upgradeWhitespacesAtPosition(i),!(l=n.getTextNodeAtStep(i)))return!1;if(!(d=a.getParagraphElement(l.textNode)))return!1;for(u=a.isListItem(d.parentNode)?d.parentNode:d,0===l.offset?(p=l.textNode.previousSibling,f=null):(p=l.textNode,f=l.offset>=l.textNode.length?null:l.textNode.splitText(l.offset)),c=l.textNode;c!==u;){if(h=(c=c.parentNode).cloneNode(!1),f&&h.appendChild(f),p)for(;p&&p.nextSibling;)h.appendChild(p.nextSibling);else for(;c.firstChild;)h.appendChild(c.firstChild);c.parentNode.insertBefore(h,c.nextSibling),p=c,f=h}return a.isListItem(f)&&(f=f.childNodes.item(0)),o?f.setAttributeNS(s,"text:style-name",o):f.removeAttributeNS(s,"style-name"),0===l.textNode.length&&l.textNode.parentNode.removeChild(l.textNode),n.emit(ops.OdtDocument.signalStepsInserted,{position:i}),m&&r&&(n.moveCursor(e,i+1,0),n.emit(ops.Document.signalCursorMoved,m)),n.fixCursorPositions(),n.getOdfCanvas().refreshSize(),n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:d,memberId:e,timeStamp:t}),n.emit(ops.OdtDocument.signalParagraphChanged,{paragraphElement:f,memberId:e,timeStamp:t}),n.getOdfCanvas().rerenderAnnotations(),!0},this.spec=function(){return{optype:"SplitParagraph",memberid:e,timestamp:t,position:i,sourceParagraphPosition:n,paragraphStyleName:o,moveCursor:r}}},ops.OpUpdateMember=function(){var e,t,n,i;this.init=function(r){e=r.memberid,t=parseInt(r.timestamp,10),n=r.setProperties,i=r.removedProperties},this.isEdit=!1,this.group=void 0,this.execute=function(t){var r=t.getMember(e);return!!r&&(i&&r.removeProperties(i),n&&(r.setProperties(n),n.fullName&&function(t){var i="//dc:creator[@editinfo:memberid='"+e+"']";for(t=xmldom.XPath.getODFElementsWithXPath(t.getRootNode(),i,function(e){return"editinfo"===e?"urn:webodf:names:editinfo":odf.Namespaces.lookupNamespaceURI(e)}),i=0;i<t.length;i+=1)t[i].textContent=n.fullName}(t)),t.emit(ops.Document.signalMemberUpdated,r),!0)},this.spec=function(){return{optype:"UpdateMember",memberid:e,timestamp:t,setProperties:n,removedProperties:i}}},ops.OpUpdateMetadata=function(){var e,t,n,i;this.init=function(r){e=r.memberid,t=parseInt(r.timestamp,10),n=r.setProperties,i=r.removedProperties},this.isEdit=!0,this.group=void 0,this.execute=function(e){var t=e.getOdfCanvas().odfContainer(),r=null;return i&&(r=i.attributes.split(",")),t.setMetadata(n,r),e.emit(ops.OdtDocument.signalMetadataUpdated,{setProperties:null!==n?n:{},removedProperties:null!==r?r:[]}),!0},this.spec=function(){return{optype:"UpdateMetadata",memberid:e,timestamp:t,setProperties:n,removedProperties:i}}},ops.OpUpdateParagraphStyle=function(){function e(e,t){var n,i,r=t?t.split(","):[];for(n=0;n<r.length;n+=1)i=r[n].split(":"),e.removeAttributeNS(odf.Namespaces.lookupNamespaceURI(i[0]),i[1])}var t,n,i,r,o,a=odf.Namespaces.stylens;this.init=function(e){t=e.memberid,n=e.timestamp,i=e.styleName,r=e.setProperties,o=e.removedProperties},this.isEdit=!0,this.group=void 0,this.execute=function(t){var n,s,l,d=t.getFormatting();return!!(n=""!==i?d.getStyleElement(i,"paragraph"):d.getDefaultStyleElement("paragraph"))&&(s=n.getElementsByTagNameNS(a,"paragraph-properties").item(0),l=n.getElementsByTagNameNS(a,"text-properties").item(0),r&&d.updateStyle(n,r),o&&(d=o["style:paragraph-properties"],s&&d&&(e(s,d.attributes),0===s.attributes.length&&n.removeChild(s)),d=o["style:text-properties"],l&&d&&(e(l,d.attributes),0===l.attributes.length&&n.removeChild(l)),e(n,o.attributes)),t.getOdfCanvas().refreshCSS(),t.emit(ops.OdtDocument.signalParagraphStyleModified,i),t.getOdfCanvas().rerenderAnnotations(),!0)},this.spec=function(){return{optype:"UpdateParagraphStyle",memberid:t,timestamp:n,styleName:i,setProperties:r,removedProperties:o}}},ops.OperationFactory=function(){function e(e){return function(t){return new e}}var t;this.register=function(e,n){t[e]=n},this.create=function(e){var n=null,i=t[e.optype];return i&&(n=i(e)).init(e),n},t={AddMember:e(ops.OpAddMember),UpdateMember:e(ops.OpUpdateMember),RemoveMember:e(ops.OpRemoveMember),AddCursor:e(ops.OpAddCursor),ApplyDirectStyling:e(ops.OpApplyDirectStyling),SetBlob:e(ops.OpSetBlob),RemoveBlob:e(ops.OpRemoveBlob),InsertImage:e(ops.OpInsertImage),InsertTable:e(ops.OpInsertTable),InsertText:e(ops.OpInsertText),RemoveText:e(ops.OpRemoveText),MergeParagraph:e(ops.OpMergeParagraph),SplitParagraph:e(ops.OpSplitParagraph),SetParagraphStyle:e(ops.OpSetParagraphStyle),UpdateParagraphStyle:e(ops.OpUpdateParagraphStyle),AddStyle:e(ops.OpAddStyle),RemoveStyle:e(ops.OpRemoveStyle),MoveCursor:e(ops.OpMoveCursor),RemoveCursor:e(ops.OpRemoveCursor),AddAnnotation:e(ops.OpAddAnnotation),RemoveAnnotation:e(ops.OpRemoveAnnotation),UpdateMetadata:e(ops.OpUpdateMetadata),ApplyHyperlink:e(ops.OpApplyHyperlink),RemoveHyperlink:e(ops.OpRemoveHyperlink)}},ops.OperationRouter=function(){},ops.OperationRouter.prototype.setOperationFactory=function(e){},ops.OperationRouter.prototype.setPlaybackFunction=function(e){},ops.OperationRouter.prototype.push=function(e){},ops.OperationRouter.prototype.close=function(e){},ops.OperationRouter.prototype.subscribe=function(e,t){},ops.OperationRouter.prototype.unsubscribe=function(e,t){},ops.OperationRouter.prototype.hasLocalUnsyncedOps=function(){},ops.OperationRouter.prototype.hasSessionHostConnection=function(){},ops.OperationRouter.signalProcessingBatchStart="router/batchstart",ops.OperationRouter.signalProcessingBatchEnd="router/batchend",ops.TrivialOperationRouter=function(){var e,t,n=new core.EventNotifier([ops.OperationRouter.signalProcessingBatchStart,ops.OperationRouter.signalProcessingBatchEnd]),i=0;this.setOperationFactory=function(t){e=t},this.setPlaybackFunction=function(e){t=e},this.push=function(r){i+=1,n.emit(ops.OperationRouter.signalProcessingBatchStart,{}),r.forEach(function(n){(n=n.spec()).timestamp=Date.now(),(n=e.create(n)).group="g"+i,t(n)}),n.emit(ops.OperationRouter.signalProcessingBatchEnd,{})},this.close=function(e){e()},this.subscribe=function(e,t){n.subscribe(e,t)},this.unsubscribe=function(e,t){n.unsubscribe(e,t)},this.hasLocalUnsyncedOps=function(){return!1},this.hasSessionHostConnection=function(){return!0}},ops.Session=function(e){function t(e){r.emit(ops.OdtDocument.signalProcessingBatchStart,e)}function n(e){r.emit(ops.OdtDocument.signalProcessingBatchEnd,e)}var i=new ops.OperationFactory,r=new ops.OdtDocument(e),o=null;this.setOperationFactory=function(e){i=e,o&&o.setOperationFactory(i)},this.setOperationRouter=function(e){o&&(o.unsubscribe(ops.OperationRouter.signalProcessingBatchStart,t),o.unsubscribe(ops.OperationRouter.signalProcessingBatchEnd,n)),(o=e).subscribe(ops.OperationRouter.signalProcessingBatchStart,t),o.subscribe(ops.OperationRouter.signalProcessingBatchEnd,n),e.setPlaybackFunction(function(e){return r.emit(ops.OdtDocument.signalOperationStart,e),!!e.execute(r)&&(r.emit(ops.OdtDocument.signalOperationEnd,e),!0)}),e.setOperationFactory(i)},this.getOperationFactory=function(){return i},this.getOdtDocument=function(){return r},this.enqueue=function(e){o.push(e)},this.close=function(e){o.close(function(t){t?e(t):r.close(e)})},this.destroy=function(e){r.destroy(e)},this.setOperationRouter(new ops.TrivialOperationRouter)},gui.AnnotationController=function(e,t,n){function i(){var e,t=!1;(e=(e=s.getCursor(n))&&e.getNode())&&(t=!u.isWithinAnnotation(e,s.getRootNode())),t!==l&&(l=t,d.emit(gui.AnnotationController.annotatableChanged,l))}function r(e){e.getMemberId()===n&&i()}function o(e){e===n&&i()}function a(e){e.getMemberId()===n&&i()}var s=e.getOdtDocument(),l=!1,d=new core.EventNotifier([gui.AnnotationController.annotatableChanged]),u=odf.OdfUtils,c=core.StepDirection.NEXT;this.isAnnotatable=function(){return l},this.addAnnotation=function(){var t=new ops.OpAddAnnotation,i=(r=s.getCursorSelection(n)).length,r=r.position;l&&(0===i?i=void 0:(r=0<=i?r:r+i,i=Math.abs(i)),t.init({memberid:n,position:r,length:i,name:n+Date.now()}),e.enqueue([t]))},this.removeAnnotation=function(i){var r,o;r=s.getMember(n).getProperties().fullName,!0===t.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&r!==u.getAnnotationCreator(i)||(r=s.convertDomPointToCursorStep(i,0,c),o=s.convertDomPointToCursorStep(i,i.childNodes.length),(i=new ops.OpRemoveAnnotation).init({memberid:n,position:r,length:o-r}),(o=new ops.OpMoveCursor).init({memberid:n,position:0<r?r-1:r,length:0}),e.enqueue([i,o]))},this.subscribe=function(e,t){d.subscribe(e,t)},this.unsubscribe=function(e,t){d.unsubscribe(e,t)},this.destroy=function(e){s.unsubscribe(ops.Document.signalCursorAdded,r),s.unsubscribe(ops.Document.signalCursorRemoved,o),s.unsubscribe(ops.Document.signalCursorMoved,a),e()},t.registerConstraint(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN),s.subscribe(ops.Document.signalCursorAdded,r),s.subscribe(ops.Document.signalCursorRemoved,o),s.subscribe(ops.Document.signalCursorMoved,a),i()},gui.AnnotationController.annotatableChanged="annotatable/changed",gui.Avatar=function(e,t){var n,i,r,o=this;this.setColor=function(e){i.style.borderColor=e},this.setImageUrl=function(e){o.isVisible()?i.src=e:r=e},this.isVisible=function(){return"block"===n.style.display},this.show=function(){r&&(i.src=r,r=void 0),n.style.display="block"},this.hide=function(){n.style.display="none"},this.markAsFocussed=function(e){e?n.classList.add("active"):n.classList.remove("active")},this.destroy=function(t){e.removeChild(n),t()},function(){var r=e.ownerDocument;n=r.createElement("div"),i=r.createElement("img"),n.appendChild(i),n.style.display=t?"block":"none",n.className="handle",e.appendChild(n)}()},gui.StepInfo=function(){},gui.StepInfo.VisualDirection={LEFT_TO_RIGHT:0,RIGHT_TO_LEFT:1},gui.StepInfo.prototype.container=function(){},gui.StepInfo.prototype.offset=function(){},gui.VisualStepScanner=function(){},gui.VisualStepScanner.prototype.process=function(e,t,n){},gui.GuiStepUtils=function(){function e(e){var r,o=null;return(e=n.getContentBounds(e))&&(e.container.nodeType===Node.TEXT_NODE?((r=e.container.ownerDocument.createRange()).setStart(e.container,e.startOffset),r.setEnd(e.container,e.endOffset),(o=0<r.getClientRects().length?r.getBoundingClientRect():null)&&" "===e.container.data.substring(e.startOffset,e.endOffset)&&1>=o.width&&(o=null),r.detach()):(t.isCharacterElement(e.container)||t.isCharacterFrame(e.container))&&(o=i.getBoundingClientRect(e.container))),o}var t=odf.OdfUtils,n=new odf.StepUtils,i=core.DomUtils,r=core.StepDirection.NEXT,o=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT,a=gui.StepInfo.VisualDirection.RIGHT_TO_LEFT;this.getContentRect=e,this.moveToFilteredStep=function(t,n,i){function s(e,t){return t.process(f,u,c)&&(e=!0,!h&&t.token&&(h=t.token)),e}var l,d,u,c,h,f,p=n===r,m=t.snapshot();l=!1;do{l=e(t),f={token:t.snapshot(),container:t.container,offset:t.offset,direction:n,visualDirection:n===r?o:a},d=t.nextStep()?e(t):null,t.restore(f.token),p?(u=l,c=d):(u=d,c=l),l=i.reduce(s,!1)}while(!l&&t.advanceStep(n));return l||i.forEach(function(e){!h&&e.token&&(h=e.token)}),t.restore(h||m),Boolean(h)}},gui.Caret=function(e,t,n,i){function r(){u.style.opacity="0"===u.style.opacity?"1":"0",_.trigger()}function o(){return p.selectNodeContents(f),p.getBoundingClientRect()}function a(e){return E[e]!==N[e]}function s(){if(!1===N.isShown||e.getSelectionType()!==ops.OdtCursor.RangeSelection||!i&&!e.getSelectedRange().collapsed?(N.visibility="hidden",u.style.visibility="hidden",_.cancel()):(N.visibility="visible",u.style.visibility="visible",!1===N.isFocused?(u.style.opacity="1",_.cancel()):((x||a("visibility"))&&(u.style.opacity="1",_.cancel()),_.trigger())),S||w){var n;n=e.getNode();var r,s,l=b.getBoundingClientRect(v.getSizer()),f=!1,p=0;if(n.removeAttributeNS("urn:webodf:names:cursor","caret-sizer-active"),0<n.getClientRects().length)p=(s=o()).left-b.getBoundingClientRect(n).left,f=!0;else if(m.setPosition(n,0),!(s=y.getContentRect(m))&&m.nextStep()&&(r=y.getContentRect(m))&&(s=r,f=!0),s||(n.setAttributeNS("urn:webodf:names:cursor","caret-sizer-active","true"),s=o(),f=!0),!s)for(runtime.log("WARN: No suitable client rectangle found for visual caret for "+e.getMemberId());n;){if(0<n.getClientRects().length){s=b.getBoundingClientRect(n),f=!0;break}n=n.parentNode}8>(n={top:(s=b.translateRect(s,l,v.getZoomLevel())).top,height:s.height,right:f?s.left:s.right,width:b.adaptRangeDifferenceToZoomLevel(p,v.getZoomLevel())}).height&&(n={top:n.top-(8-n.height)/2,height:8,right:n.right}),d.style.height=n.height+"px",d.style.top=n.top+"px",d.style.left=n.right-n.width+"px",d.style.width=n.width?n.width+"px":"",h&&((n=runtime.getWindow().getComputedStyle(e.getNode(),null)).font?h.style.font=n.font:(h.style.fontStyle=n.fontStyle,h.style.fontVariant=n.fontVariant,h.style.fontWeight=n.fontWeight,h.style.fontSize=n.fontSize,h.style.lineHeight=n.lineHeight,h.style.fontFamily=n.fontFamily))}N.isShown&&w&&t.scrollIntoView(u.getBoundingClientRect()),a("isFocused")&&c.markAsFocussed(N.isFocused),Object.keys(N).forEach(function(e){E[e]=N[e]}),S=w=x=!1}function l(e){d.parentNode.removeChild(d),f.parentNode.removeChild(f),e()}var d,u,c,h,f,p,m,g,_,v=e.getDocument().getCanvas(),b=core.DomUtils,y=new gui.GuiStepUtils,x=!1,w=!1,S=!1,N={isFocused:!1,isShown:!0,visibility:"hidden"},E={isFocused:!N.isFocused,isShown:!N.isShown,visibility:"hidden"};this.handleUpdate=function(){S=!0,g.trigger()},this.refreshCursorBlinking=function(){x=!0,g.trigger()},this.setFocus=function(){N.isFocused=!0,g.trigger()},this.removeFocus=function(){N.isFocused=!1,g.trigger()},this.show=function(){N.isShown=!0,g.trigger()},this.hide=function(){N.isShown=!1,g.trigger()},this.setAvatarImageUrl=function(e){c.setImageUrl(e)},this.setColor=function(e){u.style.borderColor=e,c.setColor(e)},this.getCursor=function(){return e},this.getFocusElement=function(){return u},this.toggleHandleVisibility=function(){c.isVisible()?c.hide():c.show()},this.showHandle=function(){c.show()},this.hideHandle=function(){c.hide()},this.setOverlayElement=function(e){h=e,d.appendChild(e),S=!0,g.trigger()},this.ensureVisible=function(){w=!0,g.trigger()},this.getBoundingClientRect=function(){return b.getBoundingClientRect(d)},this.destroy=function(e){core.Async.destroyAll([g.destroy,_.destroy,c.destroy,l],e)},function(){var t=e.getDocument(),i=[t.createRootFilter(e.getMemberId()),t.getPositionFilter()],o=t.getDOMDocument();p=o.createRange(),(f=o.createElement("span")).className="webodf-caretSizer",f.textContent="|",e.getNode().appendChild(f),(d=o.createElement("div")).setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",e.getMemberId()),d.className="webodf-caretOverlay",(u=o.createElement("div")).className="caret",d.appendChild(u),c=new gui.Avatar(d,n),v.getSizer().appendChild(d),m=t.createStepIterator(e.getNode(),0,i,t.getRootNode()),g=core.Task.createRedrawTask(s),_=core.Task.createTimeoutTask(r,500),g.triggerImmediate()}()},odf.TextSerializer=function(){function e(i){var r,o="",a=t.filter?t.filter.acceptNode(i):NodeFilter.FILTER_ACCEPT,s=i.nodeType;if((a===NodeFilter.FILTER_ACCEPT||a===NodeFilter.FILTER_SKIP)&&n.isTextContentContainingNode(i))for(r=i.firstChild;r;)o+=e(r),r=r.nextSibling;return a===NodeFilter.FILTER_ACCEPT&&(s===Node.ELEMENT_NODE&&n.isParagraph(i)?o+="\n":s===Node.TEXT_NODE&&i.textContent&&(o+=i.textContent)),o}var t=this,n=odf.OdfUtils;this.filter=null,this.writeToString=function(t){return t?("\n"===(t=e(t))[t.length-1]&&(t=t.substr(0,t.length-1)),t):""}},gui.MimeDataExporter=function(){var e;this.exportRangeToDataTransfer=function(t,n){var i;(i=n.startContainer.ownerDocument.createElement("span")).appendChild(n.cloneContents()),i=e.writeToString(i);try{t.setData("text/plain",i)}catch(e){t.setData("Text",i)}},(e=new odf.TextSerializer).filter=new odf.OdfNodeFilter},gui.Clipboard=function(e){this.setDataFromRange=function(t,n){var i,r=t.clipboardData;return i=runtime.getWindow(),!r&&i&&(r=i.clipboardData),r?(i=!0,e.exportRangeToDataTransfer(r,n),t.preventDefault()):i=!1,i}},gui.SessionContext=function(e,t){var n=e.getOdtDocument(),i=odf.OdfUtils;this.isLocalCursorWithinOwnAnnotation=function(){var e,r=n.getCursor(t);return!!r&&(e=r&&r.getNode(),r=n.getMember(t).getProperties().fullName,!(!(e=i.getParentAnnotation(e,n.getRootNode()))||i.getAnnotationCreator(e)!==r))}},gui.StyleSummary=function(e){function t(t,n){var i,o=t+"|"+n;return r.hasOwnProperty(o)||(i=[],e.forEach(function(e){e=(e=e.styleProperties[t])&&e[n],-1===i.indexOf(e)&&i.push(e)}),r[o]=i),r[o]}function n(e,n,i){return function(){var r=t(e,n);return i.length>=r.length&&r.every(function(e){return-1!==i.indexOf(e)})}}function i(e,n){var i=t(e,n);return 1===i.length?i[0]:void 0}var r={};this.getPropertyValues=t,this.getCommonValue=i,this.isBold=n("style:text-properties","fo:font-weight",["bold"]),this.isItalic=n("style:text-properties","fo:font-style",["italic"]),this.hasUnderline=n("style:text-properties","style:text-underline-style",["solid"]),this.hasStrikeThrough=n("style:text-properties","style:text-line-through-style",["solid"]),this.fontSize=function(){var e=i("style:text-properties","fo:font-size");return e&&parseFloat(e)},this.fontName=function(){return i("style:text-properties","style:font-name")},this.isAlignedLeft=n("style:paragraph-properties","fo:text-align",["left","start"]),this.isAlignedCenter=n("style:paragraph-properties","fo:text-align",["center"]),this.isAlignedRight=n("style:paragraph-properties","fo:text-align",["right","end"]),this.isAlignedJustified=n("style:paragraph-properties","fo:text-align",["justify"]),this.text={isBold:this.isBold,isItalic:this.isItalic,hasUnderline:this.hasUnderline,hasStrikeThrough:this.hasStrikeThrough,fontSize:this.fontSize,fontName:this.fontName},this.paragraph={isAlignedLeft:this.isAlignedLeft,isAlignedCenter:this.isAlignedCenter,isAlignedRight:this.isAlignedRight,isAlignedJustified:this.isAlignedJustified}},gui.DirectFormattingController=function(e,t,n,i,r,o,a){function s(){return P.value().styleSummary}function l(){return P.value().enabledFeatures}function d(e){var t;return e.collapsed?((t=e.startContainer).hasChildNodes()&&e.startOffset<t.childNodes.length&&(t=t.childNodes.item(e.startOffset)),e=[t]):e=L.getTextElements(e,!0,!1),e}function u(){var e=I.getCursor(i),r=e&&e.getSelectedRange(),o=[],a=(o=[],!0),s={directTextStyling:!0,directParagraphStyling:!0};return r&&(0===(o=d(r)).length&&(o=[r.startContainer,r.endContainer],a=!1),o=I.getFormatting().getAppliedStyles(o)),void 0!==o[0]&&j&&(o[0].styleProperties=F.mergeObjects(o[0].styleProperties,j)),!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(s.directTextStyling=s.directParagraphStyling=n.isLocalCursorWithinOwnAnnotation()),s.directTextStyling&&(s.directTextStyling=a&&void 0!==e&&e.getSelectionType()===ops.OdtCursor.RangeSelection),{enabledFeatures:s,appliedStyles:o,styleSummary:new gui.StyleSummary(o)}}function c(e,t){var n={};return Object.keys(e).forEach(function(i){var r=e[i](),o=t[i]();r!==o&&(n[i]=o)}),n}function h(){var e,t;t=R.styleSummary;var n=P.value(),i=n.styleSummary,r=R.enabledFeatures,o=n.enabledFeatures;e=c(t.text,i.text),t=c(t.paragraph,i.paragraph),r=!(o.directTextStyling===r.directTextStyling&&o.directParagraphStyling===r.directParagraphStyling),R=n,r&&B.emit(gui.DirectFormattingController.enabledChanged,o),0<Object.keys(e).length&&B.emit(gui.DirectFormattingController.textStylingChanged,e),0<Object.keys(t).length&&B.emit(gui.DirectFormattingController.paragraphStylingChanged,t)}function f(){P.reset(),h()}function p(e){("string"==typeof e?e:e.getMemberId())===i&&P.reset()}function m(){P.reset()}function g(e){var t=I.getCursor(i);e=e.paragraphElement,t&&L.getParagraphElement(t.getNode())===e&&P.reset()}function _(e,t){return t(!e()),!0}function v(t){if(l().directTextStyling){var n=I.getCursorSelection(i),r={"style:text-properties":t};0!==n.length?((t=new ops.OpApplyDirectStyling).init({memberid:i,position:n.position,length:n.length,setProperties:r}),e.enqueue([t])):(j=F.mergeObjects(j||{},r),P.reset())}}function b(e,t){var n={};n[e]=t,v(n)}function y(e){e=e.spec(),j&&e.memberid===i&&"SplitParagraph"!==e.optype&&(j=null,P.reset())}function x(e){b("fo:font-weight",e?"bold":"normal")}function w(e){b("fo:font-style",e?"italic":"normal")}function S(e){b("style:text-underline-style",e?"solid":"none")}function N(e){b("style:text-line-through-style",e?"solid":"none")}function E(t){if(l().directParagraphStyling){var n,o=I.getCursor(i).getSelectedRange(),a=(o=L.getParagraphElements(o),I.getFormatting()),s=[],d={};o.forEach(function(e){var o,l=I.convertDomPointToCursorStep(e,0,z),u=e.getAttributeNS(odf.Namespaces.textns,"style-name");(e=u?d.hasOwnProperty(u)?d[u]:void 0:n)||(e=r.generateStyleName(),u?(d[u]=e,o=a.createDerivedStyleObject(u,"paragraph",{})):(n=e,o={}),o=t(o),(u=new ops.OpAddStyle).init({memberid:i,styleName:e.toString(),styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:o}),s.push(u)),(u=new ops.OpSetParagraphStyle).init({memberid:i,styleName:e.toString(),position:l}),s.push(u)}),e.enqueue(s)}}function C(e){!function(e){E(function(t){return F.mergeObjects(t,e)})}({"style:paragraph-properties":{"fo:text-align":e}})}function k(e,t){var n,i=I.getFormatting().getDefaultTabStopDistance(),r=t["style:paragraph-properties"];return r&&(r=r["fo:margin-left"],n=L.parseLength(r)),F.mergeObjects(t,{"style:paragraph-properties":{"fo:margin-left":n&&n.unit===i.unit?n.value+e*i.value+n.unit:e*i.value+i.unit}})}function T(e,t){var n=0===(n=d(e)).length?[e.startContainer]:n,i=0<(n=I.getFormatting().getAppliedStyles(n)).length?n[0].styleProperties:void 0,r=I.getFormatting().getAppliedStylesForElement(t).styleProperties;return!(!i||"text"!==i["style:family"]||!i["style:text-properties"])&&(!r||!r["style:text-properties"]||(i=i["style:text-properties"],r=r["style:text-properties"],!Object.keys(i).every(function(e){return i[e]===r[e]})))}function A(){}function O(){return!1}function D(){return!1}var R,P,M=this,I=e.getOdtDocument(),F=new core.Utils,L=odf.OdfUtils,B=new core.EventNotifier([gui.DirectFormattingController.enabledChanged,gui.DirectFormattingController.textStylingChanged,gui.DirectFormattingController.paragraphStylingChanged]),U=odf.Namespaces.textns,z=core.StepDirection.NEXT,j=null;this.enabledFeatures=l,this.formatTextSelection=v,this.createCursorStyleOp=function(e,t,n){var r=null,o=j;return n&&(o=(n=P.value().appliedStyles[0])&&n.styleProperties),o&&o["style:text-properties"]&&((r=new ops.OpApplyDirectStyling).init({memberid:i,position:e,length:t,setProperties:{"style:text-properties":o["style:text-properties"]}}),j=null,P.reset()),r},this.setBold=x,this.setItalic=w,this.setHasUnderline=S,this.setHasStrikethrough=N,this.setFontSize=function(e){b("fo:font-size",e+"pt")},this.setFontName=function(e){b("style:font-name",e)},this.getAppliedStyles=function(){return P.value().appliedStyles},this.toggleBold=_.bind(M,function(){return s().isBold()},x),this.toggleItalic=_.bind(M,function(){return s().isItalic()},w),this.toggleUnderline=_.bind(M,function(){return s().hasUnderline()},S),this.toggleStrikethrough=_.bind(M,function(){return s().hasStrikeThrough()},N),this.isBold=function(){return s().isBold()},this.isItalic=function(){return s().isItalic()},this.hasUnderline=function(){return s().hasUnderline()},this.hasStrikeThrough=function(){return s().hasStrikeThrough()},this.fontSize=function(){return s().fontSize()},this.fontName=function(){return s().fontName()},this.isAlignedLeft=function(){return s().isAlignedLeft()},this.isAlignedCenter=function(){return s().isAlignedCenter()},this.isAlignedRight=function(){return s().isAlignedRight()},this.isAlignedJustified=function(){return s().isAlignedJustified()},this.alignParagraphLeft=function(){return C("left"),!0},this.alignParagraphCenter=function(){return C("center"),!0},this.alignParagraphRight=function(){return C("right"),!0},this.alignParagraphJustified=function(){return C("justify"),!0},this.indent=function(){return E(k.bind(null,1)),!0},this.outdent=function(){return E(k.bind(null,-1)),!0},this.createParagraphStyleOps=function(e){if(!l().directParagraphStyling)return[];var t,n,o=I.getCursor(i),a=o.getSelectedRange(),s=[];o.hasForwardSelection()?(t=o.getAnchorNode(),n=o.getNode()):(t=o.getNode(),n=o.getAnchorNode()),o=L.getParagraphElement(n),runtime.assert(Boolean(o),"DirectFormattingController: Cursor outside paragraph");var d=o,u=[I.getPositionFilter(),I.createRootFilter(i)];return!1!==I.createStepIterator(a.endContainer,a.endOffset,u,d).nextStep()?s:(n!==t&&(o=L.getParagraphElement(t)),(j||T(a,o))&&(a=(a=P.value().appliedStyles[0])&&a.styleProperties)?((o=o.getAttributeNS(U,"style-name"))&&(a={"style:text-properties":a["style:text-properties"]},a=I.getFormatting().createDerivedStyleObject(o,"paragraph",a)),t=r.generateStyleName(),(o=new ops.OpAddStyle).init({memberid:i,styleName:t,styleFamily:"paragraph",isAutomaticStyle:!0,setProperties:a}),s.push(o),(o=new ops.OpSetParagraphStyle).init({memberid:i,styleName:t,position:e}),s.push(o),s):s)},this.subscribe=function(e,t){B.subscribe(e,t)},this.unsubscribe=function(e,t){B.unsubscribe(e,t)},this.destroy=function(e){I.unsubscribe(ops.Document.signalCursorAdded,p),I.unsubscribe(ops.Document.signalCursorRemoved,p),I.unsubscribe(ops.Document.signalCursorMoved,p),I.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,m),I.unsubscribe(ops.OdtDocument.signalParagraphChanged,g),I.unsubscribe(ops.OdtDocument.signalOperationEnd,y),I.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,h),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,f),e()},I.subscribe(ops.Document.signalCursorAdded,p),I.subscribe(ops.Document.signalCursorRemoved,p),I.subscribe(ops.Document.signalCursorMoved,p),I.subscribe(ops.OdtDocument.signalParagraphStyleModified,m),I.subscribe(ops.OdtDocument.signalParagraphChanged,g),I.subscribe(ops.OdtDocument.signalOperationEnd,y),I.subscribe(ops.OdtDocument.signalProcessingBatchEnd,h),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,f),P=new core.LazyProperty(u),R=P.value(),o||(M.formatTextSelection=A,M.setBold=A,M.setItalic=A,M.setHasUnderline=A,M.setHasStrikethrough=A,M.setFontSize=A,M.setFontName=A,M.toggleBold=D,M.toggleItalic=D,M.toggleUnderline=D,M.toggleStrikethrough=D),a||(M.alignParagraphCenter=O,M.alignParagraphJustified=O,M.alignParagraphLeft=O,M.alignParagraphRight=O,M.createParagraphStyleOps=function(){return[]},M.indent=O,M.outdent=O)},gui.DirectFormattingController.enabledChanged="enabled/changed",gui.DirectFormattingController.textStylingChanged="textStyling/changed",gui.DirectFormattingController.paragraphStylingChanged="paragraphStyling/changed",gui.DirectFormattingController.SelectionInfo=function(){},gui.KeyboardHandler=function(){function e(e,n){switch(n||(n=t.None),e){case gui.KeyboardHandler.KeyCode.LeftMeta:case gui.KeyboardHandler.KeyCode.RightMeta:case gui.KeyboardHandler.KeyCode.MetaInMozilla:n|=t.Meta;break;case gui.KeyboardHandler.KeyCode.Ctrl:n|=t.Ctrl;break;case gui.KeyboardHandler.KeyCode.Alt:n|=t.Alt;break;case gui.KeyboardHandler.KeyCode.Shift:n|=t.Shift}return e+":"+n}var t=gui.KeyboardHandler.Modifier,n=null,i={};this.setDefault=function(e){n=e},this.bind=function(t,n,r,o){t=e(t,n),runtime.assert(o||!1===i.hasOwnProperty(t),"tried to overwrite the callback handler of key combo: "+t),i[t]=r},this.unbind=function(t,n){var r=e(t,n);delete i[r]},this.reset=function(){n=null,i={}},this.handleEvent=function(r){var o=r.keyCode,a=t.None;r.metaKey&&(a|=t.Meta),r.ctrlKey&&(a|=t.Ctrl),r.altKey&&(a|=t.Alt),r.shiftKey&&(a|=t.Shift),o=e(o,a),a=!1,(o=i[o])?a=o():null!==n&&(a=n(r)),a&&(r.preventDefault?r.preventDefault():r.returnValue=!1)}},gui.KeyboardHandler.Modifier={None:0,Meta:1,Ctrl:2,Alt:4,CtrlAlt:6,Shift:8,MetaShift:9,CtrlShift:10,AltShift:12},gui.KeyboardHandler.KeyCode={Backspace:8,Tab:9,Clear:12,Enter:13,Shift:16,Ctrl:17,Alt:18,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Delete:46,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LeftMeta:91,RightMeta:93,MetaInMozilla:224},gui.HyperlinkClickHandler=function(e,t,n){function i(){var t=e();runtime.assert(Boolean(t.classList),"Document container has no classList element"),t.classList.remove("webodf-inactiveLinks")}function r(){var t=e();runtime.assert(Boolean(t.classList),"Document container has no classList element"),t.classList.add("webodf-inactiveLinks")}function o(){c.removeEventListener("focus",r,!1),f.forEach(function(e){t.unbind(e.keyCode,e.modifier),n.unbind(e.keyCode,e.modifier)}),f.length=0}function a(e){if(o(),e!==s.None){switch(c.addEventListener("focus",r,!1),e){case s.Ctrl:f.push({keyCode:l.Ctrl,modifier:s.None});break;case s.Meta:f.push({keyCode:l.LeftMeta,modifier:s.None}),f.push({keyCode:l.RightMeta,modifier:s.None}),f.push({keyCode:l.MetaInMozilla,modifier:s.None})}f.forEach(function(e){t.bind(e.keyCode,e.modifier,i),n.bind(e.keyCode,e.modifier,r)})}}var s=gui.KeyboardHandler.Modifier,l=gui.KeyboardHandler.KeyCode,d=xmldom.XPath,u=odf.OdfUtils,c=runtime.getWindow(),h=s.None,f=[];runtime.assert(null!==c,"Expected to be run in an environment which has a global window, like a browser."),this.handleClick=function(t){var n,i,r=t.target||t.srcElement;if(t.ctrlKey?n=s.Ctrl:t.metaKey&&(n=s.Meta),h===s.None||h===n){e:{for(;null!==r;){if(u.isHyperlink(r))break e;if(u.isParagraph(r))break;r=r.parentNode}r=null}r&&(""!==(r=u.getHyperlinkTarget(r))&&("#"===r[0]?(r=r.substring(1),n=e(),0===(i=d.getODFElementsWithXPath(n,"//text:bookmark-start[@text:name='"+r+"']",odf.Namespaces.lookupNamespaceURI)).length&&(i=d.getODFElementsWithXPath(n,"//text:bookmark[@text:name='"+r+"']",odf.Namespaces.lookupNamespaceURI)),0<i.length&&i[0].scrollIntoView(!0)):/^\s*(javascript|data):/.test(r)?runtime.log("WARN:","potentially malicious URL ignored"):c.open(r),t.preventDefault?t.preventDefault():t.returnValue=!1))}},this.setModifier=function(e){h!==e&&(runtime.assert(e===s.None||e===s.Ctrl||e===s.Meta,"Unsupported KeyboardHandler.Modifier value: "+e),(h=e)!==s.None?r():i(),a(h))},this.getModifier=function(){return h},this.destroy=function(e){r(),o(),e()}},gui.EventManager=function(e){function t(e){function t(e,t,n){var i,r=!1;i="on"+t,e.attachEvent&&(e.attachEvent(i,n),r=!0),!r&&e.addEventListener&&(e.addEventListener(t,n,!1),r=!0),r&&!b[t]||!e.hasOwnProperty(i)||(e[i]=n)}function n(e,t,n){var i="on"+t;e.detachEvent&&e.detachEvent(i,n),e.removeEventListener&&e.removeEventListener(t,n,!1),e[i]===n&&(e[i]=null)}function i(t){if(-1===o.indexOf(t)){if(o.push(t),r.filters.every(function(e){return e(t)}))try{a.emit(e,t)}catch(t){runtime.log("Error occurred while processing "+e+":\n"+t.message+"\n"+t.stack)}runtime.setTimeout(function(){o.splice(o.indexOf(t),1)},0)}}var r=this,o=[],a=new core.EventNotifier([e]);this.filters=[],this.subscribe=function(t){a.subscribe(e,t)},this.unsubscribe=function(t){a.unsubscribe(e,t)},this.destroy=function(){n(v,e,i),n(_,e,i),n(S,e,i)},y[e]&&t(v,e,i),t(_,e,i),t(S,e,i)}function n(e,t,n){function i(t){n(t,r,function(t){t.type=e,o.emit(e,t)})}var r={},o=new core.EventNotifier([e]);this.subscribe=function(t){o.subscribe(e,t)},this.unsubscribe=function(t){o.unsubscribe(e,t)},this.destroy=function(){t.forEach(function(e){N.unsubscribe(e,i)})},t.forEach(function(e){N.subscribe(e,i)})}function i(e){runtime.clearTimeout(e),delete E[e]}function r(e,t,n){var r=e.touches.length,o=e.touches[0],a=t.timer;"touchmove"===e.type||"touchend"===e.type?a&&i(a):"touchstart"===e.type&&(1!==r?runtime.clearTimeout(a):a=function(e,t){var n=runtime.setTimeout(function(){e(),i(n)},t);return E[n]=!0,n}(function(){n({clientX:o.clientX,clientY:o.clientY,pageX:o.pageX,pageY:o.pageY,target:e.target||e.srcElement||null,detail:1})},400)),t.timer=a}function o(e,t,n){var i=e.touches[0],r=e.target||e.srcElement||null,o=t.target;1!==e.touches.length||"touchend"===e.type?o=null:"touchstart"===e.type&&"webodf-draggable"===r.getAttribute("class")?o=r:"touchmove"===e.type&&o&&(e.preventDefault(),e.stopPropagation(),n({clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,target:o,detail:1})),t.target=o}function a(e,t,n){var i=e.target||e.srcElement||null,r=t.dragging;"drag"===e.type?r=!0:"touchend"===e.type&&r&&(r=!1,n({clientX:(e=e.changedTouches[0]).clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,target:i,detail:1})),t.dragging=r}function s(){S.classList.add("webodf-touchEnabled"),N.unsubscribe("touchstart",s)}function l(e){var t=e.scrollX,n=e.scrollY;this.restore=function(){e.scrollX===t&&e.scrollY===n||e.scrollTo(t,n)}}function d(e){var t=e.scrollTop,n=e.scrollLeft;this.restore=function(){e.scrollTop===t&&e.scrollLeft===n||(e.scrollTop=t,e.scrollLeft=n)}}function u(e,n){var i=w[e]||x[e]||null;return!i&&n&&(i=w[e]=new t(e)),i}function c(e,t){u(e,!0).subscribe(t)}function h(e,t){var n=u(e,!1);n&&n.unsubscribe(t)}function f(){return e.getDOMDocument().activeElement===_}function p(){f()&&_.blur(),_.setAttribute("disabled","true")}function m(){_.removeAttribute("disabled")}function g(){var e;f()||(e=function(e){for(var t=[];e;)(e.scrollWidth>e.clientWidth||e.scrollHeight>e.clientHeight)&&t.push(new d(e)),e=e.parentNode;return t.push(new l(v)),t}(_),m(),_.focus(),e.forEach(function(e){e.restore()}))}var _,v=runtime.getWindow(),b={beforecut:!0,beforepaste:!0,longpress:!0,drag:!0,dragstop:!0},y={mousedown:!0,mouseup:!0,focus:!0},x={},w={},S=e.getCanvas().getElement(),N=this,E={};this.addFilter=function(e,t){u(e,!0).filters.push(t)},this.removeFilter=function(e,t){var n=u(e,!0),i=n.filters.indexOf(t);-1!==i&&n.filters.splice(i,1)},this.subscribe=c,this.unsubscribe=h,this.hasFocus=f,this.focus=g,this.getEventTrap=function(){return _},this.setEditing=function(e){var t=f();t&&_.blur(),e?_.removeAttribute("readOnly"):_.setAttribute("readOnly","true"),t&&g()},this.destroy=function(e){h("touchstart",s),Object.keys(E).forEach(function(e){i(parseInt(e,10))}),E.length=0,Object.keys(x).forEach(function(e){x[e].destroy()}),x={},h("mousedown",p),h("mouseup",m),h("contextmenu",m),Object.keys(w).forEach(function(e){w[e].destroy()}),w={},_.parentNode.removeChild(_),e()},function(){var t=e.getOdfCanvas().getSizer(),i=t.ownerDocument;runtime.assert(Boolean(v),"EventManager requires a window object to operate correctly"),(_=i.createElement("textarea")).id="eventTrap",_.setAttribute("tabindex","-1"),_.setAttribute("readOnly","true"),_.setAttribute("rows","1"),t.appendChild(_),c("mousedown",p),c("mouseup",m),c("contextmenu",m),x.longpress=new n("longpress",["touchstart","touchmove","touchend"],r),x.drag=new n("drag",["touchstart","touchmove","touchend"],o),x.dragstop=new n("dragstop",["drag","touchend"],a),c("touchstart",s)}()},gui.IOSSafariSupport=function(e){function t(){n.innerHeight!==n.outerHeight&&(i.style.display="none",runtime.requestAnimationFrame(function(){i.style.display="block"}))}var n=runtime.getWindow(),i=e.getEventTrap();this.destroy=function(n){e.unsubscribe("focus",t),i.removeAttribute("autocapitalize"),i.style.WebkitTransform="",n()},e.subscribe("focus",t),i.setAttribute("autocapitalize","off"),i.style.WebkitTransform="translateX(-10000px)"},gui.HyperlinkController=function(e,t,n,i){function r(){var e=!0;!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(e=n.isLocalCursorWithinOwnAnnotation()),e!==d&&(d=e,l.emit(gui.HyperlinkController.enabledChanged,d))}function o(e){e.getMemberId()===i&&r()}var a=odf.OdfUtils,s=e.getOdtDocument(),l=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),d=!1;this.isEnabled=function(){return d},this.subscribe=function(e,t){l.subscribe(e,t)},this.unsubscribe=function(e,t){l.unsubscribe(e,t)},this.addHyperlink=function(t,n){if(d){var r=s.getCursorSelection(i),o=new ops.OpApplyHyperlink,a=[];(0===r.length||n)&&(n=n||t,(o=new ops.OpInsertText).init({memberid:i,position:r.position,text:n}),r.length=n.length,a.push(o)),(o=new ops.OpApplyHyperlink).init({memberid:i,position:r.position,length:r.length,hyperlink:t}),a.push(o),e.enqueue(a)}},this.removeHyperlinks=function(){if(d){var t,n,r=s.createPositionIterator(s.getRootNode()),o=s.getCursor(i).getSelectedRange(),l=a.getHyperlinkElements(o),u=o.collapsed&&1===l.length,c=s.getDOMDocument().createRange(),h=[];0!==l.length&&(l.forEach(function(e){c.selectNodeContents(e),t=s.convertDomToCursorRange({anchorNode:c.startContainer,anchorOffset:c.startOffset,focusNode:c.endContainer,focusOffset:c.endOffset}),(n=new ops.OpRemoveHyperlink).init({memberid:i,position:t.position,length:t.length}),h.push(n)}),u||(u=l[0],-1===o.comparePoint(u,0)&&(c.setStart(u,0),c.setEnd(o.startContainer,o.startOffset),0<(t=s.convertDomToCursorRange({anchorNode:c.startContainer,anchorOffset:c.startOffset,focusNode:c.endContainer,focusOffset:c.endOffset})).length&&((n=new ops.OpApplyHyperlink).init({memberid:i,position:t.position,length:t.length,hyperlink:a.getHyperlinkTarget(u)}),h.push(n))),l=l[l.length-1],r.moveToEndOfNode(l),r=r.unfilteredDomOffset(),1===o.comparePoint(l,r)&&(c.setStart(o.endContainer,o.endOffset),c.setEnd(l,r),0<(t=s.convertDomToCursorRange({anchorNode:c.startContainer,anchorOffset:c.startOffset,focusNode:c.endContainer,focusOffset:c.endOffset})).length&&((n=new ops.OpApplyHyperlink).init({memberid:i,position:t.position,length:t.length,hyperlink:a.getHyperlinkTarget(l)}),h.push(n)))),e.enqueue(h),c.detach())}},this.destroy=function(e){s.unsubscribe(ops.Document.signalCursorMoved,o),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),e()},s.subscribe(ops.Document.signalCursorMoved,o),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),r()},gui.HyperlinkController.enabledChanged="enabled/changed",gui.ImageController=function(e,t,n,i,r){function o(){var e=!0;!0===t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)&&(e=n.isLocalCursorWithinOwnAnnotation()),e!==f&&(f=e,h.emit(gui.ImageController.enabledChanged,f))}function a(e){e.getMemberId()===i&&o()}var s={"image/gif":".gif","image/jpeg":".jpg","image/png":".png"},l=odf.Namespaces.textns,d=e.getOdtDocument(),u=odf.OdfUtils,c=d.getFormatting(),h=new core.EventNotifier([gui.HyperlinkController.enabledChanged]),f=!1;this.isEnabled=function(){return f},this.subscribe=function(e,t){h.subscribe(e,t)},this.unsubscribe=function(e,t){h.unsubscribe(e,t)},this.insertImage=function(t,n,o,a){if(f){var h=new core.CSSUnits;if(runtime.assert(0<o&&0<a,"Both width and height of the image should be greater than 0px."),a={width:o,height:a},o=u.getParagraphElement(d.getCursor(i).getNode()).getAttributeNS(l,"style-name")){o=c.getContentSize(o,"paragraph");var p=1,m=1;a.width>o.width&&(p=o.width/a.width),a.height>o.height&&(m=o.height/a.height),o=Math.min(p,m),a={width:a.width*o,height:a.height*o}}o=h.convert(a.width,"px","cm")+"cm",h=h.convert(a.height,"px","cm")+"cm",m=d.getOdfCanvas().odfContainer().rootElement.styles,a=t.toLowerCase();var g;p=s.hasOwnProperty(a)?s[a]:null;a=[],runtime.assert(null!==p,"Image type is not supported: "+t),p="Pictures/"+r.generateImageName()+p,(g=new ops.OpSetBlob).init({memberid:i,filename:p,mimetype:t,content:n}),a.push(g),c.getStyleElement("Graphics","graphic",[m])||((t=new ops.OpAddStyle).init({memberid:i,styleName:"Graphics",styleFamily:"graphic",isAutomaticStyle:!1,setProperties:{"style:graphic-properties":{"text:anchor-type":"paragraph","svg:x":"0cm","svg:y":"0cm","style:wrap":"dynamic","style:number-wrapped-paragraphs":"no-limit","style:wrap-contour":"false","style:vertical-pos":"top","style:vertical-rel":"paragraph","style:horizontal-pos":"center","style:horizontal-rel":"paragraph"}}}),a.push(t)),t=r.generateStyleName(),(n=new ops.OpAddStyle).init({memberid:i,styleName:t,styleFamily:"graphic",isAutomaticStyle:!0,setProperties:{"style:parent-style-name":"Graphics","style:graphic-properties":{"style:vertical-pos":"top","style:vertical-rel":"baseline","style:horizontal-pos":"center","style:horizontal-rel":"paragraph","fo:background-color":"transparent","style:background-transparency":"100%","style:shadow":"none","style:mirror":"none","fo:clip":"rect(0cm, 0cm, 0cm, 0cm)","draw:luminance":"0%","draw:contrast":"0%","draw:red":"0%","draw:green":"0%","draw:blue":"0%","draw:gamma":"100%","draw:color-inversion":"false","draw:image-opacity":"100%","draw:color-mode":"standard"}}}),a.push(n),(g=new ops.OpInsertImage).init({memberid:i,position:d.getCursorPosition(i),filename:p,frameWidth:o,frameHeight:h,frameStyleName:t,frameName:r.generateFrameName()}),a.push(g),e.enqueue(a)}},this.destroy=function(e){d.unsubscribe(ops.Document.signalCursorMoved,a),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,o),e()},d.subscribe(ops.Document.signalCursorMoved,a),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,o),o()},gui.ImageController.enabledChanged="enabled/changed",gui.ImageSelector=function(e){function t(){var t=e.getSizer(),n=r.createElement("div");return n.id="imageSelector",n.style.borderWidth="1px",t.appendChild(n),i.forEach(function(e){var t=r.createElement("div");t.className=e,n.appendChild(t)}),n}var n=odf.Namespaces.svgns,i="topLeft topRight bottomRight bottomLeft topMiddle rightMiddle bottomMiddle leftMiddle".split(" "),r=e.getElement().ownerDocument,o=!1;this.select=function(i){var a,s,l=r.getElementById("imageSelector");l||(l=t()),o=!0,a=l.parentNode,s=i.getBoundingClientRect();var d=a.getBoundingClientRect(),u=e.getZoomLevel();a=(s.left-d.left)/u-1,s=(s.top-d.top)/u-1,l.style.display="block",l.style.left=a+"px",l.style.top=s+"px",l.style.width=i.getAttributeNS(n,"width"),l.style.height=i.getAttributeNS(n,"height")},this.clearSelection=function(){var e;o&&(e=r.getElementById("imageSelector"))&&(e.style.display="none"),o=!1},this.isSelectorElement=function(e){var t=r.getElementById("imageSelector");return!!t&&(e===t||e.parentNode===t)}},function(){function e(e){function t(e){return o=e.which&&String.fromCharCode(e.which)===r,r=void 0,!1===o}function n(){o=!1}function i(e){r=e.data,o=!1}var r,o=!1;this.destroy=function(r){e.unsubscribe("textInput",n),e.unsubscribe("compositionend",i),e.removeFilter("keypress",t),r()},e.subscribe("textInput",n),e.subscribe("compositionend",i),e.addFilter("keypress",t)}gui.InputMethodEditor=function(t,n){function i(e){g&&(e?g.getNode().setAttributeNS("urn:webodf:names:cursor","composing","true"):(g.getNode().removeAttributeNS("urn:webodf:names:cursor","composing"),c.textContent=""))}function r(){b&&(b=!1,i(!1),x.emit(gui.InputMethodEditor.signalCompositionEnd,{data:y}),y="")}function o(){S||(S=!0,r(),g&&g.getSelectedRange().collapsed?_.value="":_.value=p.writeToString(g.getSelectedRange().cloneContents()),_.setSelectionRange(0,_.value.length),S=!1)}function a(){n.hasFocus()&&h.trigger()}function s(){f=void 0,h.cancel(),i(!0),b||x.emit(gui.InputMethodEditor.signalCompositionStart,{data:""})}function l(e){e=f=e.data,b=!0,y+=e,h.trigger()}function d(e){e.data!==f&&(e=e.data,b=!0,y+=e,h.trigger()),f=void 0}function u(){c.textContent=_.value}var c,h,f,p,m,g=null,_=n.getEventTrap(),v=_.ownerDocument,b=!1,y="",x=new core.EventNotifier([gui.InputMethodEditor.signalCompositionStart,gui.InputMethodEditor.signalCompositionEnd]),w=[],S=!1;this.subscribe=x.subscribe,this.unsubscribe=x.unsubscribe,this.registerCursor=function(e){e.getMemberId()===t&&((g=e).getNode().appendChild(c),e.subscribe(ops.OdtCursor.signalCursorUpdated,a),n.subscribe("input",u),n.subscribe("compositionupdate",u))},this.removeCursor=function(e){g&&e===t&&(g.getNode().removeChild(c),g.unsubscribe(ops.OdtCursor.signalCursorUpdated,a),n.unsubscribe("input",u),n.unsubscribe("compositionupdate",u),g=null)},this.destroy=function(e){n.unsubscribe("compositionstart",s),n.unsubscribe("compositionend",l),n.unsubscribe("textInput",d),n.unsubscribe("keypress",r),n.unsubscribe("focus",o),core.Async.destroyAll(m,e)},(p=new odf.TextSerializer).filter=new odf.OdfNodeFilter,n.subscribe("compositionstart",s),n.subscribe("compositionend",l),n.subscribe("textInput",d),n.subscribe("keypress",r),n.subscribe("focus",o),w.push(new e(n)),m=w.map(function(e){return e.destroy}),(c=v.createElement("span")).setAttribute("id","composer"),h=core.Task.createTimeoutTask(o,1),m.push(h.destroy)},gui.InputMethodEditor.signalCompositionStart="input/compositionstart",gui.InputMethodEditor.signalCompositionEnd="input/compositionend"}(),gui.MetadataController=function(e,t){function n(e){o.emit(gui.MetadataController.signalMetadataChanged,e)}function i(e){var t=-1===a.indexOf(e);return t||runtime.log("Setting "+e+" is restricted."),t}var r=e.getOdtDocument(),o=new core.EventNotifier([gui.MetadataController.signalMetadataChanged]),a=["dc:creator","dc:date","meta:editing-cycles","meta:editing-duration","meta:document-statistic"];this.setMetadata=function(n,r){var o,a={},s="";n&&Object.keys(n).filter(i).forEach(function(e){a[e]=n[e]}),r&&(s=r.filter(i).join(",")),(0<s.length||0<Object.keys(a).length)&&((o=new ops.OpUpdateMetadata).init({memberid:t,setProperties:a,removedProperties:0<s.length?{attributes:s}:null}),e.enqueue([o]))},this.getMetadata=function(e){var t;return runtime.assert("string"==typeof e,"Property must be a string"),t=e.split(":"),runtime.assert(2===t.length,"Property must be a namespace-prefixed string"),e=odf.Namespaces.lookupNamespaceURI(t[0]),runtime.assert(Boolean(e),"Prefix must be for an ODF namespace."),r.getOdfCanvas().odfContainer().getMetadata(e,t[1])},this.subscribe=function(e,t){o.subscribe(e,t)},this.unsubscribe=function(e,t){o.unsubscribe(e,t)},this.destroy=function(e){r.unsubscribe(ops.OdtDocument.signalMetadataUpdated,n),e()},r.subscribe(ops.OdtDocument.signalMetadataUpdated,n)},gui.MetadataController.signalMetadataChanged="metadata/changed",gui.PasteController=function(e,t,n,i){function r(){s=!0!==t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)||n.isLocalCursorWithinOwnAnnotation()}function o(e){e.getMemberId()===i&&r()}var a=e.getOdtDocument(),s=!1,l=odf.Namespaces.textns,d=core.StepDirection.NEXT,u=odf.OdfUtils;this.isEnabled=function(){return s},this.paste=function(t){if(s){var n=a.getCursorPosition(i),r=a.getCursor(i).getNode(),o=(r=u.getParagraphElement(r)).getAttributeNS(l,"style-name")||"",c=n,h=[],f=a.convertDomPointToCursorStep(r,0,d);t.replace(/\r/g,"").split("\n").forEach(function(e){var t=new ops.OpInsertText,n=new ops.OpSplitParagraph;t.init({memberid:i,position:c,text:e,moveCursor:!0}),h.push(t),c+=e.length,n.init({memberid:i,position:c,paragraphStyleName:o,sourceParagraphPosition:f,moveCursor:!0}),h.push(n),f=c+=1}),h.pop(),e.enqueue(h)}},this.destroy=function(e){a.unsubscribe(ops.Document.signalCursorMoved,o),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),e()},a.subscribe(ops.Document.signalCursorMoved,o),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,r),r()},gui.ClosestXOffsetScanner=function(e){function t(t){return null!==t&&void 0!==i&&Math.abs(t-e)>i}function n(n){null!==n&&!1===t(n)&&(i=Math.abs(n-e))}var i,r=this,o=gui.StepInfo.VisualDirection.LEFT_TO_RIGHT;this.token=void 0,this.process=function(e,i,a){var s,l;return e.visualDirection===o?(s=i&&i.right,l=a&&a.left):(s=i&&i.left,l=a&&a.right),!(!t(s)&&!t(l))||((i||a)&&(n(s),n(l),r.token=e.token),!1)}},gui.LineBoundaryScanner=function(){var e=this,t=null;this.token=void 0,this.process=function(n,i,r){var o;if(o=r)if(t){var a=t;o=Math.min(a.bottom-a.top,r.bottom-r.top);var s=Math.max(a.top,r.top);a=Math.min(a.bottom,r.bottom)-s;o=.4>=(0<o?a/o:0)}else o=!1;return!i||r&&!o||(e.token=n.token),!!o||(t=(n=t)&&i?{left:Math.min(n.left,i.left),right:Math.max(n.right,i.right),top:Math.min(n.top,i.top),bottom:Math.min(n.bottom,i.bottom)}:n||i,!1)}},gui.ParagraphBoundaryScanner=function(){var e,t=this,n=!1,i=odf.OdfUtils;this.token=void 0,this.process=function(r){var o=i.getParagraphElement(r.container());return n||(e=o,n=!0),e!==o||(t.token=r.token,!1)}},odf.WordBoundaryFilter=function(e,t){function n(t,n,i){for(var r,o=null,a=e.getRootNode();t!==a&&null!==t&&null===o;)i(r=0>n?t.previousSibling:t.nextSibling)===NodeFilter.FILTER_ACCEPT&&(o=r),t=t.parentNode;return o}function i(e,t){var n;return null===e?f.NO_NEIGHBOUR:a.isCharacterElement(e)?f.SPACE_CHAR:e.nodeType===r||a.isTextSpan(e)||a.isHyperlink(e)?(n=e.textContent.charAt(t()),l.test(n)?f.SPACE_CHAR:s.test(n)?f.PUNCTUATION_CHAR:f.WORD_CHAR):f.OTHER}var r=Node.TEXT_NODE,o=Node.ELEMENT_NODE,a=odf.OdfUtils,s=/[!-#%-*,-\/:-;?-@\[-\]_{}\u00a1\u00ab\u00b7\u00bb\u00bf;\u00b7\u055a-\u055f\u0589-\u058a\u05be\u05c0\u05c3\u05c6\u05f3-\u05f4\u0609-\u060a\u060c-\u060d\u061b\u061e-\u061f\u066a-\u066d\u06d4\u0700-\u070d\u07f7-\u07f9\u0964-\u0965\u0970\u0df4\u0e4f\u0e5a-\u0e5b\u0f04-\u0f12\u0f3a-\u0f3d\u0f85\u0fd0-\u0fd4\u104a-\u104f\u10fb\u1361-\u1368\u166d-\u166e\u169b-\u169c\u16eb-\u16ed\u1735-\u1736\u17d4-\u17d6\u17d8-\u17da\u1800-\u180a\u1944-\u1945\u19de-\u19df\u1a1e-\u1a1f\u1b5a-\u1b60\u1c3b-\u1c3f\u1c7e-\u1c7f\u2000-\u206e\u207d-\u207e\u208d-\u208e\u3008-\u3009\u2768-\u2775\u27c5-\u27c6\u27e6-\u27ef\u2983-\u2998\u29d8-\u29db\u29fc-\u29fd\u2cf9-\u2cfc\u2cfe-\u2cff\u2e00-\u2e7e\u3000-\u303f\u30a0\u30fb\ua60d-\ua60f\ua673\ua67e\ua874-\ua877\ua8ce-\ua8cf\ua92e-\ua92f\ua95f\uaa5c-\uaa5f\ufd3e-\ufd3f\ufe10-\ufe19\ufe30-\ufe52\ufe54-\ufe61\ufe63\ufe68\ufe6a-\ufe6b\uff01-\uff03\uff05-\uff0a\uff0c-\uff0f\uff1a-\uff1b\uff1f-\uff20\uff3b-\uff3d\uff3f\uff5b\uff5d\uff5f-\uff65]|\ud800[\udd00-\udd01\udf9f\udfd0]|\ud802[\udd1f\udd3f\ude50-\ude58]|\ud809[\udc00-\udc7e]/,l=/\s/,d=core.PositionFilter.FilterResult.FILTER_ACCEPT,u=core.PositionFilter.FilterResult.FILTER_REJECT,c=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,h=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,f={NO_NEIGHBOUR:0,SPACE_CHAR:1,PUNCTUATION_CHAR:2,WORD_CHAR:3,OTHER:4};this.acceptPosition=function(e){var r=e.container(),a=e.leftNode(),s=e.rightNode(),l=e.unfilteredDomOffset,p=function(){return e.unfilteredDomOffset()-1};return r.nodeType===o&&(null===s&&(s=n(r,1,e.getNodeFilter())),null===a&&(a=n(r,-1,e.getNodeFilter()))),r!==s&&(l=function(){return 0}),r!==a&&null!==a&&(p=function(){return a.textContent.length-1}),r=i(a,p),s=i(s,l),r===f.WORD_CHAR&&s===f.WORD_CHAR||r===f.PUNCTUATION_CHAR&&s===f.PUNCTUATION_CHAR||t===c&&r!==f.NO_NEIGHBOUR&&s===f.SPACE_CHAR||t===h&&r===f.SPACE_CHAR&&s!==f.NO_NEIGHBOUR?u:d}},odf.WordBoundaryFilter.IncludeWhitespace={None:0,TRAILING:1,LEADING:2},gui.SelectionController=function(e,t){function n(e){var n=e.spec();(e.isEdit||n.memberid===t)&&(g=void 0,_.cancel())}function i(){var e=v.getCursor(t).getNode();return v.createStepIterator(e,0,[x,S],v.getRootElement(e))}function r(e,t,n){n=new odf.WordBoundaryFilter(v,n);var i=v.getRootElement(e)||v.getRootNode(),r=v.createRootFilter(i);return v.createStepIterator(e,t,[x,r,n],i)}function o(e,t){return t?{anchorNode:e.startContainer,anchorOffset:e.startOffset,focusNode:e.endContainer,focusOffset:e.endOffset}:{anchorNode:e.endContainer,anchorOffset:e.endOffset,focusNode:e.startContainer,focusOffset:e.startOffset}}function a(e,n,i){var r=new ops.OpMoveCursor;return r.init({memberid:t,position:e,length:n||0,selectionType:i}),r}function s(n,i,r){var s;(s=o((s=v.getCursor(t)).getSelectedRange(),s.hasForwardSelection())).focusNode=n,s.focusOffset=i,r||(s.anchorNode=s.focusNode,s.anchorOffset=s.focusOffset),n=v.convertDomToCursorRange(s),e.enqueue([a(n.position,n.length)])}function l(e){var t;(t=r(e.startContainer,e.startOffset,E)).roundToPreviousStep()&&e.setStart(t.container(),t.offset()),(t=r(e.endContainer,e.endOffset,C)).roundToNextStep()&&e.setEnd(t.container(),t.offset())}function d(e){var t=(n=y.getParagraphElements(e))[0],n=n[n.length-1];t&&e.setStart(t,0),n&&(y.isParagraph(e.endContainer)&&0===e.endOffset?e.setEndBefore(n):e.setEnd(n,n.childNodes.length))}function u(e,t,n,i){var r,o;i?(r=n.startContainer,o=n.startOffset):(r=n.endContainer,o=n.endOffset),b.containsNode(e,r)||(o=0>b.comparePoints(e,0,r,o)?0:e.childNodes.length,r=e),(e=v.createStepIterator(r,o,t,y.getParagraphElement(r)||e)).roundToClosestStep()||runtime.assert(!1,"No step found in requested range"),i?n.setStart(e.container(),e.offset()):n.setEnd(e.container(),e.offset())}function c(e,t){var n=i();n.advanceStep(e)&&s(n.container(),n.offset(),t)}function h(e,t){var n,r=g,o=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];void 0===r&&N&&(r=N()),isNaN(r)||(n=i(),w.moveToFilteredStep(n,e,o)&&n.advanceStep(e)&&(o=[new gui.ClosestXOffsetScanner(r),new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner],w.moveToFilteredStep(n,e,o)&&(s(n.container(),n.offset(),t),g=r,_.restart())))}function f(e,t){var n=i(),r=[new gui.LineBoundaryScanner,new gui.ParagraphBoundaryScanner];w.moveToFilteredStep(n,e,r)&&s(n.container(),n.offset(),t)}function p(e,n){var i;(i=r((i=o((i=v.getCursor(t)).getSelectedRange(),i.hasForwardSelection())).focusNode,i.focusOffset,E)).advanceStep(e)&&s(i.container(),i.offset(),n)}function m(e,n,i){var r=!1,a=o((a=v.getCursor(t)).getSelectedRange(),a.hasForwardSelection());r=v.getRootElement(a.focusNode);runtime.assert(Boolean(r),"SelectionController: Cursor outside root"),(a=v.createStepIterator(a.focusNode,a.focusOffset,[x,S],r)).roundToClosestStep(),a.advanceStep(e)&&(i=i(a.container()))&&(e===k?(a.setPosition(i,0),r=a.roundToNextStep()):(a.setPosition(i,i.childNodes.length),r=a.roundToPreviousStep()),r&&s(a.container(),a.offset(),n))}var g,_,v=e.getOdtDocument(),b=core.DomUtils,y=odf.OdfUtils,x=v.getPositionFilter(),w=new gui.GuiStepUtils,S=v.createRootFilter(t),N=null,E=odf.WordBoundaryFilter.IncludeWhitespace.TRAILING,C=odf.WordBoundaryFilter.IncludeWhitespace.LEADING,k=core.StepDirection.PREVIOUS,T=core.StepDirection.NEXT;this.selectionToRange=function(e){var t=0<=b.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),n=e.focusNode.ownerDocument.createRange();return t?(n.setStart(e.anchorNode,e.anchorOffset),n.setEnd(e.focusNode,e.focusOffset)):(n.setStart(e.focusNode,e.focusOffset),n.setEnd(e.anchorNode,e.anchorOffset)),{range:n,hasForwardSelection:t}},this.rangeToSelection=o,this.selectImage=function(t){var n,i=v.getRootElement(t),r=v.createRootFilter(i);(i=v.createStepIterator(t,0,[r,v.getPositionFilter()],i)).roundToPreviousStep()||runtime.assert(!1,"No walkable position before frame"),r=i.container(),n=i.offset(),i.setPosition(t,t.childNodes.length),i.roundToNextStep()||runtime.assert(!1,"No walkable position after frame"),t=a((t=v.convertDomToCursorRange({anchorNode:r,anchorOffset:n,focusNode:i.container(),focusOffset:i.offset()})).position,t.length,ops.OdtCursor.RegionSelection),e.enqueue([t])},this.expandToWordBoundaries=l,this.expandToParagraphBoundaries=d,this.selectRange=function(n,i,r){var s,c=v.getOdfCanvas().getElement(),h=[x];s=b.containsNode(c,n.startContainer),c=b.containsNode(c,n.endContainer),(s||c)&&(s&&c&&(2===r?l(n):3<=r&&d(n)),(r=i?v.getRootElement(n.startContainer):v.getRootElement(n.endContainer))||(r=v.getRootNode()),h.push(v.createRootFilter(r)),u(r,h,n,!0),u(r,h,n,!1),n=o(n,i),i=v.convertDomToCursorRange(n),n=v.getCursorSelection(t),(i.position!==n.position||i.length!==n.length)&&(n=a(i.position,i.length,ops.OdtCursor.RangeSelection),e.enqueue([n])))},this.moveCursorToLeft=function(){return c(k,!1),!0},this.moveCursorToRight=function(){return c(T,!1),!0},this.extendSelectionToLeft=function(){return c(k,!0),!0},this.extendSelectionToRight=function(){return c(T,!0),!0},this.setCaretXPositionLocator=function(e){N=e},this.moveCursorUp=function(){return h(k,!1),!0},this.moveCursorDown=function(){return h(T,!1),!0},this.extendSelectionUp=function(){return h(k,!0),!0},this.extendSelectionDown=function(){return h(T,!0),!0},this.moveCursorBeforeWord=function(){return p(k,!1),!0},this.moveCursorPastWord=function(){return p(T,!1),!0},this.extendSelectionBeforeWord=function(){return p(k,!0),!0},this.extendSelectionPastWord=function(){return p(T,!0),!0},this.moveCursorToLineStart=function(){return f(k,!1),!0},this.moveCursorToLineEnd=function(){return f(T,!1),!0},this.extendSelectionToLineStart=function(){return f(k,!0),!0},this.extendSelectionToLineEnd=function(){return f(T,!0),!0},this.extendSelectionToParagraphStart=function(){return m(k,!0,y.getParagraphElement),!0},this.extendSelectionToParagraphEnd=function(){return m(T,!0,y.getParagraphElement),!0},this.moveCursorToParagraphStart=function(){return m(k,!1,y.getParagraphElement),!0},this.moveCursorToParagraphEnd=function(){return m(T,!1,y.getParagraphElement),!0},this.moveCursorToDocumentStart=function(){return m(k,!1,v.getRootElement),!0},this.moveCursorToDocumentEnd=function(){return m(T,!1,v.getRootElement),!0},this.extendSelectionToDocumentStart=function(){return m(k,!0,v.getRootElement),!0},this.extendSelectionToDocumentEnd=function(){return m(T,!0,v.getRootElement),!0},this.extendSelectionToEntireDocument=function(){var n,i,r,o=v.getCursor(t);o=v.getRootElement(o.getNode());return runtime.assert(Boolean(o),"SelectionController: Cursor outside root"),(r=v.createStepIterator(o,0,[x,S],o)).roundToClosestStep(),n=r.container(),i=r.offset(),r.setPosition(o,o.childNodes.length),r.roundToClosestStep(),o=v.convertDomToCursorRange({anchorNode:n,anchorOffset:i,focusNode:r.container(),focusOffset:r.offset()}),e.enqueue([a(o.position,o.length)]),!0},this.destroy=function(e){v.unsubscribe(ops.OdtDocument.signalOperationStart,n),core.Async.destroyAll([_.destroy],e)},_=core.Task.createTimeoutTask(function(){g=void 0},2e3),v.subscribe(ops.OdtDocument.signalOperationStart,n)},gui.TextController=function(e,t,n,i,r,o){function a(){m=!0!==t.getState(gui.CommonConstraints.EDIT.REVIEW_MODE)||n.isLocalCursorWithinOwnAnnotation()}function s(e){e.getMemberId()===i&&a()}function l(e,t,n){var i=[h.getPositionFilter()];return n&&i.push(h.createRootFilter(e.startContainer)),(n=h.createStepIterator(e.startContainer,e.startOffset,i,t)).roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range start"),t=h.convertDomPointToCursorStep(n.container(),n.offset()),e.collapsed?e=t:(n.setPosition(e.endContainer,e.endOffset),n.roundToClosestStep()||runtime.assert(!1,"No walkable step found in paragraph element at range end"),e=h.convertDomPointToCursorStep(n.container(),n.offset())),{position:t,length:e-t}}function d(e){var t,n,r,o=f.getParagraphElements(e),a=e.cloneRange(),s=[];return t=o[0],1<o.length&&(f.hasNoODFContent(t)&&(t=o[o.length-1]),n=t.getAttributeNS(odf.Namespaces.textns,"style-name")||""),o.forEach(function(t,o){var d,u;a.setStart(t,0),a.collapse(!0),d=l(a,t,!1).position,0<o&&((u=new ops.OpMergeParagraph).init({memberid:i,paragraphStyleName:n,destinationStartPosition:r,sourceStartPosition:d,moveCursor:1===o}),s.unshift(u)),r=d,a.selectNodeContents(t),(d=p.rangeIntersection(a,e))&&(0<(d=l(d,t,!0)).length&&((u=new ops.OpRemoveText).init({memberid:i,position:d.position,length:d.length}),s.unshift(u)))}),s}function u(e){return 0>e.length&&(e.position+=e.length,e.length=-e.length),e}function c(t){if(!m)return!1;var n,r,o=h.getCursor(i).getSelectedRange().cloneRange(),a=u(h.getCursorSelection(i));if(0===a.length){a=void 0,n=h.getCursor(i).getNode(),r=h.getRootElement(n);var s=[h.getPositionFilter(),h.createRootFilter(r)];(r=h.createStepIterator(n,0,s,r)).roundToClosestStep()&&(t?r.nextStep():r.previousStep())&&(a=u(h.convertDomToCursorRange({anchorNode:n,anchorOffset:0,focusNode:r.container(),focusOffset:r.offset()})),t?(o.setStart(n,0),o.setEnd(r.container(),r.offset())):(o.setStart(r.container(),r.offset()),o.setEnd(n,0)))}return a&&e.enqueue(d(o)),void 0!==a}var h=e.getOdtDocument(),f=odf.OdfUtils,p=core.DomUtils,m=!1,g=odf.Namespaces.textns,_=core.StepDirection.NEXT;this.isEnabled=function(){return m},this.enqueueParagraphSplittingOps=function(){if(!m)return!1;var t,n=(t=h.getCursor(i)).getSelectedRange(),r=u(h.getCursorSelection(i)),a=[],s=(t=f.getParagraphElement(t.getNode())).getAttributeNS(g,"style-name")||"";return 0<r.length&&(a=a.concat(d(n))),(n=new ops.OpSplitParagraph).init({memberid:i,position:r.position,paragraphStyleName:s,sourceParagraphPosition:h.convertDomPointToCursorStep(t,0,_),moveCursor:!0}),a.push(n),o&&(r=o(r.position+1),a=a.concat(r)),e.enqueue(a),!0},this.removeTextByBackspaceKey=function(){return c(!1)},this.removeTextByDeleteKey=function(){return c(!0)},this.removeCurrentSelection=function(){if(!m)return!1;var t=h.getCursor(i).getSelectedRange();return e.enqueue(d(t)),!0},this.insertText=function(t){if(m){var n=h.getCursor(i).getSelectedRange(),o=u(h.getCursorSelection(i)),a=[],s=!1;0<o.length&&(a=a.concat(d(n)),s=!0),(n=new ops.OpInsertText).init({memberid:i,position:o.position,text:t,moveCursor:!0}),a.push(n),r&&(t=r(o.position,t.length,s))&&a.push(t),e.enqueue(a)}},this.destroy=function(e){h.unsubscribe(ops.Document.signalCursorMoved,s),t.unsubscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a),e()},h.subscribe(ops.Document.signalCursorMoved,s),t.subscribe(gui.CommonConstraints.EDIT.REVIEW_MODE,a),a()},gui.UndoManager=function(){},gui.UndoManager.prototype.subscribe=function(e,t){},gui.UndoManager.prototype.unsubscribe=function(e,t){},gui.UndoManager.prototype.setDocument=function(e){},gui.UndoManager.prototype.setInitialState=function(){},gui.UndoManager.prototype.initialize=function(){},gui.UndoManager.prototype.purgeInitialState=function(){},gui.UndoManager.prototype.setPlaybackFunction=function(e){},gui.UndoManager.prototype.hasUndoStates=function(){},gui.UndoManager.prototype.hasRedoStates=function(){},gui.UndoManager.prototype.moveForward=function(e){},gui.UndoManager.prototype.moveBackward=function(e){},gui.UndoManager.prototype.onOperationExecuted=function(e){},gui.UndoManager.prototype.isDocumentModified=function(){},gui.UndoManager.prototype.setDocumentModified=function(e){},gui.UndoManager.signalUndoStackChanged="undoStackChanged",gui.UndoManager.signalUndoStateCreated="undoStateCreated",gui.UndoManager.signalUndoStateModified="undoStateModified",gui.UndoManager.signalDocumentModifiedChanged="documentModifiedChanged",gui.SessionControllerOptions=function(){this.annotationsEnabled=this.directParagraphStylingEnabled=this.directTextStylingEnabled=!1},function(){var e=core.PositionFilter.FilterResult.FILTER_ACCEPT;gui.SessionController=function(t,n,i,r){function o(e,t){var n=I.getDOMDocument(),i=null;return n.caretRangeFromPoint?i={container:(n=n.caretRangeFromPoint(e,t)).startContainer,offset:n.startOffset}:n.caretPositionFromPoint&&(n=n.caretPositionFromPoint(e,t))&&n.offsetNode&&(i={container:n.offsetNode,offset:n.offset}),i}function a(e){var t=I.getCursor(n).getSelectedRange();t.collapsed?e.preventDefault():j.setDataFromRange(e,t)?ee.removeCurrentSelection():runtime.log("Cut operation failed")}function s(){return!1!==I.getCursor(n).getSelectedRange().collapsed}function l(e){var t=I.getCursor(n).getSelectedRange();t.collapsed?e.preventDefault():j.setDataFromRange(e,t)||runtime.log("Copy operation failed")}function d(e){var t;M.clipboardData&&M.clipboardData.getData?t=M.clipboardData.getData("Text"):e.clipboardData&&e.clipboardData.getData&&(t=e.clipboardData.getData("text/plain")),t&&(ee.removeCurrentSelection(),re.paste(t)),e.preventDefault?e.preventDefault():e.returnValue=!1}function u(){return!1}function c(e){J&&J.onOperationExecuted(e)}function h(e){I.emit(ops.OdtDocument.signalUndoStackChanged,e)}function f(){var e;return!!J&&(e=K.hasFocus(),J.moveBackward(1),e&&K.focus(),!0)}function p(){var e;return!!J&&(e=K.hasFocus(),J.moveForward(1),e&&K.focus(),!0)}function m(t){var r=I.getCursor(n).getSelectedRange(),a=(t.target||t.srcElement||null).getAttribute("end");r&&a&&(t=o(t.clientX,t.clientY))&&(ie.setUnfilteredPosition(t.container,t.offset),Z.acceptPosition(ie)===e&&(r=r.cloneRange(),"left"===a?r.setStart(ie.container(),ie.unfilteredDomOffset()):r.setEnd(ie.container(),ie.unfilteredDomOffset()),i.setSelectedRange(r,"right"===a),I.emit(ops.Document.signalCursorMoved,i)))}function g(){de.selectRange(i.getSelectedRange(),i.hasForwardSelection(),1)}function _(){var t=M.getSelection(),n=0<t.rangeCount&&de.selectionToRange(t);W&&n&&(Y=!0,ne.clearSelection(),ie.setUnfilteredPosition(t.focusNode,t.focusOffset),Z.acceptPosition(ie)===e&&(2===ae?de.expandToWordBoundaries(n.range):3<=ae&&de.expandToParagraphBoundaries(n.range),i.setSelectedRange(n.range,n.hasForwardSelection),I.emit(ops.Document.signalCursorMoved,i)))}function v(e){var t=e.target||e.srcElement||null,i=I.getCursor(n);(W=null!==t&&B.containsNode(I.getOdfCanvas().getElement(),t))&&(Y=!1,t=I.getRootElement(t)||I.getRootNode(),Z=I.createRootFilter(t),ae=0===e.button?e.detail:0,i&&e.shiftKey?M.getSelection().collapse(i.getAnchorNode(),0):(e=M.getSelection(),t=i.getSelectedRange(),e.extend?i.hasForwardSelection()?(e.collapse(t.startContainer,t.startOffset),e.extend(t.endContainer,t.endOffset)):(e.collapse(t.endContainer,t.endOffset),e.extend(t.startContainer,t.startOffset)):(e.removeAllRanges(),e.addRange(t.cloneRange()))),1<ae&&_())}function b(e){var t=I.getRootElement(e),n=I.createRootFilter(t);return(t=I.createStepIterator(e,0,[n,I.getPositionFilter()],t)).setPosition(e,e.childNodes.length),t.roundToNextStep()?{container:t.container(),offset:t.offset()}:null}function y(e){var t;t=(t=M.getSelection())?{anchorNode:t.anchorNode,anchorOffset:t.anchorOffset,focusNode:t.focusNode,focusOffset:t.focusOffset}:null;var n,i,r=M.getSelection().isCollapsed;t.anchorNode||t.focusNode||!(n=o(e.clientX,e.clientY))||(t.anchorNode=n.container,t.anchorOffset=n.offset,t.focusNode=t.anchorNode,t.focusOffset=t.anchorOffset),U.isImage(t.focusNode)&&0===t.focusOffset&&U.isCharacterFrame(t.focusNode.parentNode)?(n=(i=t.focusNode.parentNode).getBoundingClientRect(),e.clientX>n.left&&(n=b(i))&&(t.focusNode=n.container,t.focusOffset=n.offset,r&&(t.anchorNode=t.focusNode,t.anchorOffset=t.focusOffset))):U.isImage(t.focusNode.firstChild)&&1===t.focusOffset&&U.isCharacterFrame(t.focusNode)&&(n=b(t.focusNode))&&(t.anchorNode=t.focusNode=n.container,t.anchorOffset=t.focusOffset=n.offset),t.anchorNode&&t.focusNode&&(t=de.selectionToRange(t),de.selectRange(t.range,t.hasForwardSelection,0===e.button?e.detail:0)),K.focus()}function x(e){var t;(t=o(e.clientX,e.clientY))&&(e={anchorNode:e=t.container,anchorOffset:t=t.offset,focusNode:e,focusOffset:t},e=de.selectionToRange(e),de.selectRange(e.range,e.hasForwardSelection,2),K.focus())}function w(e){var t,n,r,o=e.target||e.srcElement||null;D.processRequests(),W&&(U.isImage(o)&&U.isCharacterFrame(o.parentNode)&&M.getSelection().isCollapsed?(de.selectImage(o.parentNode),K.focus()):ne.isSelectorElement(o)?K.focus():Y?(n=(o=i.getSelectedRange()).collapsed,U.isImage(o.endContainer)&&0===o.endOffset&&U.isCharacterFrame(o.endContainer.parentNode)&&(r=b(r=o.endContainer.parentNode))&&(o.setEnd(r.container,r.offset),n&&o.collapse(!1)),de.selectRange(o,i.hasForwardSelection(),0===e.button?e.detail:0),K.focus()):pe?y(e):(t=B.cloneEvent(e),O=runtime.setTimeout(function(){y(t)},0)),ae=0,Y=W=!1)}function S(e){var t=I.getCursor(n).getSelectedRange();t.collapsed||z.exportRangeToDataTransfer(e.dataTransfer,t)}function N(){W&&K.focus(),ae=0,Y=W=!1}function E(e){w(e)}function C(e){var t=e.target||e.srcElement||null,n=null;"annotationRemoveButton"===t.className?(runtime.assert(G,"Remove buttons are displayed on annotations while annotation editing is disabled in the controller."),n=t.parentNode.getElementsByTagNameNS(odf.Namespaces.officens,"annotation").item(0),$.removeAnnotation(n),K.focus()):"webodf-draggable"!==t.getAttribute("class")&&w(e)}function k(e){(e=e.data)&&(-1===e.indexOf("\n")?ee.insertText(e):re.paste(e))}function T(e){return function(t){return I.getCursor(n).getSelectionType()!==ops.OdtCursor.RangeSelection||e(t)}}function A(e){K.unsubscribe("keydown",H.handleEvent),K.unsubscribe("keypress",X.handleEvent),K.unsubscribe("keyup",V.handleEvent),K.unsubscribe("copy",l),K.unsubscribe("mousedown",v),K.unsubscribe("mousemove",D.trigger),K.unsubscribe("mouseup",C),K.unsubscribe("contextmenu",E),K.unsubscribe("dragstart",S),K.unsubscribe("dragend",N),K.unsubscribe("click",se.handleClick),K.unsubscribe("longpress",x),K.unsubscribe("drag",m),K.unsubscribe("dragstop",g),I.unsubscribe(ops.OdtDocument.signalOperationEnd,R.trigger),I.unsubscribe(ops.Document.signalCursorAdded,oe.registerCursor),I.unsubscribe(ops.Document.signalCursorRemoved,oe.removeCursor),I.unsubscribe(ops.OdtDocument.signalOperationEnd,c),e()}var O,D,R,P,M=runtime.getWindow(),I=t.getOdtDocument(),F=new gui.SessionConstraints,L=new gui.SessionContext(t,n),B=core.DomUtils,U=odf.OdfUtils,z=new gui.MimeDataExporter,j=new gui.Clipboard(z),H=new gui.KeyboardHandler,X=new gui.KeyboardHandler,V=new gui.KeyboardHandler,W=!1,q=new odf.ObjectNameGenerator(I.getOdfCanvas().odfContainer(),n),Y=!1,Z=null,J=null,K=new gui.EventManager(I),G=r.annotationsEnabled,$=new gui.AnnotationController(t,F,n),Q=new gui.DirectFormattingController(t,F,L,n,q,r.directTextStylingEnabled,r.directParagraphStylingEnabled),ee=new gui.TextController(t,F,L,n,Q.createCursorStyleOp,Q.createParagraphStyleOps),te=new gui.ImageController(t,F,L,n,q),ne=new gui.ImageSelector(I.getOdfCanvas()),ie=I.createPositionIterator(I.getRootNode()),re=new gui.PasteController(t,F,L,n),oe=new gui.InputMethodEditor(n,K),ae=0,se=new gui.HyperlinkClickHandler(I.getOdfCanvas().getElement,H,V),le=new gui.HyperlinkController(t,F,L,n),de=new gui.SelectionController(t,n),ue=new gui.MetadataController(t,n),ce=gui.KeyboardHandler.Modifier,he=gui.KeyboardHandler.KeyCode,fe=-1!==M.navigator.appVersion.toLowerCase().indexOf("mac"),pe=-1!==["iPad","iPod","iPhone"].indexOf(M.navigator.platform);runtime.assert(null!==M,"Expected to be run in an environment which has a global window, like a browser."),this.undo=f,this.redo=p,this.insertLocalCursor=function(){runtime.assert(void 0===t.getOdtDocument().getCursor(n),"Inserting local cursor a second time.");var e=new ops.OpAddCursor;e.init({memberid:n}),t.enqueue([e]),K.focus()},this.removeLocalCursor=function(){runtime.assert(void 0!==t.getOdtDocument().getCursor(n),"Removing local cursor without inserting before.");var e=new ops.OpRemoveCursor;e.init({memberid:n}),t.enqueue([e])},this.startEditing=function(){oe.subscribe(gui.InputMethodEditor.signalCompositionStart,ee.removeCurrentSelection),oe.subscribe(gui.InputMethodEditor.signalCompositionEnd,k),K.subscribe("beforecut",s),K.subscribe("cut",a),K.subscribe("beforepaste",u),K.subscribe("paste",d),J&&J.initialize(),K.setEditing(!0),se.setModifier(fe?ce.Meta:ce.Ctrl),H.bind(he.Backspace,ce.None,function(e){return function(){return e(),!0}}(ee.removeTextByBackspaceKey),!0),H.bind(he.Delete,ce.None,ee.removeTextByDeleteKey),H.bind(he.Tab,ce.None,T(function(){return ee.insertText("\t"),!0})),fe?(H.bind(he.Clear,ce.None,ee.removeCurrentSelection),H.bind(he.B,ce.Meta,T(Q.toggleBold)),H.bind(he.I,ce.Meta,T(Q.toggleItalic)),H.bind(he.U,ce.Meta,T(Q.toggleUnderline)),H.bind(he.L,ce.MetaShift,T(Q.alignParagraphLeft)),H.bind(he.E,ce.MetaShift,T(Q.alignParagraphCenter)),H.bind(he.R,ce.MetaShift,T(Q.alignParagraphRight)),H.bind(he.J,ce.MetaShift,T(Q.alignParagraphJustified)),G&&H.bind(he.C,ce.MetaShift,$.addAnnotation),H.bind(he.Z,ce.Meta,f),H.bind(he.Z,ce.MetaShift,p)):(H.bind(he.B,ce.Ctrl,T(Q.toggleBold)),H.bind(he.I,ce.Ctrl,T(Q.toggleItalic)),H.bind(he.U,ce.Ctrl,T(Q.toggleUnderline)),H.bind(he.L,ce.CtrlShift,T(Q.alignParagraphLeft)),H.bind(he.E,ce.CtrlShift,T(Q.alignParagraphCenter)),H.bind(he.R,ce.CtrlShift,T(Q.alignParagraphRight)),H.bind(he.J,ce.CtrlShift,T(Q.alignParagraphJustified)),G&&H.bind(he.C,ce.CtrlAlt,$.addAnnotation),H.bind(he.Z,ce.Ctrl,f),H.bind(he.Z,ce.CtrlShift,p)),X.setDefault(T(function(e){var t;return!(!(t=null===e.which||void 0===e.which?String.fromCharCode(e.keyCode):0!==e.which&&0!==e.charCode?String.fromCharCode(e.which):null)||e.altKey||e.ctrlKey||e.metaKey)&&(ee.insertText(t),!0)})),X.bind(he.Enter,ce.None,T(ee.enqueueParagraphSplittingOps))},this.endEditing=function(){oe.unsubscribe(gui.InputMethodEditor.signalCompositionStart,ee.removeCurrentSelection),oe.unsubscribe(gui.InputMethodEditor.signalCompositionEnd,k),K.unsubscribe("cut",a),K.unsubscribe("beforecut",s),K.unsubscribe("paste",d),K.unsubscribe("beforepaste",u),K.setEditing(!1),se.setModifier(ce.None),H.bind(he.Backspace,ce.None,function(){return!0},!0),H.unbind(he.Delete,ce.None),H.unbind(he.Tab,ce.None),fe?(H.unbind(he.Clear,ce.None),H.unbind(he.B,ce.Meta),H.unbind(he.I,ce.Meta),H.unbind(he.U,ce.Meta),H.unbind(he.L,ce.MetaShift),H.unbind(he.E,ce.MetaShift),H.unbind(he.R,ce.MetaShift),H.unbind(he.J,ce.MetaShift),G&&H.unbind(he.C,ce.MetaShift),H.unbind(he.Z,ce.Meta),H.unbind(he.Z,ce.MetaShift)):(H.unbind(he.B,ce.Ctrl),H.unbind(he.I,ce.Ctrl),H.unbind(he.U,ce.Ctrl),H.unbind(he.L,ce.CtrlShift),H.unbind(he.E,ce.CtrlShift),H.unbind(he.R,ce.CtrlShift),H.unbind(he.J,ce.CtrlShift),G&&H.unbind(he.C,ce.CtrlAlt),H.unbind(he.Z,ce.Ctrl),H.unbind(he.Z,ce.CtrlShift)),X.setDefault(null),X.unbind(he.Enter,ce.None)},this.getInputMemberId=function(){return n},this.getSession=function(){return t},this.getSessionConstraints=function(){return F},this.setUndoManager=function(e){J&&J.unsubscribe(gui.UndoManager.signalUndoStackChanged,h),(J=e)&&(J.setDocument(I),J.setPlaybackFunction(t.enqueue),J.subscribe(gui.UndoManager.signalUndoStackChanged,h))},this.getUndoManager=function(){return J},this.getMetadataController=function(){return ue},this.getAnnotationController=function(){return $},this.getDirectFormattingController=function(){return Q},this.getHyperlinkClickHandler=function(){return se},this.getHyperlinkController=function(){return le},this.getImageController=function(){return te},this.getSelectionController=function(){return de},this.getTextController=function(){return ee},this.getEventManager=function(){return K},this.getKeyboardHandlers=function(){return{keydown:H,keypress:X}},this.destroy=function(e){var t=[D.destroy,R.destroy,Q.destroy,oe.destroy,K.destroy,se.destroy,le.destroy,ue.destroy,de.destroy,ee.destroy,A];P&&t.unshift(P.destroy),runtime.clearTimeout(O),core.Async.destroyAll(t,e)},D=core.Task.createRedrawTask(_),R=core.Task.createRedrawTask(function(){var e=I.getCursor(n);e&&e.getSelectionType()===ops.OdtCursor.RegionSelection&&(e=U.getImageElements(e.getSelectedRange())[0])?ne.select(e.parentNode):ne.clearSelection()}),H.bind(he.Left,ce.None,T(de.moveCursorToLeft)),H.bind(he.Right,ce.None,T(de.moveCursorToRight)),H.bind(he.Up,ce.None,T(de.moveCursorUp)),H.bind(he.Down,ce.None,T(de.moveCursorDown)),H.bind(he.Left,ce.Shift,T(de.extendSelectionToLeft)),H.bind(he.Right,ce.Shift,T(de.extendSelectionToRight)),H.bind(he.Up,ce.Shift,T(de.extendSelectionUp)),H.bind(he.Down,ce.Shift,T(de.extendSelectionDown)),H.bind(he.Home,ce.None,T(de.moveCursorToLineStart)),H.bind(he.End,ce.None,T(de.moveCursorToLineEnd)),H.bind(he.Home,ce.Ctrl,T(de.moveCursorToDocumentStart)),H.bind(he.End,ce.Ctrl,T(de.moveCursorToDocumentEnd)),H.bind(he.Home,ce.Shift,T(de.extendSelectionToLineStart)),H.bind(he.End,ce.Shift,T(de.extendSelectionToLineEnd)),H.bind(he.Up,ce.CtrlShift,T(de.extendSelectionToParagraphStart)),H.bind(he.Down,ce.CtrlShift,T(de.extendSelectionToParagraphEnd)),H.bind(he.Home,ce.CtrlShift,T(de.extendSelectionToDocumentStart)),H.bind(he.End,ce.CtrlShift,T(de.extendSelectionToDocumentEnd)),fe?(H.bind(he.Left,ce.Alt,T(de.moveCursorBeforeWord)),H.bind(he.Right,ce.Alt,T(de.moveCursorPastWord)),H.bind(he.Left,ce.Meta,T(de.moveCursorToLineStart)),H.bind(he.Right,ce.Meta,T(de.moveCursorToLineEnd)),H.bind(he.Home,ce.Meta,T(de.moveCursorToDocumentStart)),H.bind(he.End,ce.Meta,T(de.moveCursorToDocumentEnd)),H.bind(he.Left,ce.AltShift,T(de.extendSelectionBeforeWord)),H.bind(he.Right,ce.AltShift,T(de.extendSelectionPastWord)),H.bind(he.Left,ce.MetaShift,T(de.extendSelectionToLineStart)),H.bind(he.Right,ce.MetaShift,T(de.extendSelectionToLineEnd)),H.bind(he.Up,ce.AltShift,T(de.extendSelectionToParagraphStart)),H.bind(he.Down,ce.AltShift,T(de.extendSelectionToParagraphEnd)),H.bind(he.Up,ce.MetaShift,T(de.extendSelectionToDocumentStart)),H.bind(he.Down,ce.MetaShift,T(de.extendSelectionToDocumentEnd)),H.bind(he.A,ce.Meta,T(de.extendSelectionToEntireDocument))):(H.bind(he.Left,ce.Ctrl,T(de.moveCursorBeforeWord)),H.bind(he.Right,ce.Ctrl,T(de.moveCursorPastWord)),H.bind(he.Left,ce.CtrlShift,T(de.extendSelectionBeforeWord)),H.bind(he.Right,ce.CtrlShift,T(de.extendSelectionPastWord)),H.bind(he.A,ce.Ctrl,T(de.extendSelectionToEntireDocument))),pe&&(P=new gui.IOSSafariSupport(K)),K.subscribe("keydown",H.handleEvent),K.subscribe("keypress",X.handleEvent),K.subscribe("keyup",V.handleEvent),K.subscribe("copy",l),K.subscribe("mousedown",v),K.subscribe("mousemove",D.trigger),K.subscribe("mouseup",C),K.subscribe("contextmenu",E),K.subscribe("dragstart",S),K.subscribe("dragend",N),K.subscribe("click",se.handleClick),K.subscribe("longpress",x),K.subscribe("drag",m),K.subscribe("dragstop",g),I.subscribe(ops.OdtDocument.signalOperationEnd,R.trigger),I.subscribe(ops.Document.signalCursorAdded,oe.registerCursor),I.subscribe(ops.Document.signalCursorRemoved,oe.removeCursor),I.subscribe(ops.OdtDocument.signalOperationEnd,c)}}(),gui.CaretManager=function(e,t){function n(e){return o.hasOwnProperty(e)?o[e]:null}function i(){return Object.keys(o).map(function(e){return o[e]})}function r(t){var n=o[t];n&&(delete o[t],t===e.getInputMemberId()?(s.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,n.ensureVisible),s.unsubscribe(ops.Document.signalCursorMoved,n.refreshCursorBlinking),l.unsubscribe("compositionupdate",n.handleUpdate),l.unsubscribe("compositionend",n.handleUpdate),l.unsubscribe("focus",n.setFocus),l.unsubscribe("blur",n.removeFocus),a.removeEventListener("focus",n.show,!1),a.removeEventListener("blur",n.hide,!1)):s.unsubscribe(ops.OdtDocument.signalProcessingBatchEnd,n.handleUpdate),n.destroy(function(){}))}var o={},a=runtime.getWindow(),s=e.getSession().getOdtDocument(),l=e.getEventManager();this.registerCursor=function(n,i,r){var d=n.getMemberId();return n=new gui.Caret(n,t,i,r),o[d]=n,d===e.getInputMemberId()?(runtime.log("Starting to track input on new cursor of "+d),s.subscribe(ops.OdtDocument.signalProcessingBatchEnd,n.ensureVisible),s.subscribe(ops.Document.signalCursorMoved,n.refreshCursorBlinking),l.subscribe("compositionupdate",n.handleUpdate),l.subscribe("compositionend",n.handleUpdate),l.subscribe("focus",n.setFocus),l.subscribe("blur",n.removeFocus),a.addEventListener("focus",n.show,!1),a.addEventListener("blur",n.hide,!1),n.setOverlayElement(l.getEventTrap())):s.subscribe(ops.OdtDocument.signalProcessingBatchEnd,n.handleUpdate),n},this.getCaret=n,this.getCarets=i,this.destroy=function(t){var n=i().map(function(e){return e.destroy});e.getSelectionController().setCaretXPositionLocator(null),s.unsubscribe(ops.Document.signalCursorRemoved,r),o={},core.Async.destroyAll(n,t)},e.getSelectionController().setCaretXPositionLocator(function(){var t,i=n(e.getInputMemberId());return i&&(t=i.getBoundingClientRect()),t?t.right:void 0}),s.subscribe(ops.Document.signalCursorRemoved,r)},gui.EditInfoHandle=function(e){var t,n=[],i=e.ownerDocument,r=i.documentElement.namespaceURI;this.setEdits=function(e){var o,a,s,l;for(n=e,core.DomUtils.removeAllChildNodes(t),e=0;e<n.length;e+=1)(o=i.createElementNS(r,"div")).className="editInfo",(a=i.createElementNS(r,"span")).className="editInfoColor",a.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),(s=i.createElementNS(r,"span")).className="editInfoAuthor",s.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),(l=i.createElementNS(r,"span")).className="editInfoTime",l.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n[e].memberid),l.appendChild(i.createTextNode(n[e].time.toString())),o.appendChild(a),o.appendChild(s),o.appendChild(l),t.appendChild(o)},this.show=function(){t.style.display="block"},this.hide=function(){t.style.display="none"},this.destroy=function(n){e.removeChild(t),n()},(t=i.createElementNS(r,"div")).setAttribute("class","editInfoHandle"),t.style.display="none",e.appendChild(t)},ops.EditInfo=function(e,t){var n,i={};this.getNode=function(){return n},this.getOdtDocument=function(){return t},this.getEdits=function(){return i},this.getSortedEdits=function(){return function(){var e,t=[];for(e in i)i.hasOwnProperty(e)&&t.push({memberid:e,time:i[e].time});return t.sort(function(e,t){return e.time-t.time}),t}()},this.addEdit=function(e,t){i[e]={time:t}},this.clearEdits=function(){i={}},this.destroy=function(t){e.parentNode&&e.removeChild(n),t()},n=t.getDOMDocument().createElementNS("urn:webodf:names:editinfo","editinfo"),e.insertBefore(n,e.firstChild)},gui.EditInfoMarker=function(e,t){function n(e,t){return runtime.setTimeout(function(){o.style.opacity=e},t)}var i,r,o,a,s,l,d=this;this.addEdit=function(t,i){var d=Date.now()-i;e.addEdit(t,i),r.setEdits(e.getSortedEdits()),o.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",t),runtime.clearTimeout(s),runtime.clearTimeout(l),1e4>d?(a=n(1,0),s=n(.5,1e4-d),l=n(.2,2e4-d)):1e4<=d&&2e4>d?(a=n(.5,0),l=n(.2,2e4-d)):a=n(.2,0)},this.getEdits=function(){return e.getEdits()},this.clearEdits=function(){e.clearEdits(),r.setEdits([]),o.hasAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")&&o.removeAttributeNS("urn:webodf:names:editinfo","editinfo:memberid")},this.getEditInfo=function(){return e},this.show=function(){o.style.display="block"},this.hide=function(){d.hideHandle(),o.style.display="none"},this.showHandle=function(){r.show()},this.hideHandle=function(){r.hide()},this.destroy=function(t){runtime.clearTimeout(a),runtime.clearTimeout(s),runtime.clearTimeout(l),i.removeChild(o),r.destroy(function(n){n?t(n):e.destroy(t)})},function(){var n=e.getOdtDocument().getDOMDocument();(o=n.createElementNS(n.documentElement.namespaceURI,"div")).setAttribute("class","editInfoMarker"),o.onmouseover=function(){d.showHandle()},o.onmouseout=function(){d.hideHandle()},(i=e.getNode()).appendChild(o),r=new gui.EditInfoHandle(i),t||d.hide()}()},gui.HyperlinkTooltipView=function(e,t){var n,i,r,o=core.DomUtils,a=odf.OdfUtils,s=runtime.getWindow();runtime.assert(null!==s,"Expected to be run in an environment which has a global window, like a browser."),this.showTooltip=function(l){var d,u=l.target||l.srcElement,c=e.getSizer(),h=e.getZoomLevel();e:{for(;u;){if(a.isHyperlink(u))break e;if(a.isParagraph(u)||a.isInlineRoot(u))break;u=u.parentNode}u=null}if(u){var f;switch(o.containsNode(c,r)||c.appendChild(r),d=i,t()){case gui.KeyboardHandler.Modifier.Ctrl:f=runtime.tr("Ctrl-click to follow link");break;case gui.KeyboardHandler.Modifier.Meta:f=runtime.tr("\u2318-click to follow link");break;default:f=""}d.textContent=f,n.textContent=a.getHyperlinkTarget(u),r.style.display="block",d=s.innerWidth-r.offsetWidth-15,u=l.clientX>d?d:l.clientX+15,d=s.innerHeight-r.offsetHeight-10,l=l.clientY>d?d:l.clientY+10,u=(u-(c=c.getBoundingClientRect()).left)/h,l=(l-c.top)/h,r.style.left=u+"px",r.style.top=l+"px"}},this.hideTooltip=function(){r.style.display="none"},this.destroy=function(e){r.parentNode&&r.parentNode.removeChild(r),e()},function(){var t=e.getElement().ownerDocument;n=t.createElement("span"),i=t.createElement("span"),n.className="webodf-hyperlinkTooltipLink",i.className="webodf-hyperlinkTooltipText",(r=t.createElement("div")).className="webodf-hyperlinkTooltip",r.appendChild(n),r.appendChild(i),e.getElement().appendChild(r)}()},gui.OdfFieldView=function(e){var t,n=e.getElement().ownerDocument;this.showFieldHighlight=function(){t.appendChild(n.createTextNode(function(){var e;return(e=odf.OdfSchema.getFields().map(function(e){return e.replace(":","|")})).join(",\n")+"\n{ background-color: #D0D0D0; }\n\n"+e.map(function(e){return e+":empty::after"}).join(",\n")+"\n{ content:' '; white-space: pre; }\n"}()))},this.hideFieldHighlight=function(){for(var e=t.sheet,n=e.cssRules;n.length;)e.deleteRule(n.length-1)},this.destroy=function(e){t.parentNode&&t.parentNode.removeChild(t),e()},t=function(){var e=n.getElementsByTagName("head").item(0),t=n.createElement("style"),i="";return t.type="text/css",t.media="screen, print, handheld, projection",odf.Namespaces.forEachPrefix(function(e,t){i+="@namespace "+e+" url("+t+");\n"}),t.appendChild(n.createTextNode(i)),e.appendChild(t),t}()},gui.ShadowCursor=function(e){var t=e.getDOMDocument().createRange(),n=!0;this.removeFromDocument=function(){},this.getMemberId=function(){return gui.ShadowCursor.ShadowCursorMemberId},this.getSelectedRange=function(){return t},this.setSelectedRange=function(e,i){t=e,n=!1!==i},this.hasForwardSelection=function(){return n},this.getDocument=function(){return e},this.getSelectionType=function(){return ops.OdtCursor.RangeSelection},t.setStart(e.getRootNode(),0)},gui.ShadowCursor.ShadowCursorMemberId="",gui.SelectionView=function(e){},gui.SelectionView.prototype.rerender=function(){},gui.SelectionView.prototype.show=function(){},gui.SelectionView.prototype.hide=function(){},gui.SelectionView.prototype.destroy=function(e){},gui.SelectionViewManager=function(e){function t(){return Object.keys(n).map(function(e){return n[e]})}var n={};this.getSelectionView=function(e){return n.hasOwnProperty(e)?n[e]:null},this.getSelectionViews=t,this.removeSelectionView=function(e){n.hasOwnProperty(e)&&(n[e].destroy(function(){}),delete n[e])},this.hideSelectionView=function(e){n.hasOwnProperty(e)&&n[e].hide()},this.showSelectionView=function(e){n.hasOwnProperty(e)&&n[e].show()},this.rerenderSelectionViews=function(){Object.keys(n).forEach(function(e){n[e].rerender()})},this.registerCursor=function(t,i){var r=t.getMemberId(),o=new e(t);return i?o.show():o.hide(),n[r]=o},this.destroy=function(e){var n=t();!function t(i,r){r?e(r):i<n.length?n[i].destroy(function(e){t(i+1,e)}):e()}(0,void 0)}},gui.SessionViewOptions=function(){this.caretBlinksOnRangeSelect=this.caretAvatarsInitiallyVisible=this.editInfoMarkersInitiallyVisible=!0},function(){function e(e,t){return void 0!==e?Boolean(e):t}gui.SessionView=function(t,n,i,r,o,a){function s(e){e.memberId===n&&x.getViewport().scrollIntoView(e.annotation.getBoundingClientRect())}function l(){var e=document.getElementsByTagName("head").item(0),t=document.createElement("style");return t.type="text/css",t.media="screen, print, handheld, projection",e.appendChild(t),t}function d(e){var t,n;for(n in S)S.hasOwnProperty(n)&&(t=S[n],e?t.show():t.hide())}function u(e){o.getCarets().forEach(function(t){e?t.showHandle():t.hideHandle()})}function c(e){!function(e,t,i){function r(t,n,i){n=t+'[editinfo|memberid="'+e+'"]'+i+n;e:{var r=v.firstChild;for(t=t+'[editinfo|memberid="'+e+'"]'+i+"{";r;){if(r.nodeType===Node.TEXT_NODE&&0===r.data.indexOf(t)){t=r;break e}r=r.nextSibling}t=null}t?t.data=n:v.appendChild(document.createTextNode(n))}r("div.editInfoMarker","{ background-color: "+i+"; }",""),r("span.editInfoColor","{ background-color: "+i+"; }",""),r("span.editInfoAuthor",'{ content: "'+t+'"; }',":before"),r("dc|creator","{ background-color: "+i+"; }",""),r(".webodf-selectionOverlay","{ fill: "+i+"; stroke: "+i+";}",""),e===n&&(r(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"),e=gui.ShadowCursor.ShadowCursorMemberId,r(".webodf-selectionOverlay","{ fill: "+i+"; stroke: "+i+";}",""),r(".webodf-touchEnabled .webodf-selectionOverlay","{ display: block; }"," > .webodf-draggable"))}(e.getMemberId(),(e=e.getProperties()).fullName,e.color)}function h(e){var t=e.getMemberId(),n=i.getOdtDocument().getMember(t).getProperties();o.registerCursor(e,E,C),a.registerCursor(e,!0),(e=o.getCaret(t))&&(e.setAvatarImageUrl(n.imageUrl),e.setColor(n.color)),runtime.log("+++ View here +++ eagerly created an Caret for '"+t+"'! +++")}function f(e){e=e.getMemberId();var t=a.getSelectionView(n),i=a.getSelectionView(gui.ShadowCursor.ShadowCursorMemberId),r=o.getCaret(n);e===n?(i.hide(),t&&t.show(),r&&r.show()):e===gui.ShadowCursor.ShadowCursorMemberId&&(i.show(),t&&t.hide(),r&&r.hide())}function p(e){a.removeSelectionView(e)}function m(e){var t=e.paragraphElement,n=e.memberId;e=e.timeStamp;var r,o="",a=t.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0);a?(o=a.getAttributeNS("urn:webodf:names:editinfo","id"),r=S[o]):(o=Math.random().toString(),r=new ops.EditInfo(t,i.getOdtDocument()),r=new gui.EditInfoMarker(r,N),(a=t.getElementsByTagNameNS("urn:webodf:names:editinfo","editinfo").item(0)).setAttributeNS("urn:webodf:names:editinfo","id",o),S[o]=r),r.addEdit(n,new Date(e)),w.trigger()}function g(){var e;b.hasChildNodes()&&core.DomUtils.removeAllChildNodes(b),!0===r.getState(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN)&&(e=i.getOdtDocument().getMember(n))&&(e=e.getProperties().fullName,b.appendChild(document.createTextNode(".annotationWrapper:not([creator = '"+e+"']) .annotationRemoveButton { display: none; }")))}function _(e){var t=Object.keys(S).map(function(e){return S[e]});y.unsubscribe(ops.Document.signalMemberAdded,c),y.unsubscribe(ops.Document.signalMemberUpdated,c),y.unsubscribe(ops.Document.signalCursorAdded,h),y.unsubscribe(ops.Document.signalCursorRemoved,p),y.unsubscribe(ops.OdtDocument.signalParagraphChanged,m),y.unsubscribe(ops.Document.signalCursorMoved,f),y.unsubscribe(ops.OdtDocument.signalParagraphChanged,a.rerenderSelectionViews),y.unsubscribe(ops.OdtDocument.signalTableAdded,a.rerenderSelectionViews),y.unsubscribe(ops.OdtDocument.signalParagraphStyleModified,a.rerenderSelectionViews),r.unsubscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,g),y.unsubscribe(ops.Document.signalMemberAdded,g),y.unsubscribe(ops.Document.signalMemberUpdated,g),v.parentNode.removeChild(v),b.parentNode.removeChild(b),function n(i,r){r?e(r):i<t.length?t[i].destroy(function(e){n(i+1,e)}):e()}(0,void 0)}var v,b,y,x,w,S={},N=e(t.editInfoMarkersInitiallyVisible,!0),E=e(t.caretAvatarsInitiallyVisible,!0),C=e(t.caretBlinksOnRangeSelect,!0);this.showEditInfoMarkers=function(){N||d(N=!0)},this.hideEditInfoMarkers=function(){N&&d(N=!1)},this.showCaretAvatars=function(){E||u(E=!0)},this.hideCaretAvatars=function(){E&&u(E=!1)},this.getSession=function(){return i},this.getCaret=function(e){return o.getCaret(e)},this.destroy=function(e){var t=[w.destroy,_];y.unsubscribe(ops.OdtDocument.signalAnnotationAdded,s),core.Async.destroyAll(t,e)},y=i.getOdtDocument(),x=y.getOdfCanvas(),y.subscribe(ops.OdtDocument.signalAnnotationAdded,s),y.subscribe(ops.Document.signalMemberAdded,c),y.subscribe(ops.Document.signalMemberUpdated,c),y.subscribe(ops.Document.signalCursorAdded,h),y.subscribe(ops.Document.signalCursorRemoved,p),y.subscribe(ops.OdtDocument.signalParagraphChanged,m),y.subscribe(ops.Document.signalCursorMoved,f),y.subscribe(ops.OdtDocument.signalParagraphChanged,a.rerenderSelectionViews),y.subscribe(ops.OdtDocument.signalTableAdded,a.rerenderSelectionViews),y.subscribe(ops.OdtDocument.signalParagraphStyleModified,a.rerenderSelectionViews),r.subscribe(gui.CommonConstraints.EDIT.ANNOTATIONS.ONLY_DELETE_OWN,g),y.subscribe(ops.Document.signalMemberAdded,g),y.subscribe(ops.Document.signalMemberUpdated,g),(v=l()).appendChild(document.createTextNode("@namespace editinfo url(urn:webodf:names:editinfo);")),v.appendChild(document.createTextNode("@namespace dc url(http://purl.org/dc/elements/1.1/);")),b=l(),g(),w=core.Task.createRedrawTask(function(){var e=x.getAnnotationViewManager();e&&(e.rehighlightAnnotations(),y.fixCursorPositions())})}}(),gui.SvgSelectionView=function(e){function t(){var e=m.getRootNode();h!==e&&(h=e,(f=m.getCanvas().getSizer()).appendChild(_),_.setAttribute("class","webodf-selectionOverlay"),b.setAttribute("class","webodf-draggable"),y.setAttribute("class","webodf-draggable"),b.setAttribute("end","left"),y.setAttribute("end","right"),b.setAttribute("r",8),y.setAttribute("r",8),_.appendChild(v),_.appendChild(b),_.appendChild(y))}function n(e){return e=e.getBoundingClientRect(),Boolean(e&&0!==e.height)}function i(e){var t,i=x.getTextElements(e,!0,!1),r=e.cloneRange(),o=e.cloneRange();if(e=e.cloneRange(),!i.length)return null;e:{var a=i[t=0],s=r.startContainer===a?r.startOffset:0,l=s;for(r.setStart(a,s),r.setEnd(a,l);!n(r);){if(a.nodeType===Node.ELEMENT_NODE&&l<a.childNodes.length)l=a.childNodes.length;else if(a.nodeType===Node.TEXT_NODE&&l<a.length)l+=1;else{if(!i[t]){t=!1;break e}a=i[t],t+=1,s=l=0}r.setStart(a,s),r.setEnd(a,l)}t=!0}if(!t)return null;e:{for(a=i[t=i.length-1],l=s=o.endContainer===a?o.endOffset:a.nodeType===Node.TEXT_NODE?a.length:a.childNodes.length,o.setStart(a,s),o.setEnd(a,l);!n(o);){if(a.nodeType===Node.ELEMENT_NODE&&0<s)s=0;else if(a.nodeType===Node.TEXT_NODE&&0<s)--s;else{if(!i[t]){i=!1;break e}a=i[t],--t,s=l=a.length||a.childNodes.length}o.setStart(a,s),o.setEnd(a,l)}i=!0}return i?(e.setStart(r.startContainer,r.startOffset),e.setEnd(o.endContainer,o.endOffset),{firstRange:r,lastRange:o,fillerRange:e}):null}function r(e,t){var n={};return n.top=Math.min(e.top,t.top),n.left=Math.min(e.left,t.left),n.right=Math.max(e.right,t.right),n.bottom=Math.max(e.bottom,t.bottom),n.width=n.right-n.left,n.height=n.bottom-n.top,n}function o(e,t){return t&&0<t.width&&0<t.height&&(e=e?r(e,t):t),e}function a(e){function t(e){return E.setUnfilteredPosition(e,0),_.acceptNode(e)===C&&a.acceptPosition(E)===C?C:k}function n(e){var n=null;return t(e)===C&&(n=w.getBoundingClientRect(e)),n}var i,r,a,s,l=e.commonAncestorContainer,d=e.startContainer,u=e.endContainer,c=e.startOffset,h=e.endOffset,f=null,p=g.createRange(),_=new odf.OdfNodeFilter;if(d===l||u===l)return f=(p=e.cloneRange()).getBoundingClientRect(),p.detach(),f;for(e=d;e.parentNode!==l;)e=e.parentNode;for(r=u;r.parentNode!==l;)r=r.parentNode;for(a=m.createRootFilter(d),l=e.nextSibling;l&&l!==r;)f=o(f,n(l)),l=l.nextSibling;if(x.isParagraph(e))f=o(f,w.getBoundingClientRect(e));else if(e.nodeType===Node.TEXT_NODE)l=e,p.setStart(l,c),p.setEnd(l,l===r?h:l.length),f=o(f,p.getBoundingClientRect());else for(l=(s=g.createTreeWalker(e,NodeFilter.SHOW_TEXT,t,!1)).currentNode=d;l&&l!==u;)p.setStart(l,c),p.setEnd(l,l.length),f=o(f,p.getBoundingClientRect()),i=l,c=0,l=s.nextNode();if(i||(i=d),x.isParagraph(r))f=o(f,w.getBoundingClientRect(r));else if(r.nodeType===Node.TEXT_NODE)l=r,p.setStart(l,l===e?c:0),p.setEnd(l,h),f=o(f,p.getBoundingClientRect());else for(l=(s=g.createTreeWalker(r,NodeFilter.SHOW_TEXT,t,!1)).currentNode=u;l&&l!==i;)p.setStart(l,0),p.setEnd(l,h),f=o(f,p.getBoundingClientRect()),(l=s.previousNode())&&(h=l.length);return f}function s(e,t){var n=e.getBoundingClientRect(),i={width:0};return i.top=n.top,i.bottom=n.bottom,i.height=n.height,i.left=i.right=t?n.right:n.left,i}function l(){var n,o=e.getSelectedRange();if(n=N&&e.getSelectionType()===ops.OdtCursor.RangeSelection&&!o.collapsed){t();var l,d,u,c,h,p,m=w.getBoundingClientRect(f),g=S.getZoomLevel();if(o=i(o)){var x;for(n=o.firstRange,l=o.lastRange,d=o.fillerRange,u=w.translateRect(s(n,!1),m,g),h=w.translateRect(s(l,!0),m,g),p=(c=(c=a(d))?w.translateRect(c,m,g):r(u,h)).left,c=u.left+Math.max(0,c.width-(u.left-c.left)),m=Math.min(u.top,h.top),g=h.top+h.height,p=[{x:u.left,y:m+u.height},{x:u.left,y:m},{x:c,y:m},{x:c,y:g-h.height},{x:h.right,y:g-h.height},{x:h.right,y:g},{x:p,y:g},{x:p,y:m+u.height},{x:u.left,y:m+u.height}],c="",x=0;x<p.length;x+=1)c+=p[x].x+","+p[x].y+" ";v.setAttribute("points",c),b.setAttribute("cx",u.left),b.setAttribute("cy",m+u.height/2),y.setAttribute("cx",h.right),y.setAttribute("cy",g-h.height/2),n.detach(),l.detach(),d.detach()}n=Boolean(o)}_.style.display=n?"block":"none"}function d(t){N&&t===e&&p.trigger()}function u(e){e=8/e,b.setAttribute("r",e),y.setAttribute("r",e)}function c(t){f.removeChild(_),f.classList.remove("webodf-virtualSelections"),e.getDocument().unsubscribe(ops.Document.signalCursorMoved,d),S.unsubscribe(gui.ZoomHelper.signalZoomChanged,u),t()}var h,f,p,m=e.getDocument(),g=m.getDOMDocument(),_=g.createElementNS("http://www.w3.org/2000/svg","svg"),v=g.createElementNS("http://www.w3.org/2000/svg","polygon"),b=g.createElementNS("http://www.w3.org/2000/svg","circle"),y=g.createElementNS("http://www.w3.org/2000/svg","circle"),x=odf.OdfUtils,w=core.DomUtils,S=m.getCanvas().getZoomHelper(),N=!0,E=e.getDocument().createPositionIterator(m.getRootNode()),C=NodeFilter.FILTER_ACCEPT,k=NodeFilter.FILTER_REJECT;this.rerender=function(){N&&p.trigger()},this.show=function(){N=!0,p.trigger()},this.hide=function(){N=!1,p.trigger()},this.destroy=function(e){core.Async.destroyAll([p.destroy,c],e)},function(){var n=e.getMemberId();p=core.Task.createRedrawTask(l),t(),_.setAttributeNS("urn:webodf:names:editinfo","editinfo:memberid",n),f.classList.add("webodf-virtualSelections"),e.getDocument().subscribe(ops.Document.signalCursorMoved,d),S.subscribe(gui.ZoomHelper.signalZoomChanged,u),u(S.getZoomLevel())}()},gui.UndoStateRules=function(){function e(e,t){var n=e.length;this.previous=function(){for(--n;0<=n;--n)if(t(e[n]))return e[n];return null}}function t(e){var t;return(e=e.spec()).hasOwnProperty("position")&&(t=e.position),t}function n(e){return e.isEdit}function i(e,n,i){return i?(e=t(e))-(n=t(n))==n-(i=t(i)):0===(i=t(e)-t(n))||1===Math.abs(i)}this.isEditOperation=n,this.isPartOfOperationSet=function(t,r){var o,a=void 0!==t.group;if(!t.isEdit||0===r.length)return!0;if(o=r[r.length-1],a&&t.group===o.group)return!0;e:switch(t.spec().optype){case"RemoveText":case"InsertText":o=!0;break e;default:o=!1}if(o&&r.some(n)){if(a){var s;a=t.spec().optype;var l,d,u=(o=new e(r,n)).previous(),c=null;for(runtime.assert(Boolean(u),"No edit operations found in state"),d=u.group,runtime.assert(void 0!==d,"Operation has no group"),l=1;u&&u.group===d;){if(a===u.spec().optype){s=u;break}u=o.previous()}if(s){for(u=o.previous();u;){if(u.group!==d){if(2===l)break;d=u.group,l+=1}if(a===u.spec().optype){c=u;break}u=o.previous()}s=i(t,s,c)}else s=!1;return s}return s=t.spec().optype,o=(a=new e(r,n)).previous(),runtime.assert(Boolean(o),"No edit operations found in state"),s=s===o.spec().optype&&i(t,o,a.previous())}return!1}},function(){function e(e,t){this.mainId=void 0!==e?e:-1,this.subId=void 0!==t?t:-1}function t(t,i,r){var o,a,s;this.addOperation=function(e){t.isEditOperation(e)&&(s+=1),a.push(e)},this.isNextStateId=function(e){return e.mainId===o&&e.subId===s},this.getNextStateId=function(){return new e(o,s)},this.getOperations=function(){return a},o=n+=1,a=i||[],s=i&&r?i.reduce(function(e,n){return e+(t.isEditOperation(n)?1:0)},0):0}var n=0;gui.TrivialUndoManager=function(n){function i(){return!0!==g.isNextStateId(m)}function r(e){0<(e=e.getOperations()).length&&(S=!0,f(e),S=!1)}function o(){x.emit(gui.UndoManager.signalUndoStackChanged,{undoAvailable:_.hasUndoStates(),redoAvailable:_.hasRedoStates()})}function a(e){var t=i();e!==t&&x.emit(gui.UndoManager.signalDocumentModifiedChanged,t)}function s(){g!==h&&g!==b[b.length-1]&&b.push(g)}function l(e){var t=e.previousSibling||e.nextSibling;e.parentNode.removeChild(e),v.normalizeTextNodes(t)}function d(e){return Object.keys(e).map(function(t){return e[t]})}function u(){var e=i(),n=c=p.cloneDocumentElement();v.getElementsByTagNameNS(n,"urn:webodf:names:cursor","cursor").forEach(l),v.getElementsByTagNameNS(n,"urn:webodf:names:cursor","anchor").forEach(l),s(),g=h=function(e){function n(e){var t=e.spec();if(s[t.memberid])switch(t.optype){case"AddCursor":o[t.memberid]||(o[t.memberid]=e,delete s[t.memberid],--i);break;case"MoveCursor":a[t.memberid]||(a[t.memberid]=e)}}var i,r,o={},a={},s={};for(r=e.pop(),p.getMemberIds().forEach(function(e){s[e]=!0}),i=Object.keys(s).length;r&&0<i;)(r=r.getOperations()).reverse(),r.forEach(n),r=e.pop();return new t(w,d(o).concat(d(a)))}([h].concat(b)),b.length=0,y.length=0,e||(m=g.getNextStateId()),o(),a(e)}var c,h,f,p,m,g,_=this,v=core.DomUtils,b=[],y=[],x=new core.EventNotifier([gui.UndoManager.signalUndoStackChanged,gui.UndoManager.signalUndoStateCreated,gui.UndoManager.signalUndoStateModified,gui.UndoManager.signalDocumentModifiedChanged,gui.TrivialUndoManager.signalDocumentRootReplaced]),w=n||new gui.UndoStateRules,S=!1;this.subscribe=function(e,t){x.subscribe(e,t)},this.unsubscribe=function(e,t){x.unsubscribe(e,t)},this.isDocumentModified=i,this.setDocumentModified=function(t){i()!==t&&(m=t?new e:g.getNextStateId(),x.emit(gui.UndoManager.signalDocumentModifiedChanged,t))},this.hasUndoStates=function(){return 0<b.length},this.hasRedoStates=function(){return 0<y.length},this.setDocument=function(e){p=e},this.purgeInitialState=function(){var e=i();b.length=0,y.length=0,g=h=new t(w),m=g.getNextStateId(),c=null,o(),a(e)},this.setInitialState=u,this.initialize=function(){c||u()},this.setPlaybackFunction=function(e){f=e},this.onOperationExecuted=function(e){if(!S){var n=i();w.isEditOperation(e)&&(g===h||0<y.length)||!w.isPartOfOperationSet(e,g.getOperations())?(y.length=0,s(),g=new t(w,[e],!0),b.push(g),x.emit(gui.UndoManager.signalUndoStateCreated,{operations:g.getOperations()}),o()):(g.addOperation(e),x.emit(gui.UndoManager.signalUndoStateModified,{operations:g.getOperations()})),a(n)}},this.moveForward=function(e){for(var t,n=0,s=i();e&&y.length;)t=y.pop(),b.push(t),r(t),--e,n+=1;return n&&(g=b[b.length-1],o(),a(s)),n},this.moveBackward=function(e){for(var t=0,n=i();e&&b.length;)y.push(b.pop()),--e,t+=1;return t&&(p.getMemberIds().forEach(function(e){p.hasCursor(e)&&p.removeCursor(e)}),p.setDocumentElement(c.cloneNode(!0)),x.emit(gui.TrivialUndoManager.signalDocumentRootReplaced,{}),r(h),b.forEach(r),g=b[b.length-1]||h,o(),a(n)),t},g=h=new t(w),m=g.getNextStateId()},gui.TrivialUndoManager.signalDocumentRootReplaced="documentRootReplaced"}(),odf.GraphicProperties=function(e,t,n){var i=this,r=odf.Namespaces.stylens,o=odf.Namespaces.svgns;this.verticalPos=function(){return i.data.value("verticalPos")},this.verticalRel=function(){return i.data.value("verticalRel")},this.horizontalPos=function(){return i.data.value("horizontalPos")},this.horizontalRel=function(){return i.data.value("horizontalRel")},this.strokeWidth=function(){return i.data.value("strokeWidth")},i.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{verticalPos:function(){var t=e.getAttributeNS(r,"vertical-pos");return""===t?void 0:t},verticalRel:function(){var t=e.getAttributeNS(r,"vertical-rel");return""===t?void 0:t},horizontalPos:function(){var t=e.getAttributeNS(r,"horizontal-pos");return""===t?void 0:t},horizontalRel:function(){var t=e.getAttributeNS(r,"horizontal-rel");return""===t?void 0:t},strokeWidth:function(){var n=e.getAttributeNS(o,"stroke-width");return t.parseLength(n)}})},odf.ComputedGraphicProperties=function(){var e;this.setGraphicProperties=function(t){e=t},this.verticalPos=function(){return e&&e.verticalPos()||"from-top"},this.verticalRel=function(){return e&&e.verticalRel()||"page"},this.horizontalPos=function(){return e&&e.horizontalPos()||"from-left"},this.horizontalRel=function(){return e&&e.horizontalRel()||"page"}},odf.PageLayoutProperties=function(e,t,n){var i=this,r=odf.Namespaces.fons;this.pageHeight=function(){return i.data.value("pageHeight")||1123},this.pageWidth=function(){return i.data.value("pageWidth")||794},i.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{pageHeight:function(){var n;return e&&(n=e.getAttributeNS(r,"page-height"),n=t.parseLength(n)),n},pageWidth:function(){var n;return e&&(n=e.getAttributeNS(r,"page-width"),n=t.parseLength(n)),n}})},odf.PageLayout=function(e,t,n){var i=null;e&&(i=t.getPropertiesElement("page-layout-properties",e)),this.pageLayout=new odf.PageLayoutProperties(i,t,n&&n.pageLayout)},odf.PageLayoutCache=function(){},odf.PageLayoutCache.prototype.getPageLayout=function(e){},odf.PageLayoutCache.prototype.getDefaultPageLayout=function(){},odf.ParagraphProperties=function(e,t,n){var i=this,r=odf.Namespaces.fons;this.marginTop=function(){return i.data.value("marginTop")},i.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{marginTop:function(){var i=e.getAttributeNS(r,"margin-top");return t.parsePositiveLengthOrPercent(i,"marginTop",n&&n.data)}})},odf.ComputedParagraphProperties=function(){var e={},t=[];this.setStyleChain=function(n){t=n,e={}},this.marginTop=function(){var n,i;if(e.hasOwnProperty("marginTop"))n=e.marginTop;else{for(i=0;void 0===n&&i<t.length;i+=1)n=t[i].marginTop();e.marginTop=n}return n||0}},odf.TextProperties=function(e,t,n){var i=this,r=odf.Namespaces.fons;this.fontSize=function(){return i.data.value("fontSize")},i.data=new odf.LazyStyleProperties(void 0===n?void 0:n.data,{fontSize:function(){var i=e.getAttributeNS(r,"font-size");return t.parsePositiveLengthOrPercent(i,"fontSize",n&&n.data)}})},odf.ComputedTextProperties=function(){var e={},t=[];this.setStyleChain=function(n){t=n,e={}},this.fontSize=function(){var n,i;if(e.hasOwnProperty("fontSize"))n=e.fontSize;else{for(i=0;void 0===n&&i<t.length;i+=1)n=t[i].fontSize();e.fontSize=n}return n||12}},odf.MasterPage=function(e,t){var n;e?(n=e.getAttributeNS(odf.Namespaces.stylens,"page-layout-name"),this.pageLayout=t.getPageLayout(n)):this.pageLayout=t.getDefaultPageLayout()},odf.MasterPageCache=function(){},odf.MasterPageCache.prototype.getMasterPage=function(e){},odf.StylePileEntry=function(e,t,n,i){this.masterPage=function(){var t=e.getAttributeNS(odf.Namespaces.stylens,"master-page-name"),i=null;return t&&(i=n.getMasterPage(t)),i},function(n){var r=e.getAttributeNS(odf.Namespaces.stylens,"family"),o=null;"graphic"!==r&&"chart"!==r||(n.graphic=void 0===i?void 0:i.graphic,null!==(o=t.getPropertiesElement("graphic-properties",e,o))&&(n.graphic=new odf.GraphicProperties(o,t,n.graphic))),"paragraph"!==r&&"table-cell"!==r&&"graphic"!==r&&"presentation"!==r&&"chart"!==r||(n.paragraph=void 0===i?void 0:i.paragraph,null!==(o=t.getPropertiesElement("paragraph-properties",e,o))&&(n.paragraph=new odf.ParagraphProperties(o,t,n.paragraph))),"text"!==r&&"paragraph"!==r&&"table-cell"!==r&&"graphic"!==r&&"presentation"!==r&&"chart"!==r||(n.text=void 0===i?void 0:i.text,null!==(o=t.getPropertiesElement("text-properties",e,o))&&(n.text=new odf.TextProperties(o,t,n.text)))}(this)},odf.StylePile=function(e,t){function n(n,i){var a,s;return n.hasAttributeNS(o,"parent-style-name")&&(s=n.getAttributeNS(o,"parent-style-name"),-1===i.indexOf(s)&&(a=r(s,i))),new odf.StylePileEntry(n,e,t,a)}var i,r,o=odf.Namespaces.stylens,a={},s={},l={},d={};r=function(e,t){var i,r=l[e];return!r&&(i=a[e])&&(t.push(e),r=n(i,t),l[e]=r),r},this.getStyle=function(e){var t,i=d[e]||l[e],r=[];return i||((t=s[e])||(t=a[e])&&r.push(e),t&&(i=n(t,r))),i},this.addCommonStyle=function(e){var t;e.hasAttributeNS(o,"name")&&(t=e.getAttributeNS(o,"name"),a.hasOwnProperty(t)||(a[t]=e))},this.addAutomaticStyle=function(e){var t;e.hasAttributeNS(o,"name")&&(t=e.getAttributeNS(o,"name"),s.hasOwnProperty(t)||(s[t]=e))},this.setDefaultStyle=function(e){void 0===i&&(i=n(e,[]))},this.getDefaultStyle=function(){return i}},odf.ComputedGraphicStyle=function(){this.text=new odf.ComputedTextProperties,this.paragraph=new odf.ComputedParagraphProperties,this.graphic=new odf.ComputedGraphicProperties},odf.ComputedParagraphStyle=function(){this.text=new odf.ComputedTextProperties,this.paragraph=new odf.ComputedParagraphProperties},odf.ComputedTextStyle=function(){this.text=new odf.ComputedTextProperties},odf.StyleCache=function(e){function t(e,t,n,i){var r;if(t=n.getAttributeNS(t,"class-names"))for(t=t.split(" "),r=0;r<t.length;r+=1)(n=t[r])&&(i.push(e),i.push(n))}function n(e,n){var i=w.getStyleName("paragraph",e);return void 0!==i&&(n.push("paragraph"),n.push(i)),e.namespaceURI!==y||"h"!==e.localName&&"p"!==e.localName||t("paragraph",y,e,n),n}function i(e,t,n){var i,r,o,s,l=[];for(i=0;i<e.length;i+=2)o=e[i],s=e[i+1],void 0!==(s=(o=a[o]).getStyle(s))&&(void 0!==(s=s[t])&&s!==r&&(l.push(s),r=s));return(s=(o=a[n]).getDefaultStyle())&&(void 0!==(s=s[t])&&s!==r&&l.push(s)),l}function r(i,o){var a=w.getStyleName("text",i),s=i.parentNode;return void 0!==a&&(o.push("text"),o.push(a)),"span"===i.localName&&i.namespaceURI===y&&t("text",y,i,o),s&&s!==e?(s.namespaceURI!==y||"p"!==s.localName&&"h"!==s.localName?r(s,o):n(s,o),o):o}function o(e){return e=e.getAttributeNS(x,"family"),a[e]}var a,s,l,d,u,c,h,f,p,m,g,_,v,b=this,y=odf.Namespaces.textns,x=odf.Namespaces.stylens,w=new odf.StyleInfo,S=new odf.StyleParseUtils;this.getComputedGraphicStyle=function(e){var t=[];void 0!==(e=w.getStyleName("graphic",e))&&(t.push("graphic"),t.push(e)),e=t.join("/");var n=d[e];return runtime.assert(0==t.length%2,"Invalid style chain."),void 0===n&&((n=new odf.ComputedGraphicStyle).graphic.setGraphicProperties(i(t,"graphic","graphic")[0]),n.text.setStyleChain(i(t,"text","graphic")),n.paragraph.setStyleChain(i(t,"paragraph","graphic")),d[e]=n),n},this.getComputedParagraphStyle=function(e){var t=(e=n(e,[])).join("/"),r=l[t];return runtime.assert(0==e.length%2,"Invalid style chain."),void 0===r&&((r=new odf.ComputedParagraphStyle).text.setStyleChain(i(e,"text","paragraph")),r.paragraph.setStyleChain(i(e,"paragraph","paragraph")),l[t]=r),r},this.getComputedTextStyle=function(e){var t=(e=r(e,[])).join("/"),n=s[t];return runtime.assert(0==e.length%2,"Invalid style chain."),void 0===n&&((n=new odf.ComputedTextStyle).text.setStyleChain(i(e,"text","text")),s[t]=n),n},this.getPageLayout=function(e){var t=v[e];return t||((t=_[e])?(t=new odf.PageLayout(t,S,g),v[e]=t):t=g),t},this.getDefaultPageLayout=function(){return g},this.getMasterPage=function(e){var t=p[e];return void 0===t&&((t=f[e])?(t=new odf.MasterPage(t,b),p[e]=t):t=null),t},this.getDefaultMasterPage=function(){return m},this.update=function(){var t,n,i=null,r=null;for(s={},l={},d={},f={},p={},v={},_={},u=new odf.StylePile(S,b),c=new odf.StylePile(S,b),h=new odf.StylePile(S,b),a={text:u,paragraph:c,graphic:h},t=e.styles.firstElementChild;t;)t.namespaceURI===x&&((n=o(t))?"style"===t.localName?n.addCommonStyle(t):"default-style"===t.localName&&n.setDefaultStyle(t):"default-page-layout"===t.localName&&(i=t)),t=t.nextElementSibling;for(g=new odf.PageLayout(i,S),t=e.automaticStyles.firstElementChild;t;)t.namespaceURI===x&&((n=o(t))&&"style"===t.localName?n.addAutomaticStyle(t):"page-layout"===t.localName&&(_[t.getAttributeNS(x,"name")]=t)),t=t.nextElementSibling;for(t=e.masterStyles.firstElementChild;t;)t.namespaceURI===x&&"master-page"===t.localName&&(r=r||t,0<(i=(n=t).getAttributeNS(x,"name")).length&&!f.hasOwnProperty(i)&&(f[i]=n)),t=t.nextElementSibling;m=new odf.MasterPage(r,b)}},ops.OperationTransformMatrix=function(){function e(e){e.position+=e.length,e.length*=-1}function t(t){var n=0>t.length;return n&&e(t),n}function n(e,t){var n=[];return e&&["style:parent-style-name","style:next-style-name"].forEach(function(i){e[i]===t&&n.push(i)}),n}function i(e,t){e&&["style:parent-style-name","style:next-style-name"].forEach(function(n){e[n]===t&&delete e[n]})}function r(e){var t={};return Object.keys(e).forEach(function(n){t[n]="object"==typeof e[n]?r(e[n]):e[n]}),t}function o(e,t,n,i){var r,o,a=!1,s=!1,l=[];if(i&&i.attributes&&(l=i.attributes.split(",")),e&&(n||0<l.length)&&Object.keys(e).forEach(function(t){var i,r=e[t];"object"!=typeof r&&(n&&(i=n[t]),void 0!==i?(delete e[t],s=!0,i===r&&(delete n[t],a=!0)):-1!==l.indexOf(t)&&(delete e[t],s=!0))}),t&&t.attributes&&(n||0<l.length)){for(o=t.attributes.split(","),i=0;i<o.length;i+=1)r=o[i],(n&&void 0!==n[r]||l&&-1!==l.indexOf(r))&&(o.splice(i,1),--i,s=!0);0<o.length?t.attributes=o.join(","):delete t.attributes}return{majorChanged:a,minorChanged:s}}function a(e){for(var t in e)if(e.hasOwnProperty(t))return!0;return!1}function s(e){for(var t in e)if(e.hasOwnProperty(t)&&("attributes"!==t||0<e.attributes.length))return!0;return!1}function l(e,t,n,i,r){var l,d=e?e[r]:null,u=t?t[r]:null,c=n?n[r]:null,h=i?i[r]:null;return l=o(d,u,c,h),d&&!a(d)&&delete e[r],u&&!s(u)&&delete t[r],c&&!a(c)&&delete n[r],h&&!s(h)&&delete i[r],l}function d(e,t){return{opSpecsA:[e],opSpecsB:[t]}}var u;u={AddAnnotation:{AddAnnotation:function(e,t,n){var i;return e.position<t.position?(i=e,n=t):t.position<e.position?(i=t,n=e):(i=n?e:t,n=n?t:e),n.position<i.position+i.length&&(i.length+=2),n.position+=2,{opSpecsA:[e],opSpecsB:[t]}},AddCursor:d,AddMember:d,AddStyle:d,ApplyDirectStyling:function(e,t){return e.position<=t.position?t.position+=2:e.position<=t.position+t.length&&(t.length+=2),{opSpecsA:[e],opSpecsB:[t]}},InsertText:function(e,t){return t.position<=e.position?e.position+=t.text.length:(void 0!==e.length&&t.position<=e.position+e.length&&(e.length+=t.text.length),t.position+=2),{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){return t.sourceStartPosition<=e.position?--e.position:(void 0!==e.length&&t.sourceStartPosition<=e.position+e.length&&--e.length,t.sourceStartPosition+=2,e.position<t.destinationStartPosition&&(t.destinationStartPosition+=2)),{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:function(n,i){var r=t(i);return n.position<i.position?i.position+=2:n.position<i.position+i.length&&(i.length+=2),r&&e(i),{opSpecsA:[n],opSpecsB:[i]}},RemoveAnnotation:function(e,t){return e.position<t.position?(t.position<e.position+e.length&&(e.length-=t.length+2),t.position+=2):e.position-=t.length+2,{opSpecsA:[e],opSpecsB:[t]}},RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:function(e,t){var n,i=t.position,r=t.position+t.length,o=[e],a=[t];return e.position<=t.position?t.position+=2:e.position<r&&(t.length=e.position-t.position,n={optype:"RemoveText",memberid:t.memberid,timestamp:t.timestamp,position:e.position+2,length:r-e.position},a.unshift(n)),t.position+t.length<=e.position?(e.position-=t.length,void 0!==e.length&&n&&(e.length=n.length>=e.length?0:e.length-n.length)):void 0!==e.length&&(r<=(n=e.position+e.length)?e.length-=t.length:i<n&&(e.length=i-e.position)),{opSpecsA:o,opSpecsB:a}},SetParagraphStyle:function(e,t){return e.position<t.position&&(t.position+=2),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){return e.position<t.sourceParagraphPosition&&(t.sourceParagraphPosition+=2),t.position<=e.position?e.position+=1:(void 0!==e.length&&t.position<=e.position+e.length&&(e.length+=1),t.position+=2),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},AddCursor:{AddCursor:d,AddMember:d,AddStyle:d,ApplyDirectStyling:d,InsertText:d,MergeParagraph:d,MoveCursor:d,RemoveAnnotation:d,RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:d,SetParagraphStyle:d,SplitParagraph:d,UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},AddMember:{AddStyle:d,ApplyDirectStyling:d,InsertText:d,MergeParagraph:d,MoveCursor:d,RemoveAnnotation:d,RemoveCursor:d,RemoveStyle:d,RemoveText:d,SetParagraphStyle:d,SplitParagraph:d,UpdateMetadata:d,UpdateParagraphStyle:d},AddStyle:{AddStyle:d,ApplyDirectStyling:d,InsertText:d,MergeParagraph:d,MoveCursor:d,RemoveAnnotation:d,RemoveCursor:d,RemoveMember:d,RemoveStyle:function(e,t){var r,o=[e],a=[t];return e.styleFamily===t.styleFamily&&(0<(r=n(e.setProperties,t.styleName)).length&&(r={optype:"UpdateParagraphStyle",memberid:t.memberid,timestamp:t.timestamp,styleName:e.styleName,removedProperties:{attributes:r.join(",")}},a.unshift(r)),i(e.setProperties,t.styleName)),{opSpecsA:o,opSpecsB:a}},RemoveText:d,SetParagraphStyle:d,SplitParagraph:d,UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},ApplyDirectStyling:{ApplyDirectStyling:function(e,t,n){var i,o,s,d,u,c,h,f;return d=[e],s=[t],e.position+e.length<=t.position||e.position>=t.position+t.length||(i=n?e:t,o=n?t:e,e.position===t.position&&e.length===t.length||(c=r(i),h=r(o)),((t=l(o.setProperties,null,i.setProperties,null,"style:text-properties")).majorChanged||t.minorChanged)&&(s=[],e=[],d=i.position+i.length,u=o.position+o.length,o.position<i.position?t.minorChanged&&((f=r(h)).length=i.position-o.position,e.push(f),o.position=i.position,o.length=u-o.position):i.position<o.position&&t.majorChanged&&((f=r(c)).length=o.position-i.position,s.push(f),i.position=o.position,i.length=d-i.position),u>d?t.minorChanged&&((c=h).position=d,c.length=u-d,e.push(c),o.length=d-o.position):d>u&&t.majorChanged&&(c.position=u,c.length=d-u,s.push(c),i.length=u-i.position),i.setProperties&&a(i.setProperties)&&s.push(i),o.setProperties&&a(o.setProperties)&&e.push(o),n?(d=s,s=e):d=e)),{opSpecsA:d,opSpecsB:s}},InsertText:function(e,t){return t.position<=e.position?e.position+=t.text.length:t.position<=e.position+e.length&&(e.length+=t.text.length),{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){var n=e.position,i=e.position+e.length;return n>=t.sourceStartPosition&&--n,i>=t.sourceStartPosition&&--i,e.position=n,e.length=i-n,{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:d,RemoveAnnotation:function(e,t){var n=e.position,i=e.position+e.length,r=t.position+t.length,o=[e],a=[t];return t.position<=n&&i<=r?o=[]:(r<n&&(n-=t.length+2),r<i&&(i-=t.length+2),e.position=n,e.length=i-n),{opSpecsA:o,opSpecsB:a}},RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:function(e,t){var n=e.position+e.length,i=t.position+t.length,r=[e],o=[t];return i<=e.position?e.position-=t.length:t.position<n&&(e.position<t.position?e.length=i<n?e.length-t.length:t.position-e.position:(e.position=t.position,i<n?e.length=n-i:r=[])),{opSpecsA:r,opSpecsB:o}},SetParagraphStyle:d,SplitParagraph:function(e,t){return t.position<e.position?e.position+=1:t.position<e.position+e.length&&(e.length+=1),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},InsertText:{InsertText:function(e,t,n){return e.position<t.position?t.position+=e.text.length:e.position>t.position?e.position+=t.text.length:n?t.position+=e.text.length:e.position+=t.text.length,{opSpecsA:[e],opSpecsB:[t]}},MergeParagraph:function(e,t){return e.position>=t.sourceStartPosition?--e.position:(e.position<t.sourceStartPosition&&(t.sourceStartPosition+=e.text.length),e.position<t.destinationStartPosition&&(t.destinationStartPosition+=e.text.length)),{opSpecsA:[e],opSpecsB:[t]}},MoveCursor:function(n,i){var r=t(i);return n.position<i.position?i.position+=n.text.length:n.position<i.position+i.length&&(i.length+=n.text.length),r&&e(i),{opSpecsA:[n],opSpecsB:[i]}},RemoveAnnotation:function(e,t){var n=e.position,i=t.position+t.length,r=[e],o=[t];return t.position<=n&&n<=i?(r=[],t.length+=e.text.length):i<e.position?e.position-=t.length+2:t.position+=e.text.length,{opSpecsA:r,opSpecsB:o}},RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:function(e,t){var n,i=[e],r=[t];return(n=t.position+t.length)<=e.position?e.position-=t.length:e.position<=t.position?t.position+=e.text.length:(t.length=e.position-t.position,n={optype:"RemoveText",memberid:t.memberid,timestamp:t.timestamp,position:e.position+e.text.length,length:n-e.position},r.unshift(n),e.position=t.position),{opSpecsA:i,opSpecsB:r}},SetParagraphStyle:function(e,t){return t.position>e.position&&(t.position+=e.text.length),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){return e.position<t.sourceParagraphPosition&&(t.sourceParagraphPosition+=e.text.length),e.position<=t.position?t.position+=e.text.length:e.position+=1,{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},MergeParagraph:{MergeParagraph:function(e,t,n){var i,r=[e],o=[t];return e.destinationStartPosition===t.destinationStartPosition?(r=[],o=[],e.moveCursor&&(i={optype:"MoveCursor",memberid:e.memberid,timestamp:e.timestamp,position:e.sourceStartPosition-1},r.push(i)),t.moveCursor&&(i={optype:"MoveCursor",memberid:t.memberid,timestamp:t.timestamp,position:t.sourceStartPosition-1},o.push(i)),e={optype:"SetParagraphStyle",memberid:(e=n?e:t).memberid,timestamp:e.timestamp,position:e.destinationStartPosition,styleName:e.paragraphStyleName},n?r.push(e):o.push(e)):t.sourceStartPosition===e.destinationStartPosition?(e.destinationStartPosition=t.destinationStartPosition,--e.sourceStartPosition,e.paragraphStyleName=t.paragraphStyleName):e.sourceStartPosition===t.destinationStartPosition?(t.destinationStartPosition=e.destinationStartPosition,--t.sourceStartPosition,t.paragraphStyleName=e.paragraphStyleName):e.destinationStartPosition<t.destinationStartPosition?(--t.destinationStartPosition,--t.sourceStartPosition):(--e.destinationStartPosition,--e.sourceStartPosition),{opSpecsA:r,opSpecsB:o}},MoveCursor:function(e,t){var n=t.position,i=t.position+t.length,r=Math.min(n,i);n=Math.max(n,i);return r>=e.sourceStartPosition&&--r,n>=e.sourceStartPosition&&--n,0<=t.length?(t.position=r,t.length=n-r):(t.position=n,t.length=r-n),{opSpecsA:[e],opSpecsB:[t]}},RemoveAnnotation:function(e,t){var n=t.position+t.length,i=[e],r=[t];return t.position<=e.destinationStartPosition&&e.sourceStartPosition<=n?(i=[],--t.length):e.sourceStartPosition<t.position?--t.position:(n<e.destinationStartPosition&&(e.destinationStartPosition-=t.length+2),n<e.sourceStartPosition&&(e.sourceStartPosition-=t.length+2)),{opSpecsA:i,opSpecsB:r}},RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:function(e,t){return t.position>=e.sourceStartPosition?--t.position:(t.position<e.destinationStartPosition&&(e.destinationStartPosition-=t.length),t.position<e.sourceStartPosition&&(e.sourceStartPosition-=t.length)),{opSpecsA:[e],opSpecsB:[t]}},SetParagraphStyle:function(e,t){var n=[e],i=[t];return t.position>e.sourceStartPosition?--t.position:t.position!==e.destinationStartPosition&&t.position!==e.sourceStartPosition||(t.position=e.destinationStartPosition,e.paragraphStyleName=t.styleName),{opSpecsA:n,opSpecsB:i}},SplitParagraph:function(e,t){var n,i=[e],r=[t];return t.position<e.destinationStartPosition?(e.destinationStartPosition+=1,e.sourceStartPosition+=1):t.position>=e.destinationStartPosition&&t.position<e.sourceStartPosition?(t.paragraphStyleName=e.paragraphStyleName,n={optype:"SetParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,position:e.destinationStartPosition,styleName:e.paragraphStyleName},i.push(n),t.position===e.sourceStartPosition-1&&e.moveCursor&&(n={optype:"MoveCursor",memberid:e.memberid,timestamp:e.timestamp,position:t.position,length:0},i.push(n)),e.destinationStartPosition=t.position+1,e.sourceStartPosition+=1):t.position>=e.sourceStartPosition&&(--t.position,--t.sourceParagraphPosition),{opSpecsA:i,opSpecsB:r}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},MoveCursor:{MoveCursor:d,RemoveAnnotation:function(n,i){var r=t(n),o=n.position+n.length,a=i.position+i.length;return i.position<=n.position&&o<=a?(n.position=i.position-1,n.length=0):(a<n.position?n.position-=i.length+2:a<o&&(n.length-=i.length+2),r&&e(n)),{opSpecsA:[n],opSpecsB:[i]}},RemoveCursor:function(e,t){return{opSpecsA:e.memberid===t.memberid?[]:[e],opSpecsB:[t]}},RemoveMember:d,RemoveStyle:d,RemoveText:function(n,i){var r=t(n),o=n.position+n.length,a=i.position+i.length;return a<=n.position?n.position-=i.length:i.position<o&&(n.position<i.position?n.length=a<o?n.length-i.length:i.position-n.position:(n.position=i.position,n.length=a<o?o-a:0)),r&&e(n),{opSpecsA:[n],opSpecsB:[i]}},SetParagraphStyle:d,SplitParagraph:function(n,i){var r=t(n);return i.position<n.position?n.position+=1:i.position<n.position+n.length&&(n.length+=1),r&&e(n),{opSpecsA:[n],opSpecsB:[i]}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},RemoveAnnotation:{RemoveAnnotation:function(e,t){var n=[e],i=[t];return e.position===t.position&&e.length===t.length?(n=[],i=[]):e.position<t.position?t.position-=e.length+2:e.position-=t.length+2,{opSpecsA:n,opSpecsB:i}},RemoveCursor:d,RemoveMember:d,RemoveStyle:d,RemoveText:function(e,t){var n=e.position+e.length,i=t.position+t.length,r=[e],o=[t];return e.position<=t.position&&i<=n?(o=[],e.length-=t.length):i<e.position?e.position-=t.length:t.position<e.position?(e.position=t.position+1,t.length-=e.length+2):t.position-=e.length+2,{opSpecsA:r,opSpecsB:o}},SetParagraphStyle:function(e,t){var n=t.position,i=e.position+e.length,r=[e],o=[t];return e.position<=n&&n<=i?o=[]:i<n&&(t.position-=e.length+2),{opSpecsA:r,opSpecsB:o}},SplitParagraph:function(e,t){var n=t.position,i=e.position+e.length,r=[e],o=[t];return e.position<=n&&n<=i?(o=[],e.length+=1):(i<t.sourceParagraphPosition&&(t.sourceParagraphPosition-=e.length+2),i<n?t.position-=e.length+2:e.position+=1),{opSpecsA:r,opSpecsB:o}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},RemoveCursor:{RemoveCursor:function(e,t){var n=e.memberid===t.memberid;return{opSpecsA:n?[]:[e],opSpecsB:n?[]:[t]}},RemoveMember:d,RemoveStyle:d,RemoveText:d,SetParagraphStyle:d,SplitParagraph:d,UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},RemoveMember:{RemoveStyle:d,RemoveText:d,SetParagraphStyle:d,SplitParagraph:d,UpdateMetadata:d,UpdateParagraphStyle:d},RemoveStyle:{RemoveStyle:function(e,t){var n=e.styleName===t.styleName&&e.styleFamily===t.styleFamily;return{opSpecsA:n?[]:[e],opSpecsB:n?[]:[t]}},RemoveText:d,SetParagraphStyle:function(e,t){var n,i=[e],r=[t];return"paragraph"===e.styleFamily&&e.styleName===t.styleName&&(n={optype:"SetParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,position:t.position,styleName:""},i.unshift(n),t.styleName=""),{opSpecsA:i,opSpecsB:r}},SplitParagraph:d,UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:function(e,t){var r,o=[e],a=[t];return"paragraph"===e.styleFamily&&(0<(r=n(t.setProperties,e.styleName)).length&&(r={optype:"UpdateParagraphStyle",memberid:e.memberid,timestamp:e.timestamp,styleName:t.styleName,removedProperties:{attributes:r.join(",")}},o.unshift(r)),e.styleName===t.styleName?a=[]:i(t.setProperties,e.styleName)),{opSpecsA:o,opSpecsB:a}}},RemoveText:{RemoveText:function(e,t){var n=e.position+e.length,i=t.position+t.length,r=[e],o=[t];return i<=e.position?e.position-=t.length:n<=t.position?t.position-=e.length:t.position<n&&(e.position<t.position?(e.length=i<n?e.length-t.length:t.position-e.position,n<i?(t.position=e.position,t.length=i-n):o=[]):(n<i?t.length-=e.length:t.position<e.position?t.length=e.position-t.position:o=[],i<n?(e.position=t.position,e.length=n-i):r=[])),{opSpecsA:r,opSpecsB:o}},SetParagraphStyle:function(e,t){return e.position<t.position&&(t.position-=e.length),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){var n=e.position+e.length,i=[e],r=[t];return t.position<=e.position?e.position+=1:t.position<n&&(e.length=t.position-e.position,n={optype:"RemoveText",memberid:e.memberid,timestamp:e.timestamp,position:t.position+1,length:n-t.position},i.unshift(n)),e.position+e.length<=t.position?t.position-=e.length:e.position<t.position&&(t.position=e.position),e.position+e.length<t.sourceParagraphPosition&&(t.sourceParagraphPosition-=e.length),{opSpecsA:i,opSpecsB:r}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},SetParagraphStyle:{SetParagraphStyle:function(e,t,n){return e.position===t.position&&(n?t.styleName=e.styleName:e.styleName=t.styleName),{opSpecsA:[e],opSpecsB:[t]}},SplitParagraph:function(e,t){var n,i=[e],o=[t];return e.position>t.position?e.position+=1:e.position===t.sourceParagraphPosition&&(t.paragraphStyleName=e.styleName,(n=r(e)).position=t.position+1,i.push(n)),{opSpecsA:i,opSpecsB:o}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},SplitParagraph:{SplitParagraph:function(e,t,n){var i,r;return e.position<t.position?i=!0:t.position<e.position?r=!0:e.position===t.position&&(n?i=!0:r=!0),i?(t.position+=1,t.sourceParagraphPosition=e.position<t.sourceParagraphPosition?t.sourceParagraphPosition+1:e.position+1):r&&(e.position+=1,e.sourceParagraphPosition=t.position<t.sourceParagraphPosition?e.sourceParagraphPosition+1:t.position+1),{opSpecsA:[e],opSpecsB:[t]}},UpdateMember:d,UpdateMetadata:d,UpdateParagraphStyle:d},UpdateMember:{UpdateMetadata:d,UpdateParagraphStyle:d},UpdateMetadata:{UpdateMetadata:function(e,t,n){var i,r=[e],l=[t];return i=n?e:t,o((e=n?t:e).setProperties||null,e.removedProperties||null,i.setProperties||null,i.removedProperties||null),i.setProperties&&a(i.setProperties)||i.removedProperties&&s(i.removedProperties)||(n?r=[]:l=[]),e.setProperties&&a(e.setProperties)||e.removedProperties&&s(e.removedProperties)||(n?l=[]:r=[]),{opSpecsA:r,opSpecsB:l}},UpdateParagraphStyle:d},UpdateParagraphStyle:{UpdateParagraphStyle:function(e,t,n){var i,r=[e],d=[t];return e.styleName===t.styleName&&(i=n?e:t,l((e=n?t:e).setProperties,e.removedProperties,i.setProperties,i.removedProperties,"style:paragraph-properties"),l(e.setProperties,e.removedProperties,i.setProperties,i.removedProperties,"style:text-properties"),o(e.setProperties||null,e.removedProperties||null,i.setProperties||null,i.removedProperties||null),i.setProperties&&a(i.setProperties)||i.removedProperties&&s(i.removedProperties)||(n?r=[]:d=[]),e.setProperties&&a(e.setProperties)||e.removedProperties&&s(e.removedProperties)||(n?d=[]:r=[])),{opSpecsA:r,opSpecsB:d}}}},this.passUnchanged=d,this.extendTransformations=function(e){Object.keys(e).forEach(function(t){var n,i=e[t],r=u.hasOwnProperty(t);runtime.log((r?"Extending":"Adding")+" map for optypeA: "+t),r||(u[t]={}),n=u[t],Object.keys(i).forEach(function(e){var r=n.hasOwnProperty(e);runtime.assert(t<=e,"Wrong order:"+t+", "+e),runtime.log("  "+(r?"Overwriting":"Adding")+" entry for optypeB: "+e),n[e]=i[e]})})},this.transformOpspecVsOpspec=function(e,t){var n,i=e.optype<=t.optype;return runtime.log("Crosstransforming:"),runtime.log(runtime.toJson(e)),runtime.log(runtime.toJson(t)),i||(n=e,e=t,t=n),(n=(n=u[e.optype])&&n[t.optype])?(n=n(e,t,!i),i||null===n||(n={opSpecsA:n.opSpecsB,opSpecsB:n.opSpecsA})):n=null,runtime.log("result:"),n?(runtime.log(runtime.toJson(n.opSpecsA)),runtime.log(runtime.toJson(n.opSpecsB))):runtime.log("null"),n}},ops.OperationTransformer=function(){function e(n,i){for(var r,o,a=[],s=[];0<n.length&&i;){if(r=n.shift(),!(r=t.transformOpspecVsOpspec(r,i)))return null;if(a=a.concat(r.opSpecsA),0===r.opSpecsB.length){a=a.concat(n),i=null;break}for(;1<r.opSpecsB.length;){if(!(o=e(n,r.opSpecsB.shift())))return null;s=s.concat(o.opSpecsB),n=o.opSpecsA}i=r.opSpecsB.pop()}return i&&s.push(i),{opSpecsA:a,opSpecsB:s}}var t=new ops.OperationTransformMatrix;this.getOperationTransformMatrix=function(){return t},this.transform=function(t,n){for(var i,r=[];0<n.length;){if(!(i=e(t,n.shift())))return null;t=i.opSpecsA,r=r.concat(i.opSpecsB)}return{opSpecsA:t,opSpecsB:r}}};var webodf_css='@namespace draw url(urn:oasis:names:tc:opendocument:xmlns:drawing:1.0);@namespace fo url(urn:oasis:names:tc:opendocument:xmlns:xsl-fo-compatible:1.0);@namespace office url(urn:oasis:names:tc:opendocument:xmlns:office:1.0);@namespace presentation url(urn:oasis:names:tc:opendocument:xmlns:presentation:1.0);@namespace style url(urn:oasis:names:tc:opendocument:xmlns:style:1.0);@namespace svg url(urn:oasis:names:tc:opendocument:xmlns:svg-compatible:1.0);@namespace table url(urn:oasis:names:tc:opendocument:xmlns:table:1.0);@namespace text url(urn:oasis:names:tc:opendocument:xmlns:text:1.0);@namespace webodfhelper url(urn:webodf:names:helper);@namespace cursor url(urn:webodf:names:cursor);@namespace editinfo url(urn:webodf:names:editinfo);@namespace annotation url(urn:webodf:names:annotation);@namespace dc url(http://purl.org/dc/elements/1.1/);@namespace svgns url(http://www.w3.org/2000/svg);office|document > *, office|document-content > * {display: none;}office|body, office|document {display: inline-block;position: relative;}text|p, text|h {display: block;padding: 0;margin: 0;line-height: normal;position: relative;}text|p::after, text|h::after {content: "\\200B";white-space: pre;}*[webodfhelper|containsparagraphanchor] {position: relative;}text|s {white-space: pre;}text|tab {display: inline;white-space: pre;}text|tracked-changes {display: none;}office|binary-data {display: none;}office|text {display: block;text-align: left;overflow: visible;word-wrap: break-word;}office|text::selection {background: transparent;}.webodf-virtualSelections *::selection {background: transparent;}.webodf-virtualSelections *::-moz-selection {background: transparent;}office|text * draw|text-box {display: block;border: 1px solid #d3d3d3;}office|text draw|frame {z-index: 1;}office|spreadsheet {display: block;border-collapse: collapse;empty-cells: show;font-family: sans-serif;font-size: 10pt;text-align: left;page-break-inside: avoid;overflow: hidden;}office|presentation {display: inline-block;text-align: left;}#shadowContent {display: inline-block;text-align: left;}draw|page {display: block;position: relative;overflow: hidden;}presentation|notes, presentation|footer-decl, presentation|date-time-decl {display: none;}@media print {draw|page {border: 1pt solid black;page-break-inside: avoid;}presentation|notes {}}office|spreadsheet text|p {border: 0px;padding: 1px;margin: 0px;}office|spreadsheet table|table {margin: 3px;}office|spreadsheet table|table:after {}office|spreadsheet table|table-row {counter-increment: row;}office|spreadsheet table|table-row:before {width: 3em;background: #cccccc;border: 1px solid black;text-align: center;content: counter(row);display: table-cell;}office|spreadsheet table|table-cell {border: 1px solid #cccccc;}table|table {display: table;}draw|frame table|table {width: 100%;height: 100%;background: white;}table|table-header-rows {display: table-header-group;}table|table-row {display: table-row;}table|table-column {display: table-column;}table|table-cell {width: 0.889in;display: table-cell;word-break: break-all;}draw|frame {display: block;}draw|image {display: block;width: 100%;height: 100%;top: 0px;left: 0px;background-repeat: no-repeat;background-size: 100% 100%;-moz-background-size: 100% 100%;}draw|frame > draw|image:nth-of-type(n+2) {display: none;}text|list:before {display: none;content:"";}text|list {display: block;}text|list-item {display: block;}text|number {display:none;}text|a {color: blue;text-decoration: underline;cursor: pointer;}.webodf-inactiveLinks text|a {cursor: text;}text|note-citation {vertical-align: super;font-size: smaller;}text|note-body {display: none;}text|note:hover text|note-citation {background: #dddddd;}text|note:hover text|note-body {display: block;left:1em;max-width: 80%;position: absolute;background: #ffffaa;}text|bibliography-source {display: none;}svg|title, svg|desc {display: none;}video {width: 100%;height: 100%}cursor|anchor {display: none;}cursor|cursor {display: none;}.webodf-caretOverlay {position: absolute;top: 5%;height: 1em;z-index: 10;padding-left: 1px;pointer-events: none;}.webodf-caretOverlay .caret {position: absolute;border-left: 2px solid black;top: 0;bottom: 0;right: 0;}.webodf-caretOverlay .handle {position: absolute;margin-top: 5px;padding-top: 3px;margin-left: auto;margin-right: auto;width: 64px;height: 68px;border-radius: 5px;opacity: 0.3;text-align: center;background-color: black;box-shadow: 0px 0px 5px rgb(90, 90, 90);border: 1px solid black;top: -85px;right: -32px;}.webodf-caretOverlay .handle > img {box-shadow: 0px 0px 5px rgb(90, 90, 90) inset;background-color: rgb(200, 200, 200);border-radius: 5px;border: 2px solid;height: 60px;width: 60px;display: block;margin: auto;}.webodf-caretOverlay .handle.active {opacity: 0.8;}.webodf-caretOverlay .handle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 43%;}.webodf-caretSizer {display: inline-block;width: 0;visibility: hidden;}#eventTrap {display: block;position: absolute;bottom: 0;left: 0;outline: none;opacity: 0;color: rgba(255, 255, 255, 0);pointer-events: none;white-space: pre;overflow: hidden;}cursor|cursor > #composer {text-decoration: underline;}cursor|cursor[cursor|caret-sizer-active="true"],cursor|cursor[cursor|composing="true"] {display: inline;}editinfo|editinfo {display: inline-block;}.editInfoMarker {position: absolute;width: 10px;height: 100%;left: -20px;opacity: 0.8;top: 0;border-radius: 5px;background-color: transparent;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);}.editInfoMarker:hover {box-shadow: 0px 0px 8px rgba(0, 0, 0, 1);}.editInfoHandle {position: absolute;background-color: black;padding: 5px;border-radius: 5px;opacity: 0.8;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);bottom: 100%;margin-bottom: 10px;z-index: 3;left: -25px;}.editInfoHandle:after {content: " ";position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: black transparent transparent transparent;top: 100%;left: 5px;}.editInfo {font-family: sans-serif;font-weight: normal;font-style: normal;text-decoration: none;color: white;width: 100%;height: 12pt;}.editInfoColor {float: left;width: 10pt;height: 10pt;border: 1px solid white;}.editInfoAuthor {float: left;margin-left: 5pt;font-size: 10pt;text-align: left;height: 12pt;line-height: 12pt;}.editInfoTime {float: right;margin-left: 30pt;font-size: 8pt;font-style: italic;color: yellow;height: 12pt;line-height: 12pt;}.annotationWrapper {display: inline;position: relative;}.annotationRemoveButton:before {content: "\xd7";color: white;padding: 5px;line-height: 1em;}.annotationRemoveButton {width: 20px;height: 20px;border-radius: 10px;background-color: black;box-shadow: 0px 0px 5px rgba(50, 50, 50, 0.75);position: absolute;top: -10px;left: -10px;z-index: 3;text-align: center;font-family: sans-serif;font-style: normal;font-weight: normal;text-decoration: none;font-size: 15px;}.annotationRemoveButton:hover {cursor: pointer;box-shadow: 0px 0px 5px rgba(0, 0, 0, 1);}.annotationNote {width: 4cm;position: absolute;display: inline;z-index: 10;top: 0;}.annotationNote > office|annotation {display: block;text-align: left;}.annotationConnector {position: absolute;display: inline;top: 0;z-index: 2;border-top: 1px dashed brown;}.annotationConnector.angular {-moz-transform-origin: left top;-webkit-transform-origin: left top;-ms-transform-origin: left top;transform-origin: left top;}.annotationConnector.horizontal {left: 0;}.annotationConnector.horizontal:before {content: "";display: inline;position: absolute;width: 0px;height: 0px;border-style: solid;border-width: 8.7px 5px 0 5px;border-color: brown transparent transparent transparent;top: -1px;left: -5px;}office|annotation {width: 100%;height: 100%;display: none;background: rgb(198, 238, 184);background: -moz-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -webkit-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -o-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: -ms-linear-gradient(90deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);background: linear-gradient(180deg, rgb(198, 238, 184) 30%, rgb(180, 196, 159) 100%);box-shadow: 0 3px 4px -3px #ccc;}office|annotation > dc|creator {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;color: white;background-color: brown;padding: 4px;}office|annotation > dc|date {display: block;font-size: 10pt;font-weight: normal;font-style: normal;font-family: sans-serif;border: 4px solid transparent;color: black;}office|annotation > text|list {display: block;padding: 5px;}office|annotation text|p {font-size: 10pt;color: black;font-weight: normal;font-style: normal;text-decoration: none;font-family: sans-serif;}#annotationsPane {background-color: #EAEAEA;width: 4cm;height: 100%;display: none;position: absolute;outline: 1px solid #ccc;}.webodf-annotationHighlight {background-color: yellow;position: relative;}.webodf-selectionOverlay {position: absolute;pointer-events: none;top: 0;left: 0;top: 0;left: 0;width: 100%;height: 100%;z-index: 15;}.webodf-selectionOverlay > polygon {fill-opacity: 0.3;stroke-opacity: 0.8;stroke-width: 1;fill-rule: evenodd;}.webodf-selectionOverlay > .webodf-draggable {fill-opacity: 0.8;stroke-opacity: 0;stroke-width: 8;pointer-events: all;display: none;-moz-transform-origin: center center;-webkit-transform-origin: center center;-ms-transform-origin: center center;transform-origin: center center;}#imageSelector {display: none;position: absolute;border-style: solid;border-color: black;}#imageSelector > div {width: 5px;height: 5px;display: block;position: absolute;border: 1px solid black;background-color: #ffffff;}#imageSelector > .topLeft {top: -4px;left: -4px;}#imageSelector > .topRight {top: -4px;right: -4px;}#imageSelector > .bottomRight {right: -4px;bottom: -4px;}#imageSelector > .bottomLeft {bottom: -4px;left: -4px;}#imageSelector > .topMiddle {top: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .rightMiddle {top: 50%;right: -4px;margin-top: -2.5px;}#imageSelector > .bottomMiddle {bottom: -4px;left: 50%;margin-left: -2.5px;}#imageSelector > .leftMiddle {top: 50%;left: -4px;margin-top: -2.5px;}div.webodf-customScrollbars::-webkit-scrollbar{width: 8px;height: 8px;background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-track{background-color: transparent;}div.webodf-customScrollbars::-webkit-scrollbar-thumb{background-color: #444;border-radius: 4px;}.webodf-hyperlinkTooltip {display: none;color: white;background-color: black;border-radius: 5px;box-shadow: 2px 2px 5px gray;padding: 3px;position: absolute;max-width: 210px;text-align: left;word-break: break-all;z-index: 16;}.webodf-hyperlinkTooltipText {display: block;font-weight: bold;}';
/*

 @licstart
JSZip - A Javascript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2014 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/master/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/master/LICENSE
 @licend
*/!function(e){var t="undefined"!=typeof window?window:"undefined"!=typeof global?global:{};(t.externs||(t.externs={})).JSZip=function e(t,n,i){function r(a,s){if(!n[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(o)return o(a,!0);throw new Error("Cannot find module '"+a+"'")}var d=n[a]={exports:{}};t[a][0].call(d.exports,function(e){var n=t[a][1][e];return r(n||e)},d,d.exports,e,t,n,i)}return n[a].exports}for(var o="function"==typeof require&&require,a=0;a<i.length;a++)r(i[a]);return r}({1:[function(e,t,n){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";n.encode=function(e,t){for(var n,r,o,a,s,l,d,u="",c=0;c<e.length;)a=(n=e.charCodeAt(c++))>>2,s=(3&n)<<4|(r=e.charCodeAt(c++))>>4,l=(15&r)<<2|(o=e.charCodeAt(c++))>>6,d=63&o,isNaN(r)?l=d=64:isNaN(o)&&(d=64),u=u+i.charAt(a)+i.charAt(s)+i.charAt(l)+i.charAt(d);return u},n.decode=function(e,t){var n,r,o,a,s,l,d="",u=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");u<e.length;)n=i.indexOf(e.charAt(u++))<<2|(a=i.indexOf(e.charAt(u++)))>>4,r=(15&a)<<4|(s=i.indexOf(e.charAt(u++)))>>2,o=(3&s)<<6|(l=i.indexOf(e.charAt(u++))),d+=String.fromCharCode(n),64!=s&&(d+=String.fromCharCode(r)),64!=l&&(d+=String.fromCharCode(o));return d}},{}],2:[function(e,t,n){function i(){this.compressedSize=0,this.uncompressedSize=0,this.crc32=0,this.compressionMethod=null,this.compressedContent=null}i.prototype={getContent:function(){return null},getCompressedContent:function(){return null}},t.exports=i},{}],3:[function(e,t,n){n.STORE={magic:"\0\0",compress:function(e){return e},uncompress:function(e){return e},compressInputType:null,uncompressInputType:null},n.DEFLATE=e("./flate")},{"./flate":8}],4:[function(e,t,n){var i=e("./utils"),r=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];t.exports=function(e,t){if(void 0===e||!e.length)return 0;var n="string"!==i.getTypeOf(e);void 0===t&&(t=0);var o=0;t^=-1;for(var a=0,s=e.length;a<s;a++)o=n?e[a]:e.charCodeAt(a),t=t>>>8^r[255&(t^o)];return-1^t}},{"./utils":21}],5:[function(e,t,n){var i=e("./utils");function r(e){this.data=null,this.length=0,this.index=0}r.prototype={checkOffset:function(e){this.checkIndex(this.index+e)},checkIndex:function(e){if(this.length<e||e<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+e+"). Corrupted zip ?")},setIndex:function(e){this.checkIndex(e),this.index=e},skip:function(e){this.setIndex(this.index+e)},byteAt:function(e){},readInt:function(e){var t,n=0;for(this.checkOffset(e),t=this.index+e-1;t>=this.index;t--)n=(n<<8)+this.byteAt(t);return this.index+=e,n},readString:function(e){return i.transformTo("string",this.readData(e))},readData:function(e){},lastIndexOfSignature:function(e){},readDate:function(){var e=this.readInt(4);return new Date(1980+(e>>25&127),(e>>21&15)-1,e>>16&31,e>>11&31,e>>5&63,(31&e)<<1)}},t.exports=r},{"./utils":21}],6:[function(e,t,n){n.base64=!1,n.binary=!1,n.dir=!1,n.createFolders=!1,n.date=null,n.compression=null,n.comment=null},{}],7:[function(e,t,n){var i=e("./utils");n.string2binary=function(e){return i.string2binary(e)},n.string2Uint8Array=function(e){return i.transformTo("uint8array",e)},n.uint8Array2String=function(e){return i.transformTo("string",e)},n.string2Blob=function(e){var t=i.transformTo("arraybuffer",e);return i.arrayBuffer2Blob(t)},n.arrayBuffer2Blob=function(e){return i.arrayBuffer2Blob(e)},n.transformTo=function(e,t){return i.transformTo(e,t)},n.getTypeOf=function(e){return i.getTypeOf(e)},n.checkSupport=function(e){return i.checkSupport(e)},n.MAX_VALUE_16BITS=i.MAX_VALUE_16BITS,n.MAX_VALUE_32BITS=i.MAX_VALUE_32BITS,n.pretty=function(e){return i.pretty(e)},n.findCompression=function(e){return i.findCompression(e)},n.isRegExp=function(e){return i.isRegExp(e)}},{"./utils":21}],8:[function(e,t,n){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array,r=e("pako");n.uncompressInputType=i?"uint8array":"array",n.compressInputType=i?"uint8array":"array",n.magic="\b\0",n.compress=function(e){return r.deflateRaw(e)},n.uncompress=function(e){return r.inflateRaw(e)}},{pako:24}],9:[function(e,t,n){var i=e("./base64");function r(e,t){if(!(this instanceof r))return new r(e,t);this.files={},this.comment=null,this.root="",e&&this.load(e,t),this.clone=function(){var e=new r;for(var t in this)"function"!=typeof this[t]&&(e[t]=this[t]);return e}}r.prototype=e("./object"),r.prototype.load=e("./load"),r.support=e("./support"),r.defaults=e("./defaults"),r.utils=e("./deprecatedPublicUtils"),r.base64={encode:function(e){return i.encode(e)},decode:function(e){return i.decode(e)}},r.compressions=e("./compressions"),t.exports=r},{"./base64":1,"./compressions":3,"./defaults":6,"./deprecatedPublicUtils":7,"./load":10,"./object":13,"./support":17}],10:[function(e,t,n){var i=e("./base64"),r=e("./zipEntries");t.exports=function(e,t){var n,o,a,s;for((t=t||{}).base64&&(e=i.decode(e)),n=(o=new r(e,t)).files,a=0;a<n.length;a++)s=n[a],this.file(s.fileName,s.decompressed,{binary:!0,optimizedBinaryString:!0,date:s.date,dir:s.dir,comment:s.fileComment.length?s.fileComment:null,createFolders:t.createFolders});return o.zipComment.length&&(this.comment=o.zipComment),this}},{"./base64":1,"./zipEntries":22}],11:[function(e,t,n){(function(e){t.exports=function(t,n){return new e(t,n)},t.exports.test=function(t){return e.isBuffer(t)}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],12:[function(e,t,n){var i=e("./uint8ArrayReader");function r(e){this.data=e,this.length=this.data.length,this.index=0}r.prototype=new i,r.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./uint8ArrayReader":18}],13:[function(e,t,n){var i=e("./support"),r=e("./utils"),o=e("./crc32"),a=e("./signature"),s=e("./defaults"),l=e("./base64"),d=e("./compressions"),u=e("./compressedObject"),c=e("./nodeBuffer"),h=e("./utf8"),f=e("./stringWriter"),p=e("./uint8ArrayWriter"),m=function(e){if(e._data instanceof u&&(e._data=e._data.getContent(),e.options.binary=!0,e.options.base64=!1,"uint8array"===r.getTypeOf(e._data))){var t=e._data;e._data=new Uint8Array(t.length),0!==t.length&&e._data.set(t,0)}return e._data},g=function(e){var t=m(e);return"string"===r.getTypeOf(t)?!e.options.binary&&i.nodebuffer?c(t,"utf-8"):e.asBinary():t},_=function(e){var t=m(this);return null==t?"":(this.options.base64&&(t=l.decode(t)),t=e&&this.options.binary?k.utf8decode(t):r.transformTo("string",t),e||this.options.binary||(t=r.transformTo("string",k.utf8encode(t))),t)},v=function(e,t,n){this.name=e,this.dir=n.dir,this.date=n.date,this.comment=n.comment,this._data=t,this.options=n,this._initialMetadata={dir:n.dir,date:n.date}};v.prototype={asText:function(){return _.call(this,!0)},asBinary:function(){return _.call(this,!1)},asNodeBuffer:function(){var e=g(this);return r.transformTo("nodebuffer",e)},asUint8Array:function(){var e=g(this);return r.transformTo("uint8array",e)},asArrayBuffer:function(){return this.asUint8Array().buffer}};var b=function(e,t){var n,i="";for(n=0;n<t;n++)i+=String.fromCharCode(255&e),e>>>=8;return i},y=function(){var e,t,n={};for(e=0;e<arguments.length;e++)for(t in arguments[e])arguments[e].hasOwnProperty(t)&&void 0===n[t]&&(n[t]=arguments[e][t]);return n},x=function(e){return!0!==(e=e||{}).base64||null!==e.binary&&void 0!==e.binary||(e.binary=!0),(e=y(e,s)).date=e.date||new Date,null!==e.compression&&(e.compression=e.compression.toUpperCase()),e},w=function(e,t,n){var i,o=r.getTypeOf(t);if((n=x(n)).createFolders&&(i=S(e))&&N.call(this,i,!0),n.dir||null==t)n.base64=!1,n.binary=!1,t=null;else if("string"===o)n.binary&&!n.base64&&!0!==n.optimizedBinaryString&&(t=r.string2binary(t));else{if(n.base64=!1,n.binary=!0,!(o||t instanceof u))throw new Error("The data of '"+e+"' is in an unsupported format !");"arraybuffer"===o&&(t=r.transformTo("uint8array",t))}var a=new v(e,t,n);return this.files[e]=a,a},S=function(e){"/"==e.slice(-1)&&(e=e.substring(0,e.length-1));var t=e.lastIndexOf("/");return t>0?e.substring(0,t):""},N=function(e,t){return"/"!=e.slice(-1)&&(e+="/"),t=void 0!==t&&t,this.files[e]||w.call(this,e,null,{dir:!0,createFolders:t}),this.files[e]},E=function(e,t){var n,i=new u;return e._data instanceof u?(i.uncompressedSize=e._data.uncompressedSize,i.crc32=e._data.crc32,0===i.uncompressedSize||e.dir?(t=d.STORE,i.compressedContent="",i.crc32=0):e._data.compressionMethod===t.magic?i.compressedContent=e._data.getCompressedContent():(n=e._data.getContent(),i.compressedContent=t.compress(r.transformTo(t.compressInputType,n)))):((n=g(e))&&0!==n.length&&!e.dir||(t=d.STORE,n=""),i.uncompressedSize=n.length,i.crc32=o(n),i.compressedContent=t.compress(r.transformTo(t.compressInputType,n))),i.compressedSize=i.compressedContent.length,i.compressionMethod=t.magic,i},C=function(e,t,n,i){n.compressedContent;var s,l,d,u,c=r.transformTo("string",h.utf8encode(t.name)),f=t.comment||"",p=r.transformTo("string",h.utf8encode(f)),m=c.length!==t.name.length,g=p.length!==f.length,_=t.options,v="",y="",x="";d=t._initialMetadata.dir!==t.dir?t.dir:_.dir,s=(u=t._initialMetadata.date!==t.date?t.date:_.date).getHours(),s<<=6,s|=u.getMinutes(),s<<=5,s|=u.getSeconds()/2,l=u.getFullYear()-1980,l<<=4,l|=u.getMonth()+1,l<<=5,l|=u.getDate(),m&&(y=b(1,1)+b(o(c),4)+c,v+="up"+b(y.length,2)+y),g&&(x=b(1,1)+b(this.crc32(p),4)+p,v+="uc"+b(x.length,2)+x);var w="";return w+="\n\0",w+=m||g?"\0\b":"\0\0",w+=n.compressionMethod,w+=b(s,2),w+=b(l,2),w+=b(n.crc32,4),w+=b(n.compressedSize,4),w+=b(n.uncompressedSize,4),w+=b(c.length,2),w+=b(v.length,2),{fileRecord:a.LOCAL_FILE_HEADER+w+c+v,dirRecord:a.CENTRAL_FILE_HEADER+"\x14\0"+w+b(p.length,2)+"\0\0\0\0"+(!0===d?"\x10\0\0\0":"\0\0\0\0")+b(i,4)+c+v+p,compressedObject:n}},k={load:function(e,t){throw new Error("Load method is not defined. Is the file jszip-load.js included ?")},filter:function(e){var t,n,i,r,o=[];for(t in this.files)this.files.hasOwnProperty(t)&&(i=this.files[t],r=new v(i.name,i._data,y(i.options)),n=t.slice(this.root.length,t.length),t.slice(0,this.root.length)===this.root&&e(n,r)&&o.push(r));return o},file:function(e,t,n){if(1===arguments.length){if(r.isRegExp(e)){var i=e;return this.filter(function(e,t){return!t.dir&&i.test(e)})}return this.filter(function(t,n){return!n.dir&&t===e})[0]||null}return e=this.root+e,w.call(this,e,t,n),this},folder:function(e){if(!e)return this;if(r.isRegExp(e))return this.filter(function(t,n){return n.dir&&e.test(t)});var t=this.root+e,n=N.call(this,t),i=this.clone();return i.root=n.name,i},remove:function(e){e=this.root+e;var t=this.files[e];if(t||("/"!=e.slice(-1)&&(e+="/"),t=this.files[e]),t&&!t.dir)delete this.files[e];else for(var n=this.filter(function(t,n){return n.name.slice(0,e.length)===e}),i=0;i<n.length;i++)delete this.files[n[i].name];return this},generate:function(e){e=y(e||{},{base64:!0,compression:"STORE",type:"base64",comment:null}),r.checkSupport(e.type);var t,n,i=[],o=0,s=0,u=r.transformTo("string",this.utf8encode(e.comment||this.comment||""));for(var c in this.files)if(this.files.hasOwnProperty(c)){var h=this.files[c],m=h.options.compression||e.compression.toUpperCase(),g=d[m];if(!g)throw new Error(m+" is not a valid compression method !");var _=E.call(this,h,g),v=C.call(this,c,h,_,o);o+=v.fileRecord.length+_.compressedSize,s+=v.dirRecord.length,i.push(v)}var x="";x=a.CENTRAL_DIRECTORY_END+"\0\0\0\0"+b(i.length,2)+b(i.length,2)+b(s,4)+b(o,4)+b(u.length,2)+u;var w=e.type.toLowerCase();for(t="uint8array"===w||"arraybuffer"===w||"blob"===w||"nodebuffer"===w?new p(o+s+x.length):new f(o+s+x.length),n=0;n<i.length;n++)t.append(i[n].fileRecord),t.append(i[n].compressedObject.compressedContent);for(n=0;n<i.length;n++)t.append(i[n].dirRecord);t.append(x);var S=t.finalize();switch(e.type.toLowerCase()){case"uint8array":case"arraybuffer":case"nodebuffer":return r.transformTo(e.type.toLowerCase(),S);case"blob":return r.arrayBuffer2Blob(r.transformTo("arraybuffer",S));case"base64":return e.base64?l.encode(S):S;default:return S}},crc32:function(e,t){return o(e,t)},utf8encode:function(e){return r.transformTo("string",h.utf8encode(e))},utf8decode:function(e){return h.utf8decode(e)}};t.exports=k},{"./base64":1,"./compressedObject":2,"./compressions":3,"./crc32":4,"./defaults":6,"./nodeBuffer":11,"./signature":14,"./stringWriter":16,"./support":17,"./uint8ArrayWriter":19,"./utf8":20,"./utils":21}],14:[function(e,t,n){n.LOCAL_FILE_HEADER="PK\x03\x04",n.CENTRAL_FILE_HEADER="PK\x01\x02",n.CENTRAL_DIRECTORY_END="PK\x05\x06",n.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x06\x07",n.ZIP64_CENTRAL_DIRECTORY_END="PK\x06\x06",n.DATA_DESCRIPTOR="PK\x07\b"},{}],15:[function(e,t,n){var i=e("./dataReader"),r=e("./utils");function o(e,t){this.data=e,t||(this.data=r.string2binary(this.data)),this.length=this.data.length,this.index=0}o.prototype=new i,o.prototype.byteAt=function(e){return this.data.charCodeAt(e)},o.prototype.lastIndexOfSignature=function(e){return this.data.lastIndexOf(e)},o.prototype.readData=function(e){this.checkOffset(e);var t=this.data.slice(this.index,this.index+e);return this.index+=e,t},t.exports=o},{"./dataReader":5,"./utils":21}],16:[function(e,t,n){var i=e("./utils"),r=function(){this.data=[]};r.prototype={append:function(e){e=i.transformTo("string",e),this.data.push(e)},finalize:function(){return this.data.join("")}},t.exports=r},{"./utils":21}],17:[function(e,t,n){(function(e){if(n.base64=!0,n.array=!0,n.string=!0,n.arraybuffer="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof Uint8Array,n.nodebuffer=void 0!==e,n.uint8array="undefined"!=typeof Uint8Array,"undefined"==typeof ArrayBuffer)n.blob=!1;else{var t=new ArrayBuffer(0);try{n.blob=0===new Blob([t],{type:"application/zip"}).size}catch(e){try{var i=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);i.append(t),n.blob=0===i.getBlob("application/zip").size}catch(e){n.blob=!1}}}}).call(this,"undefined"!=typeof Buffer?Buffer:void 0)},{}],18:[function(e,t,n){var i=e("./dataReader");function r(e){e&&(this.data=e,this.length=this.data.length,this.index=0)}r.prototype=new i,r.prototype.byteAt=function(e){return this.data[e]},r.prototype.lastIndexOfSignature=function(e){for(var t=e.charCodeAt(0),n=e.charCodeAt(1),i=e.charCodeAt(2),r=e.charCodeAt(3),o=this.length-4;o>=0;--o)if(this.data[o]===t&&this.data[o+1]===n&&this.data[o+2]===i&&this.data[o+3]===r)return o;return-1},r.prototype.readData=function(e){if(this.checkOffset(e),0===e)return new Uint8Array(0);var t=this.data.subarray(this.index,this.index+e);return this.index+=e,t},t.exports=r},{"./dataReader":5}],19:[function(e,t,n){var i=e("./utils"),r=function(e){this.data=new Uint8Array(e),this.index=0};r.prototype={append:function(e){0!==e.length&&(e=i.transformTo("uint8array",e),this.data.set(e,this.index),this.index+=e.length)},finalize:function(){return this.data}},t.exports=r},{"./utils":21}],20:[function(e,t,n){for(var i=e("./utils"),r=e("./support"),o=e("./nodeBuffer"),a=new Array(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;a[254]=a[254]=1;var l=function(e){var t,n,i,o,a,s=e.length,l=0;for(o=0;o<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=r.uint8array?new Uint8Array(l):new Array(l),a=0,o=0;a<l;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(i=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(i-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},d=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t},u=function(e){var t,n,r,o,s=e.length,l=new Array(2*s);for(n=0,t=0;t<s;)if((r=e[t++])<128)l[n++]=r;else if((o=a[r])>4)l[n++]=65533,t+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&t<s;)r=r<<6|63&e[t++],o--;o>1?l[n++]=65533:r<65536?l[n++]=r:(r-=65536,l[n++]=55296|r>>10&1023,l[n++]=56320|1023&r)}return l.length!==n&&(l.subarray?l=l.subarray(0,n):l.length=n),i.applyFromCharCode(l)};n.utf8encode=function(e){return r.nodebuffer?o(e,"utf-8"):l(e)},n.utf8decode=function(e){if(r.nodebuffer)return i.transformTo("nodebuffer",e).toString("utf-8");for(var t=[],n=0,o=(e=i.transformTo(r.uint8array?"uint8array":"array",e)).length,a=65536;n<o;){var s=d(e,Math.min(n+a,o));r.uint8array?t.push(u(e.subarray(n,s))):t.push(u(e.slice(n,s))),n=s}return t.join("")}},{"./nodeBuffer":11,"./support":17,"./utils":21}],21:[function(e,t,n){var i=e("./support"),r=e("./compressions"),o=e("./nodeBuffer");function a(e){return e}function s(e,t){for(var n=0;n<e.length;++n)t[n]=255&e.charCodeAt(n);return t}function l(e){var t=65536,i=[],r=e.length,a=n.getTypeOf(e),s=0,l=!0;try{switch(a){case"uint8array":String.fromCharCode.apply(null,new Uint8Array(0));break;case"nodebuffer":String.fromCharCode.apply(null,o(0))}}catch(e){l=!1}if(!l){for(var d="",u=0;u<e.length;u++)d+=String.fromCharCode(e[u]);return d}for(;s<r&&t>1;)try{"array"===a||"nodebuffer"===a?i.push(String.fromCharCode.apply(null,e.slice(s,Math.min(s+t,r)))):i.push(String.fromCharCode.apply(null,e.subarray(s,Math.min(s+t,r)))),s+=t}catch(e){t=Math.floor(t/2)}return i.join("")}function d(e,t){for(var n=0;n<e.length;n++)t[n]=e[n];return t}n.string2binary=function(e){for(var t="",n=0;n<e.length;n++)t+=String.fromCharCode(255&e.charCodeAt(n));return t},n.arrayBuffer2Blob=function(e){n.checkSupport("blob");try{return new Blob([e],{type:"application/zip"})}catch(n){try{var t=new(window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder);return t.append(e),t.getBlob("application/zip")}catch(e){throw new Error("Bug : can't construct the Blob.")}}},n.applyFromCharCode=l;var u={};u.string={string:a,array:function(e){return s(e,new Array(e.length))},arraybuffer:function(e){return u.string.uint8array(e).buffer},uint8array:function(e){return s(e,new Uint8Array(e.length))},nodebuffer:function(e){return s(e,o(e.length))}},u.array={string:l,array:a,arraybuffer:function(e){return new Uint8Array(e).buffer},uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o(e)}},u.arraybuffer={string:function(e){return l(new Uint8Array(e))},array:function(e){return d(new Uint8Array(e),new Array(e.byteLength))},arraybuffer:a,uint8array:function(e){return new Uint8Array(e)},nodebuffer:function(e){return o(new Uint8Array(e))}},u.uint8array={string:l,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return e.buffer},uint8array:a,nodebuffer:function(e){return o(e)}},u.nodebuffer={string:l,array:function(e){return d(e,new Array(e.length))},arraybuffer:function(e){return u.nodebuffer.uint8array(e).buffer},uint8array:function(e){return d(e,new Uint8Array(e.length))},nodebuffer:a},n.transformTo=function(e,t){if(t||(t=""),!e)return t;n.checkSupport(e);var i=n.getTypeOf(t);return u[i][e](t)},n.getTypeOf=function(e){return"string"==typeof e?"string":"[object Array]"===Object.prototype.toString.call(e)?"array":i.nodebuffer&&o.test(e)?"nodebuffer":i.uint8array&&e instanceof Uint8Array?"uint8array":i.arraybuffer&&e instanceof ArrayBuffer?"arraybuffer":void 0},n.checkSupport=function(e){if(!i[e.toLowerCase()])throw new Error(e+" is not supported by this browser")},n.MAX_VALUE_16BITS=65535,n.MAX_VALUE_32BITS=-1,n.pretty=function(e){var t,n,i="";for(n=0;n<(e||"").length;n++)i+="\\x"+((t=e.charCodeAt(n))<16?"0":"")+t.toString(16).toUpperCase();return i},n.findCompression=function(e){for(var t in r)if(r.hasOwnProperty(t)&&r[t].magic===e)return r[t];return null},n.isRegExp=function(e){return"[object RegExp]"===Object.prototype.toString.call(e)}},{"./compressions":3,"./nodeBuffer":11,"./support":17}],22:[function(e,t,n){var i=e("./stringReader"),r=e("./nodeBufferReader"),o=e("./uint8ArrayReader"),a=e("./utils"),s=e("./signature"),l=e("./zipEntry"),d=e("./support"),u=e("./object");function c(e,t){this.files=[],this.loadOptions=t,e&&this.load(e)}c.prototype={checkSignature:function(e){var t=this.reader.readString(4);if(t!==e)throw new Error("Corrupted zip or bug : unexpected signature ("+a.pretty(t)+", expected "+a.pretty(e)+")")},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2),this.zipComment=this.reader.readString(this.zipCommentLength),this.zipComment=u.utf8decode(this.zipComment)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.versionMadeBy=this.reader.readString(2),this.versionNeeded=this.reader.readInt(2),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var e,t,n,i=this.zip64EndOfCentralSize-44,r=0;r<i;)e=this.reader.readInt(2),t=this.reader.readInt(4),n=this.reader.readString(t),this.zip64ExtensibleData[e]={id:e,length:t,value:n}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),this.disksCount>1)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var e,t;for(e=0;e<this.files.length;e++)t=this.files[e],this.reader.setIndex(t.localHeaderOffset),this.checkSignature(s.LOCAL_FILE_HEADER),t.readLocalPart(this.reader),t.handleUTF8()},readCentralDir:function(){var e;for(this.reader.setIndex(this.centralDirOffset);this.reader.readString(4)===s.CENTRAL_FILE_HEADER;)(e=new l({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(e)},readEndOfCentral:function(){var e=this.reader.lastIndexOfSignature(s.CENTRAL_DIRECTORY_END);if(-1===e)throw new Error("Corrupted zip : can't find end of central directory");if(this.reader.setIndex(e),this.checkSignature(s.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===a.MAX_VALUE_16BITS||this.diskWithCentralDirStart===a.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===a.MAX_VALUE_16BITS||this.centralDirRecords===a.MAX_VALUE_16BITS||this.centralDirSize===a.MAX_VALUE_32BITS||this.centralDirOffset===a.MAX_VALUE_32BITS){if(this.zip64=!0,-1===(e=this.reader.lastIndexOfSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR)))throw new Error("Corrupted zip : can't find the ZIP64 end of central directory locator");this.reader.setIndex(e),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(s.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}},prepareReader:function(e){var t=a.getTypeOf(e);"string"!==t||d.uint8array?this.reader="nodebuffer"===t?new r(e):new o(a.transformTo("uint8array",e)):this.reader=new i(e,this.loadOptions.optimizedBinaryString)},load:function(e){this.prepareReader(e),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},t.exports=c},{"./nodeBufferReader":12,"./object":13,"./signature":14,"./stringReader":15,"./support":17,"./uint8ArrayReader":18,"./utils":21,"./zipEntry":23}],23:[function(e,t,n){var i=e("./stringReader"),r=e("./utils"),o=e("./compressedObject"),a=e("./object");function s(e,t){this.options=e,this.loadOptions=t}s.prototype={isEncrypted:function(){return 1==(1&this.bitFlag)},useUTF8:function(){return 2048==(2048&this.bitFlag)},prepareCompressedContent:function(e,t,n){return function(){var i=e.index;e.setIndex(t);var r=e.readData(n);return e.setIndex(i),r}},prepareContent:function(e,t,n,i,o){return function(){var e=r.transformTo(i.uncompressInputType,this.getCompressedContent()),t=i.uncompress(e);if(t.length!==o)throw new Error("Bug : uncompressed data size mismatch");return t}},readLocalPart:function(e){var t,n;if(e.skip(22),this.fileNameLength=e.readInt(2),n=e.readInt(2),this.fileName=e.readString(this.fileNameLength),e.skip(n),-1==this.compressedSize||-1==this.uncompressedSize)throw new Error("Bug or corrupted zip : didn't get enough informations from the central directory (compressedSize == -1 || uncompressedSize == -1)");if(null===(t=r.findCompression(this.compressionMethod)))throw new Error("Corrupted zip : compression "+r.pretty(this.compressionMethod)+" unknown (inner file : "+this.fileName+")");if(this.decompressed=new o,this.decompressed.compressedSize=this.compressedSize,this.decompressed.uncompressedSize=this.uncompressedSize,this.decompressed.crc32=this.crc32,this.decompressed.compressionMethod=this.compressionMethod,this.decompressed.getCompressedContent=this.prepareCompressedContent(e,e.index,this.compressedSize,t),this.decompressed.getContent=this.prepareContent(e,e.index,this.compressedSize,t,this.uncompressedSize),this.loadOptions.checkCRC32&&(this.decompressed=r.transformTo("string",this.decompressed.getContent()),a.crc32(this.decompressed)!==this.crc32))throw new Error("Corrupted zip : CRC32 mismatch")},readCentralPart:function(e){if(this.versionMadeBy=e.readString(2),this.versionNeeded=e.readInt(2),this.bitFlag=e.readInt(2),this.compressionMethod=e.readString(2),this.date=e.readDate(),this.crc32=e.readInt(4),this.compressedSize=e.readInt(4),this.uncompressedSize=e.readInt(4),this.fileNameLength=e.readInt(2),this.extraFieldsLength=e.readInt(2),this.fileCommentLength=e.readInt(2),this.diskNumberStart=e.readInt(2),this.internalFileAttributes=e.readInt(2),this.externalFileAttributes=e.readInt(4),this.localHeaderOffset=e.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");this.fileName=e.readString(this.fileNameLength),this.readExtraFields(e),this.parseZIP64ExtraField(e),this.fileComment=e.readString(this.fileCommentLength),this.dir=!!(16&this.externalFileAttributes)},parseZIP64ExtraField:function(e){if(this.extraFields[1]){var t=new i(this.extraFields[1].value);this.uncompressedSize===r.MAX_VALUE_32BITS&&(this.uncompressedSize=t.readInt(8)),this.compressedSize===r.MAX_VALUE_32BITS&&(this.compressedSize=t.readInt(8)),this.localHeaderOffset===r.MAX_VALUE_32BITS&&(this.localHeaderOffset=t.readInt(8)),this.diskNumberStart===r.MAX_VALUE_32BITS&&(this.diskNumberStart=t.readInt(4))}},readExtraFields:function(e){var t,n,i,r=e.index;for(this.extraFields=this.extraFields||{};e.index<r+this.extraFieldsLength;)t=e.readInt(2),n=e.readInt(2),i=e.readString(n),this.extraFields[t]={id:t,length:n,value:i}},handleUTF8:function(){if(this.useUTF8())this.fileName=a.utf8decode(this.fileName),this.fileComment=a.utf8decode(this.fileComment);else{var e=this.findExtraFieldUnicodePath();null!==e&&(this.fileName=e);var t=this.findExtraFieldUnicodeComment();null!==t&&(this.fileComment=t)}},findExtraFieldUnicodePath:function(){var e=this.extraFields[28789];if(e){var t=new i(e.value);return 1!==t.readInt(1)||a.crc32(this.fileName)!==t.readInt(4)?null:a.utf8decode(t.readString(e.length-5))}return null},findExtraFieldUnicodeComment:function(){var e=this.extraFields[25461];if(e){var t=new i(e.value);return 1!==t.readInt(1)||a.crc32(this.fileComment)!==t.readInt(4)?null:a.utf8decode(t.readString(e.length-5))}return null}},t.exports=s},{"./compressedObject":2,"./object":13,"./stringReader":15,"./utils":21}],24:[function(e,t,n){var i={};(0,e("./lib/utils/common").assign)(i,e("./lib/deflate"),e("./lib/inflate"),e("./lib/zlib/constants")),t.exports=i},{"./lib/deflate":25,"./lib/inflate":26,"./lib/utils/common":27,"./lib/zlib/constants":30}],25:[function(e,t,n){var i=e("./zlib/deflate.js"),r=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/messages"),s=e("./zlib/zstream"),l=0,d=4,u=0,c=1,h=-1,f=0,p=8,m=function(e){this.options=r.assign({level:h,method:p,chunkSize:16384,windowBits:15,memLevel:8,strategy:f,to:""},e||{});var t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new s,this.strm.avail_out=0;var n=i.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(n!==u)throw new Error(a[n]);t.header&&i.deflateSetHeader(this.strm,t.header)};function g(e,t){var n=new m(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function _(e,t){return(t=t||{}).raw=!0,g(e,t)}function v(e,t){return(t=t||{}).gzip=!0,g(e,t)}m.prototype.push=function(e,t){var n,a,s=this.strm,h=this.options.chunkSize;if(this.ended)return!1;a=t===~~t?t:!0===t?d:l,s.input="string"==typeof e?o.string2buf(e):e,s.next_in=0,s.avail_in=s.input.length;do{if(0===s.avail_out&&(s.output=new r.Buf8(h),s.next_out=0,s.avail_out=h),(n=i.deflate(s,a))!==c&&n!==u)return this.onEnd(n),this.ended=!0,!1;(0===s.avail_out||0===s.avail_in&&a===d)&&("string"===this.options.to?this.onData(o.buf2binstring(r.shrinkBuf(s.output,s.next_out))):this.onData(r.shrinkBuf(s.output,s.next_out)))}while((s.avail_in>0||0===s.avail_out)&&n!==c);return a!==d||(n=i.deflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===u)},m.prototype.onData=function(e){this.chunks.push(e)},m.prototype.onEnd=function(e){e===u&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Deflate=m,n.deflate=g,n.deflateRaw=_,n.gzip=v},{"./utils/common":27,"./utils/strings":28,"./zlib/deflate.js":32,"./zlib/messages":37,"./zlib/zstream":39}],26:[function(e,t,n){var i=e("./zlib/inflate.js"),r=e("./utils/common"),o=e("./utils/strings"),a=e("./zlib/constants"),s=e("./zlib/messages"),l=e("./zlib/zstream"),d=e("./zlib/gzheader"),u=function(e){this.options=r.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&0==(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new l,this.strm.avail_out=0;var n=i.inflateInit2(this.strm,t.windowBits);if(n!==a.Z_OK)throw new Error(s[n]);this.header=new d,i.inflateGetHeader(this.strm,this.header)};function c(e,t){var n=new u(t);if(n.push(e,!0),n.err)throw n.msg;return n.result}function h(e,t){return(t=t||{}).raw=!0,c(e,t)}u.prototype.push=function(e,t){var n,s,l,d,u,c=this.strm,h=this.options.chunkSize;if(this.ended)return!1;s=t===~~t?t:!0===t?a.Z_FINISH:a.Z_NO_FLUSH,c.input="string"==typeof e?o.binstring2buf(e):e,c.next_in=0,c.avail_in=c.input.length;do{if(0===c.avail_out&&(c.output=new r.Buf8(h),c.next_out=0,c.avail_out=h),(n=i.inflate(c,a.Z_NO_FLUSH))!==a.Z_STREAM_END&&n!==a.Z_OK)return this.onEnd(n),this.ended=!0,!1;c.next_out&&(0===c.avail_out||n===a.Z_STREAM_END||0===c.avail_in&&s===a.Z_FINISH)&&("string"===this.options.to?(l=o.utf8border(c.output,c.next_out),d=c.next_out-l,u=o.buf2string(c.output,l),c.next_out=d,c.avail_out=h-d,d&&r.arraySet(c.output,c.output,l,d,0),this.onData(u)):this.onData(r.shrinkBuf(c.output,c.next_out)))}while(c.avail_in>0&&n!==a.Z_STREAM_END);return n===a.Z_STREAM_END&&(s=a.Z_FINISH),s!==a.Z_FINISH||(n=i.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===a.Z_OK)},u.prototype.onData=function(e){this.chunks.push(e)},u.prototype.onEnd=function(e){e===a.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=r.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},n.Inflate=u,n.inflate=c,n.inflateRaw=h,n.ungzip=c},{"./utils/common":27,"./utils/strings":28,"./zlib/constants":30,"./zlib/gzheader":33,"./zlib/inflate.js":35,"./zlib/messages":37,"./zlib/zstream":39}],27:[function(e,t,n){var i="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;n.assign=function(e){for(var t=Array.prototype.slice.call(arguments,1);t.length;){var n=t.shift();if(n){if("object"!=typeof n)throw new TypeError(n+"must be non-object");for(var i in n)n.hasOwnProperty(i)&&(e[i]=n[i])}}return e},n.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var r={arraySet:function(e,t,n,i,r){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+i),r);else for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){var t,n,i,r,o,a;for(i=0,t=0,n=e.length;t<n;t++)i+=e[t].length;for(a=new Uint8Array(i),r=0,t=0,n=e.length;t<n;t++)o=e[t],a.set(o,r),r+=o.length;return a}},o={arraySet:function(e,t,n,i,r){for(var o=0;o<i;o++)e[r+o]=t[n+o]},flattenChunks:function(e){return[].concat.apply([],e)}};n.setTyped=function(e){e?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,o))},n.setTyped(i)},{}],28:[function(e,t,n){var i=e("./common"),r=!0,o=!0;try{String.fromCharCode.apply(null,[0])}catch(e){r=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){o=!1}for(var a=new i.Buf8(256),s=0;s<256;s++)a[s]=s>=252?6:s>=248?5:s>=240?4:s>=224?3:s>=192?2:1;function l(e,t){if(t<65537&&(e.subarray&&o||!e.subarray&&r))return String.fromCharCode.apply(null,i.shrinkBuf(e,t));for(var n="",a=0;a<t;a++)n+=String.fromCharCode(e[a]);return n}a[254]=a[254]=1,n.string2buf=function(e){var t,n,r,o,a,s=e.length,l=0;for(o=0;o<s;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),l+=n<128?1:n<2048?2:n<65536?3:4;for(t=new i.Buf8(l),a=0,o=0;a<l;o++)55296==(64512&(n=e.charCodeAt(o)))&&o+1<s&&56320==(64512&(r=e.charCodeAt(o+1)))&&(n=65536+(n-55296<<10)+(r-56320),o++),n<128?t[a++]=n:n<2048?(t[a++]=192|n>>>6,t[a++]=128|63&n):n<65536?(t[a++]=224|n>>>12,t[a++]=128|n>>>6&63,t[a++]=128|63&n):(t[a++]=240|n>>>18,t[a++]=128|n>>>12&63,t[a++]=128|n>>>6&63,t[a++]=128|63&n);return t},n.buf2binstring=function(e){return l(e,e.length)},n.binstring2buf=function(e){for(var t=new i.Buf8(e.length),n=0,r=t.length;n<r;n++)t[n]=e.charCodeAt(n);return t},n.buf2string=function(e,t){var n,i,r,o,s=t||e.length,d=new Array(2*s);for(i=0,n=0;n<s;)if((r=e[n++])<128)d[i++]=r;else if((o=a[r])>4)d[i++]=65533,n+=o-1;else{for(r&=2===o?31:3===o?15:7;o>1&&n<s;)r=r<<6|63&e[n++],o--;o>1?d[i++]=65533:r<65536?d[i++]=r:(r-=65536,d[i++]=55296|r>>10&1023,d[i++]=56320|1023&r)}return l(d,i)},n.utf8border=function(e,t){var n;for((t=t||e.length)>e.length&&(t=e.length),n=t-1;n>=0&&128==(192&e[n]);)n--;return n<0||0===n?t:n+a[e[n]]>t?n:t}},{"./common":27}],29:[function(e,t,n){function i(e,t,n,i){for(var r=65535&e|0,o=e>>>16&65535|0,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{o=o+(r=r+t[i++]|0)|0}while(--a);r%=65521,o%=65521}return r|o<<16|0}t.exports=i},{}],30:[function(e,t,n){t.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],31:[function(e,t,n){function i(){for(var e,t=[],n=0;n<256;n++){e=n;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}var r=i();function o(e,t,n,i){var o=r,a=i+n;e^=-1;for(var s=i;s<a;s++)e=e>>>8^o[255&(e^t[s])];return-1^e}t.exports=o},{}],32:[function(e,t,n){var i=e("../utils/common"),r=e("./trees"),o=e("./adler32"),a=e("./crc32"),s=e("./messages"),l=0,d=1,u=3,c=4,h=5,f=0,p=1,m=-2,g=-3,_=-5,v=-1,b=1,y=2,x=3,w=4,S=0,N=2,E=8,C=9,k=15,T=8,A=286,O=30,D=19,R=2*A+1,P=15,M=3,I=258,F=I+M+1,L=32,B=42,U=69,z=73,j=91,H=103,X=113,V=666,W=1,q=2,Y=3,Z=4,J=3;function K(e,t){return e.msg=s[t],t}function G(e){return(e<<1)-(e>4?9:0)}function $(e){for(var t=e.length;--t>=0;)e[t]=0}function Q(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(i.arraySet(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function ee(e,t){r._tr_flush_block(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Q(e.strm)}function te(e,t){e.pending_buf[e.pending++]=t}function ne(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function ie(e,t,n,r){var s=e.avail_in;return s>r&&(s=r),0===s?0:(e.avail_in-=s,i.arraySet(t,e.input,e.next_in,s,n),1===e.state.wrap?e.adler=o(e.adler,t,s,n):2===e.state.wrap&&(e.adler=a(e.adler,t,s,n)),e.next_in+=s,e.total_in+=s,s)}function re(e,t){var n,i,r=e.max_chain_length,o=e.strstart,a=e.prev_length,s=e.nice_match,l=e.strstart>e.w_size-F?e.strstart-(e.w_size-F):0,d=e.window,u=e.w_mask,c=e.prev,h=e.strstart+I,f=d[o+a-1],p=d[o+a];e.prev_length>=e.good_match&&(r>>=2),s>e.lookahead&&(s=e.lookahead);do{if(d[(n=t)+a]===p&&d[n+a-1]===f&&d[n]===d[o]&&d[++n]===d[o+1]){o+=2,n++;do{}while(d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&d[++o]===d[++n]&&o<h);if(i=I-(h-o),o=h-I,i>a){if(e.match_start=t,a=i,i>=s)break;f=d[o+a-1],p=d[o+a]}}}while((t=c[t&u])>l&&0!=--r);return a<=e.lookahead?a:e.lookahead}function oe(e){var t,n,r,o,a,s=e.w_size;do{if(o=e.window_size-e.lookahead-e.strstart,e.strstart>=s+(s-F)){i.arraySet(e.window,e.window,s,s,0),e.match_start-=s,e.strstart-=s,e.block_start-=s,t=n=e.hash_size;do{r=e.head[--t],e.head[t]=r>=s?r-s:0}while(--n);t=n=s;do{r=e.prev[--t],e.prev[t]=r>=s?r-s:0}while(--n);o+=s}if(0===e.strm.avail_in)break;if(n=ie(e.strm,e.window,e.strstart+e.lookahead,o),e.lookahead+=n,e.lookahead+e.insert>=M)for(a=e.strstart-e.insert,e.ins_h=e.window[a],e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[a+M-1])&e.hash_mask,e.prev[a&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=a,a++,e.insert--,!(e.lookahead+e.insert<M)););}while(e.lookahead<F&&0!==e.strm.avail_in)}function ae(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(oe(e),0===e.lookahead&&t===l)return W;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var i=e.block_start+n;if((0===e.strstart||e.strstart>=i)&&(e.lookahead=e.strstart-i,e.strstart=i,ee(e,!1),0===e.strm.avail_out))return W;if(e.strstart-e.block_start>=e.w_size-F&&(ee(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===c?(ee(e,!0),0===e.strm.avail_out?Y:Z):(e.strstart>e.block_start&&(ee(e,!1),e.strm.avail_out),W)}function se(e,t){for(var n,i;;){if(e.lookahead<F){if(oe(e),e.lookahead<F&&t===l)return W;if(0===e.lookahead)break}if(n=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-F&&(e.match_length=re(e,n)),e.match_length>=M)if(i=r._tr_tally(e,e.strstart-e.match_start,e.match_length-M),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=M){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else i=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(ee(e,!1),0===e.strm.avail_out))return W}return e.insert=e.strstart<M-1?e.strstart:M-1,t===c?(ee(e,!0),0===e.strm.avail_out?Y:Z):e.last_lit&&(ee(e,!1),0===e.strm.avail_out)?W:q}function le(e,t){for(var n,i,o;;){if(e.lookahead<F){if(oe(e),e.lookahead<F&&t===l)return W;if(0===e.lookahead)break}if(n=0,e.lookahead>=M&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=M-1,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-F&&(e.match_length=re(e,n),e.match_length<=5&&(e.strategy===b||e.match_length===M&&e.strstart-e.match_start>4096)&&(e.match_length=M-1)),e.prev_length>=M&&e.match_length<=e.prev_length){o=e.strstart+e.lookahead-M,i=r._tr_tally(e,e.strstart-1-e.prev_match,e.prev_length-M),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=o&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+M-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=M-1,e.strstart++,i&&(ee(e,!1),0===e.strm.avail_out))return W}else if(e.match_available){if((i=r._tr_tally(e,0,e.window[e.strstart-1]))&&ee(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return W}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=r._tr_tally(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<M-1?e.strstart:M-1,t===c?(ee(e,!0),0===e.strm.avail_out?Y:Z):e.last_lit&&(ee(e,!1),0===e.strm.avail_out)?W:q}function de(e,t){for(var n,i,o,a,s=e.window;;){if(e.lookahead<=I){if(oe(e),e.lookahead<=I&&t===l)return W;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=M&&e.strstart>0&&(i=s[o=e.strstart-1])===s[++o]&&i===s[++o]&&i===s[++o]){a=e.strstart+I;do{}while(i===s[++o]&&i===s[++o]&&i===s[++o]&&i===s[++o]&&i===s[++o]&&i===s[++o]&&i===s[++o]&&i===s[++o]&&o<a);e.match_length=I-(a-o),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=M?(n=r._tr_tally(e,1,e.match_length-M),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(ee(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===c?(ee(e,!0),0===e.strm.avail_out?Y:Z):e.last_lit&&(ee(e,!1),0===e.strm.avail_out)?W:q}function ue(e,t){for(var n;;){if(0===e.lookahead&&(oe(e),0===e.lookahead)){if(t===l)return W;break}if(e.match_length=0,n=r._tr_tally(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(ee(e,!1),0===e.strm.avail_out))return W}return e.insert=0,t===c?(ee(e,!0),0===e.strm.avail_out?Y:Z):e.last_lit&&(ee(e,!1),0===e.strm.avail_out)?W:q}var ce,he=function(e,t,n,i,r){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=i,this.func=r};function fe(e){e.window_size=2*e.w_size,$(e.head),e.max_lazy_match=ce[e.level].max_lazy,e.good_match=ce[e.level].good_length,e.nice_match=ce[e.level].nice_length,e.max_chain_length=ce[e.level].max_chain,e.strstart=0,e.block_start=0,e.lookahead=0,e.insert=0,e.match_length=e.prev_length=M-1,e.match_available=0,e.ins_h=0}function pe(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=E,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new i.Buf16(2*R),this.dyn_dtree=new i.Buf16(2*(2*O+1)),this.bl_tree=new i.Buf16(2*(2*D+1)),$(this.dyn_ltree),$(this.dyn_dtree),$(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new i.Buf16(P+1),this.heap=new i.Buf16(2*A+1),$(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new i.Buf16(2*A+1),$(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function me(e){var t;return e&&e.state?(e.total_in=e.total_out=0,e.data_type=N,(t=e.state).pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=t.wrap?B:X,e.adler=2===t.wrap?0:1,t.last_flush=l,r._tr_init(t),f):K(e,m)}function ge(e){var t=me(e);return t===f&&fe(e.state),t}function _e(e,t){return e&&e.state?2!==e.state.wrap?m:(e.state.gzhead=t,f):m}function ve(e,t,n,r,o,a){if(!e)return m;var s=1;if(t===v&&(t=6),r<0?(s=0,r=-r):r>15&&(s=2,r-=16),o<1||o>C||n!==E||r<8||r>15||t<0||t>9||a<0||a>w)return K(e,m);8===r&&(r=9);var l=new pe;return e.state=l,l.strm=e,l.wrap=s,l.gzhead=null,l.w_bits=r,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=o+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+M-1)/M),l.window=new i.Buf8(2*l.w_size),l.head=new i.Buf16(l.hash_size),l.prev=new i.Buf16(l.w_size),l.lit_bufsize=1<<o+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new i.Buf8(l.pending_buf_size),l.d_buf=l.lit_bufsize>>1,l.l_buf=3*l.lit_bufsize,l.level=t,l.strategy=a,l.method=n,ge(e)}function be(e,t){return ve(e,t,E,k,T,S)}function ye(e,t){var n,i,o,s;if(!e||!e.state||t>h||t<0)return e?K(e,m):m;if(i=e.state,!e.output||!e.input&&0!==e.avail_in||i.status===V&&t!==c)return K(e,0===e.avail_out?_:m);if(i.strm=e,n=i.last_flush,i.last_flush=t,i.status===B)if(2===i.wrap)e.adler=0,te(i,31),te(i,139),te(i,8),i.gzhead?(te(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),te(i,255&i.gzhead.time),te(i,i.gzhead.time>>8&255),te(i,i.gzhead.time>>16&255),te(i,i.gzhead.time>>24&255),te(i,9===i.level?2:i.strategy>=y||i.level<2?4:0),te(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(te(i,255&i.gzhead.extra.length),te(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=a(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=U):(te(i,0),te(i,0),te(i,0),te(i,0),te(i,0),te(i,9===i.level?2:i.strategy>=y||i.level<2?4:0),te(i,J),i.status=X);else{var g=E+(i.w_bits-8<<4)<<8;g|=(i.strategy>=y||i.level<2?0:i.level<6?1:6===i.level?2:3)<<6,0!==i.strstart&&(g|=L),g+=31-g%31,i.status=X,ne(i,g),0!==i.strstart&&(ne(i,e.adler>>>16),ne(i,65535&e.adler)),e.adler=1}if(i.status===U)if(i.gzhead.extra){for(o=i.pending;i.gzindex<(65535&i.gzhead.extra.length)&&(i.pending!==i.pending_buf_size||(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),Q(e),o=i.pending,i.pending!==i.pending_buf_size));)te(i,255&i.gzhead.extra[i.gzindex]),i.gzindex++;i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),i.gzindex===i.gzhead.extra.length&&(i.gzindex=0,i.status=z)}else i.status=z;if(i.status===z)if(i.gzhead.name){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),Q(e),o=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,te(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),0===s&&(i.gzindex=0,i.status=j)}else i.status=j;if(i.status===j)if(i.gzhead.comment){o=i.pending;do{if(i.pending===i.pending_buf_size&&(i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),Q(e),o=i.pending,i.pending===i.pending_buf_size)){s=1;break}s=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,te(i,s)}while(0!==s);i.gzhead.hcrc&&i.pending>o&&(e.adler=a(e.adler,i.pending_buf,i.pending-o,o)),0===s&&(i.status=H)}else i.status=H;if(i.status===H&&(i.gzhead.hcrc?(i.pending+2>i.pending_buf_size&&Q(e),i.pending+2<=i.pending_buf_size&&(te(i,255&e.adler),te(i,e.adler>>8&255),e.adler=0,i.status=X)):i.status=X),0!==i.pending){if(Q(e),0===e.avail_out)return i.last_flush=-1,f}else if(0===e.avail_in&&G(t)<=G(n)&&t!==c)return K(e,_);if(i.status===V&&0!==e.avail_in)return K(e,_);if(0!==e.avail_in||0!==i.lookahead||t!==l&&i.status!==V){var v=i.strategy===y?ue(i,t):i.strategy===x?de(i,t):ce[i.level].func(i,t);if(v!==Y&&v!==Z||(i.status=V),v===W||v===Y)return 0===e.avail_out&&(i.last_flush=-1),f;if(v===q&&(t===d?r._tr_align(i):t!==h&&(r._tr_stored_block(i,0,0,!1),t===u&&($(i.head),0===i.lookahead&&(i.strstart=0,i.block_start=0,i.insert=0))),Q(e),0===e.avail_out))return i.last_flush=-1,f}return t!==c?f:i.wrap<=0?p:(2===i.wrap?(te(i,255&e.adler),te(i,e.adler>>8&255),te(i,e.adler>>16&255),te(i,e.adler>>24&255),te(i,255&e.total_in),te(i,e.total_in>>8&255),te(i,e.total_in>>16&255),te(i,e.total_in>>24&255)):(ne(i,e.adler>>>16),ne(i,65535&e.adler)),Q(e),i.wrap>0&&(i.wrap=-i.wrap),0!==i.pending?f:p)}function xe(e){var t;return e&&e.state?(t=e.state.status)!==B&&t!==U&&t!==z&&t!==j&&t!==H&&t!==X&&t!==V?K(e,m):(e.state=null,t===X?K(e,g):f):m}ce=[new he(0,0,0,0,ae),new he(4,4,8,4,se),new he(4,5,16,8,se),new he(4,6,32,32,se),new he(4,4,16,16,le),new he(8,16,32,32,le),new he(8,16,128,128,le),new he(8,32,128,256,le),new he(32,128,258,1024,le),new he(32,258,258,4096,le)],n.deflateInit=be,n.deflateInit2=ve,n.deflateReset=ge,n.deflateResetKeep=me,n.deflateSetHeader=_e,n.deflate=ye,n.deflateEnd=xe,n.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./messages":37,"./trees":38}],33:[function(e,t,n){function i(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}t.exports=i},{}],34:[function(e,t,n){var i=30,r=12;t.exports=function(e,t){var n,o,a,s,l,d,u,c,h,f,p,m,g,_,v,b,y,x,w,S,N,E,C,k,T;n=e.state,o=e.next_in,k=e.input,a=o+(e.avail_in-5),s=e.next_out,T=e.output,l=s-(t-e.avail_out),d=s+(e.avail_out-257),u=n.dmax,c=n.wsize,h=n.whave,f=n.wnext,p=n.window,m=n.hold,g=n.bits,_=n.lencode,v=n.distcode,b=(1<<n.lenbits)-1,y=(1<<n.distbits)-1;e:do{g<15&&(m+=k[o++]<<g,g+=8,m+=k[o++]<<g,g+=8),x=_[m&b];t:for(;;){if(m>>>=w=x>>>24,g-=w,0==(w=x>>>16&255))T[s++]=65535&x;else{if(!(16&w)){if(0==(64&w)){x=_[(65535&x)+(m&(1<<w)-1)];continue t}if(32&w){n.mode=r;break e}e.msg="invalid literal/length code",n.mode=i;break e}S=65535&x,(w&=15)&&(g<w&&(m+=k[o++]<<g,g+=8),S+=m&(1<<w)-1,m>>>=w,g-=w),g<15&&(m+=k[o++]<<g,g+=8,m+=k[o++]<<g,g+=8),x=v[m&y];n:for(;;){if(m>>>=w=x>>>24,g-=w,!(16&(w=x>>>16&255))){if(0==(64&w)){x=v[(65535&x)+(m&(1<<w)-1)];continue n}e.msg="invalid distance code",n.mode=i;break e}if(N=65535&x,g<(w&=15)&&(m+=k[o++]<<g,(g+=8)<w&&(m+=k[o++]<<g,g+=8)),(N+=m&(1<<w)-1)>u){e.msg="invalid distance too far back",n.mode=i;break e}if(m>>>=w,g-=w,N>(w=s-l)){if((w=N-w)>h&&n.sane){e.msg="invalid distance too far back",n.mode=i;break e}if(E=0,C=p,0===f){if(E+=c-w,w<S){S-=w;do{T[s++]=p[E++]}while(--w);E=s-N,C=T}}else if(f<w){if(E+=c+f-w,(w-=f)<S){S-=w;do{T[s++]=p[E++]}while(--w);if(E=0,f<S){S-=w=f;do{T[s++]=p[E++]}while(--w);E=s-N,C=T}}}else if(E+=f-w,w<S){S-=w;do{T[s++]=p[E++]}while(--w);E=s-N,C=T}for(;S>2;)T[s++]=C[E++],T[s++]=C[E++],T[s++]=C[E++],S-=3;S&&(T[s++]=C[E++],S>1&&(T[s++]=C[E++]))}else{E=s-N;do{T[s++]=T[E++],T[s++]=T[E++],T[s++]=T[E++],S-=3}while(S>2);S&&(T[s++]=T[E++],S>1&&(T[s++]=T[E++]))}break}}break}}while(o<a&&s<d);o-=S=g>>3,m&=(1<<(g-=S<<3))-1,e.next_in=o,e.next_out=s,e.avail_in=o<a?a-o+5:5-(o-a),e.avail_out=s<d?d-s+257:257-(s-d),n.hold=m,n.bits=g}},{}],35:[function(e,t,n){var i=e("../utils/common"),r=e("./adler32"),o=e("./crc32"),a=e("./inffast"),s=e("./inftrees"),l=0,d=1,u=2,c=4,h=5,f=6,p=0,m=1,g=2,_=-2,v=-3,b=-4,y=-5,x=8,w=1,S=2,N=3,E=4,C=5,k=6,T=7,A=8,O=9,D=10,R=11,P=12,M=13,I=14,F=15,L=16,B=17,U=18,z=19,j=20,H=21,X=22,V=23,W=24,q=25,Y=26,Z=27,J=28,K=29,G=30,$=31,Q=852,ee=592,te=15;function ne(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ie(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new i.Buf16(320),this.work=new i.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function re(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=w,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new i.Buf32(Q),t.distcode=t.distdyn=new i.Buf32(ee),t.sane=1,t.back=-1,p):_}function oe(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,re(e)):_}function ae(e,t){var n,i;return e&&e.state?(i=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?_:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=n,i.wbits=t,oe(e))):_}function se(e,t){var n,i;return e?(i=new ie,e.state=i,i.window=null,(n=ae(e,t))!==p&&(e.state=null),n):_}function le(e){return se(e,te)}var de,ue,ce=!0;function he(e){if(ce){var t;for(de=new i.Buf32(512),ue=new i.Buf32(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(s(d,e.lens,0,288,de,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;s(u,e.lens,0,32,ue,0,e.work,{bits:5}),ce=!1}e.lencode=de,e.lenbits=9,e.distcode=ue,e.distbits=5}function fe(e,t,n,r){var o,a=e.state;return null===a.window&&(a.wsize=1<<a.wbits,a.wnext=0,a.whave=0,a.window=new i.Buf8(a.wsize)),r>=a.wsize?(i.arraySet(a.window,t,n-a.wsize,a.wsize,0),a.wnext=0,a.whave=a.wsize):((o=a.wsize-a.wnext)>r&&(o=r),i.arraySet(a.window,t,n-r,o,a.wnext),(r-=o)?(i.arraySet(a.window,t,n-r,r,0),a.wnext=r,a.whave=a.wsize):(a.wnext+=o,a.wnext===a.wsize&&(a.wnext=0),a.whave<a.wsize&&(a.whave+=o))),0}function pe(e,t){var n,Q,ee,te,ie,re,oe,ae,se,le,de,ue,ce,pe,me,ge,_e,ve,be,ye,xe,we,Se,Ne,Ee=0,Ce=new i.Buf8(4),ke=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return _;(n=e.state).mode===P&&(n.mode=M),ie=e.next_out,ee=e.output,oe=e.avail_out,te=e.next_in,Q=e.input,re=e.avail_in,ae=n.hold,se=n.bits,le=re,de=oe,we=p;e:for(;;)switch(n.mode){case w:if(0===n.wrap){n.mode=M;break}for(;se<16;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}if(2&n.wrap&&35615===ae){n.check=0,Ce[0]=255&ae,Ce[1]=ae>>>8&255,n.check=o(n.check,Ce,2,0),ae=0,se=0,n.mode=S;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&ae)<<8)+(ae>>8))%31){e.msg="incorrect header check",n.mode=G;break}if((15&ae)!==x){e.msg="unknown compression method",n.mode=G;break}if(se-=4,xe=8+(15&(ae>>>=4)),0===n.wbits)n.wbits=xe;else if(xe>n.wbits){e.msg="invalid window size",n.mode=G;break}n.dmax=1<<xe,e.adler=n.check=1,n.mode=512&ae?D:P,ae=0,se=0;break;case S:for(;se<16;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}if(n.flags=ae,(255&n.flags)!==x){e.msg="unknown compression method",n.mode=G;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=G;break}n.head&&(n.head.text=ae>>8&1),512&n.flags&&(Ce[0]=255&ae,Ce[1]=ae>>>8&255,n.check=o(n.check,Ce,2,0)),ae=0,se=0,n.mode=N;case N:for(;se<32;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}n.head&&(n.head.time=ae),512&n.flags&&(Ce[0]=255&ae,Ce[1]=ae>>>8&255,Ce[2]=ae>>>16&255,Ce[3]=ae>>>24&255,n.check=o(n.check,Ce,4,0)),ae=0,se=0,n.mode=E;case E:for(;se<16;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}n.head&&(n.head.xflags=255&ae,n.head.os=ae>>8),512&n.flags&&(Ce[0]=255&ae,Ce[1]=ae>>>8&255,n.check=o(n.check,Ce,2,0)),ae=0,se=0,n.mode=C;case C:if(1024&n.flags){for(;se<16;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}n.length=ae,n.head&&(n.head.extra_len=ae),512&n.flags&&(Ce[0]=255&ae,Ce[1]=ae>>>8&255,n.check=o(n.check,Ce,2,0)),ae=0,se=0}else n.head&&(n.head.extra=null);n.mode=k;case k:if(1024&n.flags&&((ue=n.length)>re&&(ue=re),ue&&(n.head&&(xe=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),i.arraySet(n.head.extra,Q,te,ue,xe)),512&n.flags&&(n.check=o(n.check,Q,ue,te)),re-=ue,te+=ue,n.length-=ue),n.length))break e;n.length=0,n.mode=T;case T:if(2048&n.flags){if(0===re)break e;ue=0;do{xe=Q[te+ue++],n.head&&xe&&n.length<65536&&(n.head.name+=String.fromCharCode(xe))}while(xe&&ue<re);if(512&n.flags&&(n.check=o(n.check,Q,ue,te)),re-=ue,te+=ue,xe)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=A;case A:if(4096&n.flags){if(0===re)break e;ue=0;do{xe=Q[te+ue++],n.head&&xe&&n.length<65536&&(n.head.comment+=String.fromCharCode(xe))}while(xe&&ue<re);if(512&n.flags&&(n.check=o(n.check,Q,ue,te)),re-=ue,te+=ue,xe)break e}else n.head&&(n.head.comment=null);n.mode=O;case O:if(512&n.flags){for(;se<16;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}if(ae!==(65535&n.check)){e.msg="header crc mismatch",n.mode=G;break}ae=0,se=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=P;break;case D:for(;se<32;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}e.adler=n.check=ne(ae),ae=0,se=0,n.mode=R;case R:if(0===n.havedict)return e.next_out=ie,e.avail_out=oe,e.next_in=te,e.avail_in=re,n.hold=ae,n.bits=se,g;e.adler=n.check=1,n.mode=P;case P:if(t===h||t===f)break e;case M:if(n.last){ae>>>=7&se,se-=7&se,n.mode=Z;break}for(;se<3;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}switch(n.last=1&ae,se-=1,3&(ae>>>=1)){case 0:n.mode=I;break;case 1:if(he(n),n.mode=j,t===f){ae>>>=2,se-=2;break e}break;case 2:n.mode=B;break;case 3:e.msg="invalid block type",n.mode=G}ae>>>=2,se-=2;break;case I:for(ae>>>=7&se,se-=7&se;se<32;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}if((65535&ae)!=(ae>>>16^65535)){e.msg="invalid stored block lengths",n.mode=G;break}if(n.length=65535&ae,ae=0,se=0,n.mode=F,t===f)break e;case F:n.mode=L;case L:if(ue=n.length){if(ue>re&&(ue=re),ue>oe&&(ue=oe),0===ue)break e;i.arraySet(ee,Q,te,ue,ie),re-=ue,te+=ue,oe-=ue,ie+=ue,n.length-=ue;break}n.mode=P;break;case B:for(;se<14;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}if(n.nlen=257+(31&ae),ae>>>=5,se-=5,n.ndist=1+(31&ae),ae>>>=5,se-=5,n.ncode=4+(15&ae),ae>>>=4,se-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=G;break}n.have=0,n.mode=U;case U:for(;n.have<n.ncode;){for(;se<3;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}n.lens[ke[n.have++]]=7&ae,ae>>>=3,se-=3}for(;n.have<19;)n.lens[ke[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,Se={bits:n.lenbits},we=s(l,n.lens,0,19,n.lencode,0,n.work,Se),n.lenbits=Se.bits,we){e.msg="invalid code lengths set",n.mode=G;break}n.have=0,n.mode=z;case z:for(;n.have<n.nlen+n.ndist;){for(;ge=(Ee=n.lencode[ae&(1<<n.lenbits)-1])>>>16&255,_e=65535&Ee,!((me=Ee>>>24)<=se);){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}if(_e<16)ae>>>=me,se-=me,n.lens[n.have++]=_e;else{if(16===_e){for(Ne=me+2;se<Ne;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}if(ae>>>=me,se-=me,0===n.have){e.msg="invalid bit length repeat",n.mode=G;break}xe=n.lens[n.have-1],ue=3+(3&ae),ae>>>=2,se-=2}else if(17===_e){for(Ne=me+3;se<Ne;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}se-=me,xe=0,ue=3+(7&(ae>>>=me)),ae>>>=3,se-=3}else{for(Ne=me+7;se<Ne;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}se-=me,xe=0,ue=11+(127&(ae>>>=me)),ae>>>=7,se-=7}if(n.have+ue>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=G;break}for(;ue--;)n.lens[n.have++]=xe}}if(n.mode===G)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=G;break}if(n.lenbits=9,Se={bits:n.lenbits},we=s(d,n.lens,0,n.nlen,n.lencode,0,n.work,Se),n.lenbits=Se.bits,we){e.msg="invalid literal/lengths set",n.mode=G;break}if(n.distbits=6,n.distcode=n.distdyn,Se={bits:n.distbits},we=s(u,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,Se),n.distbits=Se.bits,we){e.msg="invalid distances set",n.mode=G;break}if(n.mode=j,t===f)break e;case j:n.mode=H;case H:if(re>=6&&oe>=258){e.next_out=ie,e.avail_out=oe,e.next_in=te,e.avail_in=re,n.hold=ae,n.bits=se,a(e,de),ie=e.next_out,ee=e.output,oe=e.avail_out,te=e.next_in,Q=e.input,re=e.avail_in,ae=n.hold,se=n.bits,n.mode===P&&(n.back=-1);break}for(n.back=0;ge=(Ee=n.lencode[ae&(1<<n.lenbits)-1])>>>16&255,_e=65535&Ee,!((me=Ee>>>24)<=se);){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}if(ge&&0==(240&ge)){for(ve=me,be=ge,ye=_e;ge=(Ee=n.lencode[ye+((ae&(1<<ve+be)-1)>>ve)])>>>16&255,_e=65535&Ee,!(ve+(me=Ee>>>24)<=se);){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}ae>>>=ve,se-=ve,n.back+=ve}if(ae>>>=me,se-=me,n.back+=me,n.length=_e,0===ge){n.mode=Y;break}if(32&ge){n.back=-1,n.mode=P;break}if(64&ge){e.msg="invalid literal/length code",n.mode=G;break}n.extra=15&ge,n.mode=X;case X:if(n.extra){for(Ne=n.extra;se<Ne;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}n.length+=ae&(1<<n.extra)-1,ae>>>=n.extra,se-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=V;case V:for(;ge=(Ee=n.distcode[ae&(1<<n.distbits)-1])>>>16&255,_e=65535&Ee,!((me=Ee>>>24)<=se);){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}if(0==(240&ge)){for(ve=me,be=ge,ye=_e;ge=(Ee=n.distcode[ye+((ae&(1<<ve+be)-1)>>ve)])>>>16&255,_e=65535&Ee,!(ve+(me=Ee>>>24)<=se);){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}ae>>>=ve,se-=ve,n.back+=ve}if(ae>>>=me,se-=me,n.back+=me,64&ge){e.msg="invalid distance code",n.mode=G;break}n.offset=_e,n.extra=15&ge,n.mode=W;case W:if(n.extra){for(Ne=n.extra;se<Ne;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}n.offset+=ae&(1<<n.extra)-1,ae>>>=n.extra,se-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=G;break}n.mode=q;case q:if(0===oe)break e;if(ue=de-oe,n.offset>ue){if((ue=n.offset-ue)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=G;break}ue>n.wnext?(ue-=n.wnext,ce=n.wsize-ue):ce=n.wnext-ue,ue>n.length&&(ue=n.length),pe=n.window}else pe=ee,ce=ie-n.offset,ue=n.length;ue>oe&&(ue=oe),oe-=ue,n.length-=ue;do{ee[ie++]=pe[ce++]}while(--ue);0===n.length&&(n.mode=H);break;case Y:if(0===oe)break e;ee[ie++]=n.length,oe--,n.mode=H;break;case Z:if(n.wrap){for(;se<32;){if(0===re)break e;re--,ae|=Q[te++]<<se,se+=8}if(de-=oe,e.total_out+=de,n.total+=de,de&&(e.adler=n.check=n.flags?o(n.check,ee,de,ie-de):r(n.check,ee,de,ie-de)),de=oe,(n.flags?ae:ne(ae))!==n.check){e.msg="incorrect data check",n.mode=G;break}ae=0,se=0}n.mode=J;case J:if(n.wrap&&n.flags){for(;se<32;){if(0===re)break e;re--,ae+=Q[te++]<<se,se+=8}if(ae!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=G;break}ae=0,se=0}n.mode=K;case K:we=m;break e;case G:we=v;break e;case $:return b;default:return _}return e.next_out=ie,e.avail_out=oe,e.next_in=te,e.avail_in=re,n.hold=ae,n.bits=se,(n.wsize||de!==e.avail_out&&n.mode<G&&(n.mode<Z||t!==c))&&fe(e,e.output,e.next_out,de-e.avail_out)?(n.mode=$,b):(le-=e.avail_in,de-=e.avail_out,e.total_in+=le,e.total_out+=de,n.total+=de,n.wrap&&de&&(e.adler=n.check=n.flags?o(n.check,ee,de,e.next_out-de):r(n.check,ee,de,e.next_out-de)),e.data_type=n.bits+(n.last?64:0)+(n.mode===P?128:0)+(n.mode===j||n.mode===F?256:0),(0===le&&0===de||t===c)&&we===p&&(we=y),we)}function me(e){if(!e||!e.state)return _;var t=e.state;return t.window&&(t.window=null),e.state=null,p}function ge(e,t){var n;return e&&e.state?0==(2&(n=e.state).wrap)?_:(n.head=t,t.done=!1,p):_}n.inflateReset=oe,n.inflateReset2=ae,n.inflateResetKeep=re,n.inflateInit=le,n.inflateInit2=se,n.inflate=pe,n.inflateEnd=me,n.inflateGetHeader=ge,n.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":27,"./adler32":29,"./crc32":31,"./inffast":34,"./inftrees":36}],36:[function(e,t,n){var i=e("../utils/common"),r=15,o=852,a=592,s=0,l=1,d=2,u=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],f=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];t.exports=function(e,t,n,p,m,g,_,v){var b,y,x,w,S,N,E,C,k,T=v.bits,A=0,O=0,D=0,R=0,P=0,M=0,I=0,F=0,L=0,B=0,U=null,z=0,j=new i.Buf16(r+1),H=new i.Buf16(r+1),X=null,V=0;for(A=0;A<=r;A++)j[A]=0;for(O=0;O<p;O++)j[t[n+O]]++;for(P=T,R=r;R>=1&&0===j[R];R--);if(P>R&&(P=R),0===R)return m[g++]=20971520,m[g++]=20971520,v.bits=1,0;for(D=1;D<R&&0===j[D];D++);for(P<D&&(P=D),F=1,A=1;A<=r;A++)if(F<<=1,(F-=j[A])<0)return-1;if(F>0&&(e===s||1!==R))return-1;for(H[1]=0,A=1;A<r;A++)H[A+1]=H[A]+j[A];for(O=0;O<p;O++)0!==t[n+O]&&(_[H[t[n+O]]++]=O);if(e===s?(U=X=_,N=19):e===l?(U=u,z-=257,X=c,V-=257,N=256):(U=h,X=f,N=-1),B=0,O=0,A=D,S=g,M=P,I=0,x=-1,w=(L=1<<P)-1,e===l&&L>o||e===d&&L>a)return 1;for(;;){E=A-I,_[O]<N?(C=0,k=_[O]):_[O]>N?(C=X[V+_[O]],k=U[z+_[O]]):(C=96,k=0),b=1<<A-I,D=y=1<<M;do{m[S+(B>>I)+(y-=b)]=E<<24|C<<16|k|0}while(0!==y);for(b=1<<A-1;B&b;)b>>=1;if(0!==b?(B&=b-1,B+=b):B=0,O++,0==--j[A]){if(A===R)break;A=t[n+_[O]]}if(A>P&&(B&w)!==x){for(0===I&&(I=P),S+=D,F=1<<(M=A-I);M+I<R&&!((F-=j[M+I])<=0);)M++,F<<=1;if(L+=1<<M,e===l&&L>o||e===d&&L>a)return 1;m[x=B&w]=P<<24|M<<16|S-g|0}}return 0!==B&&(m[S+B]=A-I<<24|64<<16|0),v.bits=P,0}},{"../utils/common":27}],37:[function(e,t,n){t.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],38:[function(e,t,n){var i=e("../utils/common"),r=4,o=0,a=1,s=2;function l(e){for(var t=e.length;--t>=0;)e[t]=0}var d=0,u=1,c=2,h=3,f=258,p=29,m=256,g=m+1+p,_=30,v=19,b=2*g+1,y=15,x=16,w=7,S=256,N=16,E=17,C=18,k=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],T=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],A=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],O=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],D=512,R=new Array(2*(g+2));l(R);var P=new Array(2*_);l(P);var M=new Array(D);l(M);var I=new Array(f-h+1);l(I);var F=new Array(p);l(F);var L=new Array(_);l(L);var B,U,z,j=function(e,t,n,i,r){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=i,this.max_length=r,this.has_stree=e&&e.length},H=function(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t};function X(e){return e<256?M[e]:M[256+(e>>>7)]}function V(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function W(e,t,n){e.bi_valid>x-n?(e.bi_buf|=t<<e.bi_valid&65535,V(e,e.bi_buf),e.bi_buf=t>>x-e.bi_valid,e.bi_valid+=n-x):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function q(e,t,n){W(e,n[2*t],n[2*t+1])}function Y(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function Z(e){16===e.bi_valid?(V(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)}function J(e,t){var n,i,r,o,a,s,l=t.dyn_tree,d=t.max_code,u=t.stat_desc.static_tree,c=t.stat_desc.has_stree,h=t.stat_desc.extra_bits,f=t.stat_desc.extra_base,p=t.stat_desc.max_length,m=0;for(o=0;o<=y;o++)e.bl_count[o]=0;for(l[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<b;n++)(o=l[2*l[2*(i=e.heap[n])+1]+1]+1)>p&&(o=p,m++),l[2*i+1]=o,i>d||(e.bl_count[o]++,a=0,i>=f&&(a=h[i-f]),s=l[2*i],e.opt_len+=s*(o+a),c&&(e.static_len+=s*(u[2*i+1]+a)));if(0!==m){do{for(o=p-1;0===e.bl_count[o];)o--;e.bl_count[o]--,e.bl_count[o+1]+=2,e.bl_count[p]--,m-=2}while(m>0);for(o=p;0!==o;o--)for(i=e.bl_count[o];0!==i;)(r=e.heap[--n])>d||(l[2*r+1]!==o&&(e.opt_len+=(o-l[2*r+1])*l[2*r],l[2*r+1]=o),i--)}}function K(e,t,n){var i,r,o=new Array(y+1),a=0;for(i=1;i<=y;i++)o[i]=a=a+n[i-1]<<1;for(r=0;r<=t;r++){var s=e[2*r+1];0!==s&&(e[2*r]=Y(o[s]++,s))}}function G(){var e,t,n,i,r,o=new Array(y+1);for(n=0,i=0;i<p-1;i++)for(F[i]=n,e=0;e<1<<k[i];e++)I[n++]=i;for(I[n-1]=i,r=0,i=0;i<16;i++)for(L[i]=r,e=0;e<1<<T[i];e++)M[r++]=i;for(r>>=7;i<_;i++)for(L[i]=r<<7,e=0;e<1<<T[i]-7;e++)M[256+r++]=i;for(t=0;t<=y;t++)o[t]=0;for(e=0;e<=143;)R[2*e+1]=8,e++,o[8]++;for(;e<=255;)R[2*e+1]=9,e++,o[9]++;for(;e<=279;)R[2*e+1]=7,e++,o[7]++;for(;e<=287;)R[2*e+1]=8,e++,o[8]++;for(K(R,g+1,o),e=0;e<_;e++)P[2*e+1]=5,P[2*e]=Y(e,5);B=new j(R,k,m+1,g,y),U=new j(P,T,0,_,y),z=new j(new Array(0),A,0,v,w)}function $(e){var t;for(t=0;t<g;t++)e.dyn_ltree[2*t]=0;for(t=0;t<_;t++)e.dyn_dtree[2*t]=0;for(t=0;t<v;t++)e.bl_tree[2*t]=0;e.dyn_ltree[2*S]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function Q(e){e.bi_valid>8?V(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function ee(e,t,n,r){Q(e),r&&(V(e,n),V(e,~n)),i.arraySet(e.pending_buf,e.window,t,n,e.pending),e.pending+=n}function te(e,t,n,i){var r=2*t,o=2*n;return e[r]<e[o]||e[r]===e[o]&&i[t]<=i[n]}function ne(e,t,n){for(var i=e.heap[n],r=n<<1;r<=e.heap_len&&(r<e.heap_len&&te(t,e.heap[r+1],e.heap[r],e.depth)&&r++,!te(t,i,e.heap[r],e.depth));)e.heap[n]=e.heap[r],n=r,r<<=1;e.heap[n]=i}function ie(e,t,n){var i,r,o,a,s=0;if(0!==e.last_lit)do{i=e.pending_buf[e.d_buf+2*s]<<8|e.pending_buf[e.d_buf+2*s+1],r=e.pending_buf[e.l_buf+s],s++,0===i?q(e,r,t):(q(e,(o=I[r])+m+1,t),0!==(a=k[o])&&W(e,r-=F[o],a),q(e,o=X(--i),n),0!==(a=T[o])&&W(e,i-=L[o],a))}while(s<e.last_lit);q(e,S,t)}function re(e,t){var n,i,r,o=t.dyn_tree,a=t.stat_desc.static_tree,s=t.stat_desc.has_stree,l=t.stat_desc.elems,d=-1;for(e.heap_len=0,e.heap_max=b,n=0;n<l;n++)0!==o[2*n]?(e.heap[++e.heap_len]=d=n,e.depth[n]=0):o[2*n+1]=0;for(;e.heap_len<2;)o[2*(r=e.heap[++e.heap_len]=d<2?++d:0)]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=a[2*r+1]);for(t.max_code=d,n=e.heap_len>>1;n>=1;n--)ne(e,o,n);r=l;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ne(e,o,1),i=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=i,o[2*r]=o[2*n]+o[2*i],e.depth[r]=(e.depth[n]>=e.depth[i]?e.depth[n]:e.depth[i])+1,o[2*n+1]=o[2*i+1]=r,e.heap[1]=r++,ne(e,o,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],J(e,t),K(o,d,e.bl_count)}function oe(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,d=4;for(0===a&&(l=138,d=3),t[2*(n+1)+1]=65535,i=0;i<=n;i++)r=a,a=t[2*(i+1)+1],++s<l&&r===a||(s<d?e.bl_tree[2*r]+=s:0!==r?(r!==o&&e.bl_tree[2*r]++,e.bl_tree[2*N]++):s<=10?e.bl_tree[2*E]++:e.bl_tree[2*C]++,s=0,o=r,0===a?(l=138,d=3):r===a?(l=6,d=3):(l=7,d=4))}function ae(e,t,n){var i,r,o=-1,a=t[1],s=0,l=7,d=4;for(0===a&&(l=138,d=3),i=0;i<=n;i++)if(r=a,a=t[2*(i+1)+1],!(++s<l&&r===a)){if(s<d)do{q(e,r,e.bl_tree)}while(0!=--s);else 0!==r?(r!==o&&(q(e,r,e.bl_tree),s--),q(e,N,e.bl_tree),W(e,s-3,2)):s<=10?(q(e,E,e.bl_tree),W(e,s-3,3)):(q(e,C,e.bl_tree),W(e,s-11,7));s=0,o=r,0===a?(l=138,d=3):r===a?(l=6,d=3):(l=7,d=4)}}function se(e){var t;for(oe(e,e.dyn_ltree,e.l_desc.max_code),oe(e,e.dyn_dtree,e.d_desc.max_code),re(e,e.bl_desc),t=v-1;t>=3&&0===e.bl_tree[2*O[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}function le(e,t,n,i){var r;for(W(e,t-257,5),W(e,n-1,5),W(e,i-4,4),r=0;r<i;r++)W(e,e.bl_tree[2*O[r]+1],3);ae(e,e.dyn_ltree,t-1),ae(e,e.dyn_dtree,n-1)}function de(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return o;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return a;for(t=32;t<m;t++)if(0!==e.dyn_ltree[2*t])return a;return o}var ue=!1;function ce(e){ue||(G(),ue=!0),e.l_desc=new H(e.dyn_ltree,B),e.d_desc=new H(e.dyn_dtree,U),e.bl_desc=new H(e.bl_tree,z),e.bi_buf=0,e.bi_valid=0,$(e)}function he(e,t,n,i){W(e,(d<<1)+(i?1:0),3),ee(e,t,n,!0)}function fe(e){W(e,u<<1,3),q(e,S,R),Z(e)}function pe(e,t,n,i){var o,a,l=0;e.level>0?(e.strm.data_type===s&&(e.strm.data_type=de(e)),re(e,e.l_desc),re(e,e.d_desc),l=se(e),o=e.opt_len+3+7>>>3,(a=e.static_len+3+7>>>3)<=o&&(o=a)):o=a=n+5,n+4<=o&&-1!==t?he(e,t,n,i):e.strategy===r||a===o?(W(e,(u<<1)+(i?1:0),3),ie(e,R,P)):(W(e,(c<<1)+(i?1:0),3),le(e,e.l_desc.max_code+1,e.d_desc.max_code+1,l+1),ie(e,e.dyn_ltree,e.dyn_dtree)),$(e),i&&Q(e)}function me(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(I[n]+m+1)]++,e.dyn_dtree[2*X(t)]++),e.last_lit===e.lit_bufsize-1}n._tr_init=ce,n._tr_stored_block=he,n._tr_flush_block=pe,n._tr_tally=me,n._tr_align=fe},{"../utils/common":27}],39:[function(e,t,n){function i(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}t.exports=i},{}]},{},[9])(9)}();